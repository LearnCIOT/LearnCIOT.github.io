<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>

<meta property="og:title" content="4.1. Time Series Data Processing"/>
<meta property="og:description" content="We use the sensing data of Civil IoT Taiwan Data Service Platform to guide readers to understand the use of moving average, perform periodic analysis of time series data, and then disassemble the time series data into long-term trends, seasonal changes and residual fluctuations. At the same time, we apply the existing Python language suites to perform change point detection and outlier detection to check the existing Civil IoT Taiwan data, and discuss potential implications of such values detected."/>
<meta property="og:image" content="https://learnciot.github.io/images/thumbnail.jpg"/>
<meta property="og:url" content="/en/ch4/ch4.1/"/>
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="627" />
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.104.3">
    <meta name="generator" content="Relearn 5.3.3+tip">
    <meta name="description" content="We use the sensing data of Civil IoT Taiwan Data Service Platform to guide readers to understand the use of moving average, perform periodic analysis of time series data, and then disassemble the time series data into long-term trends, seasonal changes and residual fluctuations. At the same time, we apply the existing Python language suites to perform change point detection and outlier detection to check the existing Civil IoT Taiwan data, and discuss potential implications of such values detected.">
    <meta name="author" content="Ling-Jyh Chen">
    <title>4.1. Time Series Data Processing :: Tutorial for CIoT Open Data Applications</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1701306708" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1701306708" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1701306708" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1701306708" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1701306708" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1701306708" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1701306708" rel="stylesheet">
    <link href="/css/nucleus.css?1701306708" rel="stylesheet">
    <link href="/css/fonts.css?1701306708" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1701306708" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1701306708" rel="stylesheet">
    <link href="/css/theme-relearn-light.css?1701306708" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1701306708" rel="stylesheet">
    <link href="/css/variant.css?1701306708" rel="stylesheet">
    <link href="/css/print.css?1701306708" rel="stylesheet" media="print">
    <script src="/js/variant.js?1701306708"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="/en/index.json";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/LearnCIOT.github.io/';
      window.variants && variants.init( [ 'relearn-light' ] );
    </script>
    <script src="/js/jquery.min.js?1701306708" defer></script>
<meta property="fb:app_id" content="601826851395774" />
  </head>
  <body class="default-animation" data-url="/en/ch4/ch4.1/">




<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v14.0" nonce="hWjBXHAv"></script>

    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div class="navigation">
             <a class="nav nav-next" href="/en/ch4/ch4.2/" title="4.2. Time Series Data Forecast"><i class="fas fa-chevron-right fa-fw"></i></a>
          </div>
          <div class="navigation">
             <a class="nav nav-prev" href="/en/ch4/" title="4. Time Series Data Analysis"><i class="fas fa-chevron-left fa-fw"></i></a>
          </div>
          <div id="top-github-link">
            <a class="github-link" title='Edit' href="https://github.com/LearnCIOT/LearnCIOT.github.io/tree/main/content/ch4/ch4.1/index.en.md" target="blank">
              <i class="fas fa-pen fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='Menu'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title='Table of Contents'><i class="fas fa-list-alt fa-fw"></i></span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <meta itemprop="itemListOrder" content="Descending" />
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="3" /><a itemprop="item" href="/en/"><span itemprop="name">Learning Civil IoT Taiwan Open Data and Its Applications</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="2" /><a itemprop="item" href="/en/ch4/"><span itemprop="name">4. Time Series Data Analysis</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="1" /><a itemprop="item" href="/en/ch4/ch4.1/" aria-disabled="true"><span itemprop="name">4.1. Time Series Data Processing</span></a></li>
            </ol>
          </div>
          <div class="default-animation progress">
            <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#goal">Goal</a></li>
    <li><a href="#package-installation-and-importing">Package Installation and Importing</a></li>
    <li><a href="#data-access">Data Access</a>
      <ul>
        <li><a href="#air-quality-data">Air Quality Data</a></li>
        <li><a href="#water-level-data">Water Level Data</a></li>
        <li><a href="#meteorological-data">Meteorological Data</a></li>
      </ul>
    </li>
    <li><a href="#data-visualization">Data Visualization</a>
      <ul>
        <li><a href="#data-resample">Data Resample</a></li>
        <li><a href="#moving-average">Moving Average</a></li>
        <li><a href="#multi-line-charts">Multi-line Charts</a></li>
        <li><a href="#calendar-heatmap">Calendar Heatmap</a></li>
      </ul>
    </li>
    <li><a href="#data-quality-inspection">Data Quality Inspection</a>
      <ul>
        <li><a href="#outlier-detection">Outlier Detection</a></li>
        <li><a href="#change-point-detection">Change Point Detection)</a></li>
        <li><a href="#missing-data-handling">Missing Data Handling</a></li>
      </ul>
    </li>
    <li><a href="#data-decomposition">Data Decomposition</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>

      <main id="body-inner" class="highlightable ">
        <div class="flex-block-wrapper">
          <div id="head-tags"><div class="tags">
  <a class="level-link" href="/en/levels/beginner">
  <b>
	&starf;&star;&star;&star;&star;
  </b>
  </a>
  <a class="tag-link" href="/en/tags/air">Air</a>
  <a class="tag-link" href="/en/tags/python">Python</a>
  <a class="tag-link" href="/en/tags/water">Water</a>
</div>

          </div>


  
  
  

  <section class="social-share">
    <ul class="share-icons">
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f&amp;text=4.1.%20Time%20Series%20Data%20Processing" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="26px" viewBox="0 0 31 26" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(11.372549%,60.784314%,94.117647%);fill-opacity:1;" d="M 27.742188 6.535156 C 27.761719 6.8125 27.761719 7.089844 27.761719 7.371094 C 27.761719 15.875 21.414062 25.683594 9.800781 25.683594 L 9.800781 25.675781 C 6.371094 25.683594 3.011719 24.679688 0.125 22.792969 C 0.625 22.851562 1.125 22.882812 1.628906 22.886719 C 4.46875 22.886719 7.230469 21.914062 9.46875 20.125 C 6.765625 20.070312 4.398438 18.277344 3.570312 15.65625 C 4.515625 15.839844 5.492188 15.800781 6.421875 15.542969 C 3.476562 14.9375 1.355469 12.300781 1.355469 9.234375 L 1.355469 9.152344 C 2.234375 9.652344 3.214844 9.929688 4.222656 9.960938 C 1.449219 8.070312 0.59375 4.304688 2.265625 1.363281 C 5.472656 5.386719 10.203125 7.832031 15.277344 8.089844 C 14.769531 5.855469 15.464844 3.511719 17.105469 1.941406 C 19.644531 -0.496094 23.644531 -0.371094 26.035156 2.21875 C 27.449219 1.933594 28.804688 1.40625 30.042969 0.65625 C 29.574219 2.144531 28.585938 3.410156 27.269531 4.214844 C 28.519531 4.066406 29.742188 3.722656 30.894531 3.203125 C 30.046875 4.496094 28.980469 5.625 27.742188 6.535156 Z M 27.742188 6.535156 "/>
</g>
</svg>

          <p>Twitter</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<linearGradient id="linear0" gradientUnits="userSpaceOnUse" x1="-277.375" y1="406.6018" x2="-277.375" y2="407.5726" gradientTransform="matrix(32,0,0,-31.82224,8892.0008,12969.8672)">
<stop offset="0" style="stop-color:rgb(0%,38.431373%,87.843137%);stop-opacity:1;"/>
<stop offset="1" style="stop-color:rgb(9.803922%,68.627451%,100%);stop-opacity:1;"/>
</linearGradient>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:url(#linear0);" d="M 13.359375 31.839844 C 5.761719 30.480469 0 23.921875 0 16 C 0 7.199219 7.199219 0 16 0 C 24.800781 0 32 7.199219 32 16 C 32 23.921875 26.238281 30.480469 18.640625 31.839844 L 17.761719 31.121094 L 14.238281 31.121094 Z M 13.359375 31.839844 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 22.238281 20.480469 L 22.960938 16 L 18.71875 16 L 18.71875 12.878906 C 18.71875 11.601562 19.199219 10.640625 21.121094 10.640625 L 23.199219 10.640625 L 23.199219 6.558594 C 22.078125 6.398438 20.800781 6.238281 19.679688 6.238281 C 16 6.238281 13.441406 8.480469 13.441406 12.480469 L 13.441406 16 L 9.441406 16 L 9.441406 20.480469 L 13.441406 20.480469 L 13.441406 31.761719 C 14.320312 31.921875 15.199219 32 16.078125 32 C 16.960938 32 17.839844 31.921875 18.71875 31.761719 L 18.71875 20.480469 Z M 22.238281 20.480469 "/>
</g>
</svg>

          <p>Facebook</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f&amp;source=https%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f&amp;title=4.1.%20Time%20Series%20Data%20Processing&amp;summary=4.1.%20Time%20Series%20Data%20Processing" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(0%,49.411765%,73.333333%);fill-opacity:1;" d="M 16 32 C 24.835938 32 32 24.835938 32 16 C 32 7.164062 24.835938 0 16 0 C 7.164062 0 0 7.164062 0 16 C 0 24.835938 7.164062 32 16 32 Z M 16 32 "/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 26.222656 25.332031 L 22.203125 25.332031 L 22.203125 18.488281 C 22.203125 16.613281 21.492188 15.566406 20.007812 15.566406 C 18.390625 15.566406 17.546875 16.65625 17.546875 18.488281 L 17.546875 25.332031 L 13.675781 25.332031 L 13.675781 12.296875 L 17.546875 12.296875 L 17.546875 14.050781 C 17.546875 14.050781 18.710938 11.898438 21.476562 11.898438 C 24.242188 11.898438 26.222656 13.585938 26.222656 17.078125 Z M 9.054688 10.589844 C 7.734375 10.589844 6.667969 9.511719 6.667969 8.183594 C 6.667969 6.855469 7.734375 5.777344 9.054688 5.777344 C 10.375 5.777344 11.441406 6.855469 11.441406 8.183594 C 11.441406 9.511719 10.375 10.589844 9.054688 10.589844 Z M 7.054688 25.332031 L 11.09375 25.332031 L 11.09375 12.296875 L 7.054688 12.296875 Z M 7.054688 25.332031 "/>
</g>
</svg>

            <p>LinkedIn</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="whatsapp://send?text=4.1.%20Time%20Series%20Data%20Processing%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0aWe%20use%20the%20sensing%20data%20of%20Civil%20IoT%20Taiwan%20Data%20Service%20Platform%20to%20guide%20readers%20to%20understand%20the%20use%20of%20moving%20average%2c%20perform%20periodic%20analysis%20of%20time%20series%20data%2c%20and%20then%20disassemble%20the%20time%20series%20data%20into%20long-term%20trends%2c%20seasonal%20changes%20and%20residual%20fluctuations.%20At%20the%20same%20time%2c%20we%20apply%20the%20existing%20Python%20language%20suites%20to%20perform%20change%20point%20detection%20and%20outlier%20detection%20to%20check%20the%20existing%20Civil%20IoT%20Taiwan%20data%2c%20and%20discuss%20potential%20implications%20of%20such%20values%20detected.%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f%0a" target="_blank" class="share-btn whatsapp">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<image id="image5" width="588" height="590" xlink:href="data:image/png;base64,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"/>
</defs>
<g id="surface2">
<use xlink:href="#image5" transform="matrix(0.054145,0,0,0.054145,0.054145,0)"/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 24.355469 7.726562 C 22.222656 5.585938 19.378906 4.410156 16.355469 4.40625 C 10.117188 4.40625 5.042969 9.484375 5.042969 15.71875 C 5.039062 17.714844 5.5625 19.660156 6.550781 21.375 L 4.945312 27.238281 L 10.945312 25.664062 C 12.597656 26.566406 14.457031 27.039062 16.351562 27.042969 L 16.355469 27.042969 C 22.589844 27.042969 27.664062 21.964844 27.667969 15.730469 C 27.667969 12.707031 26.492188 9.863281 24.355469 7.726562 Z M 16.355469 25.132812 L 16.351562 25.132812 C 14.664062 25.128906 13.007812 24.675781 11.566406 23.820312 L 11.222656 23.617188 L 7.664062 24.550781 L 8.613281 21.082031 L 8.390625 20.722656 C 7.449219 19.226562 6.949219 17.496094 6.953125 15.71875 C 6.953125 10.535156 11.171875 6.320312 16.359375 6.320312 C 18.871094 6.320312 21.230469 7.296875 23.003906 9.074219 C 24.78125 10.851562 25.757812 13.214844 25.757812 15.726562 C 25.753906 20.914062 21.535156 25.132812 16.355469 25.132812 Z M 21.511719 18.089844 C 21.230469 17.945312 19.839844 17.261719 19.582031 17.167969 C 19.320312 17.074219 19.132812 17.027344 18.945312 17.3125 C 18.757812 17.59375 18.214844 18.230469 18.050781 18.417969 C 17.882812 18.609375 17.71875 18.632812 17.4375 18.488281 C 17.152344 18.347656 16.242188 18.050781 15.164062 17.085938 C 14.324219 16.335938 13.757812 15.410156 13.589844 15.128906 C 13.425781 14.84375 13.574219 14.691406 13.714844 14.550781 C 13.84375 14.425781 13.996094 14.222656 14.140625 14.054688 C 14.28125 13.890625 14.328125 13.773438 14.421875 13.585938 C 14.515625 13.394531 14.46875 13.230469 14.398438 13.089844 C 14.328125 12.949219 13.761719 11.554688 13.527344 10.992188 C 13.296875 10.441406 13.066406 10.515625 12.890625 10.503906 C 12.726562 10.496094 12.539062 10.496094 12.347656 10.496094 C 12.160156 10.496094 11.855469 10.566406 11.59375 10.847656 C 11.335938 11.132812 10.605469 11.816406 10.605469 13.207031 C 10.605469 14.597656 11.617188 15.941406 11.761719 16.132812 C 11.902344 16.320312 13.753906 19.175781 16.589844 20.398438 C 17.261719 20.691406 17.789062 20.863281 18.199219 20.996094 C 18.878906 21.210938 19.492188 21.179688 19.980469 21.105469 C 20.523438 21.027344 21.652344 20.421875 21.890625 19.761719 C 22.125 19.101562 22.125 18.535156 22.054688 18.417969 C 21.984375 18.300781 21.792969 18.230469 21.511719 18.089844 Z M 21.511719 18.089844 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
      

      
      
      <li>
        <a href="mailto:?subject=Tutorial%20for%20CIoT%20Open%20Data%20Applications - 4.1.%20Time%20Series%20Data%20Processing.&amp;body=4.1.%20Time%20Series%20Data%20Processing%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0aWe%20use%20the%20sensing%20data%20of%20Civil%20IoT%20Taiwan%20Data%20Service%20Platform%20to%20guide%20readers%20to%20understand%20the%20use%20of%20moving%20average%2c%20perform%20periodic%20analysis%20of%20time%20series%20data%2c%20and%20then%20disassemble%20the%20time%20series%20data%20into%20long-term%20trends%2c%20seasonal%20changes%20and%20residual%20fluctuations.%20At%20the%20same%20time%2c%20we%20apply%20the%20existing%20Python%20language%20suites%20to%20perform%20change%20point%20detection%20and%20outlier%20detection%20to%20check%20the%20existing%20Civil%20IoT%20Taiwan%20data%2c%20and%20discuss%20potential%20implications%20of%20such%20values%20detected.%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fen%2fch4%2fch4.1%2f%0a" target="_blank" class="share-btn email">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%">
  <feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"/>
</filter>
<mask id="mask0">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip1">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface5" clip-path="url(#clip1)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 26 22 C 26 23.101562 25.101562 24 24 24 L 8 24 C 6.898438 24 6 23.101562 6 22 L 6 12 C 6 10.898438 6.898438 10 8 10 L 24 10 C 25.101562 10 26 10.898438 26 12 Z M 26 22 "/>
</g>
<mask id="mask1">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip2">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface8" clip-path="url(#clip2)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 17.75 15.101562 C 16.800781 14.050781 15.199219 14.050781 14.25 15.101562 L 6.5 21.601562 C 6.398438 21.699219 6.351562 21.800781 6.25 21.898438 C 6.601562 22.550781 7.25 23 7.949219 23 L 23.949219 23 C 24.699219 23 25.300781 22.550781 25.648438 21.898438 C 25.601562 21.800781 25.5 21.699219 25.398438 21.601562 Z M 17.75 15.101562 "/>
</g>
<mask id="mask2">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip3">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface11" clip-path="url(#clip3)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 6.300781 10.101562 C 6.648438 9.449219 7.300781 9 8 9 L 24 9 C 24.75 9 25.351562 9.449219 25.699219 10.101562 C 25.648438 10.199219 25.550781 10.300781 25.449219 10.398438 L 17.75 16.898438 C 16.800781 17.949219 15.199219 17.949219 14.25 16.898438 Z M 6.300781 10.101562 "/>
</g>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(46.666667%,70.196078%,83.137255%);fill-opacity:1;" d="M 32 16 C 32 24.835938 24.835938 32 16 32 C 7.164062 32 0 24.835938 0 16 C 0 7.164062 7.164062 0 16 0 C 24.835938 0 32 7.164062 32 16 Z M 32 16 "/>
<use xlink:href="#surface5" mask="url(#mask0)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 26 21 C 26 22.101562 25.101562 23 24 23 L 8 23 C 6.898438 23 6 22.101562 6 21 L 6 11 C 6 9.898438 6.898438 9 8 9 L 24 9 C 25.101562 9 26 9.898438 26 11 Z M 26 21 "/>
<use xlink:href="#surface8" mask="url(#mask1)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 17.75 16 C 16.800781 15.050781 15.199219 15.050781 14.25 16 L 6.5 21.75 C 6.398438 21.851562 6.351562 21.898438 6.25 22 C 6.601562 22.601562 7.25 22.949219 7.949219 22.949219 L 23.949219 22.949219 C 24.699219 22.949219 25.300781 22.550781 25.648438 22 C 25.601562 21.898438 25.5 21.851562 25.398438 21.75 Z M 17.75 16 "/>
<use xlink:href="#surface11" mask="url(#mask2)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 14.25 16 C 15.199219 16.949219 16.800781 16.949219 17.75 16 L 25.5 10.25 C 25.601562 10.148438 25.648438 10.101562 25.75 10 C 25.398438 9.398438 24.75 9.050781 24.050781 9.050781 L 8 9.050781 C 7.25 9.050781 6.648438 9.449219 6.300781 10 C 6.351562 10.101562 6.449219 10.148438 6.550781 10.25 Z M 14.25 16 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
    </ul>
  </section>
  



<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCH7EJS8LE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZCH7EJS8LE', { 'anonymize_ip': false });
}
</script>



          <article class="default">
<h1>4.1. Time Series Data Processing</h1>

<p><a href="https://colab.research.google.com/drive/1MUHXiRiI7o56oZLCU2JrxI-aJEiM6RkJ?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<div>
    <h2>Table Of Contents</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#goal">Goal</a></li>
    <li><a href="#package-installation-and-importing">Package Installation and Importing</a></li>
    <li><a href="#data-access">Data Access</a>
      <ul>
        <li><a href="#air-quality-data">Air Quality Data</a></li>
        <li><a href="#water-level-data">Water Level Data</a></li>
        <li><a href="#meteorological-data">Meteorological Data</a></li>
      </ul>
    </li>
    <li><a href="#data-visualization">Data Visualization</a>
      <ul>
        <li><a href="#data-resample">Data Resample</a></li>
        <li><a href="#moving-average">Moving Average</a></li>
        <li><a href="#multi-line-charts">Multi-line Charts</a></li>
        <li><a href="#calendar-heatmap">Calendar Heatmap</a></li>
      </ul>
    </li>
    <li><a href="#data-quality-inspection">Data Quality Inspection</a>
      <ul>
        <li><a href="#outlier-detection">Outlier Detection</a></li>
        <li><a href="#change-point-detection">Change Point Detection)</a></li>
        <li><a href="#missing-data-handling">Missing Data Handling</a></li>
      </ul>
    </li>
    <li><a href="#data-decomposition">Data Decomposition</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
</div>

<p>Time series data refers to information that is organized based on when it occurred or was recorded. This data is often set at regular time intervals, like every five minutes or hourly. It&rsquo;s used in a variety of areas including finance, space engineering, and signal processing, among others. Time series data also plays a big role in our daily lives. For instance, with the ongoing global climate change, we&rsquo;ve seen a rise in average temperatures, leading to hotter summers. Similarly, air quality can vary significantly during different times of the year. Analyzing time series data helps us understand how these environmental changes occur over time by looking at the relationship between data points and time periods.</p>
<p>In this chapter, we&rsquo;ll explore how to use time series data analysis through three specific types of data: air quality, water resources, and weather. These examples are taken from the Civil IoT Taiwan Data Service Platform, showing how this analysis can provide insights into environmental trends and changes.</p>
<h2 id="goal">Goal</h2>
<ul>
<li>observe time series data using visualization tools</li>
<li>check and process time series data</li>
<li>decompose time series data to investigate its trend and seasonality</li>
</ul>
<h2 id="package-installation-and-importing">Package Installation and Importing</h2>
<p>In this article, we&rsquo;re going to work with several useful tools, including pandas, matplotlib, numpy, seaborn, statsmodels, and warnings. These are all ready to use on Google Colab, our chosen development platform, so you don&rsquo;t have to worry about installing them. However, we&rsquo;ll also be using two extra packages, kats and calplot, which aren&rsquo;t pre-installed on Colab. To use these, we&rsquo;ll need to install them first.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Upgrading pip, the package installer for Python. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This ensures we have the latest version with all the improvements and security patches.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install <span style="color:#f92672">--</span>upgrade pip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Installing specific versions of three libraries:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;kats&#39; is a toolkit for time series analysis developed by Facebook Research.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;ax-platform&#39; is a platform for adaptive experimentation.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;statsmodels&#39; is a library for statistical modeling in Python.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># By specifying the versions, we make sure our code is consistent and reliable.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install kats<span style="color:#f92672">==</span><span style="color:#ae81ff">0.1</span> ax<span style="color:#f92672">-</span>platform<span style="color:#f92672">==</span><span style="color:#ae81ff">0.2.3</span> statsmodels<span style="color:#f92672">==</span><span style="color:#ae81ff">0.12.2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Installing &#39;calplot&#39;, a library for creating calendar heatmaps.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s great for visualizing time series data in a calendar format.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install calplot
</span></span></code></pre></div><p>Once the installation of kats and calplot is finished, we can begin by importing all the necessary packages to set up our working environment for this article. Here&rsquo;s how we do it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> warnings  <span style="color:#75715e"># Importing the warnings library to control warning messages.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> calplot  <span style="color:#75715e"># Calplot is used for plotting calendar heatmaps.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd  <span style="color:#75715e"># Pandas is a powerful data manipulation and analysis library.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np  <span style="color:#75715e"># Numpy is used for numerical operations on arrays and matrices.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib <span style="color:#66d9ef">as</span> mpl  <span style="color:#75715e"># Matplotlib is a plotting library.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt  <span style="color:#75715e"># Pyplot is a module in Matplotlib for easy plotting.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> statsmodels.api <span style="color:#66d9ef">as</span> sm  <span style="color:#75715e"># Statsmodels is used for statistical modeling and testing.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os<span style="color:#f92672">,</span> zipfile  <span style="color:#75715e"># OS and zipfile for handling file and directory operations.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta  <span style="color:#75715e"># For handling date and time operations.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dateutil <span style="color:#f92672">import</span> parser <span style="color:#66d9ef">as</span> datetime_parser  <span style="color:#75715e"># For parsing date and time from strings.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> statsmodels.tsa.stattools <span style="color:#f92672">import</span> adfuller, kpss  <span style="color:#75715e"># For statistical tests in time series analysis.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> statsmodels.tsa.seasonal <span style="color:#f92672">import</span> seasonal_decompose  <span style="color:#75715e"># For decomposing time series data.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kats.detectors.outlier <span style="color:#f92672">import</span> OutlierDetector  <span style="color:#75715e"># Kats is a toolkit for time series analysis.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kats.detectors.cusum_detection <span style="color:#f92672">import</span> CUSUMDetector  <span style="color:#75715e"># For change point detection in time series.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> kats.consts <span style="color:#f92672">import</span> TimeSeriesData, TimeSeriesIterator  <span style="color:#75715e"># Constants and iterators for time series operations.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.core.pylabtools <span style="color:#f92672">import</span> figsize  <span style="color:#75715e"># For setting the size of plots in Jupyter notebooks.</span>
</span></span></code></pre></div><h2 id="data-access">Data Access</h2>
<p>We&rsquo;ll be using a tool called pandas, which is popular in data science and is part of the Python programming language. Think of pandas like a spreadsheet, similar to Microsoft Excel, but for programming. It has a feature called &lsquo;Dataframe&rsquo; that acts like a two-dimensional table, allowing us to organize data in rows and columns. This setup is very handy for various kinds of data work.</p>
<p>Our focus here is on analyzing and processing time series data, which means data that is collected over time. We&rsquo;ll be working with air quality, water level, and weather data from the Civil IoT Taiwan Data Service Platform. We&rsquo;ll especially focus on air quality data for a more in-depth analysis. This data comes from a network of monitoring stations and has been recorded over a long period. In our data table, or &lsquo;dataframe&rsquo;, the time of each data entry is labeled as &rsquo;timestamp&rsquo;. Since each timestamp is unique, we use it as an index to organize our dataframe, making it easier to navigate and analyze the data.</p>
<h3 id="air-quality-data">Air Quality Data</h3>
<p>We&rsquo;re going to work with long-term historical data. Instead of using the standard data access methods provided by the pyCIOT package, we&rsquo;ll directly download a dataset named &ldquo;Academia Sinica - Micro Air Quality Sensors&rdquo; from the historical database of the Civil IoT Taiwan Data Service Platform. Once downloaded, we&rsquo;ll save this data in a folder named Air.</p>
<p>Since the data we download comes in a zip file, which is a type of compressed file, our first step will be to unzip it. Unzipping will give us a series of daily files, also compressed. We&rsquo;ll then need to decompress each of these daily files. After decompressing, we&rsquo;ll store them in a separate folder named CSV_Air. This step-by-step process ensures that we have all the historical air quality data ready and organized for our analysis.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating directories for storing air quality data.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>mkdir Air CSV_Air 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Downloading air quality datasets for the years 2018 to 2021 from a specified URL.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2018.</span>zip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3noJTpmaJf5qCh5ZyS56m65ZOB5b6u5Z6L5oSf5ris5ZmoLzIwMTguemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2019.</span>zip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3noJTpmaJf5qCh5ZyS56m65ZOB5b6u5Z6L5oSf5ris5ZmoLzIwMTkuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2020.</span>zip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3noJTpmaJf5qCh5ZyS56m65ZOB5b6u5Z6L5oSf5ris5ZmoLzIwMjAuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2021.</span>zip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3noJTpmaJf5qCh5ZyS56m65ZOB5b6u5Z6L5oSf5ris5ZmoLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting up the folder structure and file extensions for unzipping and organizing the data.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Air&#39;</span>
</span></span><span style="display:flex;"><span>extension_zip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.zip&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unzipping the downloaded files and extracting their contents.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>      print(path) <span style="color:#75715e"># Printing the path for tracking progress.</span>
</span></span><span style="display:flex;"><span>      zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(path) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>extractall(folder) <span style="color:#75715e"># Extracting the contents.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Further unzipping nested zip files and organizing their contents.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(path) <span style="color:#75715e"># Extracting contents.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Moving CSV files to a specific folder for easy access.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>          path2 <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path2):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> it <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path2):
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> it<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path2<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>it<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(<span style="color:#e6db74">&#39;CSV_Air&#39;</span>) <span style="color:#75715e"># Extracting contents to a specific folder.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> item<span style="color:#f92672">.</span>endswith(extension_csv):
</span></span><span style="display:flex;"><span>            os<span style="color:#f92672">.</span>rename(path2, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;CSV_Air/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>) <span style="color:#75715e"># Renaming and moving CSV files.</span>
</span></span></code></pre></div><p>Now that we&rsquo;ve decompressed the daily sensor data, the <code>CSV_Air</code> folder contains all of this data in CSV (Comma-Separated Values) format. CSV files are like simple spreadsheets where each line of text is a row of data, and each value in the row is separated by a comma.</p>
<p>Our next step is to focus on data from a specific monitoring station. Let&rsquo;s say we&rsquo;re interested in the station with the code <code>74DA38C7D2AC</code>. To extract data for this station, we will read each CSV file and select only the data from this station. This selected data will be gathered into a new dataframe, which we&rsquo;ll call <code>air</code>.</p>
<p>Once we&rsquo;ve collected all the necessary data in the <code>air</code> dataframe, our final step is to delete all the downloaded and decompressed data. This is an important step to save storage space in the cloud, where we&rsquo;re working. This way, we keep only the essential data we need for analysis, making our work more efficient and organized.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Setting up the folder and file extension for processing the CSV air quality data.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CSV_Air&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;74DA38C7D2AC&#39;</span> <span style="color:#75715e"># Specific device ID to filter the data.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initializing an empty DataFrame to store the consolidated air quality data.</span>
</span></span><span style="display:flex;"><span>air <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Looping through each file in the CSV_Air folder.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>  file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e"># Constructing the file path.</span>
</span></span><span style="display:flex;"><span>  df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(file_name) <span style="color:#75715e"># Reading the CSV file into a DataFrame.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Renaming the &#39;pm25&#39; column to &#39;PM25&#39; for consistency, if it exists.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;pm25&#39;</span> <span style="color:#f92672">in</span> list(df<span style="color:#f92672">.</span>columns):
</span></span><span style="display:flex;"><span>    df<span style="color:#f92672">.</span>rename({<span style="color:#e6db74">&#39;pm25&#39;</span>:<span style="color:#e6db74">&#39;PM25&#39;</span>}, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Filtering the DataFrame for the specific device ID.</span>
</span></span><span style="display:flex;"><span>  filtered <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;device_id==@id&#39;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Concatenating the filtered data into the main DataFrame.</span>
</span></span><span style="display:flex;"><span>  air <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([air, filtered], ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Dropping rows where the &#39;timestamp&#39; column is NaN.</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>dropna(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Converting the &#39;timestamp&#39; column to a datetime format, handling timezone awareness.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, row <span style="color:#f92672">in</span> air<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>  aware <span style="color:#f92672">=</span> datetime_parser<span style="color:#f92672">.</span>parse(str(row[<span style="color:#e6db74">&#39;timestamp&#39;</span>])) <span style="color:#75715e"># Parsing the timestamp.</span>
</span></span><span style="display:flex;"><span>  naive <span style="color:#f92672">=</span> aware<span style="color:#f92672">.</span>replace(tzinfo<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>) <span style="color:#75715e"># Removing timezone information.</span>
</span></span><span style="display:flex;"><span>  air<span style="color:#f92672">.</span>at[i, <span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">=</span> naive <span style="color:#75715e"># Updating the DataFrame with the naive timestamp.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting the &#39;timestamp&#39; column as the index of the DataFrame.</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Removing the directories and their contents used for data storage.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf Air CSV_Air
</span></span></code></pre></div><p>The last step in our data preparation process involves organizing the data we&rsquo;ve collected for the specific monitoring station. Here&rsquo;s what we&rsquo;ll do:</p>
<ol>
<li>
<p><strong>Rearrange the Data:</strong> We&rsquo;ll adjust the layout of the data to make it easier to analyze. This might involve moving columns around or changing how the data is displayed in the dataframe.</p>
</li>
<li>
<p><strong>Delete Unnecessary Fields:</strong> Our dataset might contain information that isn&rsquo;t relevant to our analysis. To simplify our work and focus on the essential data, we&rsquo;ll remove these unnecessary fields. This process is about streamlining the data to what&rsquo;s important for our specific study.</p>
</li>
<li>
<p><strong>Sort by Time:</strong> Since we&rsquo;re dealing with time series data, it&rsquo;s crucial to have the data in chronological order. We&rsquo;ll sort the data based on the timestamp, ensuring that it&rsquo;s arranged from the earliest to the latest entry. This makes it easier to observe trends and patterns over time.</p>
</li>
</ol>
<p>By completing these steps, we&rsquo;ll have a clean, well-organized dataset that&rsquo;s ready for detailed analysis. This organized approach not only makes our analysis more straightforward but also ensures accuracy in our findings.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Dropping unnecessary columns from the air DataFrame.</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;device_id&#39;</span>, <span style="color:#e6db74">&#39;SiteName&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sorting the DataFrame based on the &#39;timestamp&#39; column.</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying information about the DataFrame.</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Printing the first few rows of the DataFrame.</span>
</span></span><span style="display:flex;"><span>print(air<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 195305 entries, 2018-08-01 00:00:05 to 2021-12-31 23:54:46
Data columns (total 1 columns):
 \#   Column  Non-Null Count   Dtype 
---  ------  --------------   ----- 
 0   PM25    195305 non-null  object
dtypes: object(1)
memory usage: 3.0+ MB
                     PM25
timestamp                
2018-08-01 00:00:05  20.0
2018-08-01 00:30:18  17.0
2018-08-01 01:12:34  18.0
2018-08-01 01:18:36  21.0
2018-08-01 01:30:44  22.0
</code></pre><h3 id="water-level-data">Water Level Data</h3>
<p>Just like with the air quality data, we&rsquo;re going to focus on using long-term historical data for our water level analysis. Instead of using the pyCIOT suite&rsquo;s built-in methods for accessing data, we&rsquo;ll take a different approach:</p>
<ol>
<li>
<p><strong>Download the Data Archive:</strong> We&rsquo;ll directly download the data set titled &ldquo;Water Resources Agency - Groundwater Level Station&rdquo; from the historical database of the Civil IoT Taiwan Data Service Platform. This dataset contains extensive historical data on groundwater levels.</p>
</li>
<li>
<p><strong>Save the Data:</strong> After downloading, we&rsquo;ll store this data in a folder named <code>Water</code>. This step helps us keep our data organized and easily accessible.</p>
</li>
<li>
<p><strong>Decompress the Data:</strong> The data we&rsquo;ve downloaded will be in a zip compressed file. Our first task is to unzip this file. Unzipping will reveal a number of daily files, which are also in a compressed format.</p>
</li>
<li>
<p><strong>Decompress Daily Files:</strong> We&rsquo;ll then decompress each of these daily files. This step is crucial as it converts the compressed files into a format that we can work with for our analysis.</p>
</li>
<li>
<p><strong>Store Decompressed Data:</strong> Finally, we&rsquo;ll store the decompressed daily files in another folder, named <code>CSV_Water</code>. This folder will now contain all the daily groundwater level data in an accessible format, ready for us to process and analyze.</p>
</li>
</ol>
<p>By following these steps, we ensure that we have a comprehensive and organized dataset of groundwater levels, which is crucial for accurate and effective analysis.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating directories for storing water quality data.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>mkdir Water CSV_Water
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Downloading water quality datasets for the years 2018 to 2021 from specified URLs.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Water<span style="color:#f92672">/</span><span style="color:#ae81ff">2018.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbJf5rKz5bed5rC05L2N56uZLzIwMTguemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Water<span style="color:#f92672">/</span><span style="color:#ae81ff">2019.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbJf5rKz5bed5rC05L2N56uZLzIwMTkuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Water<span style="color:#f92672">/</span><span style="color:#ae81ff">2020.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbJf5rKz5bed5rC05L2N56uZLzIwMjAuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Water<span style="color:#f92672">/</span><span style="color:#ae81ff">2021.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbJf5rKz5bed5rC05L2N56uZLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting up the folder structure and file extensions for unzipping and organizing the data.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Water&#39;</span>
</span></span><span style="display:flex;"><span>extension_zip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.zip&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unzipping the downloaded files and extracting their contents.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>      print(path) <span style="color:#75715e"># Printing the path for tracking progress.</span>
</span></span><span style="display:flex;"><span>      zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(path) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>extractall(folder) <span style="color:#75715e"># Extracting the contents.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Further unzipping nested zip files and organizing their contents, excluding &#39;QC.zip&#39; files.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(path) <span style="color:#75715e"># Extracting contents.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Moving CSV files to a specific folder for easy access.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>          path2 <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path2):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> it <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path2):
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> it<span style="color:#f92672">.</span>endswith(extension_zip) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> it<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;QC.zip&#39;</span>):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path2<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>it<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(<span style="color:#e6db74">&#39;CSV_Water&#39;</span>) <span style="color:#75715e"># Extracting contents to a specific folder.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> item<span style="color:#f92672">.</span>endswith(extension_csv):
</span></span><span style="display:flex;"><span>            os<span style="color:#f92672">.</span>rename(path2, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;CSV_Water/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>) <span style="color:#75715e"># Renaming and moving CSV files.</span>
</span></span></code></pre></div><p>Now that we&rsquo;ve decompressed the water level data, the <code>CSV_Water</code> folder is filled with daily sensor data in CSV format. Next, we&rsquo;ll focus on extracting and organizing data from a specific station. Here&rsquo;s how we&rsquo;ll do it:</p>
<ol>
<li>
<p><strong>Filter Data for a Specific Station:</strong> We&rsquo;ll target data from a particular station, for example, the one with the code <code>338c9c1c-57d8-41d7-9af2-731fb86e632c</code>. To do this, we need to read each CSV file and filter out only the data that corresponds to this station.</p>
</li>
<li>
<p><strong>Create a Dataframe:</strong> We&rsquo;ll gather all the data for our chosen station and put it into a dataframe. A dataframe is a table-like structure in programming that makes data manipulation easier. We&rsquo;ll name this dataframe <code>water</code>.</p>
</li>
<li>
<p><strong>Delete Unnecessary Data:</strong> After successfully extracting the necessary data and storing it in the <code>water</code> dataframe, we&rsquo;ll delete all the originally downloaded data and the data generated after decompression. This step is crucial for saving storage space in the cloud, ensuring that we keep only the data that is essential for our analysis.</p>
</li>
</ol>
<p>By following these steps, we&rsquo;ll have a streamlined, specific dataset ready for in-depth analysis of water levels at the chosen station. This approach helps in maintaining an organized and efficient workflow, especially when dealing with large amounts of data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Setting up the folder and file extension for processing the CSV water quality data.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CSV_Water&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;338c9c1c-57d8-41d7-9af2-731fb86e632c&#39;</span> <span style="color:#75715e"># Specific station ID for filtering the data.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initializing an empty DataFrame to store the consolidated water quality data.</span>
</span></span><span style="display:flex;"><span>water <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Looping through each file in the CSV_Water folder.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>  file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>  <span style="color:#75715e"># Constructing the file path.</span>
</span></span><span style="display:flex;"><span>  df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(file_name) <span style="color:#75715e"># Reading the CSV file into a DataFrame.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Renaming the &#39;pm25&#39; column to &#39;PM25&#39; for consistency, if it exists.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># This may not be relevant for water data and can be removed if &#39;pm25&#39; is not a column.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;pm25&#39;</span> <span style="color:#f92672">in</span> list(df<span style="color:#f92672">.</span>columns):
</span></span><span style="display:flex;"><span>    df<span style="color:#f92672">.</span>rename({<span style="color:#e6db74">&#39;pm25&#39;</span>:<span style="color:#e6db74">&#39;PM25&#39;</span>}, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Filtering the DataFrame for the specific station ID.</span>
</span></span><span style="display:flex;"><span>  filtered <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;station_id==@id&#39;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Concatenating the filtered data into the main DataFrame.</span>
</span></span><span style="display:flex;"><span>  water <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([water, filtered], ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Dropping rows where the &#39;timestamp&#39; column is NaN.</span>
</span></span><span style="display:flex;"><span>water<span style="color:#f92672">.</span>dropna(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Converting the &#39;timestamp&#39; column to a datetime format, handling timezone awareness.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, row <span style="color:#f92672">in</span> water<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>  aware <span style="color:#f92672">=</span> datetime_parser<span style="color:#f92672">.</span>parse(str(row[<span style="color:#e6db74">&#39;timestamp&#39;</span>]))
</span></span><span style="display:flex;"><span>  naive <span style="color:#f92672">=</span> aware<span style="color:#f92672">.</span>replace(tzinfo<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>  water<span style="color:#f92672">.</span>at[i, <span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">=</span> naive
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting the &#39;timestamp&#39; column as the index of the DataFrame.</span>
</span></span><span style="display:flex;"><span>water<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Removing the directories and their contents used for data storage.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf Water CSV_Water
</span></span></code></pre></div><p>As the final step in preparing our water level data for analysis, we&rsquo;ll undertake three key actions to organize and streamline the dataset:</p>
<ol>
<li>
<p><strong>Rearrange the Data:</strong> We&rsquo;ll adjust the layout of the data within the dataframe to make it more intuitive and easier to analyze. This could involve reordering columns, grouping similar data together, or any other structural changes that enhance clarity and accessibility.</p>
</li>
<li>
<p><strong>Delete Unnecessary Fields:</strong> Our dataset may contain some fields (columns of data) that aren&rsquo;t relevant to our specific analysis objectives. To keep our focus sharp and the dataset lean, we&rsquo;ll identify and remove these unnecessary fields. This step is all about trimming the data down to what&rsquo;s most useful for our study.</p>
</li>
<li>
<p><strong>Sort by Time:</strong> Since we&rsquo;re dealing with time series data, sorting it chronologically is crucial. We&rsquo;ll organize the data so that it&rsquo;s in order from the earliest to the most recent records. This chronological arrangement is vital for any analysis that tracks changes over time, as it helps in identifying trends, patterns, and anomalies.</p>
</li>
</ol>
<p>By carrying out these steps, we ensure that our water level dataset is not only tailored to our specific research needs but also organized in a way that facilitates efficient and accurate analysis. This organized approach is particularly important in data science, as it lays the groundwork for insightful and reliable results.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Dropping unnecessary columns from the water DataFrame.</span>
</span></span><span style="display:flex;"><span>water<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;station_id&#39;</span>, <span style="color:#e6db74">&#39;ciOrgname&#39;</span>, <span style="color:#e6db74">&#39;ciCategory&#39;</span>, <span style="color:#e6db74">&#39;Organize_Name&#39;</span>, <span style="color:#e6db74">&#39;CategoryInfos_Name&#39;</span>, <span style="color:#e6db74">&#39;PQ_name&#39;</span>, <span style="color:#e6db74">&#39;PQ_fullname&#39;</span>, <span style="color:#e6db74">&#39;PQ_description&#39;</span>, <span style="color:#e6db74">&#39;PQ_unit&#39;</span>, <span style="color:#e6db74">&#39;PQ_id&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sorting the DataFrame based on the &#39;timestamp&#39; column.</span>
</span></span><span style="display:flex;"><span>water<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying information about the DataFrame.</span>
</span></span><span style="display:flex;"><span>water<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Printing the first few rows of the DataFrame.</span>
</span></span><span style="display:flex;"><span>print(water<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 213466 entries, 2018-01-01 00:20:00 to 2021-12-07 11:00:00
Data columns (total 1 columns):
 #   Column  Non-Null Count   Dtype  
---  ------  --------------   -----  
 0   value   213465 non-null  float64
dtypes: float64(1)
memory usage: 3.3 MB
                         value
timestamp                     
2018-01-01 00:20:00  49.130000
2018-01-01 00:25:00  49.139999
2018-01-01 00:30:00  49.130001
2018-01-01 00:35:00  49.130001
2018-01-01 00:40:00  49.130001
</code></pre><h3 id="meteorological-data">Meteorological Data</h3>
<p>For our weather data analysis, we will follow a similar process to what we did with the air quality and water level data:</p>
<ol>
<li>
<p><strong>Download the Data Archive:</strong> We&rsquo;ll start by downloading the &ldquo;Central Weather Bureau - Automatic Weather Station&rdquo; data from the historical database of the Civil IoT Taiwan Data Service Platform. This dataset provides comprehensive historical weather data.</p>
</li>
<li>
<p><strong>Store the Data:</strong> After downloading, we&rsquo;ll save this data in a folder named <code>Weather</code>. Organizing data into specific folders helps keep our workspace tidy and makes it easier to locate the data we need for our analysis.</p>
</li>
<li>
<p><strong>Decompress the Data:</strong> The downloaded data will be in a zip compressed file format. Our first task is to decompress this file, which will reveal a number of daily files. These daily files will also be in a compressed format.</p>
</li>
<li>
<p><strong>Decompress Daily Files:</strong> Next, we&rsquo;ll decompress each of these daily files. This step is essential as it makes the data accessible and ready for analysis.</p>
</li>
<li>
<p><strong>Store Decompressed Data:</strong> Finally, we&rsquo;ll store the decompressed daily files in a separate folder, named <code>CSV_Weather</code>. This folder will now contain all the daily weather data in a format that&rsquo;s ready for processing and analysis.</p>
</li>
</ol>
<p>By completing these steps, we ensure that our weather data is well-organized and prepared for detailed analysis. This process is crucial in data science for maintaining an efficient workflow and ensuring that the data is in a usable state for any analytical tasks that follow.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating directories for storing weather data.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>mkdir Weather CSV_Weather
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Downloading weather datasets for the years 2019 to 2021 from specified URLs.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Weather<span style="color:#f92672">/</span><span style="color:#ae81ff">2019.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bawo%2BixoS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3lpK7msKPosaHlsYBf6Ieq5YuV5rCj6LGh56uZLzIwMTkuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Weather<span style="color:#f92672">/</span><span style="color:#ae81ff">2020.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bawo%2BixoS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3lpK7msKPosaHlsYBf6Ieq5YuV5rCj6LGh56uZLzIwMjAuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Weather<span style="color:#f92672">/</span><span style="color:#ae81ff">2021.</span>zip <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bawo%2BixoS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3lpK7msKPosaHlsYBf6Ieq5YuV5rCj6LGh56uZLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Downloading weather datasets for the years 2019 to 2021 from specified URLs.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Weather&#39;</span>
</span></span><span style="display:flex;"><span>extension_zip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.zip&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unzipping the downloaded files and extracting their contents.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>      print(path) <span style="color:#75715e"># Printing the path for tracking progress.</span>
</span></span><span style="display:flex;"><span>      zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(path) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>extractall(folder) <span style="color:#75715e"># Extracting the contents.</span>
</span></span><span style="display:flex;"><span>      zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Further unzipping nested zip files and organizing their contents.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> subfolder <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>subfolder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(path) <span style="color:#75715e"># Extracting contents.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Moving CSV files to a specific folder for easy access.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>          path2 <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path2):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> it <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path2):
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> it<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>path2<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>it<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                print(file_name) <span style="color:#75715e"># Printing the file name.</span>
</span></span><span style="display:flex;"><span>                zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># Opening the zip file.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>extractall(<span style="color:#e6db74">&#39;CSV_Weather&#39;</span>) <span style="color:#75715e"># Extracting contents to a specific folder.</span>
</span></span><span style="display:flex;"><span>                zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># Closing the zip file.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">elif</span> item<span style="color:#f92672">.</span>endswith(extension_csv):
</span></span><span style="display:flex;"><span>            os<span style="color:#f92672">.</span>rename(path2, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;CSV_Weather/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>) <span style="color:#75715e"># Renaming and moving CSV files.</span>
</span></span></code></pre></div><p>Having successfully decompressed the weather data, the <code>CSV_Weather</code> folder now contains all the daily sensor data in CSV format. Our next steps focus on extracting specific data and organizing it effectively:</p>
<ol>
<li>
<p><strong>Filter Data for a Specific Station:</strong> We&rsquo;ll concentrate on data from a particular weather station, for example, the one identified by the code <code>C0U750</code>. To do this, we need to sift through each CSV file, extracting only the data relevant to this station.</p>
</li>
<li>
<p><strong>Create a Dataframe:</strong> We&rsquo;ll compile all the selected data from the <code>C0U750</code> station into a dataframe, a table-like structure used in programming for data analysis. This dataframe will be named <code>weather</code>, and it will contain all the relevant weather data from the chosen station.</p>
</li>
<li>
<p><strong>Delete Unnecessary Data:</strong> After we&rsquo;ve gathered all the needed data in the <code>weather</code> dataframe, we&rsquo;ll remove all the original downloaded data and the data generated after decompression. This step is important to conserve storage space in the cloud. Keeping only the essential data ensures a more streamlined and efficient dataset for analysis.</p>
</li>
</ol>
<p>By completing these steps, we ensure that our weather dataset is focused, well-organized, and ready for in-depth analysis, specifically tailored to the <code>C0U750</code> weather station. This approach is key in data science, helping maintain an organized workflow and ensuring the integrity and relevance of the data being analyzed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Setting up the folder and file extension for processing the CSV weather data.</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CSV_Weather&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.csv&#39;</span>
</span></span><span style="display:flex;"><span>id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;C0U750&#39;</span> <span style="color:#75715e"># Specific station ID to filter the weather data.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initializing an empty DataFrame to store the consolidated weather data.</span>
</span></span><span style="display:flex;"><span>weather <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Looping through each file in the CSV_Weather folder.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>  file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e"># Constructing the file path.</span>
</span></span><span style="display:flex;"><span>  df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(file_name) <span style="color:#75715e"># Reading the CSV file into a DataFrame.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Renaming the &#39;pm25&#39; column to &#39;PM25&#39; for consistency, if it exists.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># This may not be relevant for weather data and can be removed if &#39;pm25&#39; is not a column.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;pm25&#39;</span> <span style="color:#f92672">in</span> list(df<span style="color:#f92672">.</span>columns):
</span></span><span style="display:flex;"><span>    df<span style="color:#f92672">.</span>rename({<span style="color:#e6db74">&#39;pm25&#39;</span>:<span style="color:#e6db74">&#39;PM25&#39;</span>}, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Filtering the DataFrame for the specific station ID.</span>
</span></span><span style="display:flex;"><span>  filtered <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;station_id==@id&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Concatenating the filtered data into the main DataFrame.</span>
</span></span><span style="display:flex;"><span>  weather <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([weather, filtered], ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Renaming the &#39;obsTime&#39; column to &#39;timestamp&#39; for consistency.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>rename({<span style="color:#e6db74">&#39;obsTime&#39;</span>:<span style="color:#e6db74">&#39;timestamp&#39;</span>}, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Dropping rows where the &#39;timestamp&#39; column is NaN.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>dropna(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Converting the &#39;timestamp&#39; column to a datetime format, handling timezone awareness.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, row <span style="color:#f92672">in</span> weather<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>  aware <span style="color:#f92672">=</span> datetime_parser<span style="color:#f92672">.</span>parse(str(row[<span style="color:#e6db74">&#39;timestamp&#39;</span>])) <span style="color:#75715e"># Parsing the timestamp.</span>
</span></span><span style="display:flex;"><span>  naive <span style="color:#f92672">=</span> aware<span style="color:#f92672">.</span>replace(tzinfo<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>) <span style="color:#75715e"># Removing timezone information.</span>
</span></span><span style="display:flex;"><span>  weather<span style="color:#f92672">.</span>at[i, <span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">=</span> naive <span style="color:#75715e"># Setting the &#39;timestamp&#39; column as the index of the DataFrame.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting the &#39;timestamp&#39; column as the index of the DataFrame.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Removing the directories and their contents used for data storage.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf Weather CSV_Weather
</span></span></code></pre></div><p>To finalize our preparation of the weather data for analysis, we&rsquo;ll perform three crucial steps to ensure the dataset is well-organized and tailored to our needs:</p>
<ol>
<li>
<p><strong>Rearrange the Data:</strong> We&rsquo;ll reorganize the data within the <code>weather</code> dataframe to make it more user-friendly and conducive to analysis. This may involve changing the order of columns, grouping similar types of data together, or altering the layout to improve readability and ease of use.</p>
</li>
<li>
<p><strong>Delete Unnecessary Fields:</strong> In our dataset, there may be some fields (columns) that are not relevant to our specific analysis goals. To streamline our dataset, we&rsquo;ll identify and remove these unnecessary fields. This step helps focus our dataset on only the most pertinent information, making our analysis more efficient and effective.</p>
</li>
<li>
<p><strong>Sort by Time:</strong> Since the essence of our dataset is time series data, arranging it chronologically is essential. We&rsquo;ll sort the data in the <code>weather</code> dataframe so that it&rsquo;s in order from the earliest data entry to the most recent. This chronological sorting is crucial for analyses that track changes over time, as it aids in identifying trends, patterns, and anomalies more clearly.</p>
</li>
</ol>
<p>By executing these steps, we ensure that our weather data is not only precisely tailored for our research but also organized in a way that facilitates effective and accurate analysis. Proper data organization is a fundamental aspect of data science, as it sets the foundation for insightful and reliable analytical outcomes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Dropping the &#39;station_id&#39; column from the weather DataFrame.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;station_id&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sorting the DataFrame based on the &#39;timestamp&#39; column.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying information about the DataFrame.</span>
</span></span><span style="display:flex;"><span>weather<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Printing the first few rows of the DataFrame.</span>
</span></span><span style="display:flex;"><span>print(weather<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 27093 entries, 2019-01-01 00:00:00 to 2021-12-31 23:00:00
Data columns (total 15 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   ELEV    27093 non-null  float64
 1   WDIR    27089 non-null  float64
 2   WDSD    27089 non-null  float64
 3   TEMP    27093 non-null  float64
 4   HUMD    27089 non-null  float64
 5   PRES    27093 non-null  float64
 6   SUN     13714 non-null  float64
 7   H_24R   27089 non-null  float64
 8   H_FX    27089 non-null  float64
 9   H_XD    27089 non-null  object 
 10  H_FXT   23364 non-null  object 
 11  D_TX    27074 non-null  object 
 12  D_TXT   7574 non-null   object 
 13  D_TN    27074 non-null  object 
 14  D_TNT   17 non-null     object 
dtypes: float64(9), object(6)
memory usage: 3.3+ MB
                      ELEV  WDIR  WDSD  TEMP  HUMD   PRES   SUN  H_24R  H_FX  \
timestamp                                                                      
2019-01-01 00:00:00  398.0  35.0   5.8  13.4  0.99  981.1 -99.0   18.5 -99.0   
2019-01-01 01:00:00  398.0  31.0   5.7  14.1  0.99  981.0 -99.0    0.5  10.8   
2019-01-01 02:00:00  398.0  35.0   5.3  13.9  0.99  980.7 -99.0    1.0 -99.0   
2019-01-01 03:00:00  398.0  32.0   5.7  13.8  0.99  980.2 -99.0    1.5 -99.0   
2019-01-01 04:00:00  398.0  37.0   6.9  13.8  0.99  980.0 -99.0    2.0  12.0   

                     H_XD H_FXT  D_TX D_TXT  D_TN D_TNT  
timestamp                                                
2019-01-01 00:00:00 -99.0 -99.0  14.5   NaN  13.4   NaN  
2019-01-01 01:00:00  35.0   NaN  14.1   NaN  13.5   NaN  
2019-01-01 02:00:00 -99.0 -99.0  14.1   NaN  13.5   NaN  
2019-01-01 03:00:00 -99.0 -99.0  14.1   NaN  13.5   NaN  
2019-01-01 04:00:00  39.0   NaN  14.1   NaN  13.5   NaN
</code></pre><p>In our tutorial so far, we&rsquo;ve successfully walked through the process of accessing and organizing three types of data: air quality (<code>air</code>), water level (<code>water</code>), and meteorological (<code>weather</code>) data. Each dataset was prepared by downloading, decompressing, filtering, and arranging the data for specific monitoring stations. This process sets a strong foundation for our next steps.</p>
<p>Now, we&rsquo;re going to delve into basic time series data processing using the air quality data as our example. Time series data processing is a method used to analyze and interpret data that is collected over time. Here&rsquo;s what we&rsquo;ll cover:</p>
<ol>
<li>
<p><strong>Basic Time Series Data Processing:</strong> We&rsquo;ll explore techniques to analyze the air quality data, looking at trends, patterns, and changes over time. This will involve techniques like plotting the data over time, calculating averages, and possibly identifying any anomalies or significant changes.</p>
</li>
<li>
<p><strong>Application to Other Data Types:</strong> The methods we use for the air quality data can be similarly applied to both water level and meteorological data. The principles of time series analysis remain the same, even though the specific data points and their implications may differ.</p>
</li>
<li>
<p><strong>Encouragement to Experiment:</strong> You&rsquo;re encouraged to try these methods on your own. Whether you choose to work with the water level or meteorological data, applying these time series data processing techniques will enhance your understanding and skills. Experimenting with different datasets is a great way to deepen your grasp of these concepts and discover insights specific to each type of data.</p>
</li>
</ol>
<p>By engaging in this hands-on process, you&rsquo;ll gain practical experience in handling and analyzing time series data, a valuable skill in many areas of research and data science.</p>
<h2 id="data-visualization">Data Visualization</h2>
<p>Data visualization plays a crucial role in the analysis of time series data. It transforms raw data into a visual context, such as charts or graphs, making it easier to understand, interpret, and derive insights. Let&rsquo;s explore how we can use data visualization, specifically focusing on air quality data:</p>
<ol>
<li>
<p><strong>Chronological Presentation:</strong> The first step in visualizing time series data is to present it in chronological order. This means arranging the data so that it shows changes over time. By doing this, users can quickly see overall trends, patterns, and anomalies within the dataset, which can spark new ideas and approaches for further analysis.</p>
</li>
<li>
<p><strong>Using Line Charts:</strong> One of the most common methods for visualizing time series data is through line charts. Line charts are particularly effective because they show how data points change over time, with the passage of time usually represented on the x-axis (horizontal) and the data points on the y-axis (vertical).</p>
</li>
<li>
<p><strong>Example with Air Quality Data:</strong></p>
<ul>
<li><strong>Plotting the Data:</strong> To visualize air quality data, we can plot various air quality metrics (like PM2.5, CO2 levels, etc.) on a line chart. Each line on the chart would represent a different metric.</li>
<li><strong>Identifying Trends:</strong> Line charts allow us to easily identify trends, such as periods of high pollution or sudden changes in air quality.</li>
<li><strong>Comparisons Over Time:</strong> We can also compare different time periods, such as different months or years, to see how air quality has changed over longer periods.</li>
</ul>
</li>
</ol>
<p>By using data visualization techniques like line charts, we make complex data more accessible and understandable. This is a powerful way to communicate data-driven insights and can be a stepping stone to more advanced analyses, such as identifying the causes of trends or predicting future air quality conditions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Setting up the figure size and resolution for the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the PM2.5 data from the air DataFrame.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(air[:][<span style="color:#e6db74">&#34;PM25&#34;</span>]) <span style="color:#75715e"># Simplified indexing.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Adding labels and title to the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Date&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;PM2.5&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;PM2.5 Time Series Plot&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Adjusting the layout for better fit and readability.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-3-1.png" alt="Python output"></p>
<h3 id="data-resample">Data Resample</h3>
<p>Data resampling is an important technique in time series analysis, especially when dealing with dense datasets like air quality measurements. Let&rsquo;s break down the concept and its application:</p>
<ol>
<li>
<p><strong>Understanding Data Density and Variability:</strong> In our air quality dataset, data is collected roughly every five minutes, resulting in a high density of data points. Additionally, the values can change rapidly due to environmental factors, leading to high variability. This level of detail can sometimes obscure broader trends in the data.</p>
</li>
<li>
<p><strong>The Challenge with High-Frequency Data:</strong> With data recorded every five minutes, it can be difficult to discern the overall trends in ambient air pollution. The frequent sampling captures a lot of detail, but this can also lead to a cluttered and overwhelming dataset.</p>
</li>
<li>
<p><strong>Resampling for Clarity:</strong> To address this, we use a technique called resampling. Resampling involves recalculating the data values over a larger, fixed time interval. This process simplifies the dataset, making it easier to see long-term trends and patterns.</p>
</li>
<li>
<p><strong>Resampling Syntax and Scales:</strong> To resample the data, we use specific programming commands. These commands allow us to change the sampling rate from every five minutes to a larger scale, such as hourly, daily, or monthly. By resampling, we can adjust the granularity of our data analysis to suit our needs.</p>
</li>
</ol>
<p>For example, if we&rsquo;re interested in daily trends in air quality, we can resample the data to calculate the average air quality for each day. This would give us a clearer view of how air quality changes day-to-day, rather than getting lost in the minute-to-minute fluctuations.</p>
<p>Resampling is a powerful tool in data analysis, as it allows us to tailor the dataset to our specific research questions and make more meaningful interpretations from the data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>air_hour <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>resample(<span style="color:#e6db74">&#39;H&#39;</span>)<span style="color:#f92672">.</span>mean() <span style="color:#75715e"># Resampling the air quality data to obtain hourly averages.</span>
</span></span><span style="display:flex;"><span>air_day <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>resample(<span style="color:#e6db74">&#39;D&#39;</span>)<span style="color:#f92672">.</span>mean() <span style="color:#75715e"># Resampling the air quality data to obtain daily averages.</span>
</span></span><span style="display:flex;"><span>air_month <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>resample(<span style="color:#e6db74">&#39;M&#39;</span>)<span style="color:#f92672">.</span>mean() <span style="color:#75715e"># Resampling the air quality data to obtain daily averages.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(air_hour<span style="color:#f92672">.</span>head()) <span style="color:#75715e"># Printing the first few rows of the hourly averaged data.</span>
</span></span><span style="display:flex;"><span>print(air_day<span style="color:#f92672">.</span>head()) <span style="color:#75715e"># Printing the first few rows of the daily averaged data.</span>
</span></span><span style="display:flex;"><span>print(air_month<span style="color:#f92672">.</span>head()) <span style="color:#75715e"># Printing the first few rows of the monthly averaged data.</span>
</span></span></code></pre></div><pre tabindex="0"><code>                         PM25
timestamp                     
2018-08-01 00:00:00  18.500000
2018-08-01 01:00:00  20.750000
2018-08-01 02:00:00  24.000000
2018-08-01 03:00:00  27.800000
2018-08-01 04:00:00  22.833333
                 PM25
timestamp            
2018-08-01  23.384615
2018-08-02  13.444444
2018-08-03  14.677419
2018-08-04  14.408451
2018-08-05        NaN
                 PM25
timestamp            
2018-08-31  21.704456
2018-09-30  31.797806
2018-10-31  37.217788
2018-11-30  43.228939
</code></pre><p>When we apply resampling to our air quality data, specifically averaging it on an hourly basis, the result is a transformed dataset that offers new insights:</p>
<ol>
<li>
<p><strong>Clearer Trends:</strong> By plotting the hourly averaged data, the overall trends in air quality become more apparent. This is because averaging the data over each hour smooths out the minute-to-minute variations, highlighting broader patterns that might be occurring throughout the day.</p>
</li>
<li>
<p><strong>Persistent Fluctuations:</strong> Despite this averaging, we might still observe significant fluctuations in the data. This indicates that even on an hourly scale, air quality can vary considerably. These fluctuations could be due to a variety of environmental factors, such as changes in traffic patterns, industrial activities, or natural phenomena affecting air quality.</p>
</li>
<li>
<p><strong>Visualizing the Data:</strong> In a line chart representing this resampled data, each point on the line now represents the average air quality for an hour. This visualization helps in identifying hours with particularly high or low air quality levels, which can be crucial for understanding air pollution trends and their potential impacts.</p>
</li>
<li>
<p><strong>Analytical Implications:</strong> The presence of large fluctuations even in the hourly data suggests that air quality is a dynamic attribute of the environment, influenced by many rapidly changing factors. This insight can guide further analysis, prompting questions about what causes these fluctuations and how they relate to human activities and natural processes.</p>
</li>
</ol>
<p>Overall, resampling and re-plotting the data in this manner is an essential step in time series analysis. It allows us to view the data at different scales, revealing patterns that might not be evident in the original, more granular dataset.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Setting up the figure size and resolution for the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the PM2.5 hourly average data from the air_hour DataFrame.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(air_hour[:][<span style="color:#e6db74">&#34;PM25&#34;</span>]) <span style="color:#75715e"># Simplified indexing.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Adding labels and title to the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Date&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;PM2.5&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;PM2.5 Time Series Plot&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Adjusting the layout for better fit and readability.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-3-2.png" alt="Python output"></p>
<h3 id="moving-average">Moving Average</h3>
<p>The moving average is a useful technique for smoothing out time series data, particularly when we&rsquo;re interested in identifying broader trends rather than focusing on individual data points. Here&rsquo;s how it works in the context of our air quality dataset:</p>
<ol>
<li>
<p><strong>Concept of the Moving Average:</strong> The moving average involves creating a &lsquo;sampling window&rsquo; that slides across the time series data. At each position of this window, we calculate the average value of all the data points within it. This process effectively smooths out short-term fluctuations and highlights longer-term trends in the data.</p>
</li>
<li>
<p><strong>Setting the Sampling Window Size:</strong> The size of the sampling window is a crucial decision. For instance, a window size of 10 means that each data point in the moving average will be the average of the current value and the previous 9 values. This window size can be adjusted depending on how much smoothing is desired.</p>
</li>
<li>
<p><strong>Interpreting the Smoothed Data:</strong> After applying the moving average, each data point represents an average over a period, rather than a single moment in time. This smooths out abrupt changes and reduces the &rsquo;noise&rsquo; in the data, making it easier to see overall trends.</p>
</li>
<li>
<p><strong>Visualizing Trends:</strong> When we plot this moving average on a chart, the result is a smoother curve that more clearly shows how the air quality changes over time. This can be particularly helpful in identifying trends that might be obscured in the more volatile original data.</p>
</li>
<li>
<p><strong>Analytical Benefits:</strong> Applying a moving average is especially useful in environments where conditions change rapidly, like air quality. It helps in understanding the general pattern of air quality over time, without getting distracted by short-term spikes or drops.</p>
</li>
</ol>
<p>In summary, the moving average is a powerful tool for simplifying and clarifying time series data, making it an invaluable method for analyzing and understanding complex datasets like air quality measurements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating a Moving Average (MA) DataFrame from the hourly averaged data.</span>
</span></span><span style="display:flex;"><span>MA <span style="color:#f92672">=</span> air_hour
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculating a 500-point moving average of the data.</span>
</span></span><span style="display:flex;"><span>MA10 <span style="color:#f92672">=</span> MA<span style="color:#f92672">.</span>rolling(window<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, min_periods<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Joining the original hourly data with the 500-point moving average data.</span>
</span></span><span style="display:flex;"><span>MA_combined <span style="color:#f92672">=</span> MA<span style="color:#f92672">.</span>join(MA10<span style="color:#f92672">.</span>add_suffix(<span style="color:#e6db74">&#39;_mean_500&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting both the original data and the moving average data.</span>
</span></span><span style="display:flex;"><span>MA_combined<span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The commented line is not necessary as it was intended to plot only the moving average data.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MA10.plot(figsize(15, 10))</span>
</span></span></code></pre></div><p><img src="figures/4-1-3-3.png" alt="Python output"></p>
<p>The comparison between the original data and the moving average in our visualization, represented by the blue and orange lines respectively, illustrates the effectiveness of the moving average method in time series analysis:</p>
<ol>
<li>
<p><strong>Contrast in Trends:</strong> The blue line, representing the original data, likely shows more variability and rapid fluctuations. This is typical of raw time series data, where every small change is recorded. The orange line, on the other hand, represents the data after applying the moving average. This line will appear smoother, with fewer peaks and troughs.</p>
</li>
<li>
<p><strong>Improved Representation of Trends:</strong> The smoother curve of the moving average (orange line) provides a clearer picture of the overall trend in the air quality data. By averaging out the data over a set period, it removes the noise caused by short-term fluctuations, making it easier to discern longer-term patterns and trends.</p>
</li>
<li>
<p><strong>Regular Fluctuations:</strong> Despite the smoothing, the orange line may still show regular fluctuations. These fluctuations, now more discernible due to the reduced noise, can indicate underlying patterns in the data, such as daily or weekly cycles in air quality changes.</p>
</li>
<li>
<p><strong>Further Analysis:</strong> The presence of these regular fluctuations in the moving average curve is noteworthy. It suggests that there are consistent factors affecting air quality over time, which could be linked to human activities (like traffic patterns or industrial emissions) or natural phenomena (like weather changes). This observation can lead to more targeted and in-depth analysis.</p>
</li>
</ol>
<p>In summary, the moving average technique not only simplifies the data for easier interpretation but also reveals important aspects of the data that may not be immediately apparent in the original time series. This makes it a valuable tool for initial exploration and identification of trends in complex datasets.</p>
<h3 id="multi-line-charts">Multi-line Charts</h3>
<p>Segmenting data into distinct time periods and then visualizing these segments together is an effective way to compare how data trends vary over different times. Here&rsquo;s how this approach can be applied to our air quality data:</p>
<ol>
<li>
<p><strong>Segmentation by Time Periods:</strong> First, we divide the air quality data into separate subsets based on specific time intervals, like years. In our case, we&rsquo;re considering four subsets: 2019, 2020, 2021, and 2022.</p>
</li>
<li>
<p><strong>Creating Individual Line Charts:</strong> For each subset, we create a line chart that represents the air quality trends during that particular time period. Each line chart will reflect the unique characteristics of its respective year.</p>
</li>
<li>
<p><strong>Superimposing on a Multi-Line Chart:</strong> Once we have individual line charts for each year, we overlay them onto a single chart. This multi-line chart allows us to directly compare the different time periods. Each year’s data can be represented by a line of a different color for clarity.</p>
</li>
<li>
<p><strong>Analysis and Comparison:</strong> With this visualization, it becomes easier to observe how air quality has changed year over year. We can identify patterns, such as specific times of the year where air quality tends to worsen or improve, and see how these patterns shift from one year to the next.</p>
</li>
<li>
<p><strong>Insights and Implications:</strong> This kind of comparison is particularly useful for understanding long-term trends and the impact of external factors (like policy changes, environmental events, or industrial activities) on air quality over time. It can also help in predicting future trends based on past patterns.</p>
</li>
</ol>
<p>Overall, this method of segmenting data and comparing it across different time periods in a multi-line chart is a powerful tool for data visualization. It helps in uncovering deeper insights and makes complex time series data more approachable and understandable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Resetting the index of the monthly averaged air data to access &#39;timestamp&#39; column.</span>
</span></span><span style="display:flex;"><span>air_month<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extracting the year and month from the &#39;timestamp&#39; column.</span>
</span></span><span style="display:flex;"><span>air_month[<span style="color:#e6db74">&#39;year&#39;</span>] <span style="color:#f92672">=</span> [d<span style="color:#f92672">.</span>year <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> air_month<span style="color:#f92672">.</span>timestamp]
</span></span><span style="display:flex;"><span>air_month[<span style="color:#e6db74">&#39;month&#39;</span>] <span style="color:#f92672">=</span> [d<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%b&#39;</span>) <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> air_month<span style="color:#f92672">.</span>timestamp]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Getting the unique years for plotting.</span>
</span></span><span style="display:flex;"><span>years <span style="color:#f92672">=</span> air_month[<span style="color:#e6db74">&#39;year&#39;</span>]<span style="color:#f92672">.</span>unique()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying the air DataFrame for reference (this could be removed if not needed).</span>
</span></span><span style="display:flex;"><span>print(air)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting a random seed for color consistency and generating random colors for each year.</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>mycolors <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>choice(list(mpl<span style="color:#f92672">.</span>colors<span style="color:#f92672">.</span>XKCD_COLORS<span style="color:#f92672">.</span>keys()), len(years), replace<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting up the figure size and resolution for the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, y <span style="color:#f92672">in</span> enumerate(years):
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>: <span style="color:#75715e"># Starting from the second year to avoid plotting incomplete data for the first year.</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(<span style="color:#e6db74">&#39;month&#39;</span>, <span style="color:#e6db74">&#39;PM25&#39;</span>, data<span style="color:#f92672">=</span>air_month<span style="color:#f92672">.</span>loc[air_month<span style="color:#f92672">.</span>year<span style="color:#f92672">==</span>y, :], color<span style="color:#f92672">=</span>mycolors[i], label<span style="color:#f92672">=</span>y)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Adding text annotations for each year&#39;s line.</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>text(air_month<span style="color:#f92672">.</span>loc[air_month<span style="color:#f92672">.</span>year<span style="color:#f92672">==</span>y, :]<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">.9</span>, air_month<span style="color:#f92672">.</span>loc[air_month<span style="color:#f92672">.</span>year<span style="color:#f92672">==</span>y, <span style="color:#e6db74">&#39;PM25&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:]<span style="color:#f92672">.</span>values[<span style="color:#ae81ff">0</span>], y, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>, color<span style="color:#f92672">=</span>mycolors[i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Uncomment the following lines to set the axis limits and labels, and to customize ticks and title.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># plt.gca().set(xlim=(-0.3, 11), ylim=(2, 30), ylabel=&#39;PM25&#39;, xlabel=&#39;Month&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># plt.yticks(fontsize=12, alpha=.7)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># plt.title(&#39;Seasonal Plot of PM25 Time Series&#39;, fontsize=20)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-3-4.png" alt="Python output"></p>
<p>The observations we&rsquo;ve made from the multi-line chart of air quality data across different years provide valuable insights into both the data quality and the seasonal trends in air quality:</p>
<ol>
<li>
<p><strong>Missing Values in 2019 Data:</strong> The significant portion of missing values in the 2019 data highlights an issue with data completeness. This can occur due to various reasons such as sensor malfunctions, data recording issues, or gaps in data collection. It&rsquo;s important to note these missing values, as they can affect the reliability and accuracy of any analysis conducted for that year.</p>
</li>
<li>
<p><strong>Partial Data for 2022:</strong> The observation that the 2022 data only extends until July indicates that the dataset is not complete for the current year. This is a common scenario in real-time or ongoing data collection processes. For any analysis or conclusions drawn for 2022, it&rsquo;s important to remember that they are based on partial-year data and might not represent the full year&rsquo;s trends.</p>
</li>
<li>
<p><strong>Seasonal Trends Across Years:</strong> The consistent pattern observed across different years, where air quality reaches its lowest point in summer, begins to worsen in autumn, and peaks in winter, is a significant finding. This pattern suggests a strong seasonal influence on air quality. Such trends can be due to a variety of factors, including changes in weather conditions, heating usage, and variations in human activities across seasons.</p>
</li>
<li>
<p><strong>Implications for Analysis and Policy:</strong> Understanding these seasonal trends is crucial for air quality management and policy-making. For instance, measures to improve air quality might need to be intensified in autumn and winter months. Additionally, this insight can guide further research to investigate the specific causes of these seasonal fluctuations.</p>
</li>
</ol>
<p>By analyzing these multi-year trends and noting both data completeness and seasonal patterns, we can gain a deeper understanding of the dynamics affecting air quality. This kind of analysis is vital for informed decision-making in environmental management and public health policy.</p>
<h3 id="calendar-heatmap">Calendar Heatmap</h3>
<p>The calendar heatmap is an innovative way to visualize time series data, particularly effective for showing how values change over time and identifying patterns related to specific dates or time periods. Here&rsquo;s a breakdown of how it works using air quality data, specifically PM2.5 averages:</p>
<ol>
<li>
<p><strong>Combining Calendar and Heatmap:</strong> A calendar heatmap combines elements of a traditional calendar with a heatmap. Each day is represented as a cell in the calendar, and the color intensity in each cell indicates the value of the data for that day. This format makes it easy to see trends and patterns at a glance.</p>
</li>
<li>
<p><strong>Using Calplot in Python:</strong> Calplot is a Python library specifically designed for creating calendar heatmaps. It&rsquo;s an effective tool for this type of visualization because it&rsquo;s tailored to represent time series data in a calendar format.</p>
</li>
<li>
<p><strong>Color Coding with <code>cmap</code>:</strong> The <code>cmap</code> parameter in Calplot allows us to select the color scheme for the heatmap. In our case, we&rsquo;re using <code>GnBu</code>, which typically ranges from green (representing lower values) to blue (indicating higher values). The choice of color scheme is important as it visually communicates the data&rsquo;s range and intensity.</p>
</li>
<li>
<p><strong>Interpreting the Heatmap:</strong> In the resulting heatmap, days with higher PM2.5 averages will appear in darker blue, while days with lower averages will be in lighter green or white. Days without data or with a value of zero will be uncolored or differently marked, indicating missing data.</p>
</li>
<li>
<p><strong>Correlation with Seasonal Trends:</strong> The calendar heatmap for PM2.5 levels complements our earlier observations with the multi-line chart. For example, we might observe that the summer months are represented with lighter colors (lower PM2.5 values), while the winter months are darker (higher PM2.5 values), aligning with the seasonal trends identified earlier.</p>
</li>
<li>
<p><strong>Analytical Insights:</strong> This visualization method is particularly useful for identifying specific days or periods with unusually high or low air quality. It can also help in correlating air quality with specific events or environmental factors.</p>
</li>
</ol>
<p>In summary, the calendar heatmap is a powerful tool for visualizing and analyzing time series data, offering an intuitive and visually engaging way to understand complex patterns and trends over time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># cmap: color map (https://matplotlib.org/stable/gallery/color/colormap_reference.html)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Using calplot to create a calendar heatmap of the daily averaged PM2.5 data.</span>
</span></span><span style="display:flex;"><span>pl1 <span style="color:#f92672">=</span> calplot<span style="color:#f92672">.</span>calplot(data <span style="color:#f92672">=</span> air_day[<span style="color:#e6db74">&#39;PM25&#39;</span>], cmap <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GnBu&#39;</span>, textformat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{:.0f}</span><span style="color:#e6db74">&#39;</span>, 
</span></span><span style="display:flex;"><span>											figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">12</span>), suptitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;PM25 by Month and Year&#34;</span>)
</span></span></code></pre></div><p><img src="figures/4-1-3-5.png" alt="Python output"></p>
<h2 id="data-quality-inspection">Data Quality Inspection</h2>
<p>Data quality inspection is a critical aspect of time series analysis, ensuring that the data we&rsquo;re working with is reliable and accurate. Here, we&rsquo;ll delve into some fundamental methods for assessing and improving data quality, using a Python library called kats.</p>
<ol>
<li>
<p><strong>Outlier Detection:</strong></p>
<ul>
<li><strong>Purpose:</strong> Outliers are data points that significantly differ from other observations. They can arise due to measurement errors, data entry errors, or genuine but rare variations.</li>
<li><strong>Method with kats:</strong> Kats provides functions to identify these outliers. By detecting outliers, we can decide whether to investigate them further, adjust them, or exclude them from our analysis, depending on their nature and impact.</li>
</ul>
</li>
<li>
<p><strong>Change Point Detection:</strong></p>
<ul>
<li><strong>Purpose:</strong> Change point detection involves identifying points in time where the statistical properties of the data series change significantly. These points can indicate important shifts in the underlying system that generates the data.</li>
<li><strong>Method with kats:</strong> Kats can detect these change points, helping us understand when and possibly why these shifts occur. This is particularly useful in time series data like air quality measurements, where changes could indicate environmental events or policy impacts.</li>
</ul>
</li>
<li>
<p><strong>Handling Missing Values:</strong></p>
<ul>
<li><strong>Challenge:</strong> Missing values can skew analysis and lead to inaccurate conclusions. They can occur due to various reasons, such as data collection issues or sensor malfunctions.</li>
<li><strong>Method with kats:</strong> Kats offers tools to handle missing values effectively. This might involve imputing missing data based on surrounding data points, or excluding periods with missing data from certain types of analysis.</li>
</ul>
</li>
</ol>
<p>By utilizing kats for data quality inspection, we can enhance the integrity of our data analysis. This process is crucial in ensuring that our findings and conclusions are based on robust and reliable data, which is especially important in fields where data-driven decisions can have significant impacts, such as environmental monitoring and public health.</p>
<h3 id="outlier-detection">Outlier Detection</h3>
<p>Dealing with outliers is an essential step in ensuring the accuracy of our time series analysis. Here&rsquo;s how we can identify and manage outliers in our air quality data using the kats package in Python:</p>
<ol>
<li>
<p><strong>Understanding Outliers:</strong> Outliers are data points that are significantly different from the majority of the data. They can occur due to various reasons, such as measurement errors, data entry mistakes, or unusual but real variations. In the context of air quality data, outliers could represent unexpected pollution events or sensor malfunctions.</p>
</li>
<li>
<p><strong>Conversion to <code>TimeSeriesData</code>:</strong></p>
<ul>
<li><strong>Initial Step:</strong> Before we can use kats to analyze our data, we need to convert the data from its current DataFrame format into the <code>TimeSeriesData</code> format that kats uses.</li>
<li><strong>Conversion Process:</strong> This involves transforming the data stored in the <code>air_hour</code> variable (which is presumably an hourly aggregated DataFrame) into the <code>TimeSeriesData</code> format. This format is designed specifically for time series analysis in kats.</li>
<li><strong>Saving the Converted Data:</strong> Once converted, save this new time series data into a variable, let&rsquo;s call it <code>air_ts</code>.</li>
</ul>
</li>
<li>
<p><strong>Re-plotting the Data:</strong></p>
<ul>
<li><strong>Visual Inspection:</strong> After conversion, re-plotting the data as a line chart can be a good starting point. This visual representation can sometimes make outliers immediately apparent, showing data points that deviate significantly from the overall trend.</li>
<li><strong>Analysis with kats:</strong> With the data in the correct format, we can now use kats to perform a more systematic outlier detection. Kats offer various methods to identify outliers, considering the unique characteristics of time series data.</li>
</ul>
</li>
<li>
<p><strong>Dealing with Outliers:</strong></p>
<ul>
<li><strong>Flagging:</strong> Identify and mark outliers without removing them. This approach is useful if we want to study the outliers separately or if we suspect they might represent significant but rare events.</li>
<li><strong>Removing:</strong> Exclude outliers from the dataset. This approach is more suitable if the outliers are due to errors and are not representative of the underlying phenomenon we&rsquo;re studying.</li>
<li><strong>Special Treatment:</strong> Adjust outliers using statistical methods, such as imputation, to align them more closely with other data points. This method is used when we want to retain the information provided by the outliers but mitigate their impact on the analysis.</li>
</ul>
</li>
</ol>
<p>By carefully managing outliers, we ensure that our analysis of air quality data is both accurate and representative, leading to more reliable conclusions and insights.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating a TimeSeriesData object from the air_hour DataFrame for time series analysis using Kats.</span>
</span></span><span style="display:flex;"><span>air_ts <span style="color:#f92672">=</span> TimeSeriesData(air_hour<span style="color:#f92672">.</span>reset_index(), time_col_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the PM2.5 data using Kats.</span>
</span></span><span style="display:flex;"><span>air_ts<span style="color:#f92672">.</span>plot(cols<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;PM25&#34;</span>])
</span></span></code></pre></div><p><img src="figures/4-1-4-1.png" alt="Python output"></p>
<p>Using the <code>OutlierDetector</code> tool from the kats suite is a robust way to detect outliers in our time series data. This method relies on statistical measures to identify data points that are significantly different from the rest. Here&rsquo;s how it works:</p>
<ol>
<li>
<p><strong>Understanding Quartiles and IQR:</strong></p>
<ul>
<li><strong>Quartiles:</strong> In statistics, quartiles divide a data set into four equal parts. The first quartile (Q1) is the median of the lower half of the dataset, while the third quartile (Q3) is the median of the upper half.</li>
<li><strong>Interquartile Range (IQR):</strong> The IQR is the range between the first and third quartiles (Q3 - Q1). It measures the spread of the middle 50% of the data.</li>
</ul>
</li>
<li>
<p><strong>Outlier Detection Criteria:</strong></p>
<ul>
<li><strong>Lower Bound:</strong> A data point is considered an outlier if it is less than 1.5 times the IQR below the first quartile (Q1 - 1.5 * IQR).</li>
<li><strong>Upper Bound:</strong> Similarly, a data point is an outlier if it is more than 1.5 times the IQR above the third quartile (Q3 + 1.5 * IQR).</li>
<li><strong>Rationale:</strong> This method, based on the IQR, is effective because it defines outliers in the context of the data&rsquo;s overall distribution, accounting for its variability.</li>
</ul>
</li>
<li>
<p><strong>Using <code>OutlierDetector</code> in kats:</strong></p>
<ul>
<li><strong>Application:</strong> You can apply the <code>OutlierDetector</code> tool to our <code>air_ts</code> data. This tool will automatically calculate Q1, Q3, and the IQR, and then use these to identify outliers based on the criteria mentioned above.</li>
<li><strong>Configuration:</strong> Ensure that the <code>OutlierDetector</code> is configured to use the IQR method for outlier detection. Kats may offer multiple methods, so selecting the right one for our specific analysis is important.</li>
</ul>
</li>
<li>
<p><strong>Results Interpretation:</strong></p>
<ul>
<li><strong>Identifying Outliers:</strong> The <code>OutlierDetector</code> will flag the outliers in our dataset. These might be unusually high or low air quality readings.</li>
<li><strong>Decision Making:</strong> Once identified, we can decide how to handle these outliers – whether to remove them, adjust them, or analyze them separately to understand their cause.</li>
</ul>
</li>
</ol>
<p>This approach to outlier detection is particularly useful in time series data like air quality measurements, where outliers can significantly impact the analysis. By identifying and appropriately handling these outliers, we can ensure that our analysis is more accurate and representative of the actual trends and patterns in the data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Initializing the OutlierDetector from Kats for the air_ts time series data.</span>
</span></span><span style="display:flex;"><span>outlierDetection <span style="color:#f92672">=</span> OutlierDetector(air_ts, <span style="color:#e6db74">&#39;additive&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Running the outlier detection algorithm.</span>
</span></span><span style="display:flex;"><span>outlierDetection<span style="color:#f92672">.</span>detector()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Accessing and displaying the detected outliers.</span>
</span></span><span style="display:flex;"><span>outlierDetection<span style="color:#f92672">.</span>outliers
</span></span></code></pre></div><pre tabindex="0"><code>[[Timestamp(&#39;2018-08-10 16:00:00&#39;),
  Timestamp(&#39;2018-08-10 17:00:00&#39;),
  Timestamp(&#39;2018-08-20 00:00:00&#39;),
  Timestamp(&#39;2018-08-23 03:00:00&#39;),
  Timestamp(&#39;2018-08-23 04:00:00&#39;),
  Timestamp(&#39;2018-09-02 11:00:00&#39;),
  Timestamp(&#39;2018-09-11 00:00:00&#39;),
  Timestamp(&#39;2018-09-13 14:00:00&#39;),
  Timestamp(&#39;2018-09-13 15:00:00&#39;),
  Timestamp(&#39;2018-09-13 16:00:00&#39;),
  Timestamp(&#39;2018-09-15 08:00:00&#39;),
  Timestamp(&#39;2018-09-15 09:00:00&#39;),
  Timestamp(&#39;2018-09-15 10:00:00&#39;),
  Timestamp(&#39;2018-09-15 11:00:00&#39;),
  Timestamp(&#39;2018-09-22 05:00:00&#39;),
  Timestamp(&#39;2018-09-22 06:00:00&#39;),
  Timestamp(&#39;2018-10-26 01:00:00&#39;),
  Timestamp(&#39;2018-11-06 13:00:00&#39;),
  Timestamp(&#39;2018-11-06 15:00:00&#39;),
  Timestamp(&#39;2018-11-06 16:00:00&#39;),
  Timestamp(&#39;2018-11-06 19:00:00&#39;),
  Timestamp(&#39;2018-11-06 20:00:00&#39;),
  Timestamp(&#39;2018-11-06 21:00:00&#39;),
  Timestamp(&#39;2018-11-06 22:00:00&#39;),
  Timestamp(&#39;2018-11-07 07:00:00&#39;),
  Timestamp(&#39;2018-11-07 08:00:00&#39;),
  Timestamp(&#39;2018-11-07 09:00:00&#39;),
  Timestamp(&#39;2018-11-09 00:00:00&#39;),
  Timestamp(&#39;2018-11-09 01:00:00&#39;),
  Timestamp(&#39;2018-11-09 02:00:00&#39;),
  Timestamp(&#39;2018-11-09 03:00:00&#39;),
  Timestamp(&#39;2018-11-10 02:00:00&#39;),
  Timestamp(&#39;2018-11-10 03:00:00&#39;),
  Timestamp(&#39;2018-11-16 01:00:00&#39;),
  Timestamp(&#39;2018-11-16 02:00:00&#39;),
  Timestamp(&#39;2018-11-16 03:00:00&#39;),
  Timestamp(&#39;2018-11-16 04:00:00&#39;),
  Timestamp(&#39;2018-11-21 00:00:00&#39;),
  Timestamp(&#39;2018-11-21 18:00:00&#39;),
  Timestamp(&#39;2018-11-21 19:00:00&#39;),
  Timestamp(&#39;2018-11-25 08:00:00&#39;),
  Timestamp(&#39;2018-11-30 14:00:00&#39;),
  Timestamp(&#39;2018-12-01 06:00:00&#39;),
  Timestamp(&#39;2018-12-01 16:00:00&#39;),
  Timestamp(&#39;2018-12-01 17:00:00&#39;),
  Timestamp(&#39;2018-12-15 02:00:00&#39;),
  Timestamp(&#39;2018-12-19 03:00:00&#39;),
  Timestamp(&#39;2018-12-19 04:00:00&#39;),
  Timestamp(&#39;2018-12-19 05:00:00&#39;),
  Timestamp(&#39;2018-12-19 06:00:00&#39;),
  Timestamp(&#39;2018-12-19 07:00:00&#39;),
  Timestamp(&#39;2018-12-19 08:00:00&#39;),
  Timestamp(&#39;2018-12-19 10:00:00&#39;),
  Timestamp(&#39;2018-12-19 11:00:00&#39;),
  Timestamp(&#39;2018-12-19 12:00:00&#39;),
  Timestamp(&#39;2018-12-19 13:00:00&#39;),
  Timestamp(&#39;2018-12-19 14:00:00&#39;),
  Timestamp(&#39;2018-12-19 15:00:00&#39;),
  Timestamp(&#39;2018-12-19 16:00:00&#39;),
  Timestamp(&#39;2018-12-19 17:00:00&#39;),
  Timestamp(&#39;2018-12-20 03:00:00&#39;),
  Timestamp(&#39;2018-12-20 04:00:00&#39;),
  Timestamp(&#39;2018-12-20 05:00:00&#39;),
  Timestamp(&#39;2018-12-20 06:00:00&#39;),
  Timestamp(&#39;2018-12-20 07:00:00&#39;),
  Timestamp(&#39;2018-12-20 08:00:00&#39;),
  Timestamp(&#39;2018-12-20 11:00:00&#39;),
  Timestamp(&#39;2018-12-20 12:00:00&#39;),
  Timestamp(&#39;2018-12-20 13:00:00&#39;),
  Timestamp(&#39;2018-12-20 14:00:00&#39;),
  Timestamp(&#39;2018-12-20 15:00:00&#39;),
  Timestamp(&#39;2019-01-05 02:00:00&#39;),
  Timestamp(&#39;2019-01-05 08:00:00&#39;),
  Timestamp(&#39;2019-01-05 09:00:00&#39;),
  Timestamp(&#39;2019-01-05 22:00:00&#39;),
  Timestamp(&#39;2019-01-19 06:00:00&#39;),
  Timestamp(&#39;2019-01-19 07:00:00&#39;),
  Timestamp(&#39;2019-01-19 08:00:00&#39;),
  Timestamp(&#39;2019-01-19 09:00:00&#39;),
  Timestamp(&#39;2019-01-19 13:00:00&#39;),
  Timestamp(&#39;2019-01-19 14:00:00&#39;),
  Timestamp(&#39;2019-01-19 15:00:00&#39;),
  Timestamp(&#39;2019-01-25 18:00:00&#39;),
  Timestamp(&#39;2019-01-25 19:00:00&#39;),
  Timestamp(&#39;2019-01-25 20:00:00&#39;),
  Timestamp(&#39;2019-01-26 00:00:00&#39;),
  Timestamp(&#39;2019-01-26 01:00:00&#39;),
  Timestamp(&#39;2019-01-26 02:00:00&#39;),
  Timestamp(&#39;2019-01-26 03:00:00&#39;),
  Timestamp(&#39;2019-01-26 04:00:00&#39;),
  Timestamp(&#39;2019-01-30 06:00:00&#39;),
  Timestamp(&#39;2019-01-30 11:00:00&#39;),
  Timestamp(&#39;2019-01-30 12:00:00&#39;),
  Timestamp(&#39;2019-01-30 13:00:00&#39;),
  Timestamp(&#39;2019-01-30 14:00:00&#39;),
  Timestamp(&#39;2019-02-02 16:00:00&#39;),
  Timestamp(&#39;2019-02-02 17:00:00&#39;),
  Timestamp(&#39;2019-02-02 18:00:00&#39;),
  Timestamp(&#39;2019-02-02 19:00:00&#39;),
  Timestamp(&#39;2019-02-02 20:00:00&#39;),
  Timestamp(&#39;2019-02-03 03:00:00&#39;),
  Timestamp(&#39;2019-02-03 04:00:00&#39;),
  Timestamp(&#39;2019-02-03 05:00:00&#39;),
  Timestamp(&#39;2019-02-03 06:00:00&#39;),
  Timestamp(&#39;2019-02-03 07:00:00&#39;),
  Timestamp(&#39;2019-02-03 10:00:00&#39;),
  Timestamp(&#39;2019-02-03 11:00:00&#39;),
  Timestamp(&#39;2019-02-03 12:00:00&#39;),
  Timestamp(&#39;2019-02-03 13:00:00&#39;),
  Timestamp(&#39;2019-02-03 22:00:00&#39;),
  Timestamp(&#39;2019-02-03 23:00:00&#39;),
  Timestamp(&#39;2019-02-07 05:00:00&#39;),
  Timestamp(&#39;2019-02-07 06:00:00&#39;),
  Timestamp(&#39;2019-02-16 22:00:00&#39;),
  Timestamp(&#39;2019-02-16 23:00:00&#39;),
  Timestamp(&#39;2019-02-18 18:00:00&#39;),
  Timestamp(&#39;2019-02-18 20:00:00&#39;),
  Timestamp(&#39;2019-02-18 21:00:00&#39;),
  Timestamp(&#39;2019-02-19 10:00:00&#39;),
  Timestamp(&#39;2019-02-19 11:00:00&#39;),
  Timestamp(&#39;2019-02-19 12:00:00&#39;),
  Timestamp(&#39;2019-02-19 13:00:00&#39;),
  Timestamp(&#39;2019-02-19 14:00:00&#39;),
  Timestamp(&#39;2019-02-19 15:00:00&#39;),
  Timestamp(&#39;2019-02-19 16:00:00&#39;),
  Timestamp(&#39;2019-02-19 23:00:00&#39;),
  Timestamp(&#39;2019-02-20 00:00:00&#39;),
  Timestamp(&#39;2019-02-20 03:00:00&#39;),
  Timestamp(&#39;2019-03-02 17:00:00&#39;),
  Timestamp(&#39;2019-03-03 06:00:00&#39;),
  Timestamp(&#39;2019-03-05 13:00:00&#39;),
  Timestamp(&#39;2019-03-09 23:00:00&#39;),
  Timestamp(&#39;2019-03-12 01:00:00&#39;),
  Timestamp(&#39;2019-03-16 01:00:00&#39;),
  Timestamp(&#39;2019-03-16 02:00:00&#39;),
  Timestamp(&#39;2019-03-16 03:00:00&#39;),
  Timestamp(&#39;2019-03-20 00:00:00&#39;),
  Timestamp(&#39;2019-03-20 01:00:00&#39;),
  Timestamp(&#39;2019-03-20 02:00:00&#39;),
  Timestamp(&#39;2019-03-20 03:00:00&#39;),
  Timestamp(&#39;2019-03-20 11:00:00&#39;),
  Timestamp(&#39;2019-03-27 00:00:00&#39;),
  Timestamp(&#39;2019-03-27 01:00:00&#39;),
  Timestamp(&#39;2019-04-05 03:00:00&#39;),
  Timestamp(&#39;2019-04-18 17:00:00&#39;),
  Timestamp(&#39;2019-04-20 16:00:00&#39;),
  Timestamp(&#39;2019-05-10 07:00:00&#39;),
  Timestamp(&#39;2019-05-22 20:00:00&#39;),
  Timestamp(&#39;2019-05-23 03:00:00&#39;),
  Timestamp(&#39;2019-05-23 16:00:00&#39;),
  Timestamp(&#39;2019-05-26 18:00:00&#39;),
  Timestamp(&#39;2019-05-27 05:00:00&#39;),
  Timestamp(&#39;2019-07-28 01:00:00&#39;),
  Timestamp(&#39;2019-08-23 08:00:00&#39;),
  Timestamp(&#39;2019-08-24 02:00:00&#39;),
  Timestamp(&#39;2019-08-24 03:00:00&#39;),
  Timestamp(&#39;2019-08-24 04:00:00&#39;),
  Timestamp(&#39;2019-08-24 05:00:00&#39;),
  Timestamp(&#39;2019-08-24 07:00:00&#39;),
  Timestamp(&#39;2019-08-24 08:00:00&#39;),
  Timestamp(&#39;2019-12-10 11:00:00&#39;),
  Timestamp(&#39;2019-12-10 12:00:00&#39;),
  Timestamp(&#39;2019-12-10 13:00:00&#39;),
  Timestamp(&#39;2019-12-10 20:00:00&#39;),
  Timestamp(&#39;2019-12-11 04:00:00&#39;),
  Timestamp(&#39;2019-12-16 20:00:00&#39;),
  Timestamp(&#39;2019-12-17 11:00:00&#39;),
  Timestamp(&#39;2020-01-03 15:00:00&#39;),
  Timestamp(&#39;2020-01-05 08:00:00&#39;),
  Timestamp(&#39;2020-01-05 09:00:00&#39;),
  Timestamp(&#39;2020-01-06 08:00:00&#39;),
  Timestamp(&#39;2020-01-07 10:00:00&#39;),
  Timestamp(&#39;2020-01-07 15:00:00&#39;),
  Timestamp(&#39;2020-01-10 11:00:00&#39;),
  Timestamp(&#39;2020-01-15 08:00:00&#39;),
  Timestamp(&#39;2020-01-22 14:00:00&#39;),
  Timestamp(&#39;2020-01-22 17:00:00&#39;),
  Timestamp(&#39;2020-01-22 22:00:00&#39;),
  Timestamp(&#39;2020-01-22 23:00:00&#39;),
  Timestamp(&#39;2020-01-23 00:00:00&#39;),
  Timestamp(&#39;2020-01-23 01:00:00&#39;),
  Timestamp(&#39;2020-01-23 02:00:00&#39;),
  Timestamp(&#39;2020-01-23 10:00:00&#39;),
  Timestamp(&#39;2020-01-23 11:00:00&#39;),
  Timestamp(&#39;2020-01-23 12:00:00&#39;),
  Timestamp(&#39;2020-01-23 13:00:00&#39;),
  Timestamp(&#39;2020-01-23 15:00:00&#39;),
  Timestamp(&#39;2020-01-23 16:00:00&#39;),
  Timestamp(&#39;2020-01-23 17:00:00&#39;),
  Timestamp(&#39;2020-01-23 18:00:00&#39;),
  Timestamp(&#39;2020-01-23 20:00:00&#39;),
  Timestamp(&#39;2020-01-23 21:00:00&#39;),
  Timestamp(&#39;2020-01-23 22:00:00&#39;),
  Timestamp(&#39;2020-01-23 23:00:00&#39;),
  Timestamp(&#39;2020-01-24 00:00:00&#39;),
  Timestamp(&#39;2020-01-24 01:00:00&#39;),
  Timestamp(&#39;2020-01-24 02:00:00&#39;),
  Timestamp(&#39;2020-01-24 03:00:00&#39;),
  Timestamp(&#39;2020-02-12 10:00:00&#39;),
  Timestamp(&#39;2020-02-12 11:00:00&#39;),
  Timestamp(&#39;2020-02-12 12:00:00&#39;),
  Timestamp(&#39;2020-02-12 13:00:00&#39;),
  Timestamp(&#39;2020-02-12 14:00:00&#39;),
  Timestamp(&#39;2020-02-12 19:00:00&#39;),
  Timestamp(&#39;2020-02-12 20:00:00&#39;),
  Timestamp(&#39;2020-02-12 22:00:00&#39;),
  Timestamp(&#39;2020-02-12 23:00:00&#39;),
  Timestamp(&#39;2020-02-13 20:00:00&#39;),
  Timestamp(&#39;2020-02-14 00:00:00&#39;),
  Timestamp(&#39;2020-02-14 01:00:00&#39;),
  Timestamp(&#39;2020-02-15 10:00:00&#39;),
  Timestamp(&#39;2020-02-19 08:00:00&#39;),
  Timestamp(&#39;2020-02-19 09:00:00&#39;),
  Timestamp(&#39;2020-02-19 10:00:00&#39;),
  Timestamp(&#39;2020-02-25 02:00:00&#39;),
  Timestamp(&#39;2020-02-25 03:00:00&#39;),
  Timestamp(&#39;2020-03-09 07:00:00&#39;),
  Timestamp(&#39;2020-03-18 21:00:00&#39;),
  Timestamp(&#39;2020-03-18 22:00:00&#39;),
  Timestamp(&#39;2020-03-19 01:00:00&#39;),
  Timestamp(&#39;2020-03-20 04:00:00&#39;),
  Timestamp(&#39;2020-03-21 09:00:00&#39;),
  Timestamp(&#39;2020-03-21 10:00:00&#39;),
  Timestamp(&#39;2020-03-28 22:00:00&#39;),
  Timestamp(&#39;2020-04-15 03:00:00&#39;),
  Timestamp(&#39;2020-04-28 03:00:00&#39;),
  Timestamp(&#39;2020-04-28 04:00:00&#39;),
  Timestamp(&#39;2020-05-01 13:00:00&#39;),
  Timestamp(&#39;2020-05-01 15:00:00&#39;),
  Timestamp(&#39;2020-05-01 23:00:00&#39;),
  Timestamp(&#39;2020-05-02 00:00:00&#39;),
  Timestamp(&#39;2020-11-17 14:00:00&#39;),
  Timestamp(&#39;2020-11-17 20:00:00&#39;),
  Timestamp(&#39;2020-11-17 21:00:00&#39;),
  Timestamp(&#39;2020-11-17 22:00:00&#39;),
  Timestamp(&#39;2020-11-18 19:00:00&#39;),
  Timestamp(&#39;2020-11-18 20:00:00&#39;),
  Timestamp(&#39;2020-11-18 23:00:00&#39;),
  Timestamp(&#39;2020-11-19 00:00:00&#39;),
  Timestamp(&#39;2020-11-19 01:00:00&#39;),
  Timestamp(&#39;2020-12-21 15:00:00&#39;),
  Timestamp(&#39;2020-12-27 14:00:00&#39;),
  Timestamp(&#39;2020-12-27 15:00:00&#39;),
  Timestamp(&#39;2020-12-27 16:00:00&#39;),
  Timestamp(&#39;2020-12-27 21:00:00&#39;),
  Timestamp(&#39;2021-01-16 09:00:00&#39;),
  Timestamp(&#39;2021-01-16 10:00:00&#39;),
  Timestamp(&#39;2021-01-16 11:00:00&#39;),
  Timestamp(&#39;2021-02-01 10:00:00&#39;),
  Timestamp(&#39;2021-02-03 09:00:00&#39;),
  Timestamp(&#39;2021-02-03 10:00:00&#39;),
  Timestamp(&#39;2021-02-06 11:00:00&#39;),
  Timestamp(&#39;2021-02-06 17:00:00&#39;),
  Timestamp(&#39;2021-02-08 11:00:00&#39;),
  Timestamp(&#39;2021-02-11 14:00:00&#39;),
  Timestamp(&#39;2021-02-25 22:00:00&#39;),
  Timestamp(&#39;2021-03-12 08:00:00&#39;),
  Timestamp(&#39;2021-03-19 15:00:00&#39;),
  Timestamp(&#39;2021-03-19 20:00:00&#39;),
  Timestamp(&#39;2021-03-29 13:00:00&#39;),
  Timestamp(&#39;2021-04-06 07:00:00&#39;),
  Timestamp(&#39;2021-04-12 15:00:00&#39;),
  Timestamp(&#39;2021-04-13 16:00:00&#39;),
  Timestamp(&#39;2021-11-04 14:00:00&#39;),
  Timestamp(&#39;2021-11-04 15:00:00&#39;),
  Timestamp(&#39;2021-11-04 23:00:00&#39;),
  Timestamp(&#39;2021-11-05 00:00:00&#39;),
  Timestamp(&#39;2021-11-05 01:00:00&#39;),
  Timestamp(&#39;2021-11-05 05:00:00&#39;),
  Timestamp(&#39;2021-11-05 06:00:00&#39;),
  Timestamp(&#39;2021-11-05 11:00:00&#39;),
  Timestamp(&#39;2021-11-05 15:00:00&#39;),
  Timestamp(&#39;2021-11-28 15:00:00&#39;),
  Timestamp(&#39;2021-11-29 10:00:00&#39;),
  Timestamp(&#39;2021-12-21 11:00:00&#39;)]]
</code></pre><p>Removing detected outliers and then comparing the revised dataset to the original is a key step in understanding the impact of outliers on your time series analysis. Here’s how we proceed with our air quality data:</p>
<ol>
<li>
<p><strong>Deleting Outliers:</strong></p>
<ul>
<li>Once the <code>OutlierDetector</code> from kats has identified the outliers in our <code>air_ts</code> data, we can proceed to remove these points.</li>
<li>This involves modifying the original dataset by either excluding the outlier data points or replacing them with null values, depending on our analysis needs.</li>
</ul>
</li>
<li>
<p><strong>Re-Plotting the Chart:</strong></p>
<ul>
<li>After removing the outliers, re-plot the time series data. This new plot will now represent the air quality data without the influence of the outliers.</li>
<li>Ensure that this revised chart is plotted in the same format as the original for accurate comparison.</li>
</ul>
</li>
<li>
<p><strong>Comparing with the Original Dataset:</strong></p>
<ul>
<li>Place the original and revised charts side by side to visually compare the differences. This will help us understand how the outliers were affecting the overall data trends.</li>
<li>Pay particular attention to areas where we previously noticed anomalies, such as the abnormal peak in July 2022. Observe how the removal of outliers has altered these sections.</li>
</ul>
</li>
<li>
<p><strong>Analyzing the Impact:</strong></p>
<ul>
<li>Removing outliers can often result in a smoother, more consistent trend line, which may reveal underlying patterns more clearly.</li>
<li>However, it’s also important to consider the nature of these outliers – whether they were due to errors or genuine unusual occurrences – as this can affect the interpretation of our data.</li>
</ul>
</li>
</ol>
<p>By completing this process, we not only clean our dataset but also gain a deeper understanding of how certain data points were influencing the overall analysis. This step is crucial in ensuring that our time series analysis is both accurate and reflective of the true trends in the data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Removing the detected outliers from the air_ts time series data.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Setting interpolate=False to simply remove the outliers without interpolation.</span>
</span></span><span style="display:flex;"><span>outliers_removed <span style="color:#f92672">=</span> outlierDetection<span style="color:#f92672">.</span>remover(interpolate<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Displaying the DataFrame with outliers removed.</span>
</span></span><span style="display:flex;"><span>outliers_removed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the time series data after outlier removal.</span>
</span></span><span style="display:flex;"><span>outliers_removed<span style="color:#f92672">.</span>plot(cols<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;y_0&#39;</span>])
</span></span></code></pre></div><p><img src="figures/4-1-4-2.png" alt="Python output"></p>
<h3 id="change-point-detection">Change Point Detection)</h3>
<p>Change point detection is a valuable technique in time series analysis, used to identify significant shifts in data trends. These shifts could be indicative of important events or changes in the underlying system. Here’s how we can apply change point detection to our air quality data using kats:</p>
<ol>
<li>
<p><strong>Understanding Change Points:</strong></p>
<ul>
<li>A change point represents a significant shift in the pattern or distribution of the data. In the context of air quality, this could indicate a major environmental event, a change in pollution sources, or other significant factors affecting air quality.</li>
</ul>
</li>
<li>
<p><strong>Preparing Data for Detection:</strong></p>
<ul>
<li>Use daily averages of air quality data for this analysis. This helps in smoothing out short-term fluctuations and focusing on broader trends.</li>
<li>Convert this data into the <code>TimeSeriesData</code> format required by kats.</li>
</ul>
</li>
<li>
<p><strong>Using <code>CUSUMDetector</code> for Detection:</strong></p>
<ul>
<li>Kats provides various detectors for change point analysis. The <code>CUSUMDetector</code> (Cumulative Sum Control Chart) is one of them, designed to identify shifts in the mean level of a time series.</li>
<li>Apply <code>CUSUMDetector</code> to our <code>TimeSeriesData</code> formatted air quality data. Configure it as per our analysis needs, focusing on detecting significant shifts in air quality trends.</li>
</ul>
</li>
<li>
<p><strong>Plotting and Identifying Change Points:</strong></p>
<ul>
<li>After running the <code>CUSUMDetector</code>, plot the results. Mark detected change points with red dots on the plot for clear visibility.</li>
<li>In cases where no obvious change points are detected, as in your example, it suggests that the air quality data did not experience significant abrupt changes during the period analyzed.</li>
</ul>
</li>
<li>
<p><strong>Encouraging Further Exploration:</strong></p>
<ul>
<li>While our data may not have shown clear change points, this method is still valuable for exploring other datasets.</li>
<li>Readers are encouraged to apply this technique to different datasets or vary the parameters of the detection process to gain more insights and practice.</li>
</ul>
</li>
</ol>
<p>Change point detection can offer critical insights into when and possibly why significant changes occur in time series data. This understanding is essential for accurate data analysis and prediction, particularly in fields like environmental monitoring where understanding the timing and cause of changes can have significant implications.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating a TimeSeriesData object from the daily averaged air data for change point detection.</span>
</span></span><span style="display:flex;"><span>air_ts <span style="color:#f92672">=</span> TimeSeriesData(air_day<span style="color:#f92672">.</span>reset_index(), time_col_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initializing the CUSUMDetector from Kats for the air_ts time series data.</span>
</span></span><span style="display:flex;"><span>detector <span style="color:#f92672">=</span> CUSUMDetector(air_ts)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Running the change point detection algorithm for both increases and decreases.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>change_points <span style="color:#f92672">=</span> detector<span style="color:#f92672">.</span>detector(change_directions<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;increase&#34;</span>, <span style="color:#e6db74">&#34;decrease&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Uncomment to print the start time of the first detected change point.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(&#34;The change point is on&#34;, change_points[0][0].start_time)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the results of the change point detection.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>) <span style="color:#75715e"># Rotating x-axis labels for better readability.</span>
</span></span><span style="display:flex;"><span>detector<span style="color:#f92672">.</span>plot(change_points)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-4-3.png" alt="Python output"></p>
<h3 id="missing-data-handling">Missing Data Handling</h3>
<p>Handling missing data is a crucial aspect of preparing datasets for analysis, especially in large-scale datasets where gaps can significantly impact the results. We&rsquo;ve already mentioned two common methods for addressing missing data. Let&rsquo;s delve deeper into these and introduce a third method:</p>
<ol>
<li>
<p><strong>Marking Missing Data as NaN (Not a Number):</strong></p>
<ul>
<li><strong>Usage:</strong> NaN is a standard marker used in data analysis and programming to denote missing or undefined values. It&rsquo;s especially useful in datasets where maintaining the integrity and authenticity of the data is important.</li>
<li><strong>Considerations:</strong> When using NaN to mark missing values, it&rsquo;s essential to ensure that the subsequent data analysis techniques can handle NaN values appropriately. Some methods might ignore NaN values, while others might require them to be handled or replaced.</li>
</ul>
</li>
<li>
<p><strong>Forward Filling Method:</strong></p>
<ul>
<li><strong>Description:</strong> Forward filling is a straightforward method to handle missing data. It involves filling a missing value with the most recent non-missing value that precedes it.</li>
<li><strong>Applicability:</strong> This method is particularly useful in time series data where the previous value is often a reasonable estimate for the missing value. However, it assumes that the data does not change dramatically between successive points, which might not always be the case.</li>
</ul>
</li>
<li>
<p><strong>Mean or Median Imputation:</strong></p>
<ul>
<li><strong>Mean Imputation:</strong> This involves replacing missing values with the mean (average) of the available data. It&rsquo;s a good option when the data distribution is not skewed.</li>
<li><strong>Median Imputation:</strong> Alternatively, using the median (the middle value when the data is sorted) can be more robust, especially in datasets where outliers might skew the mean.</li>
<li><strong>Considerations:</strong> Both mean and median imputation methods are simple and effective but assume that the missing values are roughly around the central tendency of the data. They can be less effective if this assumption does not hold.</li>
</ul>
</li>
</ol>
<p>Each of these methods has its strengths and is suitable for different scenarios. The choice of method depends on the nature of the data and the specific requirements of the analysis. In time series data like air quality measurements, the chosen method should ideally preserve the temporal integrity of the data while adequately dealing with gaps caused by missing values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Applying forward fill imputation to the air DataFrame to handle missing values.</span>
</span></span><span style="display:flex;"><span>df_ffill <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>ffill(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the time series data after forward fill imputation.</span>
</span></span><span style="display:flex;"><span>df_ffill<span style="color:#f92672">.</span>plot()
</span></span></code></pre></div><p><img src="figures/4-1-4-4.png" alt="Python output">
3. K-Nearest Neighbor (KNN) method: As the name suggests, the KNN method finds the k values that are closest to the missing value, and then fills the missing value with the average of these k values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">knn_mean</span>(ts, n):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Function to perform K-Nearest Neighbors (KNN) imputation for missing values in a time series.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Parameters:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ts (array-like): The time series data.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    n (int): The number of neighbors to consider for imputing each missing value.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    array: The time series with missing values imputed using KNN mean.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    out <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>copy(ts) <span style="color:#75715e"># Creating a copy of the time series to avoid modifying the original data.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, val <span style="color:#f92672">in</span> enumerate(ts):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>isnan(val): <span style="color:#75715e"># Checking for NaN values to impute.</span>
</span></span><span style="display:flex;"><span>            n_by_2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ceil(n<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>) <span style="color:#75715e"># Defining the window size for neighbors.</span>
</span></span><span style="display:flex;"><span>            lower <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>max([<span style="color:#ae81ff">0</span>, int(i<span style="color:#f92672">-</span>n_by_2)]) <span style="color:#75715e"># Lower index for the window.</span>
</span></span><span style="display:flex;"><span>            upper <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>min([len(ts)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, int(i<span style="color:#f92672">+</span>n_by_2)]) <span style="color:#75715e"># Upper index for the window.</span>
</span></span><span style="display:flex;"><span>            ts_near <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>concatenate([ts[lower:i], ts[i:upper]]) <span style="color:#75715e"># Extracting the neighbors.</span>
</span></span><span style="display:flex;"><span>            out[i] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>nanmean(ts_near) <span style="color:#75715e"># Imputing using the mean of the neighbors.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Applying the KNN imputation function to the PM25 data in the air DataFrame.</span>
</span></span><span style="display:flex;"><span>df_knn <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>copy() <span style="color:#75715e"># Creating a copy of the DataFrame.</span>
</span></span><span style="display:flex;"><span>df_knn[<span style="color:#e6db74">&#39;PM25&#39;</span>] <span style="color:#f92672">=</span> knn_mean(air<span style="color:#f92672">.</span>PM25<span style="color:#f92672">.</span>to_numpy(), <span style="color:#ae81ff">5000</span>) <span style="color:#75715e"># Imputing missing values using KNN.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the time series data after KNN imputation.</span>
</span></span><span style="display:flex;"><span>df_knn<span style="color:#f92672">.</span>plot()
</span></span></code></pre></div><p><img src="figures/4-1-4-5.png" alt="Python output"></p>
<h2 id="data-decomposition">Data Decomposition</h2>
<p>Data decomposition is a powerful technique in time series analysis that allows us to break down a dataset into its constituent components. This can provide deeper insights into the underlying patterns and trends. Let&rsquo;s apply this to our air quality data:</p>
<ol>
<li>
<p><strong>Understanding Data Decomposition:</strong></p>
<ul>
<li><strong>Trend Component:</strong> This represents the long-term progression of the series, showing how the data evolves over time, irrespective of seasonal or irregular patterns.</li>
<li><strong>Seasonal Component:</strong> This captures regular, periodic fluctuations in the data, like daily, weekly, or annual cycles.</li>
<li><strong>Residual Component:</strong> Also known as the irregular component, it encompasses random variation in the data after accounting for the trend and seasonal components.</li>
</ul>
</li>
<li>
<p><strong>Preparing the Data (<code>air_process</code>):</strong></p>
<ul>
<li><strong>Replicate Daily Averages:</strong> Begin by creating a copy of the daily average air quality data, naming this new dataset <code>air_process</code>.</li>
<li><strong>Handle Missing Data:</strong> Use the forward-filling method to address any missing values in <code>air_process</code>. This will replace missing values with the last available non-missing value, ensuring continuity in the data.</li>
</ul>
</li>
<li>
<p><strong>Initial Visualization with a Line Chart:</strong></p>
<ul>
<li><strong>Plot Raw Data:</strong> First, visualize the raw data in <code>air_process</code> as a line chart. This will provide a baseline view of the air quality data before decomposition.</li>
<li><strong>Observing Patterns:</strong> Look for any apparent trends, seasonal patterns, or irregularities in this initial plot.</li>
</ul>
</li>
<li>
<p><strong>Applying Data Decomposition:</strong></p>
<ul>
<li><strong>Decomposition Tools:</strong> Use a statistical tool or library (like <code>statsmodels</code> in Python) that offers time series decomposition capabilities.</li>
<li><strong>Breaking Down Components:</strong> Apply the decomposition method to <code>air_process</code> to separate it into trend, seasonal, and residual components.</li>
<li><strong>Visualization:</strong> Plot each of these components separately to observe their characteristics and contributions to the overall data.</li>
</ul>
</li>
<li>
<p><strong>Analysis of Decomposed Data:</strong></p>
<ul>
<li><strong>Trend Analysis:</strong> Examine the trend component for long-term changes or shifts in air quality.</li>
<li><strong>Seasonal Analysis:</strong> Look at the seasonal component to identify recurring patterns at specific times of the year or day.</li>
<li><strong>Residuals Analysis:</strong> Analyze the residual component to understand the unexplained variability in the data after removing the trend and seasonal effects.</li>
</ul>
</li>
</ol>
<p>By decomposing the time series data into these components, we gain a more nuanced understanding of the factors influencing air quality. This can lead to more targeted analyses, such as investigating the causes of trends or predicting future air quality conditions based on identified patterns.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Creating a copy of the daily averaged air data for processing.</span>
</span></span><span style="display:flex;"><span>air_process <span style="color:#f92672">=</span> air_day<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Applying forward fill imputation to handle missing values in the copied DataFrame.</span>
</span></span><span style="display:flex;"><span>air_process<span style="color:#f92672">.</span>ffill(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the time series data after applying forward fill imputation.</span>
</span></span><span style="display:flex;"><span>air_process<span style="color:#f92672">.</span>plot()
</span></span></code></pre></div><p><img src="figures/4-1-5-1.png" alt="Python output"></p>
<p>The <code>seasonal_decompose</code> function is an excellent tool for breaking down a time series into its constituent components, providing a clearer picture of the underlying patterns and trends. Here&rsquo;s how to apply it to our <code>air_process</code> data:</p>
<ol>
<li>
<p><strong>Using <code>seasonal_decompose</code>:</strong></p>
<ul>
<li><strong>Function Overview:</strong> The <code>seasonal_decompose</code> method from libraries like <code>statsmodels</code> in Python is designed to decompose a time series into trend, seasonal, and residual components.</li>
<li><strong>Setting the Period Parameter:</strong> The period parameter is crucial as it defines the cycle length for the seasonal decomposition. Setting it to 30 days implies that we&rsquo;re looking for patterns that repeat approximately every month.</li>
</ul>
</li>
<li>
<p><strong>Execution and Results:</strong></p>
<ul>
<li><strong>Applying to <code>air_process</code>:</strong> Apply the <code>seasonal_decompose</code> method to the <code>air_process</code> data, with the period set to 30 days.</li>
<li><strong>Output:</strong> The function will output four distinct plots:
<ul>
<li><strong>Raw Data Plot:</strong> This is our original time series data, serving as a reference.</li>
<li><strong>Trend Plot:</strong> Shows the long-term trend in our air quality data, removing seasonal effects and irregular fluctuations.</li>
<li><strong>Seasonal Plot:</strong> Illustrates the repeating patterns or cycles in the data over the specified period (30 days).</li>
<li><strong>Residual Plot:</strong> Displays the residuals, which are what&rsquo;s left of the data after removing the trend and seasonal components. This plot can highlight irregularities or &rsquo;noise&rsquo; in the data.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Interpreting the Decomposition:</strong></p>
<ul>
<li><strong>Trend Analysis:</strong> The trend component will help us understand the overall direction and long-term movements in air quality.</li>
<li><strong>Seasonal Analysis:</strong> The seasonal component reveals any cyclical patterns, which could be related to environmental factors, human activities, or other periodic influences.</li>
<li><strong>Residual Analysis:</strong> Investigating the residuals can offer insights into anomalies and short-term fluctuations that are not explained by the trend or seasonal components.</li>
</ul>
</li>
</ol>
<p>By completing this decomposition, we&rsquo;ll gain a comprehensive understanding of the various factors influencing the air quality data. This method can be particularly revealing in environmental data analysis, where multiple factors, both natural and anthropogenic, can impact the observed values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Performing seasonal decomposition on the PM2.5 data using an additive model.</span>
</span></span><span style="display:flex;"><span>decompose <span style="color:#f92672">=</span> seasonal_decompose(air_process[<span style="color:#e6db74">&#39;PM25&#39;</span>],model<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>, period<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the results of the decomposition.</span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> decompose<span style="color:#f92672">.</span>plot()
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>set_size_inches((<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>))  <span style="color:#75715e"># Setting the size of the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-5-2.png" alt="Python output"></p>
<p>Our analysis of the decomposed air quality data provides valuable insights into the temporal dynamics of air quality, especially PM2.5 concentrations. Let&rsquo;s explore the implications of our findings:</p>
<ol>
<li>
<p><strong>Trend Analysis with a 30-Day Cycle:</strong></p>
<ul>
<li>The trend graph shows higher values around January and lower values around July, mirroring the characteristics observed in the original data. This indicates a strong seasonal component in air quality, with winter months typically showing higher PM2.5 levels.</li>
<li>The similarity between the trend graph and the original data reinforces the significance of the seasonal influence on air quality.</li>
</ul>
</li>
<li>
<p><strong>Seasonal Analysis with a 30-Day Cycle:</strong></p>
<ul>
<li>The seasonal graph reveals a fixed periodic change every 30 days, suggesting a monthly cyclical pattern in air quality. This could be influenced by monthly variations in weather conditions, human activities, or environmental factors.</li>
</ul>
</li>
<li>
<p><strong>Changing the Period to 365 Days:</strong></p>
<ul>
<li>When the decomposition period is set to 365 days, representing an annual cycle, the seasonal plot still shows higher values in January and lower in July. This confirms that the seasonal trend is consistent on a yearly basis.</li>
<li>The trend graph on this larger timescale suggests a gradual decrease in PM2.5 concentrations, indicating an overall improvement in air quality over time.</li>
</ul>
</li>
<li>
<p><strong>Interpreting the Trend Chart:</strong></p>
<ul>
<li>The slowing trend in the annual trend chart suggests a gradual reduction in PM2.5 levels, which is a positive sign from an environmental and public health perspective.</li>
<li>This gradual decline aligns with the absence of change points in our earlier analysis, indicating a steady, rather than abrupt, improvement in air quality.</li>
</ul>
</li>
<li>
<p><strong>Confirmation of Earlier Findings:</strong></p>
<ul>
<li>The results from the decomposition corroborate our previous observations that there were no sudden change points in the PM2.5 data.</li>
<li>The consistent seasonal pattern and the overall declining trend in PM2.5 concentrations highlight the effectiveness of ongoing measures to improve air quality and the impact of seasonal factors.</li>
</ul>
</li>
</ol>
<p>By analyzing the data through different decomposition periods (30 days and 365 days), we gain a nuanced understanding of both short-term cyclical patterns and long-term trends in air quality. This comprehensive approach is crucial for accurate environmental analysis and for formulating effective policies to further improve air quality.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Performing seasonal decomposition on the PM2.5 data using an additive model with an annual period.</span>
</span></span><span style="display:flex;"><span>decompose <span style="color:#f92672">=</span> seasonal_decompose(air_process[<span style="color:#e6db74">&#39;PM25&#39;</span>],model<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>, period<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plotting the results of the decomposition.</span>
</span></span><span style="display:flex;"><span>decompose<span style="color:#f92672">.</span>plot()<span style="color:#f92672">.</span>set_size_inches((<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>)) <span style="color:#75715e"># Setting the size of the plot.</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-1-5-3.png" alt="Python output"></p>
<h2 id="references">References</h2>
<ul>
<li>Civil IoT Taiwan: Historical Data (<a href="https://history.colife.org.tw/#/">https://history.colife.org.tw/</a>)</li>
<li>Matplotlib - Colormap reference (<a href="https://matplotlib.org/stable/gallery/color/colormap_reference.html">https://matplotlib.org/stable/gallery/color/colormap_reference.html</a>)</li>
<li>Decomposition of time series - Wikipedia (<a href="https://en.wikipedia.org/wiki/Decomposition_of_time_series">https://en.wikipedia.org/wiki/Decomposition_of_time_series</a>)</li>
<li>Kats: a Generalizable Framework to Analyze Time Series Data in Python | by Khuyen Tran | Towards Data Science (<a href="https://towardsdatascience.com/kats-a-generalizable-framework-to-analyze-time-series-data-in-python-3c8d21efe057?gi=36d1c3d8372">https://towardsdatascience.com/kats-a-generalizable-framework-to-analyze-time-series-data-in-python-3c8d21efe057?gi=36d1c3d8372</a>)</li>
<li>Decomposition in Time Series Data | by Abhilasha Chourasia | Analytics Vidhya | Medium (<a href="https://medium.com/analytics-vidhya/decomposition-in-time-series-data-b20764946d63">https://medium.com/analytics-vidhya/decomposition-in-time-series-data-b20764946d63</a>)</li>
</ul>

            <footer class="footline">
            </footer>
          </article>


<div align="center">
<hr width="70%">

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 Unported License</a>.
<br />
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0;margin:2px" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
</div>
<p style="height:30px">

<div id="disqus_thread" style="border-style: ridge; padding-inline:5px"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'learnciot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation showVisitedLinks">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
          <style>
            #logo svg,
            #logo svg * {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              fill: #282828 !important;
              fill: var(--MENU-SECTIONS-BG-color) !important;
              opacity: .945;
            }
            a#logo {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              font-family: 'Work Sans', 'Helvetica', 'Tahoma', 'Geneva', 'Arial', sans-serif;
              font-size: 30px;
              font-weight: 300;
              margin-top: -13px;
              max-width: 60%;
              text-transform: uppercase;
              width: 226px;
              white-space: nowrap;
            }
            a#logo:hover {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
            }
            #logo svg {
              margin-bottom: -20px;
              margin-left: -23.5px;
              width: 40.5%;
            }
            @media only all and (max-width: 59.938em) {
              a#logo {
                font-size: 25px;
                margin-top: -3px;
              }
              #logo svg {
                margin-bottom: -12px;
                margin-left: -23px;
              }
            }
            @media all and (-ms-high-contrast:none) {
              /* IE11s understanding of positioning is weird at best */
              a#logo {
                margin-top: -58px;
              }
              #logo svg {
                margin-bottom: -62px;
              }
            }
          </style>
          <a id="logo" href="/en/">
            Learn CIoT
          </a>

        </div>
        <div class="searchbox default-animation">
          <label class="a11y-only" for="search-by">Search</label>
          <i class="fas fa-search"></i>
          <input data-search-input id="search-by" type="search" placeholder="Search...">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/js/auto-complete.js?1701306708" defer></script>
        <script src="/js/lunr.min.js?1701306708" defer></script>
        <script src="/js/lunr.stemmer.support.min.js?1701306708" defer></script>
        <script src="/js/lunr.multi.min.js?1701306708" defer></script>
        <script src="/js/lunr.en.min.js?1701306708" defer></script>
        <script src="/js/search.js?1701306708" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/en/ch1/" title="1. Introduction" class="dd-item"><a href="/en/ch1/">1. Introduction<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch2/" title="2. Overview of the Materials" class="dd-item"><label for="section-8824f0908e4fd15c767980c76e6fd82a" ></label><a href="/en/ch2/">2. Overview of the Materials<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch2/ch2.1/" title="2.1. Material Architecture" class="dd-item"><a href="/en/ch2/ch2.1/">2.1. Material Architecture<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch2/ch2.2/" title="2.2. Material Tools" class="dd-item"><a href="/en/ch2/ch2.2/">2.2. Material Tools<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/ch3/" title="3. Data Access" class="dd-item"><label for="section-8b3bcaa38467a39b2570f38fd8603d10" ></label><a href="/en/ch3/">3. Data Access<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch3/ch3.1/" title="3.1. Basic Data Access Methods" class="dd-item"><a href="/en/ch3/ch3.1/">3.1. Basic Data Access Methods<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch3/ch3.2/" title="3.2. Data Access under Spatial or Temporal Conditions" class="dd-item"><a href="/en/ch3/ch3.2/">3.2. Data Access under Spatial or Temporal Conditions<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/ch4/" title="4. Time Series Data Analysis" class="dd-item parent"><label for="section-b911da0d9c15f301a7d3deea0e716021" ></label><a href="/en/ch4/">4. Time Series Data Analysis<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch4/ch4.1/" title="4.1. Time Series Data Processing" class="dd-item active"><a href="/en/ch4/ch4.1/">4.1. Time Series Data Processing<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch4/ch4.2/" title="4.2. Time Series Data Forecast" class="dd-item"><a href="/en/ch4/ch4.2/">4.2. Time Series Data Forecast<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch4/ch4.3/" title="4.3. Time Series Data Clustering" class="dd-item"><a href="/en/ch4/ch4.3/">4.3. Time Series Data Clustering<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/ch5/" title="5. Spatial Data Analysis" class="dd-item"><label for="section-adab050366c685297e1eadc5faf1472e" ></label><a href="/en/ch5/">5. Spatial Data Analysis<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch5/ch5.1/" title="5.1. Geospatial Filtering" class="dd-item"><a href="/en/ch5/ch5.1/">5.1. Geospatial Filtering<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch5/ch5.2/" title="5.2. Geospatial Analysis" class="dd-item"><a href="/en/ch5/ch5.2/">5.2. Geospatial Analysis<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/ch6/" title="6. Data Applications" class="dd-item"><label for="section-4be7f7872a5d83dfd50bf0f4ff5c2761" ></label><a href="/en/ch6/">6. Data Applications<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch6/ch6.1/" title="6.1. Machine Learning Preliminaries" class="dd-item"><a href="/en/ch6/ch6.1/">6.1. Machine Learning Preliminaries<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch6/ch6.2/" title="6.2. Anomaly Detection" class="dd-item"><a href="/en/ch6/ch6.2/">6.2. Anomaly Detection<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch6/ch6.3/" title="6.3. Joint Data Calibration" class="dd-item"><a href="/en/ch6/ch6.3/">6.3. Joint Data Calibration<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/ch7/" title="7. System Applications" class="dd-item"><label for="section-af7207ef140cc843a4d69557766c672f" ></label><a href="/en/ch7/">7. System Applications<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/en/ch7/ch7.1/" title="7.1. QGIS Application" class="dd-item"><a href="/en/ch7/ch7.1/">7.1. QGIS Application<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch7/ch7.2/" title="7.2. Tableau Application" class="dd-item"><a href="/en/ch7/ch7.2/">7.2. Tableau Application<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/en/ch7/ch7.3/" title="7.3. Leafmap Applications" class="dd-item"><a href="/en/ch7/ch7.3/">7.3. Leafmap Applications<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/en/about/" title="About" class="dd-item"><a href="/en/about/">About<i class="fas fa-check read-icon"></i></a></li>
        </ul>
        <div id="shortcuts">
          <div class="nav-title">More</div>
          <ul>
            <li><a class="padding" href="https://github.com/LearnCIOT/LearnCIOT.github.io"><i class='fab fa-fw fa-github'></i> GitHub repo</a></li>
            <li><a class="padding" href="/en/levels/"><i class='fas fa-fw fa-heartbeat'></i> Search by difficulty</a></li>
            <li><a class="padding" href="/en/tags/"><i class='fas fa-fw fa-tags'></i> Search by topics</a></li>
            <li><a class="padding" href="/en/authors/"><i class='fas fa-fw fa-users'></i> Search by authors</a></li>
          </ul>
        </div>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"/>
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch showVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch showLangSwitch">
              <a class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-language" onchange="location = baseUri + this.value;">
                    <option id="en" value="/en/ch4/ch4.1/" selected>English</option>
                    <option id="zh-tw" value="/ch4/ch4.1/">中文</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <a class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="relearn-light" value="relearn-light" selected>Relearn Light</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks showVisitedLinks"><a class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> Clear History</a></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>

    <script src="/js/clipboard.min.js?1701306708" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1701306708" defer></script>
    <script src="/js/featherlight.min.js?1701306708" defer></script>
    <script src="/js/jquery.svg.pan.zoom.js?1701306708" defer></script>
    <script src="/js/mermaid.min.js?1701306708" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/theme.js?1701306708" defer></script>
  </body>
</html>
