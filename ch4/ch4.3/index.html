<!DOCTYPE html>
<html lang="zh-tw" class="js csstransforms3d">
  <head>

<meta property="og:title" content="4.3. 時間序列屬性分群"/>
<meta property="og:description" content="我們介紹較為進階的資料分群分析。我們首先介紹兩種時間序列的特徵擷取方法，分別是傅立葉轉換 (Fourier Transform) 和小波轉換 (Wavelet Transform)，並且以簡要的方式說明兩種轉換方式之異同。我們介紹兩種不同的時間序列比較方法，分別是幾何距離 (Euclidean Distance) 與動態時間規整 (Dynamic Time Warping, DTW) 距離，並根據所使用的距離函數，套用既有的分群演算法套件，並且探討不同的資料集與不同時間解析度的資料分群，在真實場域所代表的意義，以及可能衍生的應用。"/>
<meta property="og:image" content="https://learnciot.github.io/images/thumbnail.jpg"/>
<meta property="og:url" content="/ch4/ch4.3/"/>
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="627" />
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.104.3">
    <meta name="generator" content="Relearn 5.3.3+tip">
    <meta name="description" content="我們介紹較為進階的資料分群分析。我們首先介紹兩種時間序列的特徵擷取方法，分別是傅立葉轉換 (Fourier Transform) 和小波轉換 (Wavelet Transform)，並且以簡要的方式說明兩種轉換方式之異同。我們介紹兩種不同的時間序列比較方法，分別是幾何距離 (Euclidean Distance) 與動態時間規整 (Dynamic Time Warping, DTW) 距離，並根據所使用的距離函數，套用既有的分群演算法套件，並且探討不同的資料集與不同時間解析度的資料分群，在真實場域所代表的意義，以及可能衍生的應用。">
    <meta name="author" content="Ling-Jyh Chen">
    <title>4.3. 時間序列屬性分群 :: Tutorial for CIoT Open Data Applications</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1700107091" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1700107091" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1700107091" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1700107091" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1700107091" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1700107091" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1700107091" rel="stylesheet">
    <link href="/css/nucleus.css?1700107091" rel="stylesheet">
    <link href="/css/fonts.css?1700107091" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1700107091" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1700107091" rel="stylesheet">
    <link href="/css/theme-relearn-light.css?1700107091" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1700107091" rel="stylesheet">
    <link href="/css/variant.css?1700107091" rel="stylesheet">
    <link href="/css/print.css?1700107091" rel="stylesheet" media="print">
    <script src="/js/variant.js?1700107091"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="/index.json";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '複製到剪貼板';
      window.T_Copied_to_clipboard = '複製到剪貼簿！';
      window.T_Copy_link_to_clipboard = '將連結複製到剪貼簿';
      window.T_Link_copied_to_clipboard = '連結複製到剪貼簿！';
      // some further base stuff
      var baseUriFull='https:\/\/LearnCIOT.github.io/';
      window.variants && variants.init( [ 'relearn-light' ] );
    </script>
    <script src="/js/jquery.min.js?1700107091" defer></script>
<meta property="fb:app_id" content="601826851395774" />
  </head>
  <body class="default-animation" data-url="/ch4/ch4.3/">




<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v14.0" nonce="hWjBXHAv"></script>

    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div class="navigation">
             <a class="nav nav-next" href="/ch5/" title="5. 空間維度資料分析"><i class="fas fa-chevron-right fa-fw"></i></a>
          </div>
          <div class="navigation">
             <a class="nav nav-prev" href="/ch4/ch4.2/" title="4.2. 時間序列資料預測"><i class="fas fa-chevron-left fa-fw"></i></a>
          </div>
          <div id="top-github-link">
            <a class="github-link" title='編輯網頁' href="https://github.com/LearnCIOT/LearnCIOT.github.io/tree/main/content/ch4/ch4.3/index.zh-tw%20%28%e7%b7%a8%e8%bc%af%e4%b8%ad%29.md" target="blank">
              <i class="fas fa-pen fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='導航'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title='目錄'><i class="fas fa-list-alt fa-fw"></i></span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <meta itemprop="itemListOrder" content="Descending" />
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="3" /><a itemprop="item" href="/"><span itemprop="name">民生公共物聯網資料應用</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="2" /><a itemprop="item" href="/ch4/"><span itemprop="name">4. 時間維度資料分析</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="1" /><a itemprop="item" href="/ch4/ch4.3/" aria-disabled="true"><span itemprop="name">4.3. 時間序列屬性分群</span></a></li>
            </ol>
          </div>
          <div class="default-animation progress">
            <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#章節目標">章節目標</a></li>
    <li><a href="#套件安裝與引用">套件安裝與引用</a></li>
    <li><a href="#讀取資料與資料預處理-preprocessing">讀取資料與資料預處理 (Preprocessing)</a></li>
    <li><a href="#資料分群--集群分析-clustering">資料分群 / 集群分析 (Clustering)</a>
      <ul>
        <li><a href="#快速傅立葉轉換-fast-fourier-transform">快速傅立葉轉換 (Fast Fourier Transform)</a></li>
        <li><a href="#小波轉換-wavelet-transform">小波轉換 (Wavelet Transform)</a></li>
      </ul>
    </li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>

      <main id="body-inner" class="highlightable ">
        <div class="flex-block-wrapper">
          <div id="head-tags"><div class="tags">
  <a class="level-link" href="/levels/advanced">
  <b>
	&starf;&starf;&starf;&starf;&starf;
  </b>
  </a>
  <a class="tag-link" href="/tags/python">Python</a>
  <a class="tag-link" href="/tags/%E7%A9%BA">空</a>
</div>

          </div>


  
  
  

  <section class="social-share">
    <ul class="share-icons">
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f&amp;text=4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="26px" viewBox="0 0 31 26" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(11.372549%,60.784314%,94.117647%);fill-opacity:1;" d="M 27.742188 6.535156 C 27.761719 6.8125 27.761719 7.089844 27.761719 7.371094 C 27.761719 15.875 21.414062 25.683594 9.800781 25.683594 L 9.800781 25.675781 C 6.371094 25.683594 3.011719 24.679688 0.125 22.792969 C 0.625 22.851562 1.125 22.882812 1.628906 22.886719 C 4.46875 22.886719 7.230469 21.914062 9.46875 20.125 C 6.765625 20.070312 4.398438 18.277344 3.570312 15.65625 C 4.515625 15.839844 5.492188 15.800781 6.421875 15.542969 C 3.476562 14.9375 1.355469 12.300781 1.355469 9.234375 L 1.355469 9.152344 C 2.234375 9.652344 3.214844 9.929688 4.222656 9.960938 C 1.449219 8.070312 0.59375 4.304688 2.265625 1.363281 C 5.472656 5.386719 10.203125 7.832031 15.277344 8.089844 C 14.769531 5.855469 15.464844 3.511719 17.105469 1.941406 C 19.644531 -0.496094 23.644531 -0.371094 26.035156 2.21875 C 27.449219 1.933594 28.804688 1.40625 30.042969 0.65625 C 29.574219 2.144531 28.585938 3.410156 27.269531 4.214844 C 28.519531 4.066406 29.742188 3.722656 30.894531 3.203125 C 30.046875 4.496094 28.980469 5.625 27.742188 6.535156 Z M 27.742188 6.535156 "/>
</g>
</svg>

          <p>Twitter</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<linearGradient id="linear0" gradientUnits="userSpaceOnUse" x1="-277.375" y1="406.6018" x2="-277.375" y2="407.5726" gradientTransform="matrix(32,0,0,-31.82224,8892.0008,12969.8672)">
<stop offset="0" style="stop-color:rgb(0%,38.431373%,87.843137%);stop-opacity:1;"/>
<stop offset="1" style="stop-color:rgb(9.803922%,68.627451%,100%);stop-opacity:1;"/>
</linearGradient>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:url(#linear0);" d="M 13.359375 31.839844 C 5.761719 30.480469 0 23.921875 0 16 C 0 7.199219 7.199219 0 16 0 C 24.800781 0 32 7.199219 32 16 C 32 23.921875 26.238281 30.480469 18.640625 31.839844 L 17.761719 31.121094 L 14.238281 31.121094 Z M 13.359375 31.839844 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 22.238281 20.480469 L 22.960938 16 L 18.71875 16 L 18.71875 12.878906 C 18.71875 11.601562 19.199219 10.640625 21.121094 10.640625 L 23.199219 10.640625 L 23.199219 6.558594 C 22.078125 6.398438 20.800781 6.238281 19.679688 6.238281 C 16 6.238281 13.441406 8.480469 13.441406 12.480469 L 13.441406 16 L 9.441406 16 L 9.441406 20.480469 L 13.441406 20.480469 L 13.441406 31.761719 C 14.320312 31.921875 15.199219 32 16.078125 32 C 16.960938 32 17.839844 31.921875 18.71875 31.761719 L 18.71875 20.480469 Z M 22.238281 20.480469 "/>
</g>
</svg>

          <p>Facebook</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f&amp;source=https%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f&amp;title=4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4&amp;summary=4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(0%,49.411765%,73.333333%);fill-opacity:1;" d="M 16 32 C 24.835938 32 32 24.835938 32 16 C 32 7.164062 24.835938 0 16 0 C 7.164062 0 0 7.164062 0 16 C 0 24.835938 7.164062 32 16 32 Z M 16 32 "/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 26.222656 25.332031 L 22.203125 25.332031 L 22.203125 18.488281 C 22.203125 16.613281 21.492188 15.566406 20.007812 15.566406 C 18.390625 15.566406 17.546875 16.65625 17.546875 18.488281 L 17.546875 25.332031 L 13.675781 25.332031 L 13.675781 12.296875 L 17.546875 12.296875 L 17.546875 14.050781 C 17.546875 14.050781 18.710938 11.898438 21.476562 11.898438 C 24.242188 11.898438 26.222656 13.585938 26.222656 17.078125 Z M 9.054688 10.589844 C 7.734375 10.589844 6.667969 9.511719 6.667969 8.183594 C 6.667969 6.855469 7.734375 5.777344 9.054688 5.777344 C 10.375 5.777344 11.441406 6.855469 11.441406 8.183594 C 11.441406 9.511719 10.375 10.589844 9.054688 10.589844 Z M 7.054688 25.332031 L 11.09375 25.332031 L 11.09375 12.296875 L 7.054688 12.296875 Z M 7.054688 25.332031 "/>
</g>
</svg>

            <p>LinkedIn</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="whatsapp://send?text=4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bb%8b%e7%b4%b9%e8%bc%83%e7%82%ba%e9%80%b2%e9%9a%8e%e7%9a%84%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e5%88%86%e6%9e%90%e3%80%82%e6%88%91%e5%80%91%e9%a6%96%e5%85%88%e4%bb%8b%e7%b4%b9%e5%85%a9%e7%a8%ae%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e7%9a%84%e7%89%b9%e5%be%b5%e6%93%b7%e5%8f%96%e6%96%b9%e6%b3%95%ef%bc%8c%e5%88%86%e5%88%a5%e6%98%af%e5%82%85%e7%ab%8b%e8%91%89%e8%bd%89%e6%8f%9b%20%28Fourier%20Transform%29%20%e5%92%8c%e5%b0%8f%e6%b3%a2%e8%bd%89%e6%8f%9b%20%28Wavelet%20Transform%29%ef%bc%8c%e4%b8%a6%e4%b8%94%e4%bb%a5%e7%b0%a1%e8%a6%81%e7%9a%84%e6%96%b9%e5%bc%8f%e8%aa%aa%e6%98%8e%e5%85%a9%e7%a8%ae%e8%bd%89%e6%8f%9b%e6%96%b9%e5%bc%8f%e4%b9%8b%e7%95%b0%e5%90%8c%e3%80%82%e6%88%91%e5%80%91%e4%bb%8b%e7%b4%b9%e5%85%a9%e7%a8%ae%e4%b8%8d%e5%90%8c%e7%9a%84%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e6%af%94%e8%bc%83%e6%96%b9%e6%b3%95%ef%bc%8c%e5%88%86%e5%88%a5%e6%98%af%e5%b9%be%e4%bd%95%e8%b7%9d%e9%9b%a2%20%28Euclidean%20Distance%29%20%e8%88%87%e5%8b%95%e6%85%8b%e6%99%82%e9%96%93%e8%a6%8f%e6%95%b4%20%28Dynamic%20Time%20Warping%2c%20DTW%29%20%e8%b7%9d%e9%9b%a2%ef%bc%8c%e4%b8%a6%e6%a0%b9%e6%93%9a%e6%89%80%e4%bd%bf%e7%94%a8%e7%9a%84%e8%b7%9d%e9%9b%a2%e5%87%bd%e6%95%b8%ef%bc%8c%e5%a5%97%e7%94%a8%e6%97%a2%e6%9c%89%e7%9a%84%e5%88%86%e7%be%a4%e6%bc%94%e7%ae%97%e6%b3%95%e5%a5%97%e4%bb%b6%ef%bc%8c%e4%b8%a6%e4%b8%94%e6%8e%a2%e8%a8%8e%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b3%87%e6%96%99%e9%9b%86%e8%88%87%e4%b8%8d%e5%90%8c%e6%99%82%e9%96%93%e8%a7%a3%e6%9e%90%e5%ba%a6%e7%9a%84%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%ef%bc%8c%e5%9c%a8%e7%9c%9f%e5%af%a6%e5%a0%b4%e5%9f%9f%e6%89%80%e4%bb%a3%e8%a1%a8%e7%9a%84%e6%84%8f%e7%be%a9%ef%bc%8c%e4%bb%a5%e5%8f%8a%e5%8f%af%e8%83%bd%e8%a1%8d%e7%94%9f%e7%9a%84%e6%87%89%e7%94%a8%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f%0a" target="_blank" class="share-btn whatsapp">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<image id="image5" width="588" height="590" xlink:href="data:image/png;base64,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"/>
</defs>
<g id="surface2">
<use xlink:href="#image5" transform="matrix(0.054145,0,0,0.054145,0.054145,0)"/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 24.355469 7.726562 C 22.222656 5.585938 19.378906 4.410156 16.355469 4.40625 C 10.117188 4.40625 5.042969 9.484375 5.042969 15.71875 C 5.039062 17.714844 5.5625 19.660156 6.550781 21.375 L 4.945312 27.238281 L 10.945312 25.664062 C 12.597656 26.566406 14.457031 27.039062 16.351562 27.042969 L 16.355469 27.042969 C 22.589844 27.042969 27.664062 21.964844 27.667969 15.730469 C 27.667969 12.707031 26.492188 9.863281 24.355469 7.726562 Z M 16.355469 25.132812 L 16.351562 25.132812 C 14.664062 25.128906 13.007812 24.675781 11.566406 23.820312 L 11.222656 23.617188 L 7.664062 24.550781 L 8.613281 21.082031 L 8.390625 20.722656 C 7.449219 19.226562 6.949219 17.496094 6.953125 15.71875 C 6.953125 10.535156 11.171875 6.320312 16.359375 6.320312 C 18.871094 6.320312 21.230469 7.296875 23.003906 9.074219 C 24.78125 10.851562 25.757812 13.214844 25.757812 15.726562 C 25.753906 20.914062 21.535156 25.132812 16.355469 25.132812 Z M 21.511719 18.089844 C 21.230469 17.945312 19.839844 17.261719 19.582031 17.167969 C 19.320312 17.074219 19.132812 17.027344 18.945312 17.3125 C 18.757812 17.59375 18.214844 18.230469 18.050781 18.417969 C 17.882812 18.609375 17.71875 18.632812 17.4375 18.488281 C 17.152344 18.347656 16.242188 18.050781 15.164062 17.085938 C 14.324219 16.335938 13.757812 15.410156 13.589844 15.128906 C 13.425781 14.84375 13.574219 14.691406 13.714844 14.550781 C 13.84375 14.425781 13.996094 14.222656 14.140625 14.054688 C 14.28125 13.890625 14.328125 13.773438 14.421875 13.585938 C 14.515625 13.394531 14.46875 13.230469 14.398438 13.089844 C 14.328125 12.949219 13.761719 11.554688 13.527344 10.992188 C 13.296875 10.441406 13.066406 10.515625 12.890625 10.503906 C 12.726562 10.496094 12.539062 10.496094 12.347656 10.496094 C 12.160156 10.496094 11.855469 10.566406 11.59375 10.847656 C 11.335938 11.132812 10.605469 11.816406 10.605469 13.207031 C 10.605469 14.597656 11.617188 15.941406 11.761719 16.132812 C 11.902344 16.320312 13.753906 19.175781 16.589844 20.398438 C 17.261719 20.691406 17.789062 20.863281 18.199219 20.996094 C 18.878906 21.210938 19.492188 21.179688 19.980469 21.105469 C 20.523438 21.027344 21.652344 20.421875 21.890625 19.761719 C 22.125 19.101562 22.125 18.535156 22.054688 18.417969 C 21.984375 18.300781 21.792969 18.230469 21.511719 18.089844 Z M 21.511719 18.089844 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
      

      
      
      <li>
        <a href="mailto:?subject=Tutorial%20for%20CIoT%20Open%20Data%20Applications - 4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4.&amp;body=4.3.%20%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e5%b1%ac%e6%80%a7%e5%88%86%e7%be%a4%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bb%8b%e7%b4%b9%e8%bc%83%e7%82%ba%e9%80%b2%e9%9a%8e%e7%9a%84%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e5%88%86%e6%9e%90%e3%80%82%e6%88%91%e5%80%91%e9%a6%96%e5%85%88%e4%bb%8b%e7%b4%b9%e5%85%a9%e7%a8%ae%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e7%9a%84%e7%89%b9%e5%be%b5%e6%93%b7%e5%8f%96%e6%96%b9%e6%b3%95%ef%bc%8c%e5%88%86%e5%88%a5%e6%98%af%e5%82%85%e7%ab%8b%e8%91%89%e8%bd%89%e6%8f%9b%20%28Fourier%20Transform%29%20%e5%92%8c%e5%b0%8f%e6%b3%a2%e8%bd%89%e6%8f%9b%20%28Wavelet%20Transform%29%ef%bc%8c%e4%b8%a6%e4%b8%94%e4%bb%a5%e7%b0%a1%e8%a6%81%e7%9a%84%e6%96%b9%e5%bc%8f%e8%aa%aa%e6%98%8e%e5%85%a9%e7%a8%ae%e8%bd%89%e6%8f%9b%e6%96%b9%e5%bc%8f%e4%b9%8b%e7%95%b0%e5%90%8c%e3%80%82%e6%88%91%e5%80%91%e4%bb%8b%e7%b4%b9%e5%85%a9%e7%a8%ae%e4%b8%8d%e5%90%8c%e7%9a%84%e6%99%82%e9%96%93%e5%ba%8f%e5%88%97%e6%af%94%e8%bc%83%e6%96%b9%e6%b3%95%ef%bc%8c%e5%88%86%e5%88%a5%e6%98%af%e5%b9%be%e4%bd%95%e8%b7%9d%e9%9b%a2%20%28Euclidean%20Distance%29%20%e8%88%87%e5%8b%95%e6%85%8b%e6%99%82%e9%96%93%e8%a6%8f%e6%95%b4%20%28Dynamic%20Time%20Warping%2c%20DTW%29%20%e8%b7%9d%e9%9b%a2%ef%bc%8c%e4%b8%a6%e6%a0%b9%e6%93%9a%e6%89%80%e4%bd%bf%e7%94%a8%e7%9a%84%e8%b7%9d%e9%9b%a2%e5%87%bd%e6%95%b8%ef%bc%8c%e5%a5%97%e7%94%a8%e6%97%a2%e6%9c%89%e7%9a%84%e5%88%86%e7%be%a4%e6%bc%94%e7%ae%97%e6%b3%95%e5%a5%97%e4%bb%b6%ef%bc%8c%e4%b8%a6%e4%b8%94%e6%8e%a2%e8%a8%8e%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b3%87%e6%96%99%e9%9b%86%e8%88%87%e4%b8%8d%e5%90%8c%e6%99%82%e9%96%93%e8%a7%a3%e6%9e%90%e5%ba%a6%e7%9a%84%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%ef%bc%8c%e5%9c%a8%e7%9c%9f%e5%af%a6%e5%a0%b4%e5%9f%9f%e6%89%80%e4%bb%a3%e8%a1%a8%e7%9a%84%e6%84%8f%e7%be%a9%ef%bc%8c%e4%bb%a5%e5%8f%8a%e5%8f%af%e8%83%bd%e8%a1%8d%e7%94%9f%e7%9a%84%e6%87%89%e7%94%a8%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch4%2fch4.3%2f%0a" target="_blank" class="share-btn email">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%">
  <feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"/>
</filter>
<mask id="mask0">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip1">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface5" clip-path="url(#clip1)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 26 22 C 26 23.101562 25.101562 24 24 24 L 8 24 C 6.898438 24 6 23.101562 6 22 L 6 12 C 6 10.898438 6.898438 10 8 10 L 24 10 C 25.101562 10 26 10.898438 26 12 Z M 26 22 "/>
</g>
<mask id="mask1">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip2">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface8" clip-path="url(#clip2)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 17.75 15.101562 C 16.800781 14.050781 15.199219 14.050781 14.25 15.101562 L 6.5 21.601562 C 6.398438 21.699219 6.351562 21.800781 6.25 21.898438 C 6.601562 22.550781 7.25 23 7.949219 23 L 23.949219 23 C 24.699219 23 25.300781 22.550781 25.648438 21.898438 C 25.601562 21.800781 25.5 21.699219 25.398438 21.601562 Z M 17.75 15.101562 "/>
</g>
<mask id="mask2">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip3">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface11" clip-path="url(#clip3)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 6.300781 10.101562 C 6.648438 9.449219 7.300781 9 8 9 L 24 9 C 24.75 9 25.351562 9.449219 25.699219 10.101562 C 25.648438 10.199219 25.550781 10.300781 25.449219 10.398438 L 17.75 16.898438 C 16.800781 17.949219 15.199219 17.949219 14.25 16.898438 Z M 6.300781 10.101562 "/>
</g>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(46.666667%,70.196078%,83.137255%);fill-opacity:1;" d="M 32 16 C 32 24.835938 24.835938 32 16 32 C 7.164062 32 0 24.835938 0 16 C 0 7.164062 7.164062 0 16 0 C 24.835938 0 32 7.164062 32 16 Z M 32 16 "/>
<use xlink:href="#surface5" mask="url(#mask0)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 26 21 C 26 22.101562 25.101562 23 24 23 L 8 23 C 6.898438 23 6 22.101562 6 21 L 6 11 C 6 9.898438 6.898438 9 8 9 L 24 9 C 25.101562 9 26 9.898438 26 11 Z M 26 21 "/>
<use xlink:href="#surface8" mask="url(#mask1)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 17.75 16 C 16.800781 15.050781 15.199219 15.050781 14.25 16 L 6.5 21.75 C 6.398438 21.851562 6.351562 21.898438 6.25 22 C 6.601562 22.601562 7.25 22.949219 7.949219 22.949219 L 23.949219 22.949219 C 24.699219 22.949219 25.300781 22.550781 25.648438 22 C 25.601562 21.898438 25.5 21.851562 25.398438 21.75 Z M 17.75 16 "/>
<use xlink:href="#surface11" mask="url(#mask2)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 14.25 16 C 15.199219 16.949219 16.800781 16.949219 17.75 16 L 25.5 10.25 C 25.601562 10.148438 25.648438 10.101562 25.75 10 C 25.398438 9.398438 24.75 9.050781 24.050781 9.050781 L 8 9.050781 C 7.25 9.050781 6.648438 9.449219 6.300781 10 C 6.351562 10.101562 6.449219 10.148438 6.550781 10.25 Z M 14.25 16 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
    </ul>
  </section>
  



<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCH7EJS8LE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZCH7EJS8LE', { 'anonymize_ip': false });
}
</script>



          <article class="default">
<h1>4.3. 時間序列屬性分群</h1>

<p><a href="https://colab.research.google.com/drive/1n01pJ_3HlUN3iOru3G1E9onkUlSfu-Z6?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<div>
    <h2>Table Of Contents</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#章節目標">章節目標</a></li>
    <li><a href="#套件安裝與引用">套件安裝與引用</a></li>
    <li><a href="#讀取資料與資料預處理-preprocessing">讀取資料與資料預處理 (Preprocessing)</a></li>
    <li><a href="#資料分群--集群分析-clustering">資料分群 / 集群分析 (Clustering)</a>
      <ul>
        <li><a href="#快速傅立葉轉換-fast-fourier-transform">快速傅立葉轉換 (Fast Fourier Transform)</a></li>
        <li><a href="#小波轉換-wavelet-transform">小波轉換 (Wavelet Transform)</a></li>
      </ul>
    </li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
</div>

<p>集群分析 (Cluster Analysis) 是資料科學中常見的資料處理方法，其主要目的是被用來找出資料中相似的群聚，透過集群分析後，將性質相近的資料群聚在一起，以方便使用者可以針對特徵相似的資料進行更深入的分析與處理。在民生公共物聯網的開放資料中，由於每一種感測器的資料都是時序性的資料，為了將為數眾多的感測器進行適當的分群，以利更深入的資料分析，我們在這個單元將介紹時序資料在分群時常使用的特徵擷取方法，以及在集群分析時常使用到的分群方法。</p>
<h2 id="章節目標">章節目標</h2>
<ul>
<li>學習使用快速傅立葉轉換 (FFT) 與小波轉換 (Wavelet) 擷取時序資料的特徵</li>
<li>採用非監督式學習的方法，針對時序資料進行分群</li>
</ul>
<h2 id="套件安裝與引用">套件安裝與引用</h2>
<p>在本章節中，我們將會使用到 pandas, numpy, matplotlib, pywt 等 Colab 開發平台已預先安裝好的套件，以及另外一個 Colab 並未預先安裝的套件 tslearn ，需使用下列的方式自行安裝：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 更新 pip 至最新版本</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install <span style="color:#f92672">--</span>upgrade pip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安裝 tslearn 套件，它是一個針對時間序列分析的套件</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install tslearn
</span></span></code></pre></div><p>待安裝完畢後，即可使用下列的語法先行引入相關的套件，完成本章節的準備工作：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 引入 numpy 和 pandas，這兩個套件是進行資料分析時非常基本且常用的。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pywt 是進行小波轉換的套件，通常用於訊號處理。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pywt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># os 和 zipfile 用於處理文件和壓縮檔。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os<span style="color:#f92672">,</span> zipfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入 matplotlib.pyplot 來繪製圖表。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># datetime 和 timedelta 是兩個處理日期和時間的模組。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># fft 和 ifft 是進行快速傅立葉轉換的函式。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> numpy.fft <span style="color:#f92672">import</span> fft, ifft
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cwt 是連續小波轉換的函式。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pywt <span style="color:#f92672">import</span> cwt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TimeSeriesKMeans 是 tslearn 套件裡的一個用於時間序列資料集的 k-均值聚類方法。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tslearn.clustering <span style="color:#f92672">import</span> TimeSeriesKMeans
</span></span></code></pre></div><h2 id="讀取資料與資料預處理-preprocessing">讀取資料與資料預處理 (Preprocessing)</h2>
<p>由於我們這次要使用的是長時間的歷史資料，因此我們不直接使用 pyCIOT 套件的讀取資料功能，而直接從民生公共物聯網資料平台的歷史資料庫下載「中研院校園空品微型感測器」的 2021 年歷史資料，並存入 Air 資料夾中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 建立名為 Air 和 CSV_Air 的資料夾</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>mkdir Air CSV_Air
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下載 2021.zip 壓縮檔到 Air 資料夾</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2021.</span>zip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3noJTpmaJf5qCh5ZyS56m65ZOB5b6u5Z6L5oSf5ris5ZmoLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將 Air/2021.zip 這個壓縮檔解壓縮到 Air 資料夾</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip Air<span style="color:#f92672">/</span><span style="color:#ae81ff">2021.</span>zip <span style="color:#f92672">-</span>d Air
</span></span></code></pre></div><p>同時，由於所下載的資料是 zip 壓縮檔案的格式，我們需要先將其解壓縮，產生每日資料的壓縮檔案。由於我們在接下來的範例中只會使用到 2021/08 的資料，因此我們將 202108 子資料夾中的檔案進行解壓縮，讀取當中 csv 檔的資料，再存入 <code>air_month</code> 這個 dataframe 中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 設定想要操作的資料夾路徑和兩種檔案的副檔名</span>
</span></span><span style="display:flex;"><span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Air/2021/202108&#39;</span>
</span></span><span style="display:flex;"><span>extension_zip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;zip&#39;</span>
</span></span><span style="display:flex;"><span>extension_csv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;csv&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遍歷該資料夾下的所有檔案</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 如果檔案是 .zip 壓縮檔</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>endswith(extension_zip):
</span></span><span style="display:flex;"><span>    file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e"># 獲取該壓縮檔的完整路徑</span>
</span></span><span style="display:flex;"><span>    zip_ref <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(file_name) <span style="color:#75715e"># 開啟該壓縮檔</span>
</span></span><span style="display:flex;"><span>    zip_ref<span style="color:#f92672">.</span>extractall(folder) <span style="color:#75715e"># 解壓縮到指定資料夾</span>
</span></span><span style="display:flex;"><span>    zip_ref<span style="color:#f92672">.</span>close() <span style="color:#75715e"># 關閉該壓縮檔</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建一個空的 DataFrame 用來存放合併後的資料</span>
</span></span><span style="display:flex;"><span>air_month <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 再次遍歷該資料夾下的所有檔案</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(folder):
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 如果檔案是 .csv 檔</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>endswith(extension_csv):
</span></span><span style="display:flex;"><span>    file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>item<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e"># 獲取該 .csv 檔的完整路徑</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 讀取該 .csv 檔，並將「timestamp」欄位解析為 datetime 格式</span>
</span></span><span style="display:flex;"><span>    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(file_name, parse_dates<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>])
</span></span><span style="display:flex;"><span>    air_month <span style="color:#f92672">=</span> air_month<span style="color:#f92672">.</span>append(df) <span style="color:#75715e"># 將讀取到的資料加到 air_month DataFrame 中</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將「timestamp」欄位設為索引</span>
</span></span><span style="display:flex;"><span>air_month<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根據「timestamp」欄位對資料進行排序</span>
</span></span><span style="display:flex;"><span>air_month<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>目前 <code>air_month</code> 的格式還不符合我們的需求，需要先將其整理成以站點資料為欄，以時間資料為列的資料格式。我們先找出資料中共有多少站點，並將這些站點資訊存在一個序列中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 從 air_month 資料框中取出「device_id」欄位的所有資料，並儲存為 numpy 陣列</span>
</span></span><span style="display:flex;"><span>id_list <span style="color:#f92672">=</span> air_month[<span style="color:#e6db74">&#39;device_id&#39;</span>]<span style="color:#f92672">.</span>to_numpy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 numpy 的 unique 函數找出 id_list 中的唯一裝置ID</span>
</span></span><span style="display:flex;"><span>id_uniques <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>unique(id_list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 這時，id_uniques 陣列會包含所有唯一的裝置ID</span>
</span></span><span style="display:flex;"><span>id_uniques
</span></span></code></pre></div><pre tabindex="0"><code>array([&#39;08BEAC07D3E2&#39;, &#39;08BEAC09FF12&#39;, &#39;08BEAC09FF22&#39;, ...,
       &#39;74DA38F7C648&#39;, &#39;74DA38F7C64A&#39;, &#39;74DA38F7C64C&#39;], dtype=object)
</code></pre><p>接著我們將每個站點的資料存成一個欄，並放入 「air」 這個 dataframe 中。最後我們將所有下載的資料與解壓縮後產生的資料移除，以節省雲端的儲存空間。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 創建一個空的 DataFrame</span>
</span></span><span style="display:flex;"><span>air <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遍歷每一個裝置ID</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(id_uniques)):
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># print(&#39;device_id==&#34;&#39; + id_uniques[i] + &#39;&#34;&#39;)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 從 air_month 中過濾出當前裝置的資料</span>
</span></span><span style="display:flex;"><span>  query <span style="color:#f92672">=</span> air_month<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;device_id==&#34;&#39;</span> <span style="color:#f92672">+</span> id_uniques[i] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 根據時間戳對資料進行排序</span>
</span></span><span style="display:flex;"><span>  query<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 按小時重新取樣，計算平均值</span>
</span></span><span style="display:flex;"><span>  query_mean <span style="color:#f92672">=</span> query<span style="color:#f92672">.</span>resample(<span style="color:#e6db74">&#39;H&#39;</span>)<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 將 PM25 的列名重新命名為當前裝置 ID</span>
</span></span><span style="display:flex;"><span>  query_mean<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;PM25&#39;</span>: id_uniques[i]}, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 將重新取樣的資料添加到 air DataFrame 中</span>
</span></span><span style="display:flex;"><span>  air <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([air, query_mean], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 刪除 Air 目錄</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf Air
</span></span></code></pre></div><p>我們可以用下列的語法快速查看 air 的內容。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 從資料框 air 取得資訊，如資料的形狀、列名稱、非空資料的數量等。</span>
</span></span><span style="display:flex;"><span>air<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示資料框 air 的前五行，幫助使用者初步了解資料的樣子。</span>
</span></span><span style="display:flex;"><span>print(air<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 745 entries, 2021-08-01 00:00:00 to 2021-09-01 00:00:00
Freq: H
Columns: 1142 entries, 08BEAC07D3E2 to 74DA38F7C64C
dtypes: float64(1142)
memory usage: 6.5 MB
                     08BEAC07D3E2  08BEAC09FF12  08BEAC09FF22  08BEAC09FF2A  \
timestamp                                                                     
2021-08-01 00:00:00      2.272727      1.250000     16.818182     12.100000   
2021-08-01 01:00:00      1.909091      1.285714     13.181818     14.545455   
2021-08-01 02:00:00      2.000000      1.125000     12.727273     16.600000   
2021-08-01 03:00:00      2.083333      3.000000     11.800000     12.090909   
2021-08-01 04:00:00      2.000000      2.600000     10.090909      8.545455   

                     08BEAC09FF34  08BEAC09FF38  08BEAC09FF42  08BEAC09FF44  \
timestamp                                                                     
2021-08-01 00:00:00      2.727273      0.000000      1.181818           NaN   
2021-08-01 01:00:00      2.000000      0.545455      0.909091           NaN   
2021-08-01 02:00:00      4.090909      1.583333      0.636364           NaN   
2021-08-01 03:00:00      0.545455      1.454545      1.181818           NaN   
2021-08-01 04:00:00      1.363636      1.363636      2.454545           NaN   

                     08BEAC09FF46  08BEAC09FF48  ...  74DA38F7C62A  \
timestamp                                        ...                 
2021-08-01 00:00:00      2.636364      2.545455  ...      6.777778   
2021-08-01 01:00:00      1.636364      2.272727  ...      7.800000   
2021-08-01 02:00:00      1.400000      3.100000  ...      7.300000   
2021-08-01 03:00:00      2.181818      4.000000  ...     12.000000   
2021-08-01 04:00:00      1.909091      2.100000  ...      9.000000   

                     74DA38F7C630  74DA38F7C632  74DA38F7C634  74DA38F7C63C  \
timestamp                                                                     
2021-08-01 00:00:00      9.800000     13.200000           5.0      6.200000   
2021-08-01 01:00:00     13.000000     15.700000           5.2      6.800000   
2021-08-01 02:00:00     12.800000     19.300000           5.0      7.300000   
2021-08-01 03:00:00      8.444444     15.200000           5.1      6.777778   
2021-08-01 04:00:00      6.500000     10.222222           4.9      6.100000   

                     74DA38F7C63E  74DA38F7C640  74DA38F7C648  74DA38F7C64A  \
timestamp                                                                     
2021-08-01 00:00:00           NaN      7.500000      5.000000      9.000000   
2021-08-01 01:00:00           NaN     10.200000      4.900000      6.600000   
2021-08-01 02:00:00           NaN     10.500000      3.666667      7.600000   
2021-08-01 03:00:00           NaN      8.500000      8.400000      8.000000   
2021-08-01 04:00:00           NaN      5.571429      6.200000      5.666667   

                     74DA38F7C64C  
timestamp                          
2021-08-01 00:00:00      7.600000  
2021-08-01 01:00:00      7.700000  
2021-08-01 02:00:00      7.888889  
2021-08-01 03:00:00      6.400000  
2021-08-01 04:00:00      5.000000  
</code></pre><p>接下來，我們首先將資料中有資料缺漏的部分 (數值為 Nan) 予以刪除，並且先將資料繪製成圖形，觀察資料的分布狀況。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 將資料框 air 的最後一行刪除</span>
</span></span><span style="display:flex;"><span>air <span style="color:#f92672">=</span> air[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 dropna 方法移除在任何欄位中有缺失值的列</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># axis=1 代表操作在欄位上；how=&#39;any&#39; 代表只要欄位中有任何缺失值就刪除整個欄位</span>
</span></span><span style="display:flex;"><span>air_clean <span style="color:#f92672">=</span> air<span style="color:#f92672">.</span>dropna(<span style="color:#ae81ff">1</span>, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;any&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繪製資料框 air_clean 中的所有資料，不顯示圖例</span>
</span></span><span style="display:flex;"><span>air_clean<span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>), legend<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span></code></pre></div><p><img src="figures/4-3-3-1.png" alt="Python output"></p>
<p>由於原始資料中感測器的瞬間數值容易因為環境變化而有瞬間劇烈的變動，因此我們使用移動平均的方式，將每十次的感測值進行移動平均，讓處理過的資料可以較為平順並反映感測器周遭的整體趨勢，以方便進入接下來的集群分析。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 使用移動平均法對 air_clean 進行平滑處理。window 設定為 10 代表考慮前 10 個資料點的平均值；min_periods=1 表示資料點數量至少有 1 個時才計算平均。</span>
</span></span><span style="display:flex;"><span>air_clean <span style="color:#f92672">=</span> air_clean<span style="color:#f92672">.</span>rolling(window<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, min_periods<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繪製平滑後的 air_clean 資料，設定圖片大小並不顯示圖例。</span>
</span></span><span style="display:flex;"><span>air_clean<span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>), legend<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span></code></pre></div><p><img src="figures/4-3-3-2.png" alt="Python output"></p>
<h2 id="資料分群--集群分析-clustering">資料分群 / 集群分析 (Clustering)</h2>
<p>由於目前 dataframe 內的資料儲存是將每一個測站的資料分別放在獨立的一欄 (column) 中，而將每一列 (row) 存放特定時間點所有站點的感測器數值，此種資料格式較適合作以時間為主軸的時序資料處理與分析，但是對於我們接下來要進行的資料分群，反而需要改成以測站為主軸進行資料處理，因此我們在開始之前，需要先將現有資料進行轉製 (transpose)，也就是將資料的欄與列交換，然後才能進入資料分群。</p>
<p>資料分群已是一項十分普遍的資料科學方法，在許多常見的資料分群方法中，我們選用 tslearn 套件所提供的 KMeans 分群方法 (TimeSeriesKMeans)，在機器學習的領域中，把這類的方法歸類為一種「非監督式學習」的方法，因為在分群的過程中並沒有一定的標準將資料歸為某一群，而是只利用資料彼此間的相似度決定分群，因此後續若要找出離群值或進行預測也更為方便。</p>
<p>KMeans 分群法的內部運作大致分為下列幾個步驟：</p>
<ol>
<li>先決定 <em>k</em> 的值，亦即最後要分成幾個群；</li>
<li>隨機 <em>k</em> 筆資料，當為起始的 k 個群的中心點 (又稱「群心」)；</li>
<li>根據距離公式計算每筆資料到每個群心的距離，並選擇最近的群心，將該筆資料歸屬到該群；</li>
<li>針對每個群，重新計算其新的群心，並重複上述步驟，直到 <em>k</em> 的群的群心不再有變動為止。</li>
</ol>
<p>我們先設定 <em>k</em>=10，並使用 <code>TimeSeriesKMeans</code>，將資料分為 10 群 (0~9) 如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 將 air_clean 資料框進行轉置，使得時間序列資料位於列上，各感測器的資料為行。</span>
</span></span><span style="display:flex;"><span>air_transpose <span style="color:#f92672">=</span> air_clean<span style="color:#f92672">.</span>transpose()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立時間序列分群模型。指定分群數量為10，使用動態時間規整 (DTW) 作為計算距離的指標，最多迭代 5 次進行分群。</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> TimeSeriesKMeans(n_clusters<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dtw&#34;</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用轉置後的資料訓練分群模型。</span>
</span></span><span style="display:flex;"><span>pre <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(air_transpose)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示模型對各感測器資料的分群結果。</span>
</span></span><span style="display:flex;"><span>pre<span style="color:#f92672">.</span>labels_
</span></span></code></pre></div><pre tabindex="0"><code>array([3, 3, 6, 3, 3, 3, 3, 6, 9, 6, 3, 6, 3, 3, 3, 3, 3, 1, 3, 3, 6, 3,
3, 3, 3, 6, 6, 6, 6, 3, 3, 3, 3, 3, 3, 3, 3, 3, 6, 3, 9, 3, 3, 3,
3, 3, 6, 3, 2, 6, 3, 2, 3, 3, 3, 6, 9, 3, 3, 3, 3, 6, 6, 3, 3, 3,
6, 6, 3, 3, 3, 3, 3, 6, 3, 6, 3, 3, 3, 3, 3, 6, 6, 3, 3, 3, 6, 3,
3, 3, 6, 3, 3, 3, 3, 3, 3, 6, 9, 6, 7, 3, 2, 3, 6, 3, 3, 3, 6, 3,
3, 3, 3, 6, 3, 3, 3, 6, 3, 6, 6, 3, 6, 3, 3, 3, 3, 6, 3, 3, 3, 3,
3, 3, 3, 3, 3, 3, 3, 0, 3, 6, 3, 3, 3, 0, 6, 0, 6, 3, 0, 3, 3, 3,
6, 6, 6, 6, 3, 3, 6, 3, 3, 9, 6, 3, 6, 3, 6, 6, 3, 2, 3, 3, 3, 6,
9, 6, 6, 3, 3, 6, 3, 0, 3, 3, 6, 6, 6, 3, 0, 0, 6, 3, 6, 6, 6, 3,
6, 6, 3, 0, 3, 3, 0, 3, 3, 6, 3, 6, 6, 6, 3, 0, 3, 0, 0, 0, 9, 0,
0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 9, 9, 9, 0, 0, 0, 9, 9, 0, 0, 0, 4,
9, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0, 9, 0, 9, 0, 0, 0, 9, 9, 0, 9, 0,
0, 0, 5, 0, 0, 0, 0, 9, 9, 0, 1, 0, 9, 2, 9, 9, 0, 0, 5, 0, 9, 0,
9, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 2, 3, 3, 0, 3, 0, 0, 0, 6, 3, 0,
8, 9, 3, 9, 9, 0, 5, 0, 3, 0, 9, 9, 5, 5, 5, 3, 5, 9, 3, 0, 0, 3,
0, 0, 0, 3, 5, 5, 3, 0, 5, 6, 5, 5, 5, 0, 9, 0, 6, 6, 6, 3, 0, 3,
5, 5, 9, 6, 3, 0, 0, 0, 0, 3, 5, 0, 5, 5, 0, 3, 3, 9, 5, 5, 9, 5,
9, 9, 9, 9, 5, 5, 5, 5, 5, 5, 9, 5, 5, 5, 5, 5, 5, 5, 5, 5, 9, 5,
5, 5])
</code></pre><p>由於分群的結果有可能因為少數感測器擁有特殊的資料特徵而自成一個群集，而這些感測器其實可以被視為偏離測站，並沒有進一步分析的價值，因此我們下一步便要先統計一下每一個分離出來的群集，其內部感測器的個數是否只有一個，如果是的話，便將該群集捨棄掉。例如在這個範例中，我們便會捨棄掉其中只有一個感測器的群集如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 建立一個輔助用的資料框，將每一個 metric (即原始資料的欄位名稱) 對應到它所屬的分群編號。</span>
</span></span><span style="display:flex;"><span>df_cluster <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(list(zip(air_clean<span style="color:#f92672">.</span>columns, pre<span style="color:#f92672">.</span>labels_)), columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;metric&#39;</span>, <span style="color:#e6db74">&#39;cluster&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立一些輔助用的字典和清單。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將每一個分群裡的 metrics 彙整到一個清單中。</span>
</span></span><span style="display:flex;"><span>cluster_metrics_dict <span style="color:#f92672">=</span> df_cluster<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;cluster&#39;</span>])[<span style="color:#e6db74">&#39;metric&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x])<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 計算每一個分群中有多少 metrics。</span>
</span></span><span style="display:flex;"><span>cluster_len_dict <span style="color:#f92672">=</span> df_cluster[<span style="color:#e6db74">&#39;cluster&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找出那些只有一個 metric 的分群。</span>
</span></span><span style="display:flex;"><span>clusters_dropped <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找出那些有超過一個 metric 的分群。</span>
</span></span><span style="display:flex;"><span>clusters_final <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>clusters_final<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示那些只有一個 metric 的分群。</span>
</span></span><span style="display:flex;"><span>clusters_dropped
</span></span></code></pre></div><pre tabindex="0"><code>[7, 4, 8]
</code></pre><p>最後，我們將剩下的群集分別用繪圖的方式展示，可以發現每一個群集內的資料皆呈現極高的相似度，而不同群集的資料，彼此則呈現明顯可分辨的差異。為了量化群集內資料的相似度，我們定義一個新的變數 <code>qualiuty</code>，且這個變數的值等於內部每筆資料與其他資料的相關性 (correlation) 的平均值，且 <code>quality</code> 的值越低代表這個群集內部的資料越相似。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 根據最終的分群數量，設定子圖的數量並初始化圖形。</span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(nrows<span style="color:#f92672">=</span>len(clusters_final), ncols<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># legend = axes.legend(loc=&#34;upper left&#34;, bbox_to_anchor=(1.02, 0, 0.07, 1))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遍歷所有的分群。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> idx, cluster_number <span style="color:#f92672">in</span> enumerate(clusters_final):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算該分群中的時間序列之間的相關性。</span>
</span></span><span style="display:flex;"><span>  x_corr <span style="color:#f92672">=</span> air_clean[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>corr()<span style="color:#f92672">.</span>abs()<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算相關性矩陣中上三角形部分的平均值，排除對角線。</span>
</span></span><span style="display:flex;"><span>  x_corr_mean <span style="color:#f92672">=</span> round(x_corr[np<span style="color:#f92672">.</span>triu_indices(x_corr<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],<span style="color:#ae81ff">1</span>)]<span style="color:#f92672">.</span>mean(),<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 設定子圖的標題，包含分群編號、平均相關性以及該分群中的時間序列數量。</span>
</span></span><span style="display:flex;"><span>  plot_title <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;cluster </span><span style="color:#e6db74">{</span>cluster_number<span style="color:#e6db74">}</span><span style="color:#e6db74"> (quality=</span><span style="color:#e6db74">{</span>x_corr_mean<span style="color:#e6db74">}</span><span style="color:#e6db74">, n=</span><span style="color:#e6db74">{</span>cluster_len_dict[cluster_number]<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 繪製該分群中的所有時間序列。</span>
</span></span><span style="display:flex;"><span>  air_clean[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>axes[idx], title<span style="color:#f92672">=</span>plot_title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 移除圖例。</span>
</span></span><span style="display:flex;"><span>  axes[idx]<span style="color:#f92672">.</span>get_legend()<span style="color:#f92672">.</span>remove()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 調整子圖的間距，確保不會重疊。</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示圖形。</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-3-4-1.png" alt="Python output"></p>
<p>到目前為止，我們已經展示如何使用空品感測的資料，針對資料內的特徵資訊進行資料分群，然而由於原始資料中夾雜許多的雜訊干擾，因此在分群上的表現仍有所不足。為了減少原始資料中的雜訊干擾，我們以下介紹兩種常用的進階方法：傅立葉轉換 (Fourier transform)、小波轉換 (wavelet transform)，分別提取時序資料的進階特徵後，再用來進行資料分群，可以更有效提升感測器分群的成效。</p>
<h3 id="快速傅立葉轉換-fast-fourier-transform">快速傅立葉轉換 (Fast Fourier Transform)</h3>
<p>傅立葉轉換 (Fourier Transform) 是一種常用的信號分析方法，能將原始資料由時域 (time domain) 轉換至頻域 (frequency domain) ，以方便更進一步的特徵擷取與資料分析，常見於工程與數學領域，以及聲音與時序資料的分析。由於標準的傅立葉轉換牽涉到複雜的數學運算，在實作上較為複雜費時，因此後來發展出將原始資料離散化的快速傅立葉轉換方法，可以大幅減少傅立葉轉換的運算複雜度，特別適用於大量數據資料的處理；因此在我們接下來的主題中，將使用快速傅立葉轉換的方法，來協助資料分群所需要的資料特徵的擷取。</p>
<p>我們首先針對單一測站 (‘<code>08BEAC07D3E2</code>’) 透過繪圖的方式，觀察其在時域下的變化圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 根據指定的測站ID，繪製該測站的資料。</span>
</span></span><span style="display:flex;"><span>air_clean[<span style="color:#e6db74">&#39;08BEAC07D3E2&#39;</span>]<span style="color:#f92672">.</span>plot()
</span></span></code></pre></div><p><img src="figures/4-3-4-2.png" alt="Python output"></p>
<p>接著我們使用 numpy 套件中的快速傅立葉轉換工具 <code>fft</code>，將測站的資料輸入進行轉換，並用繪圖的方式觀察轉換到頻域後的資料分佈狀況。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 使用快速傅立葉轉換 (FFT) 計算資料的頻譜</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> fft(air_clean[<span style="color:#e6db74">&#39;08BEAC07D3E2&#39;</span>])
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> len(X) <span style="color:#75715e"># 取得資料的長度</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(N) <span style="color:#75715e"># 產生 0 到 N-1 的序列</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 獲得取樣率，這裡是每小時一次，所以取樣率為 1/3600</span>
</span></span><span style="display:flex;"><span>sr <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>T <span style="color:#f92672">=</span> N<span style="color:#f92672">/</span>sr <span style="color:#75715e"># 總取樣時間</span>
</span></span><span style="display:flex;"><span>freq <span style="color:#f92672">=</span> n<span style="color:#f92672">/</span>T <span style="color:#75715e"># 計算每個頻率成分</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 取得單側的頻譜，因為 FFT 結果是對稱的</span>
</span></span><span style="display:flex;"><span>n_oneside <span style="color:#f92672">=</span> N<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>f_oneside <span style="color:#f92672">=</span> freq[:n_oneside]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繪製頻譜</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(f_oneside, np<span style="color:#f92672">.</span>abs(X[:n_oneside]), <span style="color:#e6db74">&#39;b&#39;</span>) <span style="color:#75715e"># 使用絕對值表示振幅</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Freq (Hz)&#39;</span>) <span style="color:#75715e"># x軸標籤</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;FFT Amplitude |X(freq)|&#39;</span>) <span style="color:#75715e"># y 軸標籤</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show() <span style="color:#75715e"># 顯示圖形</span>
</span></span></code></pre></div><p><img src="figures/4-3-4-3.png" alt="Python output"></p>
<p>然後我們將相同的轉換步驟，擴及到所有的感測器，並且將所有感測器完成快速傅立葉轉換後的結果，儲存在 <code>air_fft</code> 變數中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 創建一個空的資料框來存放每個測站的 FFT 結果</span>
</span></span><span style="display:flex;"><span>air_fft <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 獲取所有測站的名稱</span>
</span></span><span style="display:flex;"><span>col_names <span style="color:#f92672">=</span> list(air_clean<span style="color:#f92672">.</span>columns)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 對每個測站的資料執行 FFT</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> col_names:
</span></span><span style="display:flex;"><span>  X <span style="color:#f92672">=</span> fft(air_clean[name]) <span style="color:#75715e"># 計算 FFT</span>
</span></span><span style="display:flex;"><span>  N <span style="color:#f92672">=</span> len(X) <span style="color:#75715e"># 獲取資料的長度</span>
</span></span><span style="display:flex;"><span>  n <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(N) <span style="color:#75715e"># 產生 0 到 N-1 的序列</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 獲取取樣率，這裡是每小時一次，所以取樣率為 1/3600</span>
</span></span><span style="display:flex;"><span>  sr <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>  T <span style="color:#f92672">=</span> N<span style="color:#f92672">/</span>sr <span style="color:#75715e"># 計算總取樣時間</span>
</span></span><span style="display:flex;"><span>  freq <span style="color:#f92672">=</span> n<span style="color:#f92672">/</span>T <span style="color:#75715e"># 計算每個頻率成分</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 取得單側的頻譜，因為 FFT 結果是對稱的</span>
</span></span><span style="display:flex;"><span>  n_oneside <span style="color:#f92672">=</span> N<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 將計算的 FFT 振幅存到資料框中</span>
</span></span><span style="display:flex;"><span>  f_oneside <span style="color:#f92672">=</span> freq[:n_oneside]
</span></span><span style="display:flex;"><span>  air_fft[name] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>abs(X[:n_oneside])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示 FFT 資料框的前五行</span>
</span></span><span style="display:flex;"><span>print(air_fft<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>08BEAC07D3E2  08BEAC09FF22  08BEAC09FF2A  08BEAC09FF42  08BEAC09FF48  \
0  12019.941563  11255.762431  13241.408211  12111.740447  11798.584351   
1   3275.369377   2640.372699   1501.672853   3096.493565   3103.006928   
2   1109.613670   1201.362571    257.659947   1085.384353   1128.373457   
3   2415.899146   1631.128345    888.838822   2281.597031   2301.936400   
4   1130.973327    446.032078    411.940722   1206.512460   1042.054041   

   08BEAC09FF66  08BEAC09FF80  08BEAC09FF82  08BEAC09FF8C  08BEAC09FF9C  ...  \
0  12441.845754  11874.390693  12259.096742   3553.255916  13531.649701  ...   
1   3262.357287   2999.042917   1459.720167   1109.764942    646.846038  ...   
2   1075.877632   1005.445596    478.569869    368.572815   1163.425916  ...   
3   2448.646527   2318.870954    956.029693    272.486798    553.409732  ...   
4   1087.461354   1172.755489    437.920193    471.824176    703.557830  ...   

   74DA38F7C504  74DA38F7C514  74DA38F7C524  74DA38F7C554  74DA38F7C5BA  \
0  11502.841221  10589.689400  11220.068048  10120.220198  11117.146124   
1   2064.762890   1407.105290   1938.647888   1126.088084   2422.787262   
2   2163.528535   1669.014077   2054.586664   1759.326882   1782.523300   
3   1564.407983   1157.759192   1253.849261   1244.799149   1519.477057   
4   1484.232397   1177.909914   1318.704021   1106.349846   1373.167639   

   74DA38F7C5BC  74DA38F7C5E0  74DA38F7C60C  74DA38F7C62A  74DA38F7C648  
0  11243.094213     26.858333   9408.414826  11228.246949   8931.871618  
1   2097.343959     15.020106   1667.485473   1687.251179   1395.239491  
2   1806.524987     10.659603   1585.987276   1851.628868   1527.925427  
3   1521.392873      6.021244   1217.547879   1240.173667   1022.239794  
4   1393.469185      3.361938   1161.975844   1350.756178   1051.434944  

[5 rows x 398 columns]
</code></pre><p>我們接著使用和前面相同的方法，使用 <code>TimeSeriesKMeans</code> 針對已轉換到頻域的感測器資料分成 10 個群集，並將分群後只有單一感測器的群集予以刪除，在這個範例中，最後會剩下 9 個群集，我們把每個感測器所屬的群集代碼列印出來。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 將 FFT 的結果進行轉置，因為後面的分群模型需要的輸入格式是每列是一段時間序列，每行是不同的時間點。</span>
</span></span><span style="display:flex;"><span>fft_transpose <span style="color:#f92672">=</span> air_fft<span style="color:#f92672">.</span>transpose() <span style="color:#75715e"># 將資料行列交換以符合分群模型輸入的需求</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用時間序列 K 均值進行分群，這裡選擇了 10 個群，使用動態時間歪曲 (DTW) 作為距離度量。</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> TimeSeriesKMeans(n_clusters<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dtw&#34;</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>pre <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(fft_transpose)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立一個輔助資料框，將每個測站 (即每個資料行) 映射到其對應的群標籤。</span>
</span></span><span style="display:flex;"><span>df_cluster <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(list(zip(air_fft<span style="color:#f92672">.</span>columns, pre<span style="color:#f92672">.</span>labels_)), columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;metric&#39;</span>, <span style="color:#e6db74">&#39;cluster&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建輔助的字典和列表來了解每個群中有多少測站，以及哪些測站屬於哪個群。</span>
</span></span><span style="display:flex;"><span>cluster_metrics_dict <span style="color:#f92672">=</span> df_cluster<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;cluster&#39;</span>])[<span style="color:#e6db74">&#39;metric&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x])<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>cluster_len_dict <span style="color:#f92672">=</span> df_cluster[<span style="color:#e6db74">&#39;cluster&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找出只有一個測站的群 (這些群對我們可能沒有太大的意義)。</span>
</span></span><span style="display:flex;"><span>clusters_dropped <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找出有多於一個測站的群。</span>
</span></span><span style="display:flex;"><span>clusters_final <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>clusters_final<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示每個測站及其所屬的群標籤。</span>
</span></span><span style="display:flex;"><span>print(df_cluster<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>))
</span></span></code></pre></div><pre tabindex="0"><code>         metric  cluster
0  08BEAC07D3E2        7
1  08BEAC09FF22        3
2  08BEAC09FF2A        0
3  08BEAC09FF42        7
4  08BEAC09FF48        7
5  08BEAC09FF66        7
6  08BEAC09FF80        7
7  08BEAC09FF82        0
8  08BEAC09FF8C        2
9  08BEAC09FF9C        8
</code></pre><p>最後，我們把九個群集的感測器資料分別繪製出來，可以發現每個群集內的感測器在頻域上的資料皆有極度的相似性，同時不同群集的感測器在頻域上的資料彼此相異程度，亦明顯比同群集內的感測器資料差異度為大。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 根據分群的結果建立多個子圖，每個子圖對應一個群。</span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(nrows<span style="color:#f92672">=</span>len(clusters_final), ncols<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遍歷每一個群，並在對應的子圖上畫出該群內所有測站的FFT結果。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> idx, cluster_number <span style="color:#f92672">in</span> enumerate(clusters_final):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算該群內所有測站之間的相關係數，並取絕對值。</span>
</span></span><span style="display:flex;"><span>  x_corr <span style="color:#f92672">=</span> air_fft[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>corr()<span style="color:#f92672">.</span>abs()<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算上三角矩陣中所有相關係數的平均值，得到該群的平均相關度。</span>
</span></span><span style="display:flex;"><span>  x_corr_mean <span style="color:#f92672">=</span> round(x_corr[np<span style="color:#f92672">.</span>triu_indices(x_corr<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],<span style="color:#ae81ff">1</span>)]<span style="color:#f92672">.</span>mean(),<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 設置子圖的標題，顯示群號、群的平均相關度和群內測站的數量。</span>
</span></span><span style="display:flex;"><span>  plot_title <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;cluster </span><span style="color:#e6db74">{</span>cluster_number<span style="color:#e6db74">}</span><span style="color:#e6db74"> (quality=</span><span style="color:#e6db74">{</span>x_corr_mean<span style="color:#e6db74">}</span><span style="color:#e6db74">, n=</span><span style="color:#e6db74">{</span>cluster_len_dict[cluster_number]<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 畫出該群內所有測站的 FFT 結果。</span>
</span></span><span style="display:flex;"><span>  air_fft[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>axes[idx], title<span style="color:#f92672">=</span>plot_title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 移除圖例，因為對於這樣的圖而言，圖例沒有太大的意義。</span>
</span></span><span style="display:flex;"><span>  axes[idx]<span style="color:#f92672">.</span>get_legend()<span style="color:#f92672">.</span>remove()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 調整子圖之間的間距，使得整體圖形看起來更加整齊。</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示整體圖形。</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-3-4-4.png" alt="Python output"></p>
<h3 id="小波轉換-wavelet-transform">小波轉換 (Wavelet Transform)</h3>
<p>除了傅立葉轉換外，小波轉換也是另一種將原始資料從時域轉換到頻域的常見手法，相較於傅立葉轉換，小波轉換可以提供更多頻域資料的觀察角度，因此近期無論在視訊、音訊、時序等相關的資料分析，已被廣泛地使用，並得到很好的效果。</p>
<p>我們使用 pywt 套件進行小波轉換的資料處理，由於小波轉換會使用到母小波來擷取時序資料中的特徵，因此我們先用下列的語法查看可使用的母小波名稱。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 從 pywt 模組中取得所有連續小波的名稱列表。</span>
</span></span><span style="display:flex;"><span>wavlist <span style="color:#f92672">=</span> pywt<span style="color:#f92672">.</span>wavelist(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;continuous&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示這些連續小波的名稱。</span>
</span></span><span style="display:flex;"><span>print(wavlist)
</span></span></code></pre></div><pre tabindex="0"><code>[&#39;cgau1&#39;, &#39;cgau2&#39;, &#39;cgau3&#39;, &#39;cgau4&#39;, &#39;cgau5&#39;, &#39;cgau6&#39;, &#39;cgau7&#39;, &#39;cgau8&#39;, &#39;cmor&#39;, &#39;fbsp&#39;, &#39;gaus1&#39;, &#39;gaus2&#39;, &#39;gaus3&#39;, &#39;gaus4&#39;, &#39;gaus5&#39;, &#39;gaus6&#39;, &#39;gaus7&#39;, &#39;gaus8&#39;, &#39;mexh&#39;, &#39;morl&#39;, &#39;shan&#39;]
</code></pre><p>不同於傅立葉轉換只能看到頻率上的變化，小波轉換可以將有限長的母小波進行縮放並在一段資料上擷取特徵，而在挑選母小波時可以先將其作圖觀察後再做決定，若以 <em>morl</em> 母小波為例，我們可以使用下列的語法進行作圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 使用 Morlet 小波建立一個連續小波物件。</span>
</span></span><span style="display:flex;"><span>wav <span style="color:#f92672">=</span> pywt<span style="color:#f92672">.</span>ContinuousWavelet(<span style="color:#e6db74">&#34;morl&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定義小波的尺度。</span>
</span></span><span style="display:flex;"><span>scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 計算指定小波的連續小波變換整合。</span>
</span></span><span style="display:flex;"><span>int_psi, x <span style="color:#f92672">=</span> pywt<span style="color:#f92672">.</span>integrate_wavelet(wav, precision<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 正規化整合小波以使其最大絕對值為 1。</span>
</span></span><span style="display:flex;"><span>int_psi <span style="color:#f92672">/=</span> np<span style="color:#f92672">.</span>abs(int_psi)<span style="color:#f92672">.</span>max()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 反轉整合小波，得到小波濾波器。</span>
</span></span><span style="display:flex;"><span>wav_filter <span style="color:#f92672">=</span> int_psi[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定義時間軸。</span>
</span></span><span style="display:flex;"><span>nt <span style="color:#f92672">=</span> len(wav_filter)
</span></span><span style="display:flex;"><span>t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span>nt <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, nt <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, nt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繪製小波濾波器的實部。</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(t, wav_filter<span style="color:#f92672">.</span>real)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylim([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;time (samples)&#34;</span>)
</span></span></code></pre></div><p><img src="figures/4-3-4-5.png" alt="Python output"></p>
<p>我們首先進行小波轉換的基本參數設定，並且使用 <em>morl</em> 母小波，針對所選定的感測器，將小波的縮放範圍設為 1~31 倍，進行小波轉換並作圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 參數設定</span>
</span></span><span style="display:flex;"><span>F <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># 每小時取樣次數</span>
</span></span><span style="display:flex;"><span>hours <span style="color:#f92672">=</span> <span style="color:#ae81ff">744</span> <span style="color:#75715e"># 31 天的小時數</span>
</span></span><span style="display:flex;"><span>nos <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>int(F<span style="color:#f92672">*</span>hours)  <span style="color:#75715e"># 31 天內的總取樣次數</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 從資料框中選擇某一測站的資料</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> air_clean[<span style="color:#e6db74">&#39;08BEAC09FF2A&#39;</span>]
</span></span><span style="display:flex;"><span>scales <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 Morlet 小波進行連續小波變換</span>
</span></span><span style="display:flex;"><span>coef, freqs <span style="color:#f92672">=</span> cwt(x, scales, <span style="color:#e6db74">&#39;morl&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 繪製 scalogram</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>imshow(abs(coef), extent<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">744</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">1</span>], interpolation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bilinear&#39;</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;viridis&#39;</span>,
</span></span><span style="display:flex;"><span>           aspect<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;auto&#39;</span>, vmax<span style="color:#f92672">=</span>abs(coef)<span style="color:#f92672">.</span>max(), vmin<span style="color:#f92672">=</span>abs(coef)<span style="color:#f92672">.</span>min()) <span style="color:#75715e"># 顯示小波變換的絕對值</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>invert_yaxis() <span style="color:#75715e"># Y 軸反向，使尺度從大到小排列</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>yticks(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xticks(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>, nos<span style="color:#f92672">/</span>F, nos<span style="color:#f92672">/</span>(<span style="color:#ae81ff">20</span><span style="color:#f92672">*</span>F))) <span style="color:#75715e"># 設定 X 軸的刻度</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;scales&#34;</span>) <span style="color:#75715e"># 設定 Y 軸標籤</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;hour&#34;</span>) <span style="color:#75715e"># 設定 X 軸標籤</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>colorbar() <span style="color:#75715e"># 顯示色條</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show() <span style="color:#75715e"># 顯示圖形</span>
</span></span></code></pre></div><p><img src="figures/4-3-4-6.png" alt="Python output"></p>
<p>整體而言，我們可以發現在圖中 scales 較大時的顏色較偏向黃綠色，代表擷取出來的特徵與母小波較為相近，反之則較偏向藍色，這些比對結果的特徵數值將會被用於接下來的資料分群。</p>
<p>不過，由於經過小波轉換後，每個測站的資料已經轉為二維的特徵數值，在開始進行資料分群前，我們需要先將原本二維資料的每一個欄位串接起來，變成一維的資料格式，並存入 <code>air_cwt</code> 變數中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 初始化空的資料框用於存儲所有測站的小波連續變換結果</span>
</span></span><span style="display:flex;"><span>air_cwt <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定義要使用的小波尺度範圍，此處選擇了 28, 30 這兩個尺度</span>
</span></span><span style="display:flex;"><span>scales <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 從 air_clean 中獲取所有測站的名稱</span>
</span></span><span style="display:flex;"><span>col_names <span style="color:#f92672">=</span> list(air_clean<span style="color:#f92672">.</span>columns)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 對每一個測站的資料進行小波連續變換</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> col_names:
</span></span><span style="display:flex;"><span>  coef, freqs <span style="color:#f92672">=</span> cwt(air_clean[name], scales, <span style="color:#e6db74">&#39;morl&#39;</span>) <span style="color:#75715e"># 使用 Morlet 小波進行連續小波變換</span>
</span></span><span style="display:flex;"><span>  air_cwt[name] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>abs(coef<span style="color:#f92672">.</span>reshape(coef<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>coef<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>])) <span style="color:#75715e"># 重塑 coef 陣列並取其絕對值</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示資料框 air_cwt 的前五行</span>
</span></span><span style="display:flex;"><span>print(air_cwt<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><pre tabindex="0"><code>08BEAC07D3E2  08BEAC09FF22  08BEAC09FF2A  08BEAC09FF42  08BEAC09FF48  \
0      0.778745      6.336664      2.137342      1.849035      0.778745   
1      0.929951      8.348031      2.977576      1.829540      0.958915   
2      1.190476     11.476048      3.223773      1.832544      1.292037   
3      1.227021     12.890554      4.488244      1.634717      1.338655   
4      1.252126     14.103178      5.715656      1.430744      1.376562   

   08BEAC09FF66  08BEAC09FF80  08BEAC09FF82  08BEAC09FF8C  08BEAC09FF9C  ...  \
0      0.555941      0.334225      8.110581      2.287378      0.409913  ...   
1      0.596532      0.201897      8.774271      1.706411      0.311242  ...   
2      0.771641      0.294242      8.327808      1.018296      2.754100  ...   
3      0.713931      0.065011      8.669036      0.249029      3.278048  ...   
4      0.670639      0.193083      8.795376      0.624988      3.628597  ...   

   74DA38F7C504  74DA38F7C514  74DA38F7C524  74DA38F7C554  74DA38F7C5BA  \
0      1.875873      1.090635      0.284901      1.111999      1.049112   
1      0.643478      1.446061      0.420701      0.974641      0.478931   
2      1.101801      2.404254      1.389941      1.190141      0.511454   
3      2.370436      2.510728      1.927692      0.703424      1.054164   
4      3.563873      2.387982      2.463458      0.098485      1.448078   

   74DA38F7C5BC  74DA38F7C5E0  74DA38F7C60C  74DA38F7C62A  74DA38F7C648  
0      1.107551      0.000918      0.080841      0.859855      0.415574  
1      0.245802      0.005389      1.053260      1.762642      0.190458  
2      1.162331      0.009754      2.667145      3.210326      0.516525  
3      1.993138      0.014496      3.669712      3.889207      0.666492  
4      2.672666      0.020433      4.482730      4.311888      0.677992  

[5 rows x 398 columns]
</code></pre><p>由於經過二維資料轉換成一維資料的程序，每筆資料的特徵數值數量因而增加，將造成後續資料運算的複雜度大幅提升，因此我們先只取前 100 個特徵數值做為每個感測器的代表性特徵，並以此套用 KMeans 方法進行資料分群。</p>
<p>由於小波轉換可以得到更細微的資料特徵，因此我們在資料分群的過程中，預設分為 20 個群集（讀者可自行測試不同的群集數目設定，觀察結果會產生哪些變化）；此外，我們對於分群結果也一樣先檢查是否存在只有單一感測器的小群集，並將其剔除，以避免少數特殊狀況的感測器，影響整體資料分群的結果。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 選擇 air_cwt 資料框的前 101 列作為一個子集</span>
</span></span><span style="display:flex;"><span>air_cwt_less <span style="color:#f92672">=</span> air_cwt<span style="color:#f92672">.</span>iloc[:, <span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">101</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 由於 TimeSeriesKMeans 模型需要資料的每一列為一個時間序列，因此我們將資料框轉置</span>
</span></span><span style="display:flex;"><span>cwt_transpose <span style="color:#f92672">=</span> air_cwt_less<span style="color:#f92672">.</span>transpose()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始化 TimeSeriesKMeans 模型，設定分群數量為 20，使用 DTW 作為相似度指標，並設定其他參數</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> TimeSeriesKMeans(n_clusters<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dtw&#34;</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, n_jobs<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 擬合模型到資料</span>
</span></span><span style="display:flex;"><span>pre <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(cwt_transpose)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建一個幫助資料框，將資料的名稱映射到其相應的分群標籤</span>
</span></span><span style="display:flex;"><span>df_cluster <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(list(zip(air_cwt<span style="color:#f92672">.</span>columns, pre<span style="color:#f92672">.</span>labels_)), columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;metric&#39;</span>, <span style="color:#e6db74">&#39;cluster&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建一些幫助字典和列表</span>
</span></span><span style="display:flex;"><span>cluster_metrics_dict <span style="color:#f92672">=</span> df_cluster<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;cluster&#39;</span>])[<span style="color:#e6db74">&#39;metric&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x])<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>cluster_len_dict <span style="color:#f92672">=</span> df_cluster[<span style="color:#e6db74">&#39;cluster&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>to_dict()
</span></span><span style="display:flex;"><span>clusters_dropped <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e"># 被捨棄的分群</span>
</span></span><span style="display:flex;"><span>clusters_final <span style="color:#f92672">=</span> [cluster <span style="color:#66d9ef">for</span> cluster <span style="color:#f92672">in</span> cluster_len_dict <span style="color:#66d9ef">if</span> cluster_len_dict[cluster]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">1</span>] <span style="color:#75715e"># 最終使用的分群</span>
</span></span><span style="display:flex;"><span>clusters_final<span style="color:#f92672">.</span>sort() <span style="color:#75715e"># 對分群編號進行排序</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示 df_cluster 的前 10 行以供查看</span>
</span></span><span style="display:flex;"><span>print(df_cluster<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>))
</span></span></code></pre></div><pre tabindex="0"><code>metric  cluster
0  08BEAC07D3E2        7
1  08BEAC09FF22        3
2  08BEAC09FF2A        6
3  08BEAC09FF42       10
4  08BEAC09FF48        7
5  08BEAC09FF66        7
6  08BEAC09FF80        7
7  08BEAC09FF82        6
8  08BEAC09FF8C       15
9  08BEAC09FF9C       19
</code></pre><p>在我們的範例中，經過上述的程序後，最後留下 14 個群集，我們將每個群集內的感測器原始資料一一繪出，我們可以發現相同群集內的感測器資料一致性更加明顯，同時不同群集間的差異也更加細緻明確，比之前使用原始資料或傅立葉轉換時的成效更為明顯。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 根據我們的分群數量，建立一個多行、單列的子圖結構</span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(nrows<span style="color:#f92672">=</span>len(clusters_final), ncols<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">15</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 對於每個分群，我們會做以下操作：</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> idx, cluster_number <span style="color:#f92672">in</span> enumerate(clusters_final):
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算這個分群中的時間序列的相關性</span>
</span></span><span style="display:flex;"><span>  x_corr <span style="color:#f92672">=</span> air_cwt[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>corr()<span style="color:#f92672">.</span>abs()<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 計算平均相關性</span>
</span></span><span style="display:flex;"><span>  x_corr_mean <span style="color:#f92672">=</span> round(x_corr[np<span style="color:#f92672">.</span>triu_indices(x_corr<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],<span style="color:#ae81ff">1</span>)]<span style="color:#f92672">.</span>mean(),<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 設定子圖的標題，包括分群號、平均相關性和該分群中的時間序列數量</span>
</span></span><span style="display:flex;"><span>  plot_title <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;cluster </span><span style="color:#e6db74">{</span>cluster_number<span style="color:#e6db74">}</span><span style="color:#e6db74"> (quality=</span><span style="color:#e6db74">{</span>x_corr_mean<span style="color:#e6db74">}</span><span style="color:#e6db74">, n=</span><span style="color:#e6db74">{</span>cluster_len_dict[cluster_number]<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 在子圖上繪製該分群中的所有時間序列</span>
</span></span><span style="display:flex;"><span>  air_cwt[cluster_metrics_dict[cluster_number]]<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>axes[idx], title<span style="color:#f92672">=</span>plot_title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># 移除子圖的圖例，以保持視覺清晰</span>
</span></span><span style="display:flex;"><span>  axes[idx]<span style="color:#f92672">.</span>get_legend()<span style="color:#f92672">.</span>remove()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 調整子圖的間距，使其適應畫布</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示圖表</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/4-3-4-7.png" alt="Python output"></p>
<h2 id="參考資料">參考資料</h2>
<ul>
<li>民生公共物聯網歷史資料 (<a href="https://history.colife.org.tw/#/">https://history.colife.org.tw/</a>)</li>
<li>Time Series Clustering — Deriving Trends and Archetypes from Sequential Data | by Denyse | Towards Data Science (<a href="https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3">https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3</a>)</li>
<li>How to Apply K-means Clustering to Time Series Data | by Alexandra Amidon | Towards Data Science (<a href="https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3">https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3</a>)</li>
<li>Understanding K-means Clustering: Hands-On with SciKit-Learn | by Carla Martins | May, 2022 | Towards AI (<a href="https://pub.towardsai.net/understanding-k-means-clustering-hands-on-with-scikit-learn-b522c0698c81">https://pub.towardsai.net/understanding-k-means-clustering-hands-on-with-scikit-learn-b522c0698c81</a>)</li>
<li>Fast Fourier Transform. How to implement the Fast Fourier… | by Cory Maklin | Towards Data Science (<a href="https://towardsdatascience.com/fast-fourier-transform-937926e591cb">https://towardsdatascience.com/fast-fourier-transform-937926e591cb</a>)</li>
<li>PyWavelets/pywt: PyWavelets - Wavelet Transforms in Python (<a href="https://github.com/PyWavelets/pywt">https://github.com/PyWavelets/pywt</a>)</li>
</ul>

            <footer class="footline">
            </footer>
          </article>


<div align="center">
<hr width="70%">

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
<br />
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0;margin:2px" src="https://i.creativecommons.org/l/by/3.0/88x31.png" /></a>
</div>
<p style="height:30px">

<div id="disqus_thread" style="border-style: ridge; padding-inline:5px"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'learnciot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation showVisitedLinks">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
          <style>
            #logo svg,
            #logo svg * {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              fill: #282828 !important;
              fill: var(--MENU-SECTIONS-BG-color) !important;
              opacity: .945;
            }
            a#logo {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              font-family: 'Work Sans', 'Helvetica', 'Tahoma', 'Geneva', 'Arial', sans-serif;
              font-size: 30px;
              font-weight: 300;
              margin-top: -13px;
              max-width: 60%;
              text-transform: uppercase;
              width: 226px;
              white-space: nowrap;
            }
            a#logo:hover {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
            }
            #logo svg {
              margin-bottom: -20px;
              margin-left: -23.5px;
              width: 40.5%;
            }
            @media only all and (max-width: 59.938em) {
              a#logo {
                font-size: 25px;
                margin-top: -3px;
              }
              #logo svg {
                margin-bottom: -12px;
                margin-left: -23px;
              }
            }
            @media all and (-ms-high-contrast:none) {
              /* IE11s understanding of positioning is weird at best */
              a#logo {
                margin-top: -58px;
              }
              #logo svg {
                margin-bottom: -62px;
              }
            }
          </style>
          <a id="logo" href="/">
            Learn CIoT
          </a>

        </div>
        <div class="searchbox default-animation">
          <label class="a11y-only" for="search-by">搜尋</label>
          <i class="fas fa-search"></i>
          <input data-search-input id="search-by" type="search" placeholder="搜尋...">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['zh'];
        </script>
        <script src="/js/auto-complete.js?1700107091" defer></script>
        <script src="/js/lunr.min.js?1700107091" defer></script>
        <script src="/js/lunr.stemmer.support.min.js?1700107091" defer></script>
        <script src="/js/lunr.multi.min.js?1700107091" defer></script>
        <script src="/js/lunr.zh.min.js?1700107091" defer></script>
        <script src="/js/search.js?1700107091" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/ch1/" title="1. 教學網站簡介" class="dd-item"><a href="/ch1/">1. 教學網站簡介<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/" title="2. 整體課程前言" class="dd-item"><label for="section-0c4ff77f81b29c69f37066d67544c3b9" ></label><a href="/ch2/">2. 整體課程前言<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch2/ch2.1/" title="2.1. 課程架構說明" class="dd-item"><a href="/ch2/ch2.1/">2.1. 課程架構說明<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/ch2.2/" title="2.2. 課程軟體工具簡介" class="dd-item"><a href="/ch2/ch2.2/">2.2. 課程軟體工具簡介<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch3/" title="3. 資料取用" class="dd-item"><label for="section-2d571a52f8e6e09b8c11625532edb2d4" ></label><a href="/ch3/">3. 資料取用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch3/ch3.1/" title="3.1. 基本資料存取方法" class="dd-item"><a href="/ch3/ch3.1/">3.1. 基本資料存取方法<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch3/ch3.2/" title="3.2. 存取特定時空條件的資料" class="dd-item"><a href="/ch3/ch3.2/">3.2. 存取特定時空條件的資料<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch4/" title="4. 時間維度資料分析" class="dd-item parent"><label for="section-a3965432c40ae592eaa5a4a04592685e" ></label><a href="/ch4/">4. 時間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch4/ch4.1/" title="4.1. 時間序列資料處理" class="dd-item"><a href="/ch4/ch4.1/">4.1. 時間序列資料處理<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.2/" title="4.2. 時間序列資料預測" class="dd-item"><a href="/ch4/ch4.2/">4.2. 時間序列資料預測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.3/" title="4.3. 時間序列屬性分群" class="dd-item active"><a href="/ch4/ch4.3/">4.3. 時間序列屬性分群<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch5/" title="5. 空間維度資料分析" class="dd-item"><label for="section-b6a8e999e0329c5971871ffc5b34192f" ></label><a href="/ch5/">5. 空間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch5/ch5.1/" title="5.1. 地理空間篩選" class="dd-item"><a href="/ch5/ch5.1/">5.1. 地理空間篩選<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch5/ch5.2/" title="5.2. 地理空間分析" class="dd-item"><a href="/ch5/ch5.2/">5.2. 地理空間分析<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch6/" title="6. 資料應用" class="dd-item"><label for="section-f8bc2d76b61c5c9922024382e3ab1dcb" ></label><a href="/ch6/">6. 資料應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch6/ch6.1/" title="6.1. 機器學習初探" class="dd-item"><a href="/ch6/ch6.1/">6.1. 機器學習初探<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.2/" title="6.2. 異常資料偵測" class="dd-item"><a href="/ch6/ch6.2/">6.2. 異常資料偵測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.3/" title="6.3. 感測器聯合校正" class="dd-item"><a href="/ch6/ch6.3/">6.3. 感測器聯合校正<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch7/" title="7. 系統整合應用" class="dd-item"><label for="section-c663021a728355d88e45618764e92f92" ></label><a href="/ch7/">7. 系統整合應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch7/ch7.1/" title="7.1. QGIS 應用" class="dd-item"><a href="/ch7/ch7.1/">7.1. QGIS 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.2/" title="7.2. Tableau 應用" class="dd-item"><a href="/ch7/ch7.2/">7.2. Tableau 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.3/" title="7.3 Leafmap 應用" class="dd-item"><a href="/ch7/ch7.3/">7.3 Leafmap 應用<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/video/" title="教學影片" class="dd-item"><a href="/video/">教學影片<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/about/" title="關於我們" class="dd-item"><a href="/about/">關於我們<i class="fas fa-check read-icon"></i></a></li>
        </ul>
        <div id="shortcuts">
          <div class="nav-title">其他連結</div>
          <ul>
            <li><a class="padding" href="https://github.com/LearnCIOT/LearnCIOT.github.io"><i class='fab fa-fw fa-github'></i> GitHub</a></li>
            <li><a class="padding" href="/levels/"><i class='fas fa-fw fa-heartbeat'></i> 按照難度等級查詢</a></li>
            <li><a class="padding" href="/tags/"><i class='fas fa-fw fa-tags'></i> 按照文章標籤查詢</a></li>
            <li><a class="padding" href="/authors/"><i class='fas fa-fw fa-users'></i> 按照文章作者查詢</a></li>
          </ul>
        </div>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"/>
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch showVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch showLangSwitch">
              <a class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-language" onchange="location = baseUri + this.value;">
                    <option id="zh-tw" value="/ch4/ch4.3/" selected>中文</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <a class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="relearn-light" value="relearn-light" selected>Relearn Light</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks showVisitedLinks"><a class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> 清除歷史紀錄</a></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>

    <script src="/js/clipboard.min.js?1700107091" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1700107091" defer></script>
    <script src="/js/featherlight.min.js?1700107091" defer></script>
    <script src="/js/jquery.svg.pan.zoom.js?1700107091" defer></script>
    <script src="/js/mermaid.min.js?1700107091" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/theme.js?1700107091" defer></script>
  </body>
</html>
