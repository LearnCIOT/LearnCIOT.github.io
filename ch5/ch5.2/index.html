<!DOCTYPE html>
<html lang="zh-tw" class="js csstransforms3d">
  <head>

<meta property="og:title" content="5.2. 地理空間分析"/>
<meta property="og:description" content="我們使用民生公共物聯網資料平台的感測資料，介紹較為進階的地理空間分析，利用測站資訊中的 GPS 位置座標，首先利用尋找最大凸多邊形 (Convex Hull) 的套件，框定感測器所涵蓋的地理區域；接著套用 Voronoi Diagram 的套件，將地圖上的區域依照感測器的分布狀況，切割出每個感測器的勢力範圍。針對感測器與感測器之間的區域，我們利用空間內插的方式，套用不同的空間內插演算法，根據感測器的數值，進行空間地圖上的填值，並產製相對應的圖片輸出。"/>
<meta property="og:image" content="https://learnciot.github.io/images/thumbnail.jpg"/>
<meta property="og:url" content="/ch5/ch5.2/"/>
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="627" />
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.104.3">
    <meta name="generator" content="Relearn 5.3.3+tip">
    <meta name="description" content="我們使用民生公共物聯網資料平台的感測資料，介紹較為進階的地理空間分析，利用測站資訊中的 GPS 位置座標，首先利用尋找最大凸多邊形 (Convex Hull) 的套件，框定感測器所涵蓋的地理區域；接著套用 Voronoi Diagram 的套件，將地圖上的區域依照感測器的分布狀況，切割出每個感測器的勢力範圍。針對感測器與感測器之間的區域，我們利用空間內插的方式，套用不同的空間內插演算法，根據感測器的數值，進行空間地圖上的填值，並產製相對應的圖片輸出。">
    <meta name="author" content="Ling-Jyh Chen">
    <title>5.2. 地理空間分析 :: Tutorial for CIoT Open Data Applications</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1697343324" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1697343324" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1697343324" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1697343324" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1697343324" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1697343324" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1697343324" rel="stylesheet">
    <link href="/css/nucleus.css?1697343324" rel="stylesheet">
    <link href="/css/fonts.css?1697343324" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1697343324" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1697343324" rel="stylesheet">
    <link href="/css/theme-relearn-light.css?1697343324" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1697343324" rel="stylesheet">
    <link href="/css/variant.css?1697343324" rel="stylesheet">
    <link href="/css/print.css?1697343324" rel="stylesheet" media="print">
    <script src="/js/variant.js?1697343324"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="/index.json";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '複製到剪貼板';
      window.T_Copied_to_clipboard = '複製到剪貼簿！';
      window.T_Copy_link_to_clipboard = '將連結複製到剪貼簿';
      window.T_Link_copied_to_clipboard = '連結複製到剪貼簿！';
      // some further base stuff
      var baseUriFull='https:\/\/LearnCIOT.github.io/';
      window.variants && variants.init( [ 'relearn-light' ] );
    </script>
    <script src="/js/jquery.min.js?1697343324" defer></script>
<meta property="fb:app_id" content="601826851395774" />
  </head>
  <body class="default-animation" data-url="/ch5/ch5.2/">




<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v14.0" nonce="hWjBXHAv"></script>

    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div class="navigation">
             <a class="nav nav-next" href="/ch6/" title="6. 資料應用"><i class="fas fa-chevron-right fa-fw"></i></a>
          </div>
          <div class="navigation">
             <a class="nav nav-prev" href="/ch5/ch5.1/" title="5.1. 地理空間篩選"><i class="fas fa-chevron-left fa-fw"></i></a>
          </div>
          <div id="top-github-link">
            <a class="github-link" title='編輯網頁' href="https://github.com/LearnCIOT/LearnCIOT.github.io/tree/main/content/ch5/ch5.2/index.zh-tw.md" target="blank">
              <i class="fas fa-pen fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='導航'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title='目錄'><i class="fas fa-list-alt fa-fw"></i></span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <meta itemprop="itemListOrder" content="Descending" />
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="3" /><a itemprop="item" href="/"><span itemprop="name">民生公共物聯網資料應用</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="2" /><a itemprop="item" href="/ch5/"><span itemprop="name">5. 空間維度資料分析</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="1" /><a itemprop="item" href="/ch5/ch5.2/" aria-disabled="true"><span itemprop="name">5.2. 地理空間分析</span></a></li>
            </ol>
          </div>
          <div class="default-animation progress">
            <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#勢力分佈圖-voronoi-diagram">勢力分佈圖 (Voronoi diagram)</a></li>
    <li><a href="#最小範圍多邊形凸包-convex-hull">最小範圍多邊形/凸包 (Convex hull)</a></li>
    <li><a href="#空間群聚-clustering">空間群聚 (Clustering)</a></li>
    <li><a href="#密度-kernel-density">密度 (Kernel density)</a></li>
    <li><a href="#空間內插-spatial-interpolation">空間內插 (Spatial interpolation)</a>
      <ul>
        <li><a href="#反距離加權法-inverse-distance-weighting">反距離加權法 (Inverse Distance Weighting)</a></li>
        <li><a href="#克力金法-kriging">克力金法 (Kriging)</a></li>
        <li><a href="#最近鄰居插值-nearest-neighbor-interpolation">最近鄰居插值 (Nearest neighbor Interpolation)</a></li>
      </ul>
    </li>
    <li><a href="#空間內插後的資料處理">空間內插後的資料處理</a>
      <ul>
        <li><a href="#擷取等值線資料-contour">擷取等值線資料 (contour)</a></li>
        <li><a href="#擷取橫切面的資料-profile">擷取橫切面的資料 (Profile)</a></li>
      </ul>
    </li>
    <li><a href="#參考資源">參考資源</a></li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>

      <main id="body-inner" class="highlightable ">
        <div class="flex-block-wrapper">
          <div id="head-tags"><div class="tags">
  <a class="level-link" href="/levels/intermediate">
  <b>
	&starf;&starf;&starf;&star;&star;
  </b>
  </a>
  <a class="tag-link" href="/tags/python">Python</a>
  <a class="tag-link" href="/tags/%E6%B0%B4">水</a>
  <a class="tag-link" href="/tags/%E7%A9%BA">空</a>
</div>

          </div>


  
  
  

  <section class="social-share">
    <ul class="share-icons">
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f&amp;text=5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="26px" viewBox="0 0 31 26" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(11.372549%,60.784314%,94.117647%);fill-opacity:1;" d="M 27.742188 6.535156 C 27.761719 6.8125 27.761719 7.089844 27.761719 7.371094 C 27.761719 15.875 21.414062 25.683594 9.800781 25.683594 L 9.800781 25.675781 C 6.371094 25.683594 3.011719 24.679688 0.125 22.792969 C 0.625 22.851562 1.125 22.882812 1.628906 22.886719 C 4.46875 22.886719 7.230469 21.914062 9.46875 20.125 C 6.765625 20.070312 4.398438 18.277344 3.570312 15.65625 C 4.515625 15.839844 5.492188 15.800781 6.421875 15.542969 C 3.476562 14.9375 1.355469 12.300781 1.355469 9.234375 L 1.355469 9.152344 C 2.234375 9.652344 3.214844 9.929688 4.222656 9.960938 C 1.449219 8.070312 0.59375 4.304688 2.265625 1.363281 C 5.472656 5.386719 10.203125 7.832031 15.277344 8.089844 C 14.769531 5.855469 15.464844 3.511719 17.105469 1.941406 C 19.644531 -0.496094 23.644531 -0.371094 26.035156 2.21875 C 27.449219 1.933594 28.804688 1.40625 30.042969 0.65625 C 29.574219 2.144531 28.585938 3.410156 27.269531 4.214844 C 28.519531 4.066406 29.742188 3.722656 30.894531 3.203125 C 30.046875 4.496094 28.980469 5.625 27.742188 6.535156 Z M 27.742188 6.535156 "/>
</g>
</svg>

          <p>Twitter</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<linearGradient id="linear0" gradientUnits="userSpaceOnUse" x1="-277.375" y1="406.6018" x2="-277.375" y2="407.5726" gradientTransform="matrix(32,0,0,-31.82224,8892.0008,12969.8672)">
<stop offset="0" style="stop-color:rgb(0%,38.431373%,87.843137%);stop-opacity:1;"/>
<stop offset="1" style="stop-color:rgb(9.803922%,68.627451%,100%);stop-opacity:1;"/>
</linearGradient>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:url(#linear0);" d="M 13.359375 31.839844 C 5.761719 30.480469 0 23.921875 0 16 C 0 7.199219 7.199219 0 16 0 C 24.800781 0 32 7.199219 32 16 C 32 23.921875 26.238281 30.480469 18.640625 31.839844 L 17.761719 31.121094 L 14.238281 31.121094 Z M 13.359375 31.839844 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 22.238281 20.480469 L 22.960938 16 L 18.71875 16 L 18.71875 12.878906 C 18.71875 11.601562 19.199219 10.640625 21.121094 10.640625 L 23.199219 10.640625 L 23.199219 6.558594 C 22.078125 6.398438 20.800781 6.238281 19.679688 6.238281 C 16 6.238281 13.441406 8.480469 13.441406 12.480469 L 13.441406 16 L 9.441406 16 L 9.441406 20.480469 L 13.441406 20.480469 L 13.441406 31.761719 C 14.320312 31.921875 15.199219 32 16.078125 32 C 16.960938 32 17.839844 31.921875 18.71875 31.761719 L 18.71875 20.480469 Z M 22.238281 20.480469 "/>
</g>
</svg>

          <p>Facebook</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f&amp;source=https%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f&amp;title=5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90&amp;summary=5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(0%,49.411765%,73.333333%);fill-opacity:1;" d="M 16 32 C 24.835938 32 32 24.835938 32 16 C 32 7.164062 24.835938 0 16 0 C 7.164062 0 0 7.164062 0 16 C 0 24.835938 7.164062 32 16 32 Z M 16 32 "/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 26.222656 25.332031 L 22.203125 25.332031 L 22.203125 18.488281 C 22.203125 16.613281 21.492188 15.566406 20.007812 15.566406 C 18.390625 15.566406 17.546875 16.65625 17.546875 18.488281 L 17.546875 25.332031 L 13.675781 25.332031 L 13.675781 12.296875 L 17.546875 12.296875 L 17.546875 14.050781 C 17.546875 14.050781 18.710938 11.898438 21.476562 11.898438 C 24.242188 11.898438 26.222656 13.585938 26.222656 17.078125 Z M 9.054688 10.589844 C 7.734375 10.589844 6.667969 9.511719 6.667969 8.183594 C 6.667969 6.855469 7.734375 5.777344 9.054688 5.777344 C 10.375 5.777344 11.441406 6.855469 11.441406 8.183594 C 11.441406 9.511719 10.375 10.589844 9.054688 10.589844 Z M 7.054688 25.332031 L 11.09375 25.332031 L 11.09375 12.296875 L 7.054688 12.296875 Z M 7.054688 25.332031 "/>
</g>
</svg>

            <p>LinkedIn</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="whatsapp://send?text=5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bd%bf%e7%94%a8%e6%b0%91%e7%94%9f%e5%85%ac%e5%85%b1%e7%89%a9%e8%81%af%e7%b6%b2%e8%b3%87%e6%96%99%e5%b9%b3%e5%8f%b0%e7%9a%84%e6%84%9f%e6%b8%ac%e8%b3%87%e6%96%99%ef%bc%8c%e4%bb%8b%e7%b4%b9%e8%bc%83%e7%82%ba%e9%80%b2%e9%9a%8e%e7%9a%84%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90%ef%bc%8c%e5%88%a9%e7%94%a8%e6%b8%ac%e7%ab%99%e8%b3%87%e8%a8%8a%e4%b8%ad%e7%9a%84%20GPS%20%e4%bd%8d%e7%bd%ae%e5%ba%a7%e6%a8%99%ef%bc%8c%e9%a6%96%e5%85%88%e5%88%a9%e7%94%a8%e5%b0%8b%e6%89%be%e6%9c%80%e5%a4%a7%e5%87%b8%e5%a4%9a%e9%82%8a%e5%bd%a2%20%28Convex%20Hull%29%20%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e6%a1%86%e5%ae%9a%e6%84%9f%e6%b8%ac%e5%99%a8%e6%89%80%e6%b6%b5%e8%93%8b%e7%9a%84%e5%9c%b0%e7%90%86%e5%8d%80%e5%9f%9f%ef%bc%9b%e6%8e%a5%e8%91%97%e5%a5%97%e7%94%a8%20Voronoi%20Diagram%20%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e5%b0%87%e5%9c%b0%e5%9c%96%e4%b8%8a%e7%9a%84%e5%8d%80%e5%9f%9f%e4%be%9d%e7%85%a7%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e5%88%86%e5%b8%83%e7%8b%80%e6%b3%81%ef%bc%8c%e5%88%87%e5%89%b2%e5%87%ba%e6%af%8f%e5%80%8b%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e5%8b%a2%e5%8a%9b%e7%af%84%e5%9c%8d%e3%80%82%e9%87%9d%e5%b0%8d%e6%84%9f%e6%b8%ac%e5%99%a8%e8%88%87%e6%84%9f%e6%b8%ac%e5%99%a8%e4%b9%8b%e9%96%93%e7%9a%84%e5%8d%80%e5%9f%9f%ef%bc%8c%e6%88%91%e5%80%91%e5%88%a9%e7%94%a8%e7%a9%ba%e9%96%93%e5%85%a7%e6%8f%92%e7%9a%84%e6%96%b9%e5%bc%8f%ef%bc%8c%e5%a5%97%e7%94%a8%e4%b8%8d%e5%90%8c%e7%9a%84%e7%a9%ba%e9%96%93%e5%85%a7%e6%8f%92%e6%bc%94%e7%ae%97%e6%b3%95%ef%bc%8c%e6%a0%b9%e6%93%9a%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e6%95%b8%e5%80%bc%ef%bc%8c%e9%80%b2%e8%a1%8c%e7%a9%ba%e9%96%93%e5%9c%b0%e5%9c%96%e4%b8%8a%e7%9a%84%e5%a1%ab%e5%80%bc%ef%bc%8c%e4%b8%a6%e7%94%a2%e8%a3%bd%e7%9b%b8%e5%b0%8d%e6%87%89%e7%9a%84%e5%9c%96%e7%89%87%e8%bc%b8%e5%87%ba%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f%0a" target="_blank" class="share-btn whatsapp">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<image id="image5" width="588" height="590" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkwAAAJOCAYAAABFrFjIAAAABmJLR0QA/wD/AP+gvaeTAAAgAElEQVR4nO3debSldXkn+u/vPefUQBUzjqCigoIISEAxDgkmBDVm6DYXo1FpYrzcdCfcXIxJO6S7z7p9zWBWx9zk3k6uHROHa2KHXE00kaAQiVOrEQcGGURFRZwYlIKqOsPez/2jCqzhFG8N55y9T53PZy0Wtd+z9/s+B12rvuv5/fbzSwAAAADgQLRRF8DSm67pyS/l3rVrsnFtJeu6zK8dJmsGaZNJ1nXJZMtwKvNt3TCZTOumkqxryWRLTSXp0rImSYap9ffft6WtrdRO/x/qkjVJN7GsvyCsAJXhTCXDUdexWnXJcJjM/uBKm+uS+SRJZev2a4NhMtsyrEo30yqzw2R+YnIw05LZpJubT2ZbajaZnOuS2a3ZumUuM1svzZu2pqVG8KuxTASmFWa6prvvJIfMZnZDZc2hlcGGynBD5icObS2HVLKuUuu7VuuTrKu09UnWVtrallqbZN22f2qqtTZZyfqWTFYymWFbl2SytZqqbe+bTDKVpKtkbZJ0264nSba/Z9f/D63Z9jZgFzOJv1BHaNB2CEyVzFUy2P5ya9v2v80wyWxSw5Y2U5XZJPPpMrPteuZbMjOsmm3JfNJmkmz9wT/1wJ9btS3D+69VtrbJtqXLcMt8uvtaJu5rmbnv3my999L2pi3L+l+B/SYwjZmL6+K1389hx3TpjkpyRAbtiJY6PK0OTdqGlraxko2V2pDUoV1rGyrZkGE2puWQlqyvZH22hZn7/z050l8KYHXYJUBt/2dbB2tLumxOsrkq93bJ5qRtqtS9ldqUapta6p6q7vvd5ODulqnvzWXm7sdl7d3TbVpncgwITCN0fl2y/rAcfuxgfv64tPbIruWhlfbQluExw9aO6pIjUjmikiOSHJpkQ5JD4n83gIPFfEs2VbIpyaZW+d6wy/dS9b0u3V2VuiOpb1flu5mo21vyjcdk6pvTbXp+1IWvNv7iXUYX1vQRXQaPqUE7Pq0e1dKOG2Z4XKt2bFqOTfKQbAtHAJBsWzb8bpLvpuX2VL7R0r5eVbel2tfb5PDWTbnva5b2lp7AtIS2d5AePxwMH99aPXaYPKZrOb4qj0ny6CRHj7pGAFacQZJvpdrXW6tbh8mtXfLVGravDCeHtzw2k1/VgVp8AtMiu7CmH575+ZNaaydUy+NbywmpOiFpx0f3CIDFV0m+nWq3ptUtLe1Lw8qXMjH44mwGN/1l+927R13gwUBgOlCV9kt5/aMH8+3krmsnVdpJqTopLY9Pcmz8NwZgec0n+Wpabkm1G1vqxuGwbpycHN7wZ+23vz3q4lYqf5nvp1fU9CMzP//kdDl1mPbkVjk5LU+MLhIA4+VbqdxYLTd2qetaV9cmU9e9pU3fNerCVhKBaR+8vF69ocv6p3TDnJHk1FROTcspSQ4bdW0AsBe+m5brWrXrUvn8YKI+d1i+d90ftz+eGXVh405g6lNpv5Tpxw8Gg7PS6inVcmYqT+nSjhl1aQCwv4ap29LyuVa5ulV9dmJi6uo/a9O3jbqucSUw7cH5Nb1mQwant2HOHqbObmlnJfWEmGINwMFlNskXKvXprrpP1kQ+eV9u/MKl7dJB7ydXEYFpFy+vV2/o5g95euuGz0jl6ZU8rbXoJgFw8Kt8I2mfSKtPtmF97N7JqU9f2qZn+z948BOYtntpTR+2Zn74w5X6kbR6dpKnZodz0wBgFdmU1Cday4eHw3y4TU596q1teuuoixqlVR+Yzq9L1m+YP/RZLXVutfqRJGdm24GzALDabWmpT1Rr/9wN68rJye9+8s3tzXOjLmoUVm1guqgumpqff8jZw7Rz03JuJWc3h9QCwEK2VvLR1nJFDdoVj52a+OxqOxR49QWmSrtw9j88OZP1vFQ9N2nPjKU3ANgbm5J2VVp9cKKbvOwtbfqWURe0XFZVYHpZve4RU4PueZX2gqTOTXL4qGsCgBXou5Vc3qX+vpuY+uBqGIK5KgLTxXXx2k2Dw388qZ9O2vOTPGbUNQHAilftxiTvH6b9/eMmu48czIf+HvSB6RX1W0+sYV5YlX+Vbd98O+h/ZwBYLpXMt+RjaXnPsJt8z9vb9NdGXdNSOGjDw7+r6Y33DQY/2VL/OslPxvElALBkKrmjpd5bqXcfNrHpioPtuJWDMjBdWK89KfMTL07a+Wn1pFHXAwCrRFVydWv5m4mu3vWW9oavjrqgxXJQBaaL6+K19w4Oe16lvTjJTyfZMOqaAGAV+l5S705NvOv4ye5DB8PepoMmML2iph85HM6/tCUvqcoZo64HAFa5SvLx1tq7prqJd725Td8x6oIOxEERmC6Yff3TWtcubMmLkxw56noAgAd8uyp/2YbtL9669j9fO+pi9teKDkzbxgUc9jMt+cVKOy/JxKhrAgB2M5u09yX158dPTH5gJS7RrdjAdEG99ug2nLgww/aKZmM3AIy9Sj6VlrfOd5PvfGebvmfU9eyLFRmYXlavOaGbn7yotfrFpB0z6noAgL01vL2qe8vEZP23v2hv+Pqoq9lbKy4wXTD32h9O6/5tS86PM+AAYCW6L8k7a1D/99vX/vY1oy5mb6yYwDRd092XB7PP7dJ+rZLzsoJqBwB2M6jU31XVH71j6nf+edTF9FkRoeOiumhqdnDMz1XaJUmeNup6AIBF86FK+4PHTUy+f7pND0ddzJ6MfWA6vy5Zv3644YI2rF9Ly8mjrgcAWGQtV6fyprUT3/3rN7c3z426nIWMdWB6eb16w8Rw7f9clVcledSo6wEAlkjl5nT5L4d197xtHM+hG9vA9Ir6zUMH81P/NsklaXn4qOsBAJZWDfPVLu2/3Dd1359d2t60ZdT17GgsA9NF9e8P3zo/+SstuSSJsQEAsGrU7a3a76+Zmnrzm9v05lFXc7+xC0zbO0u/lm1h6ahR1wMALLtvpdob29Tkn7y1TW8ddTFJ0o26gB29vF69YTg/9SsRlgBgNXt4Wv1mzc3/0sV18dpRF5OMUWA6vy5Z382v+eVKXhVhCQBWu4enDV/z/bnDL7yoLpoadTFjEZguqoumNsxteGXSfiPJQ0ZdDwAwDtpxSb12ZnDMS6ZreqSZZeSBabqmu5nBMS+pVv8+ycNGXQ8AMD5ay2Oq2utuHcy9YJR1jDww3TqYe0FVe12SY0ddCwAwflryxKr8xwvmXv+sUdUw0sB0wdxrf3hY+Y8teeIo6wAAxt5ZSf7TBTOvO20UDx/ZWIGXbX3NCW1i4o9b8rxR1QAArCSVllw6Pzn/qne2N962nE8eSWC6oF57dBt0v1dVrxhVDQDAijSo5I+Gk2um39mm71muhy77ktyFNb0u8+3iqnpZhCUAYN9MtOSVE/NzrzynpieX66HLHpgGg5nzk/xqkrEYRAUArDiHJvWq4wYzP7VcD1zWwPTy2dee3VV7TZKjl/O5AMBB59iuut+6cOY/nLocD1u2wPTS+s3jWut+q5InLdczAYCDWZ1ZbfC6l9T0MUv9pGUJTBfXxWsn5id+LannL8fzAIDVoVpeuGZ+5peXej/TsgSmewaH/mzSXplkYjmeBwCsGmuS9quPHsz+xFI+ZMkD08tnfuvkqrw2yRFL/SwAYPWp5GGpvP7CLa85fqmesaSB6fya3tha/UaSpyzlcwCAVa7yjOFE979dXBcvybfwl3S9b/3c7IuS/HxqKZ8CAJCW5MLvz278aJK/WeybL1mH6cKZ156U5NVJDlmqZwAA7ODwtO41v7Dl9Y9Z7BsvSWC6sKbXDVv3qiQnL8X9AQAWVmdOdsNfXexvzS1JYJqfnXtBpV68FPcGAHgw1dovPmZ+648t5j0X/Sy3C+s3Hj6Ym3xv0p662PcGANg79aE2lfPf3n7nzsW42+Ju+q60wfzELyY5K3Z6AwCj8yOZa7+Q5I8X42aLuiR3wezrTk21X84SdK4AAPbBRDK8+GVbX3PCYtxs0QLTRXXRVLXhJUkevVj3BADYX5V2Yuvar5xf5x/wSSOLFpi2zB/17KT93GLdDwDgwLWXrZs74awDvcuiBKaLavqQDNuvJzl0Me4HALA46pgkl1xUF00dyF0WJTBtnp05Ly0/vhj3AgBYZC+4b/6YHzmQGxxwYHppTR/WWl6VZEnObgEAOEAb23D46+fXJev39wYHHJgmZrc+P8kPH+h9AACWSmvtx9YP1p+zv58/oMB0fk1vHLZ2cZb4EF8AgAO0tgb1v15cF+/XitgBBaa1szPntuTsA7kHAMCyaDnnrvlDn7U/H93vwHR+Ta9Jy69GdwkAWBnWtdSv7s9cpv0OO2vnZ85O5ZllpjcAsFIMc+7auRNPT/KZffnY/gWmSsts/S9JW+fIOABgBdmYYb0yyb/blw/tV3/oZVt/84mtTXy8Ukftz+cBAEboW92wzn77+t/72t5+YP/2MLXuxcISALBCPXzQuhfuywf2OTC9on7z0CQ/v6+fAwAYF60NX35hTa/b2/fvc2Cam5l4dpIn7uvnAADGRzttfn7mqXv77n0OTNXqwv35HADAGJnMYPhv9vbN+xR8Ltj8+mNbmkN2AYCVr7UX/GK99iF789Z9Ckw1OXyezd4AwEHi4fOzdc7evHGvA9N0TXeV4Uv2uyQAgDFTyV5lm70OTLfMbH1cqjk3DgA4aLS0H71g8+uP7XvfvizJPS/Jxv0vCQBgvFTqqPnJ4Y/1vW/vjkaptJrLzzoGBQA42LSqf53kHQ/2nr3qMF2w5fWPTNXTFqUqAIBxUvXsC+q1Rz/YW/aqwzSYmH9OksOixQQAHGxajhnODJ6Z5L17esve7WEa1k8tVk0AAOOm0h4067S+G7y8Xr1hODNxc5JHLlpVAABjpCVfmlm7/kmXtunZhX7e22Ga3zJ1WpJHLHplAABjopLj18xu2eNZub2BaaLVc7MXnSgAgBVsoqqdu6cf9gamasM9fhgA4GDRUj+xp589aGA6vy45KmmnLn5JAABj56kvr1dvWOgHDxqYpmbW/lCSw5akJACA8XLMYK47ZaEfPGhgapVzlqQcAIAxVMPuRxe6/qCDK6vlWUtTDgDA+GmpZyf5/V2v77HDtG0Nr05b0qoAAMbLWefX9JpdL+4xMM3NTT4hyZFLWhIAwFiph3czM8fvenWPS3LdsJ7u7DgAYJVpEzV4apKbd7y4503fLU9b6ooAAMZNa+3sXa/tOTBVPWVJqwEAGEOVOmPXawsGpvPrkvWpPH7pSwIAGDOVJ15UF03teGnBPUxrZ6YePUwOtYUJAFiFjrlvyxEPS3Lb/RcW7DBV6sRlKwkAYLy0YeuesOOFPQSmdvwyFAMAMKYGj9vx1R42fbfHLXwdAGA1aMfv+GrBPUyVHL/QdQCAVeL4HV8s3GGqetRyVAIAMKaO2/HFnuYwHbsMhQAAjKtH7PhityW559fFa7O1jl6+egAAxs7DdnyxW4fp8M3rj06y2ym9AACryKEvr1dvuP/FboGpy+ARu14DAFhlurmtkw954MWuPx1M5KHLWw8AwPjpavhAJtotME1U95BdrwEArDbDLg+//8+7BaaqJjABANTwgY3fuwemDAUmAIC0BwLT7pO+qzumUstaDgDAuKlkz3uY0uqoZa0GAGAMdclRO/x5Zy3DI5a3HACA8VOtHshEuy3JVdoRsSQHAKx2lQcC00JnyekwAQDs0GESmAAAFlJt4cB0Tk1PJjl02QsCABg/Cwemh9y9ZUMWGjUAALD6HPL8unhtsktgmlo/bzkOAGCbtvHejYcluwSmuUF35GjqAQAYP93UzJHJLstvExN1RJkoAACwzaAdnuzSYaphDh9NNQAA46cmFghMqdo4kmoAAMbRYFs22vkbca02GvINALBNV+2QZNcluWo6TAAA21Wr3QNT15qhlQAA27W2baD3Lh0mU74BAB6wfX/3zpu+W9aPpBgAgDFUbYE9TC3b1ukAAEhquMAepmGyYTTlAACMoe37u3c5aLcdUuYKAABs1xbaw1T2MAEAPKDWJbtP+l4zkloAAMbStsC0y5Jc1sWSHABAkqQqC3SYEh0mAIAHbFt927nDVG2NDhMAwDYt3dpk9zlM60ZTDgDAONrWYdr5aJRkajTFAACMn7bQHqZKdJgAALartm370q7fkpuwgwkA4AETye7fkrMkBwDwA7tv+o4lOQCAHU0luwemXV8DAKx6u+xhsoMJAGAHC3aYAAD4gZ33ME3XtPAEALCznb8ld3Vut+EbAGABD+xhWnf3kVOZmh1lLQAAY2mnTd+2fAMA7M6+JQCAHgITAEAPgQkAoIfBlQAAPXSYAAB6CEwAAD0EJgCAHgITAEAPgysBAHroMAEA9Nh5rIAWEwDAbnSYAAB6CEwAAD1M+gYA6KHDBADQQ2ACAOghMAEA9DC4EgCghw4TAEAPgQkAoIfABADQQ2ACAOixw6bvu5NaN7pKAADGlA4TAEAPgQkAoIfABADQw+BKAIAeOkwAAD0EJgCAHgITAEAPgQkAoMfkzi9t+wYA2JUOEwBAj507TBpMAAC7MYcJAKCHJTkAgB4CEwBAD4EJAKCHwAQA0MMcJgCAHjpMAAA9BCYAgB4CEwBAD4MrAQB6OBoFAKCHJTkAgB4CEwBAD4EJAKCHwZUAAD10mAAAeghMAAA9zGECAOihwwQA0ENgAgDoITABAPRwNAoAQA9zmAAAeliSAwDoITABAPQwhwkAoIcOEwBAD4EJAKCHwAQA0ENgAgDoITABAPTYZdK378kBAOxKhwkAoIfABADQ44ElubuTrBthIQAA40qHCQCgh8AEANBDYAIA6CEwAQD02HkOU8xhAgDYlQ4TAEAPgQkAoMdOS3JORgEA2J0OEwBAD4EJAKCHwAQA0ENgAgDoITABAPQwuBIAoIcOEwBAj53nMI2qCgCAMabDBADQY+c9TFpMAAC70WECAOghMAEA9BCYAAB6mMMEANBDhwkAoIc5TAAAPXSYAAB6CEwAAD0EJgCAHgITAEAPR6MAAPQwhwkAoIclOQCAHuYwAQD00GECAOghMAEA9BCYAAB6CEwAAD0EJgCAHuYwAQD02HmsgLwEALAbS3IAAD0EJgCAHgITAEAPgQkAoIfABADQQ2ACAOhhDhMAQI+d5zCNqgoAgDFmSQ4AoMfOS3JaTAAAu9FhAgDoITABAPQQmAAAeghMAAA9zGECAOhhDhMAQA9LcgAAPQQmAIAeAhMAQA+TvgEAeugwAQD0EJgAAHqYwwQA0MMcJgCAHpbkAAD2bDYRmAAAHszWRGACAHgwlQhMAAC9BCYAgB4mfQMA9DCHCQCghzlMAAA97GECAOghMAEA9BCYAAB6CEwAAD0EJgCAHgITAEAPYwUAAHoYXAkA0OMHgenuJOtGVwgAwNhp2/5lDxMAQA+BCQCgh8AEANBDYAIA6CEwAQD0MIcJAKCHOUwAAD0syQEA9BCYAAB67LwkZ0UOAOAHtmcjHSYAgB4CEwBAD4EJAKCHOUwAAD12CEx3J1k3skIAAMZPS2JJDgCgl8AEANBDYAIA6CEwAQD0MOkbAKCHDhMAQA9zmAAAeuy8JCcyAQDsYFs2siQHANBDYAIA6CEwAQD0EJgAAHoITAAAPQQmAIAeO89hMlUAAGA35jABAPSwJAcA0ENgAgDoITABAPQQmAAAeghMAAA9dh4rMKoqAADGmA4TAEAPc5gAAHrsHJjkJQCA3ViSAwDoITABAPQQmAAAeghMAAA9zGECAOihwwQA0MMcJgCAHjpMAAA9BCYAgB4CEwBAD0ejAAD00GECAOjxQIfp7iTrRlgIAMC4adv/rcMEANDDHCYAgB46TAAAPQQmAIAeAhMAQA+BCQCgh8AEANBjp2/JlS/JAQA84P5opMMEANBDYAIA6GFwJQBADx0mAIAeAhMAQA+BCQCgh8AEANBj5zlMo6oCAGCM6TABAPQQmAAAeuw8h8nZKAAAu9FhAgDoITABAPQQmAAAeghMAAA9BCYAgB4GVwIA9NBhAgDoITABAPTYeXClRTkAgN3sMul7RFUAAIwxS3IAAD0EJgCAHgITAEAPc5gAAHroMAEA9BCYAAB6mMMEANBDhwkAoIfABADQQ2ACAOjhaBQAgB7mMAEA9LAkBwDQQ2ACAOghMAEA9DC4EgCghw4TAEAPgQkAoIfABADQQ2ACAOhhcCUAQA9HowAA9LAkBwDQQ2ACAOhhcCUAQA8dJgCAHgITAEAPgQkAoIc5TAAAPXSYAAB6CEwAAD0EJgCAHrscjWIXEwDArnSYAAB6CEwAAD0EJgCAHgITAEAPgysBAHroMAEA9BCYAAB6CEwAAD0EJgCAHjtP+rbtGwBgNzpMAAA9djlLbkRVAACMMR0mAIAeBlcCAPTQYQIA6CEwAQD0EJgAAHoITAAAPQyuBADoocMEANBDYAIA6CEwAQD0MLgSAKCHs+QAAHpYkgMA2LNhIjABADyYmWSHwLR1awajqwUAYCzNJjvsYVq35ciZ4cZvja4cAIAx9UCH6eqz3jw3ykIAAMaVPUwAAHvSti3J7RqY5kdQCgDAuJpJdh9cObPrNQCAVasyl+zeYZodQSkAAGOpWrYmuwemrSOoBQBgLHULd5iaDhMAwHZVC+xhSpUOEwDAD+w86TtJmj1MAAA72nnSd5JUamY0tQAAjKUtye6bvu8dQSEAAGOpbd+utHNgatk8kmoAAMZQJZuS3TZ9t82VGklBAADjprV2X7JLh6lSm0ZTDgDAGNq++mYPEwDAHgzT7k12D0z3jaAWAIDxNKwFAlM1m74BALZrWSgwbb8IAEBSC+1huv+rcwAAJNn+Lbmdxgp0LZurjBUAAEiSNszuS3KV3DOacgAAxs9wst2T7LqHaZjvjaQaAIAxNFnbAtPOh++24feSNpqKAADGzGBm6/eTXTtMc0MdJgCAJEmbu+a0Z2xJdglMg8mNAhMAQJKkNqVND5NdAtP1Tzplc5LZkdQEADBO6gd7u3dektuWonxTDgCg5e77/7jrWXJp8U05AIBK7rz/z7sFpkoJTADAqtfygw7T5EI/rJj2DQCsdrXnJblK3bW8xQAAjKHWHshEuwem1r6zvNUAAIyhynfv/+PuS3KVbzt/FwCgPRCYduswJfXt5SwFAGAc1fDBAtOwE5gAgFWvusED25R2C0yDtG8tbzkAAONnzcTkngNTWnSYAIDVbm7TxNyeB1eu25I7kgyWtSQAgPFy5y0nXjZz/4vdAtPVZ71vc5wnBwCsbt/Y8cUC35JLktjHBACsWpW6fcfXu81hSpK0+noqJy9LRQAA46by9R1fLtxhqrp1OWoBABhHXZdbd3y9YIep0m5d6DoAwGowrPrKjq8X7jC1+vKyVAMAMIYm2uROWWjBwFTVblqecgAAxs78oGZv3fHCgoFpfmLyS0m2LEdFAABj5pvXP+nyu3e8sOAepptOeu+mJ1/3k19NctKylAUAMCZacn1aasdre5rDlJZ8dulLAgAYL9XaZ3a9tsfANEx9amnLAQAYP22BDLTHwDTR5RNLWw4AwNiZa/N19a4X9xiYNk/lC3GmHACwqrSvXnPa2bfvenXho1GS3HLiZfc8+brnXZe0ZyxtYQAAY6Lqk2nTw10v77HDlCSV9pGlqwgAYLy0rhbMPnvsMCVJtfxzKv9+aUoCABgrwz01ix60w7R2Jp9Oct+SlAQAMF5um1mTLy30gwcNTJ8947I7kly3JCUBAIyXj99y4mUzC/3gQQNTWiotVyxJSQAAY6VduaefPHhgSlIZXr64xQAAjJ3ZVvWhPf2wNzANJtZ+Lsm3F7UkAIDxcuPJN2y8dU8/7A1MN5303k1JPrqYFQEAjJNW+eClL7p0sKefP+hYgR+o96Xazy1WUQAA46S6vP/Bft7bYUqSVsN/SrJpUSoCABgnldvnJ6b+5cHe0vbyRu2U6573T0nOWYSyAADGyTuuP/UfL3iwN+xVhykt1VJ/uyglAQCMkWG1d/e9Zy/3MCWDieH722DiDUk2HFBVAADj45s1Ndt7du7edZiS3HDyM7+U5FMHVBIAwDhpufzGk6+8s+9tex2Y0qaHrdq7DqgoAIDxUV21v9qbN+59YErS2uCyJHfvV0kAAGOkJbfOTU39j7157z4Fpuue/IHbUtnjOSsAACtFtbxn+4DuXvsUmNJS1eqtSYb7URcAwLjYWoN6596+ed8CU5K5dd1Hkty8r58DABgf9alD5u64dm/fvc+B6ZYTL7snyX/f188BAIyNyluvPuvqub19+z4HpiSZqOG7YvM3ALAStdzaJiYu25eP7FdguvbUD9yU1vbpQQAAY+Jd15/y/m/tywf2etL3Tloqnx/+abq8MMm6/boHAMDyu6urwdv39UP7F5iStMnDPlmDez6a5Nz9vQcAwHJqlX+47rQrbtznzx3IQ0/5/PN+Ztjqb5JMHch9AACWwaZUd94Np1/2iX394H7tYbrfRIZXJtmrCZkAAKNUaZc/7K4tn96fzx5QYLrm9A/c11X9cZK9/loeAMAI3NdV/dFVz7lqfn8+fECBKUnm1667vFU+eqD3AQBYQu9fP3fHPi/F3e+AA9NNJ71307CrP0iy9UDvBQCwBO5OdX+wL4Mqd3XAgSlJ7t10+JWttQ8uxr0AABZVy/93w00b/+XAbrFITrrm+T/aMvy7JIcv1j0BAA7Q7cPWnn/Tqf94zYHcZFE6TEmyYfY7H0/LpYt1PwCARfCWm578j3t9yO6eLFpguvqsq+faIH+Y5NbFuicAwAG4Zq66N6elDvRGixaYkuQLT7n8+lT7r0mGi3lfAIB9NFtpb7rl9MtuW4ybLWpgSpKpDN+WZL+/tgcAsAg+OL++vXuxbrZom753dNLnz/vp1vKO2AAOACy/b3bD4Yuuf8oVizYnctE7TEkyMXn45Un7f5fi3gAAD2JYLf/P9ac/6+OLedMl6TAlySnXP/eEwaDeneTUpXoGAMCOKvlIN9l+/oYnXf7NxbzvknSYkuT6U3BtjmwAAAobSURBVC6/pVq9Mcm9S/UMAIAdfLeS31nssJQsYWBKko0z697dqizNAQBLbdBa3nzo7J1XLMXNl2xJ7n7bluaGf5lqT13qZwEAq1TlgzWsC2/6oQ/evhS3X9IOU7Jtaa6l/XaSO5f6WQDAqvS1dPWGpQpLyTIEpiTpJg5/f6v8SZL9PiUYAGABW1rLH9546jM/spQPWZbAdP0pl85OTAz+ryTvXY7nAQCrQ6W9c2Z2+Odp00t6ysiyBKYkue7UK7+9fWnugE4LBgBIkpb20W44fOOXz7ri+0v9rGULTElyw+mXf6aqvSHJt5fzuQDAQecr6ep/v+GMD35xOR62rIEpSTbO3/GeVP4wyeblfjYAcFC4q5Lfv+HJz7hyuR647IHp6rOunltXs3+aan+RZLDczwcAVrSZlvzJxrm1b1vqfUs7WvbAlCSfO+Oq77XhxO+35O9H8XwAYEWqVPur2eSPrj7rfcu6UrXkgysfzEnXnHdmq/rDSp41yjoAgJWg/r4y+eqbTv/Hm5b7ySMNTEnyhGvOPbdV+4M4pBcA2LOP1nD4qpvPuPJfRvHwiVE8dEd3/tcvf+WY7zz+jiRnJTly1PUAAGPn2mr1upufcuVHR1XASPYw7aSlbrrxiHdX8ttJvj7qcgCAsXJzWv7zzadesWzfiFvI6ANTkrzo0sGhc3e9rdJ+N8mSnQMDAKwoX67K/3HTjUe8Oy01ykLGIzBl27iB2cNm/zzJG5N8Z9T1AAAj9dVUe8Mj7577q7zo0pGPIRqbwJQktz72qq0b59b9t5b6/aR9a9T1AAAj8bVUfnfj/J3vuOo5V82PuphkDL4lt5DTPn/ehq0tF7WqVyd55KjrAQCWzZdba783v37ibbeceNnMqIu538i/JbeQb//pl+bWv/yhn187NbU5rZ2S5PBR1wQALLmbU/XbG+fuevv1p354dtTF7GgsO0z3O/4r56xb9/2pf1PJryc5cdT1AABL5tokb3zE3XPvGpdluB2NdWBKklOuP3/N/Nz3XtSSV1VyxqjrAQAW3cdaqzfdeNORfzsOG7wXMvaBKUlS090Tr/nYT6VySZJzRl0OALAoKpV/rKo/uPmMK64c9eiAB7MyAtN2J3323HOq5deS9tMZ0/1XAMBemU1rf1PV/s+bn3L5p0ZdTJ8VFZiS5Amfee7p3UT9SlX9QpINo64HANhnd6e1tyXdn47iIN39seICU5Kc8ulzHz0/2V6Z5Jdi7AAArCRfqdSbB6378y+d/oEVM6h6RQamJDnhE88/bGL93EtT7cKknjbqegCAXh9L8paN8+v/+9VnvW/zqIvZFys2MCXJOR86Z/L2I6bOS1cXpvIzSdaOuiYAYDdbWst7apC/uPmMZ/1T2vRw1AXtqxUdmO53wueec8pETVxYLS9N8ohR1wMAPODrqXpH1/K2G59y5c2jLmZ/HRSBKUlO+uSPHz1ck59Pay9J8swcRL8bAKxAw6SuSuv+an6uLv3yWVd8f9QFHYiDK1T89fkTTzjh7uekay9O6oVJjhx1SQCwCn23Kn/Tuvqrm0979sdW4hLcrg6uwLTd4z597qMnJvLzrbX/Kamn5iD9PQFgzAyT/I/W2qXdXPfXN5x1+TdHXdBiOWiDxAlffP7absvMj2XQXpjWfjbJQ0ZdEwAcxG6vyt8l9Z5jvzf40DieB3cgDtrAdL/HX3veo7rB8F8leWFLnpVkctQ1AcBBZLYlVw3T3rNmau5vrz/lqm+NuqClcNAHpiTJX58/ccIJ33vWxES9oJKfSuXkUZcEACte5Zqk/cOwhu+75Yxnf/Jg2Ku0J6sjMG33uE+fe/jUZJ5brf1kqn4ylukAYH98M1X/kNa9v63bfMVNJ31s06gLWmqrKjDd76TPPu/4YQYvSKtzkzwnyeGjrgkAVoC7WvKhYdoV1eb+/pbTr7pt1AUtl1UZmJIklXbi537i9HR1birndsmzKzlk1GUBwBi6Ny0fTuWKrssVN556xXVpqVEXtZxWb2C631+fP3HCCXc9rXXtx1vajyT1jCQbRl0WAIyBTZV8vCVXperKm7941GfyoksHoy5qFASm7U65/vw1g9k7zxp27Ucz7J6dVk+PwZcArE53J/lYq/rIoGsfPnzu7quvPuvquVEXNUoC0y7O/PSZU5smDz+jVfeManl6Umcn7fgRlwUAy+ErqXyide2TGeRjj/j+3OcOtnlK+0tg2pNKe8LV5z2xJurpaXV2q/ZDaXVaKutGXRoALKItSbu2Ule3yifaxOCTN532oZtX2x6lPgLTXnjstT/+sKn57sxq9UNtmDPSckaS4+O/HwArU2VbN+lz1fKZlvbZQdc+/aXTP/CdURc2rvyFvw/O/PSZU/e2I06uLmcMW05t1U5N6tQkjxh1bQDQp7V8qyrXVuXaLu3zrepzj7hn8AXLbv0Epv10wieef1jWzJ7Sde3UyvDJqXZSKiel5bj47wrAeKgk30hyY1rdkGG+0LW6dm4wcd2Xz7ri+6MubiXxF/siOOX65x41Pzt78qC6k1prJ6XqiWk5IcnjkqwddX0ArCozSW5N8sWk3VhVN3Zdu6mbqRtuPPvKO0dc24olMC2yU64/Z+PMfPeEVHdCV3VCJScm9dikPTbJsUkmRl0jAAeVYZLbsy0k3ZLULa3alwY1/OLkhtmbV8OxJctBYFpKNd099rMfflTXtce1tMd2qccMK8e3bRvGj8u2AKUDBcC+mKvk9lb5Wmv5alXdWmm3duluncvglq+c8SNfP5gPwR0VgWkZnfnpM6funTr6uPkaHD8xbI9Kq+MqdVzSHVupR7bkoWl5qNEFAGy3JZU70nJHkm+ktduSfCM1vK3r8rXBXL66dv3RX7/+lEtnR13owU5gGqVKe/w15z2k1fDYVnlktTwswzy0tRzdWh1Zwzqy0o5oLRvT6rBU25jk0CQbY2kP4GCwJal7k3ZPknuTbEraXam6PyTdWZU7k+F3JzJ5+8z83G23PvWc7+ggLT+BaQyd9vnzNmzO7JET8xNHDVsd0ZIN6dphw2E2pmuHtWFtTMuhSW1srdtYqUOqckhLHZK09VVZ31rWJVmfZF22LfutTbJmpL8YwMGsZWsqs0m2VrKlJVuTbEmyJa02p7r7qmpLS+5Ly6ak3ZvUPZXcm6pNXWubUt2m4cTg7uFcd8fWrL/j9rPet3nEvxXbCUwr1GmfP2/Dpm6wcarahi7ZMBwO1w+rO6TL4JBqE+uqan0q67qu1mfY1qZlTdLWprKuWta21JphsqZr266N+vcBWDFatg6rZpLMpDLTdTWb6maGla3pMpOqmdZqSxu2LWnZOmxtS9dq8zB1Xzc3uXk+w83za7Zuetydk5vMP1o5BKZV5riP//D6NWs2rGlT3dqW2TVdm1wzHA7Wj7ougBVh2FU32bZmOJwZDtfOZjYzOTozt5x42cyoSwMAAAAAxtn/D9APxJ0/UvToAAAAAElFTkSuQmCC"/>
</defs>
<g id="surface2">
<use xlink:href="#image5" transform="matrix(0.054145,0,0,0.054145,0.054145,0)"/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 24.355469 7.726562 C 22.222656 5.585938 19.378906 4.410156 16.355469 4.40625 C 10.117188 4.40625 5.042969 9.484375 5.042969 15.71875 C 5.039062 17.714844 5.5625 19.660156 6.550781 21.375 L 4.945312 27.238281 L 10.945312 25.664062 C 12.597656 26.566406 14.457031 27.039062 16.351562 27.042969 L 16.355469 27.042969 C 22.589844 27.042969 27.664062 21.964844 27.667969 15.730469 C 27.667969 12.707031 26.492188 9.863281 24.355469 7.726562 Z M 16.355469 25.132812 L 16.351562 25.132812 C 14.664062 25.128906 13.007812 24.675781 11.566406 23.820312 L 11.222656 23.617188 L 7.664062 24.550781 L 8.613281 21.082031 L 8.390625 20.722656 C 7.449219 19.226562 6.949219 17.496094 6.953125 15.71875 C 6.953125 10.535156 11.171875 6.320312 16.359375 6.320312 C 18.871094 6.320312 21.230469 7.296875 23.003906 9.074219 C 24.78125 10.851562 25.757812 13.214844 25.757812 15.726562 C 25.753906 20.914062 21.535156 25.132812 16.355469 25.132812 Z M 21.511719 18.089844 C 21.230469 17.945312 19.839844 17.261719 19.582031 17.167969 C 19.320312 17.074219 19.132812 17.027344 18.945312 17.3125 C 18.757812 17.59375 18.214844 18.230469 18.050781 18.417969 C 17.882812 18.609375 17.71875 18.632812 17.4375 18.488281 C 17.152344 18.347656 16.242188 18.050781 15.164062 17.085938 C 14.324219 16.335938 13.757812 15.410156 13.589844 15.128906 C 13.425781 14.84375 13.574219 14.691406 13.714844 14.550781 C 13.84375 14.425781 13.996094 14.222656 14.140625 14.054688 C 14.28125 13.890625 14.328125 13.773438 14.421875 13.585938 C 14.515625 13.394531 14.46875 13.230469 14.398438 13.089844 C 14.328125 12.949219 13.761719 11.554688 13.527344 10.992188 C 13.296875 10.441406 13.066406 10.515625 12.890625 10.503906 C 12.726562 10.496094 12.539062 10.496094 12.347656 10.496094 C 12.160156 10.496094 11.855469 10.566406 11.59375 10.847656 C 11.335938 11.132812 10.605469 11.816406 10.605469 13.207031 C 10.605469 14.597656 11.617188 15.941406 11.761719 16.132812 C 11.902344 16.320312 13.753906 19.175781 16.589844 20.398438 C 17.261719 20.691406 17.789062 20.863281 18.199219 20.996094 C 18.878906 21.210938 19.492188 21.179688 19.980469 21.105469 C 20.523438 21.027344 21.652344 20.421875 21.890625 19.761719 C 22.125 19.101562 22.125 18.535156 22.054688 18.417969 C 21.984375 18.300781 21.792969 18.230469 21.511719 18.089844 Z M 21.511719 18.089844 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
      

      
      
      <li>
        <a href="mailto:?subject=Tutorial%20for%20CIoT%20Open%20Data%20Applications - 5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90.&amp;body=5.2.%20%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bd%bf%e7%94%a8%e6%b0%91%e7%94%9f%e5%85%ac%e5%85%b1%e7%89%a9%e8%81%af%e7%b6%b2%e8%b3%87%e6%96%99%e5%b9%b3%e5%8f%b0%e7%9a%84%e6%84%9f%e6%b8%ac%e8%b3%87%e6%96%99%ef%bc%8c%e4%bb%8b%e7%b4%b9%e8%bc%83%e7%82%ba%e9%80%b2%e9%9a%8e%e7%9a%84%e5%9c%b0%e7%90%86%e7%a9%ba%e9%96%93%e5%88%86%e6%9e%90%ef%bc%8c%e5%88%a9%e7%94%a8%e6%b8%ac%e7%ab%99%e8%b3%87%e8%a8%8a%e4%b8%ad%e7%9a%84%20GPS%20%e4%bd%8d%e7%bd%ae%e5%ba%a7%e6%a8%99%ef%bc%8c%e9%a6%96%e5%85%88%e5%88%a9%e7%94%a8%e5%b0%8b%e6%89%be%e6%9c%80%e5%a4%a7%e5%87%b8%e5%a4%9a%e9%82%8a%e5%bd%a2%20%28Convex%20Hull%29%20%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e6%a1%86%e5%ae%9a%e6%84%9f%e6%b8%ac%e5%99%a8%e6%89%80%e6%b6%b5%e8%93%8b%e7%9a%84%e5%9c%b0%e7%90%86%e5%8d%80%e5%9f%9f%ef%bc%9b%e6%8e%a5%e8%91%97%e5%a5%97%e7%94%a8%20Voronoi%20Diagram%20%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e5%b0%87%e5%9c%b0%e5%9c%96%e4%b8%8a%e7%9a%84%e5%8d%80%e5%9f%9f%e4%be%9d%e7%85%a7%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e5%88%86%e5%b8%83%e7%8b%80%e6%b3%81%ef%bc%8c%e5%88%87%e5%89%b2%e5%87%ba%e6%af%8f%e5%80%8b%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e5%8b%a2%e5%8a%9b%e7%af%84%e5%9c%8d%e3%80%82%e9%87%9d%e5%b0%8d%e6%84%9f%e6%b8%ac%e5%99%a8%e8%88%87%e6%84%9f%e6%b8%ac%e5%99%a8%e4%b9%8b%e9%96%93%e7%9a%84%e5%8d%80%e5%9f%9f%ef%bc%8c%e6%88%91%e5%80%91%e5%88%a9%e7%94%a8%e7%a9%ba%e9%96%93%e5%85%a7%e6%8f%92%e7%9a%84%e6%96%b9%e5%bc%8f%ef%bc%8c%e5%a5%97%e7%94%a8%e4%b8%8d%e5%90%8c%e7%9a%84%e7%a9%ba%e9%96%93%e5%85%a7%e6%8f%92%e6%bc%94%e7%ae%97%e6%b3%95%ef%bc%8c%e6%a0%b9%e6%93%9a%e6%84%9f%e6%b8%ac%e5%99%a8%e7%9a%84%e6%95%b8%e5%80%bc%ef%bc%8c%e9%80%b2%e8%a1%8c%e7%a9%ba%e9%96%93%e5%9c%b0%e5%9c%96%e4%b8%8a%e7%9a%84%e5%a1%ab%e5%80%bc%ef%bc%8c%e4%b8%a6%e7%94%a2%e8%a3%bd%e7%9b%b8%e5%b0%8d%e6%87%89%e7%9a%84%e5%9c%96%e7%89%87%e8%bc%b8%e5%87%ba%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch5%2fch5.2%2f%0a" target="_blank" class="share-btn email">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%">
  <feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"/>
</filter>
<mask id="mask0">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip1">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface5" clip-path="url(#clip1)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 26 22 C 26 23.101562 25.101562 24 24 24 L 8 24 C 6.898438 24 6 23.101562 6 22 L 6 12 C 6 10.898438 6.898438 10 8 10 L 24 10 C 25.101562 10 26 10.898438 26 12 Z M 26 22 "/>
</g>
<mask id="mask1">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip2">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface8" clip-path="url(#clip2)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 17.75 15.101562 C 16.800781 14.050781 15.199219 14.050781 14.25 15.101562 L 6.5 21.601562 C 6.398438 21.699219 6.351562 21.800781 6.25 21.898438 C 6.601562 22.550781 7.25 23 7.949219 23 L 23.949219 23 C 24.699219 23 25.300781 22.550781 25.648438 21.898438 C 25.601562 21.800781 25.5 21.699219 25.398438 21.601562 Z M 17.75 15.101562 "/>
</g>
<mask id="mask2">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip3">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface11" clip-path="url(#clip3)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 6.300781 10.101562 C 6.648438 9.449219 7.300781 9 8 9 L 24 9 C 24.75 9 25.351562 9.449219 25.699219 10.101562 C 25.648438 10.199219 25.550781 10.300781 25.449219 10.398438 L 17.75 16.898438 C 16.800781 17.949219 15.199219 17.949219 14.25 16.898438 Z M 6.300781 10.101562 "/>
</g>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(46.666667%,70.196078%,83.137255%);fill-opacity:1;" d="M 32 16 C 32 24.835938 24.835938 32 16 32 C 7.164062 32 0 24.835938 0 16 C 0 7.164062 7.164062 0 16 0 C 24.835938 0 32 7.164062 32 16 Z M 32 16 "/>
<use xlink:href="#surface5" mask="url(#mask0)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 26 21 C 26 22.101562 25.101562 23 24 23 L 8 23 C 6.898438 23 6 22.101562 6 21 L 6 11 C 6 9.898438 6.898438 9 8 9 L 24 9 C 25.101562 9 26 9.898438 26 11 Z M 26 21 "/>
<use xlink:href="#surface8" mask="url(#mask1)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 17.75 16 C 16.800781 15.050781 15.199219 15.050781 14.25 16 L 6.5 21.75 C 6.398438 21.851562 6.351562 21.898438 6.25 22 C 6.601562 22.601562 7.25 22.949219 7.949219 22.949219 L 23.949219 22.949219 C 24.699219 22.949219 25.300781 22.550781 25.648438 22 C 25.601562 21.898438 25.5 21.851562 25.398438 21.75 Z M 17.75 16 "/>
<use xlink:href="#surface11" mask="url(#mask2)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 14.25 16 C 15.199219 16.949219 16.800781 16.949219 17.75 16 L 25.5 10.25 C 25.601562 10.148438 25.648438 10.101562 25.75 10 C 25.398438 9.398438 24.75 9.050781 24.050781 9.050781 L 8 9.050781 C 7.25 9.050781 6.648438 9.449219 6.300781 10 C 6.351562 10.101562 6.449219 10.148438 6.550781 10.25 Z M 14.25 16 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
    </ul>
  </section>
  



<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCH7EJS8LE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZCH7EJS8LE', { 'anonymize_ip': false });
}
</script>



          <article class="default">
<h1>5.2. 地理空間分析</h1>

<p><a href="https://colab.research.google.com/drive/1dZ26qA1BLee7AMaoBk0lcWvB3PAOLKV-?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<div>
    <h2>Table Of Contents</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#勢力分佈圖-voronoi-diagram">勢力分佈圖 (Voronoi diagram)</a></li>
    <li><a href="#最小範圍多邊形凸包-convex-hull">最小範圍多邊形/凸包 (Convex hull)</a></li>
    <li><a href="#空間群聚-clustering">空間群聚 (Clustering)</a></li>
    <li><a href="#密度-kernel-density">密度 (Kernel density)</a></li>
    <li><a href="#空間內插-spatial-interpolation">空間內插 (Spatial interpolation)</a>
      <ul>
        <li><a href="#反距離加權法-inverse-distance-weighting">反距離加權法 (Inverse Distance Weighting)</a></li>
        <li><a href="#克力金法-kriging">克力金法 (Kriging)</a></li>
        <li><a href="#最近鄰居插值-nearest-neighbor-interpolation">最近鄰居插值 (Nearest neighbor Interpolation)</a></li>
      </ul>
    </li>
    <li><a href="#空間內插後的資料處理">空間內插後的資料處理</a>
      <ul>
        <li><a href="#擷取等值線資料-contour">擷取等值線資料 (contour)</a></li>
        <li><a href="#擷取橫切面的資料-profile">擷取橫切面的資料 (Profile)</a></li>
      </ul>
    </li>
    <li><a href="#參考資源">參考資源</a></li>
  </ul>
</nav>
</div>

<p>廣布在生活環境中的微型測站，協助我們掌握細緻的環境變化，並可據以決策跟行動。所以，清楚地掌握測站間的分布和數據特性，也是我們在分析測站數據時的重要基礎。這些測站除了本身的位置可能會形成某種幾何結構或空間群聚。同時，我們也可以依照測站位置與數值的差異，去推估沒有測站的區域的數值，從而獲得一個更為全面的數值分佈狀況，並從中探索感測數值與環境因子間的相關性。在這一個段落中，我們會利用水利署在不同縣市的淹水感測器與地下水位站資料，來進行一些簡單的空間分析。</p>
<h2 id="勢力分佈圖-voronoi-diagram">勢力分佈圖 (Voronoi diagram)</h2>
<p>首先，我們可能需要釐清個別測站的服務/防守範圍，並以此範圍中的測站數據來代表該區的現況。這個時候，我們可以利用沃羅諾伊圖（voronoi diagram）的方法去找尋這個範圍。沃羅諾伊圖的原理是在兩個相鄰測站間建立一條垂直平分線段，並藉由整合這些線段以構成一個多邊形；每個多邊形範圍的中心點就是測站，而該測站的數值則約可代表這個範圍內的數值。在這個範例中，我們嘗試利用嘉義縣、嘉義市的淹水感測器資料，去練習建立沃羅諾伊圖，這樣我們就可以初略知道這些淹水感測器的勢力分佈範圍。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib.request
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> ssl
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install geopython libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>apt install gdal<span style="color:#f92672">-</span>bin python<span style="color:#f92672">-</span>gdal python3<span style="color:#f92672">-</span>gdal
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install python3-rtree - Geopandas requirement</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>apt install python3<span style="color:#f92672">-</span>rtree 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install geopandas</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install geopandas
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install pykrige</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install pykrige
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install elevation</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install elevation
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install affine rasterio</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install affine rasterio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install descartes - Geopandas requirement</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install descartes
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> geopandas <span style="color:#66d9ef">as</span> gpd
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install pyCIOT
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pyCIOT.data <span style="color:#66d9ef">as</span> CIoT
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 前往政府開放資料庫下載 縣市界線(TWD97經緯度) 的資料，並解壓縮到名為 shp 的資料夾</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#34;shp.zip&#34;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://data.moi.gov.tw/MoiOD/System/DownloadFile.aspx?DATA=72874C55-884D-4CEA-B7D6-F60B0BE85AB0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip shp<span style="color:#f92672">.</span>zip <span style="color:#f92672">-</span>d shp
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 以水利署淹水感測器資料為例，資料集 gpd 為感測器數值與位置資料、basemap為台灣縣市地理邊界 shp file</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以pyCIOT取得資料</span>
</span></span><span style="display:flex;"><span>wa <span style="color:#f92672">=</span> CIoT<span style="color:#f92672">.</span>Water()<span style="color:#f92672">.</span>get_data(src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;FLOODING:WRA&#34;</span>)
</span></span><span style="display:flex;"><span>wa2 <span style="color:#f92672">=</span> CIoT<span style="color:#f92672">.</span>Water()<span style="color:#f92672">.</span>get_data(src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;FLOODING:WRA2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flood_list <span style="color:#f92672">=</span> wa <span style="color:#f92672">+</span> wa2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>county <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>read_file(<span style="color:#e6db74">&#39;/content/shp/COUNTY_MOI_1090820.shp&#39;</span>)
</span></span><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> county<span style="color:#f92672">.</span>loc[county[<span style="color:#e6db74">&#39;COUNTYNAME&#39;</span>]<span style="color:#f92672">.</span>isin([<span style="color:#e6db74">&#34;嘉義縣&#34;</span>,<span style="color:#e6db74">&#34;嘉義市&#34;</span>])]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flood_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([],columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;name&#39;</span>,  <span style="color:#e6db74">&#39;Observations&#39;</span>,<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> flood_list:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(i[&#39;data&#39;][0])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(i[<span style="color:#e6db74">&#39;data&#39;</span>])<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[i[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;stationName&#39;</span>],i[<span style="color:#e6db74">&#39;data&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;value&#39;</span>],i[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;longitude&#39;</span>],i[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;latitude&#39;</span>]]],columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;name&#39;</span>,  <span style="color:#e6db74">&#39;Observations&#39;</span>,<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> :
</span></span><span style="display:flex;"><span>        df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[i[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;stationName&#39;</span>],<span style="color:#f92672">-</span><span style="color:#ae81ff">999</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">999</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">999</span>]],columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;name&#39;</span>,  <span style="color:#e6db74">&#39;Observations&#39;</span>,<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span>    flood_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([flood_df,df])
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(df)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result_df <span style="color:#f92672">=</span> flood_df<span style="color:#f92672">.</span>drop_duplicates(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;name&#39;</span>], keep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;first&#39;</span>)
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">=</span>result_df<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span>station <span style="color:#f92672">=</span> station[station<span style="color:#f92672">.</span>lon<span style="color:#f92672">!=-</span><span style="color:#ae81ff">999</span>]
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>gdf_flood <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>GeoDataFrame(
</span></span><span style="display:flex;"><span>    station, geometry<span style="color:#f92672">=</span>gpd<span style="color:#f92672">.</span>points_from_xy(station<span style="color:#f92672">.</span>lon, station<span style="color:#f92672">.</span>lat),crs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">=</span>result_df<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span>station <span style="color:#f92672">=</span> station[station<span style="color:#f92672">.</span>lon<span style="color:#f92672">!=-</span><span style="color:#ae81ff">999</span>]
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>gdf_flood <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>GeoDataFrame(
</span></span><span style="display:flex;"><span>    station, geometry<span style="color:#f92672">=</span>gpd<span style="color:#f92672">.</span>points_from_xy(station<span style="color:#f92672">.</span>lon, station<span style="color:#f92672">.</span>lat),crs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> basemap<span style="color:#f92672">.</span>set_crs(<span style="color:#ae81ff">4326</span>,allow_override<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>intersected_data <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>overlay(gdf_flood, basemap, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;intersection&#39;</span>) 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial <span style="color:#f92672">import</span> Voronoi, voronoi_plot_2d
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>inputp <span style="color:#f92672">=</span> intersected_data[[<span style="color:#e6db74">&#39;lon&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>]]
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;purple&#39;</span>);
</span></span><span style="display:flex;"><span>vor <span style="color:#f92672">=</span> Voronoi(inputp)
</span></span><span style="display:flex;"><span>voronoi_plot_2d(vor,ax <span style="color:#f92672">=</span> ax,show_vertices<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-1-1.png" alt="Python output"></p>
<p>此外，我們也可以利用德勞內三角分割（Delaunay triangulation）去描述測站的服務/防守範圍；它的原理是以單一測站為中心，並尋找最鄰近的兩個點，以連接成一個三角形範圍。若我們將三角形的範圍視為一個均質的平面，而這個範圍內的感測數值則可用三個節點測站值的平均來替代。</p>
<p>整體而言，這兩個演算法都可以協助我們以圖形的方式，理解感測器在空間上的分佈，及其所建立的空間結構。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial <span style="color:#f92672">import</span> Delaunay, delaunay_plot_2d
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#input should be array</span>
</span></span><span style="display:flex;"><span>inputp <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(inputp)
</span></span><span style="display:flex;"><span>tri <span style="color:#f92672">=</span> Delaunay(inputp)
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;purple&#39;</span>);
</span></span><span style="display:flex;"><span>delaunay_plot_2d(tri,ax<span style="color:#f92672">=</span>ax)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-1-2.png" alt="Python output"></p>
<h2 id="最小範圍多邊形凸包-convex-hull">最小範圍多邊形/凸包 (Convex hull)</h2>
<p>最小範圍多邊形的演算法，是從一群測站中，選出位於最邊緣的若干個測站構成一個能含納所有的點位、且邊長最小的多邊形，這樣我們就可以在一堆測站中，找到一個群聚的範圍，並用這個範圍來發展一些計算。最小範圍多邊形的演算法，主要是依照測站的x座標排序測站位置，而當 X 座標相同則以 Y 座標大小排序，從而找到最外圍的端點並連接成為多邊形 (當然類似的概念還有許多方法)，透過最小範圍多邊形的演算，我們可以評估測站的有效監測範圍。所以，我們也可以利用嘉義縣、嘉義市的淹水感測器分佈，已瞭解這些淹水感測器的覆蓋範圍。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial <span style="color:#f92672">import</span> ConvexHull, convex_hull_plot_2d
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>hull <span style="color:#f92672">=</span> ConvexHull(inputp)
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;purple&#39;</span>);
</span></span><span style="display:flex;"><span>convex_hull_plot_2d(hull,ax<span style="color:#f92672">=</span>ax)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span></code></pre></div><p><img src="figures/5-2-2-1.png" alt="Python output"></p>
<h2 id="空間群聚-clustering">空間群聚 (Clustering)</h2>
<p>正如前文所說，越鄰近的測站，其周邊環境中的干擾因子可能也越相似，所以我們可以利用 Kmeans 這種分類演算法，將測站進行分群，以進一步探勘其感測數據與環境因子間的關係。Kmeans主要是根據我們預先設定的分群的數量 <em>n</em>，並隨機尋找 <em>n</em> 個點做為中心，去尋找周邊的鄰居，經由量測樣本點與中心點的直線距離，去把樣本點分群並計算各群的平均值，最後，重複前述的程序直到所有樣本點與中心點的距離平均值最短，即可完成分群。</p>
<p>此外，測站不單只有空間位置，也會有其量測數值，如果我們同時參考其空間位置與量測數值，將量測數值較為相似且地理位置相近的測站聚集起來，這些聚集的測站所遭受的環境干擾因子亦較為接近，而透過測站的空間位置，亦正可以反映出不同環境干擾因子在地理空間上的影像範圍。因此，空間群聚也是地理空間資料分析的重要一環。在這個案例中，我們也嘗試以雲林地區的地下水位站為案例，去描述這些測站的空間群聚狀況。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 獲取地下水位站資料</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">733</span>
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>water_level <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(num<span style="color:#f92672">&lt;=</span>count):
</span></span><span style="display:flex;"><span>    url_level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://sta.ci.taiwan.gov.tw/STA_WaterResource_v2/v1.0/Datastreams?$skip=&#34;</span><span style="color:#f92672">+</span>str(num)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&amp;$filter=</span><span style="color:#e6db74">%28%</span><span style="color:#e6db74">28Thing</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">properties</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">authority_type+eq+</span><span style="color:#e6db74">%27%</span><span style="color:#e6db74">E6%B0%B4</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">5</span><span style="color:#e6db74">%88%</span><span style="color:#e6db74">A9</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">7%BD%B2</span><span style="color:#e6db74">%27%</span><span style="color:#e6db74">29+and+substringof</span><span style="color:#e6db74">%28%</span><span style="color:#e6db74">27Datastream_Category_type%3D</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">5%9C%B0</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">4%B8%8B</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">6%B0%B4</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">4%BD%8D</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">7%AB</span><span style="color:#e6db74">%99%</span><span style="color:#e6db74">27%2CDatastreams</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">description</span><span style="color:#e6db74">%29%</span><span style="color:#e6db74">29&amp;$expand=Thing,Thing</span><span style="color:#e6db74">%28%</span><span style="color:#e6db74">24expand%3DLocations%29,Observations</span><span style="color:#e6db74">%28%</span><span style="color:#e6db74">24top%3D1%3B</span><span style="color:#e6db74">%24o</span><span style="color:#e6db74">rderby%3DphenomenonTime+desc%3B%24top%3D1%29&amp;$count=true&#34;</span>
</span></span><span style="display:flex;"><span>    ssl<span style="color:#f92672">.</span>_create_default_https_context <span style="color:#f92672">=</span> ssl<span style="color:#f92672">.</span>_create_unverified_context
</span></span><span style="display:flex;"><span>    r_l <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(url_level)
</span></span><span style="display:flex;"><span>    string_l <span style="color:#f92672">=</span> r_l<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    jf_level <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(string_l)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    station <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(jf_level[<span style="color:#e6db74">&#39;value&#39;</span>])<span style="color:#f92672">.</span>filter(items<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Thing&#39;</span>,<span style="color:#e6db74">&#39;observedArea&#39;</span>,<span style="color:#e6db74">&#39;Observations&#39;</span>])
</span></span><span style="display:flex;"><span>    station[<span style="color:#e6db74">&#39;lat&#39;</span>]<span style="color:#f92672">=</span>station[<span style="color:#e6db74">&#39;observedArea&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(station)):
</span></span><span style="display:flex;"><span>        station[<span style="color:#e6db74">&#39;Thing&#39;</span>][i] <span style="color:#f92672">=</span> station[<span style="color:#e6db74">&#39;Thing&#39;</span>][i][<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;stationName&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> pd<span style="color:#f92672">.</span>isnull(station[<span style="color:#e6db74">&#39;observedArea&#39;</span>][i]):
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;lat&#39;</span>][i]<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;observedArea&#39;</span>][i]<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;lat&#39;</span>][i]<span style="color:#f92672">=</span>station[<span style="color:#e6db74">&#39;lat&#39;</span>][i][<span style="color:#e6db74">&#39;coordinates&#39;</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;observedArea&#39;</span>][i]<span style="color:#f92672">=</span>station[<span style="color:#e6db74">&#39;observedArea&#39;</span>][i][<span style="color:#e6db74">&#39;coordinates&#39;</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(station[<span style="color:#e6db74">&#39;Observations&#39;</span>][i])<span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;Observations&#39;</span>][i] <span style="color:#f92672">=</span> station[<span style="color:#e6db74">&#39;Observations&#39;</span>][i][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;result&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            station[<span style="color:#e6db74">&#39;Observations&#39;</span>][i] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    station <span style="color:#f92672">=</span> station<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;Thing&#34;</span>: <span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#39;observedArea&#39;</span>: <span style="color:#e6db74">&#39;lon&#39;</span>})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> num <span style="color:#f92672">==</span><span style="color:#ae81ff">0</span> :
</span></span><span style="display:flex;"><span>        water_level <span style="color:#f92672">=</span> station
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        water_level <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([water_level, station])
</span></span><span style="display:flex;"><span>    num<span style="color:#f92672">+=</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>result_df <span style="color:#f92672">=</span> water_level<span style="color:#f92672">.</span>drop_duplicates(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;name&#39;</span>], keep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;first&#39;</span>)
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">=</span>result_df<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>])
</span></span><span style="display:flex;"><span>station<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>station <span style="color:#f92672">=</span> station[station<span style="color:#f92672">.</span>lon<span style="color:#f92672">!=-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>gdf_level <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>GeoDataFrame(
</span></span><span style="display:flex;"><span>    station, geometry<span style="color:#f92672">=</span>gpd<span style="color:#f92672">.</span>points_from_xy(station<span style="color:#f92672">.</span>lon, station<span style="color:#f92672">.</span>lat),crs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 與雲林縣範圍 intersect </span>
</span></span><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> county<span style="color:#f92672">.</span>loc[county[<span style="color:#e6db74">&#39;COUNTYNAME&#39;</span>]<span style="color:#f92672">.</span>isin([<span style="color:#e6db74">&#34;雲林縣&#34;</span>])]
</span></span><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> basemap<span style="color:#f92672">.</span>set_crs(<span style="color:#ae81ff">4326</span>,allow_override<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>intersected_data <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>overlay(gdf_level, basemap, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;intersection&#39;</span>) 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.cluster <span style="color:#f92672">import</span> KMeans
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial <span style="color:#f92672">import</span> ConvexHull
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> folium
</span></span><span style="display:flex;"><span>clusterp <span style="color:#f92672">=</span> intersected_data[[<span style="color:#e6db74">&#34;name&#34;</span>,<span style="color:#e6db74">&#34;lon&#34;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>, <span style="color:#e6db74">&#39;Observations&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 利用 kmeans 對資料進行分群</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#1.1 資料前處理</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> clusterp<span style="color:#f92672">.</span>iloc[:, <span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 利用 elbow method 看應該分成幾群</span>
</span></span><span style="display:flex;"><span>wcss <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">11</span>):
</span></span><span style="display:flex;"><span>    kmeans <span style="color:#f92672">=</span> KMeans(n_clusters <span style="color:#f92672">=</span> i, init <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;k-means++&#39;</span>, random_state <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>    kmeans<span style="color:#f92672">.</span>fit(X)
</span></span><span style="display:flex;"><span>    wcss<span style="color:#f92672">.</span>append(kmeans<span style="color:#f92672">.</span>inertia_)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">11</span>), wcss)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;The Elbow Method&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Number of clusters&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;WCSS&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-3-1.png" alt="Python output"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 1.2 根據分群的數量訓練 K-Means model </span>
</span></span><span style="display:flex;"><span>kmeans <span style="color:#f92672">=</span> KMeans(n_clusters <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, init <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;k-means++&#39;</span>, random_state <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>y_kmeans <span style="color:#f92672">=</span> kmeans<span style="color:#f92672">.</span>fit_predict(X)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1.3 map data back to df</span>
</span></span><span style="display:flex;"><span>clusterp[<span style="color:#e6db74">&#39;cluster&#39;</span>] <span style="color:#f92672">=</span> y_kmeans<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># to step up to group 1 to 4</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 2.將資料畫在地圖上</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建底圖(m)</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>Map(location<span style="color:#f92672">=</span>[clusterp[<span style="color:#e6db74">&#39;lat&#39;</span>]<span style="color:#f92672">.</span>mean(), clusterp[<span style="color:#e6db74">&#39;lon&#39;</span>]<span style="color:#f92672">.</span>mean()],
</span></span><span style="display:flex;"><span>               tiles<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CartoDB positron&#39;</span>,
</span></span><span style="display:flex;"><span>               zoom_start<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根據分群數量建立圖層</span>
</span></span><span style="display:flex;"><span>layer1 <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>FeatureGroup(name<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;u&gt;&lt;b&gt;group1&lt;/b&gt;&lt;/u&gt;&#39;</span>,show<span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>add_child(layer1)
</span></span><span style="display:flex;"><span>layer2 <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>FeatureGroup(name<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;u&gt;&lt;b&gt;group2&lt;/b&gt;&lt;/u&gt;&#39;</span>,show<span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>add_child(layer2)
</span></span><span style="display:flex;"><span>layer3 <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>FeatureGroup(name<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;u&gt;&lt;b&gt;group3&lt;/b&gt;&lt;/u&gt;&#39;</span>,show<span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>add_child(layer3)
</span></span><span style="display:flex;"><span>layer4 <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>FeatureGroup(name<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;u&gt;&lt;b&gt;group4&lt;/b&gt;&lt;/u&gt;&#39;</span>,show<span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>add_child(layer4)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立圖標(利用 html 的 CSS 語法)</span>
</span></span><span style="display:flex;"><span>my_symbol_css_class<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34; &lt;style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g1:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: black;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g1 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g2:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: black;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g2 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g3:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: black;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g3 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g4:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: black;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g4 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g1bad:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:red;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g1 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g2bad:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:red;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g2 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g3bad:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:red;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g3 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.fa-g4bad:before {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-family: Arial; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    color: white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    background-color:red;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    border-radius: 10px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    white-space: pre;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    content: &#39; g4 &#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將語法加進地圖中      </span>
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>get_root()<span style="color:#f92672">.</span>html<span style="color:#f92672">.</span>add_child(folium<span style="color:#f92672">.</span>Element(my_symbol_css_class))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建每個圖標的 icon </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> index, row <span style="color:#f92672">in</span> clusterp<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> row[<span style="color:#e6db74">&#39;cluster&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>
</span></span><span style="display:flex;"><span>        fa_symbol <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fa-g1&#39;</span>
</span></span><span style="display:flex;"><span>        lay <span style="color:#f92672">=</span> layer1
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> row[<span style="color:#e6db74">&#39;cluster&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;purple&#39;</span>
</span></span><span style="display:flex;"><span>        fa_symbol <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fa-g2&#39;</span>
</span></span><span style="display:flex;"><span>        lay <span style="color:#f92672">=</span> layer2
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> row[<span style="color:#e6db74">&#39;cluster&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>
</span></span><span style="display:flex;"><span>        fa_symbol <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fa-g3&#39;</span>
</span></span><span style="display:flex;"><span>        lay <span style="color:#f92672">=</span> layer3
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> row[<span style="color:#e6db74">&#39;cluster&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>
</span></span><span style="display:flex;"><span>        fa_symbol <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fa-g4&#39;</span>
</span></span><span style="display:flex;"><span>        lay <span style="color:#f92672">=</span> layer4
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    folium<span style="color:#f92672">.</span>Marker(
</span></span><span style="display:flex;"><span>        location<span style="color:#f92672">=</span>[row[<span style="color:#e6db74">&#39;lat&#39;</span>], row[<span style="color:#e6db74">&#39;lon&#39;</span>]],
</span></span><span style="display:flex;"><span>        title <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;group:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(str(row[<span style="color:#e6db74">&#34;cluster&#34;</span>])),
</span></span><span style="display:flex;"><span>        popup <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;group:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,value:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(str(row[<span style="color:#e6db74">&#34;cluster&#34;</span>]),str(row[<span style="color:#e6db74">&#39;Observations&#39;</span>])),
</span></span><span style="display:flex;"><span>        icon<span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>Icon(color<span style="color:#f92672">=</span>color, icon<span style="color:#f92672">=</span>fa_symbol, prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fa&#39;</span>))<span style="color:#f92672">.</span>add_to(lay)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 準備將資料畫上地圖</span>
</span></span><span style="display:flex;"><span>layer_list <span style="color:#f92672">=</span> [layer1,layer2,layer3,layer4]
</span></span><span style="display:flex;"><span>color_list <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;black&#39;</span>,<span style="color:#e6db74">&#39;purple&#39;</span>,<span style="color:#e6db74">&#39;orange&#39;</span>,<span style="color:#e6db74">&#39;blue&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> g <span style="color:#f92672">in</span> clusterp[<span style="color:#e6db74">&#39;cluster&#39;</span>]<span style="color:#f92672">.</span>unique():
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 利用 ConvexHull 找到每個群的邊界</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 首先，取出每群的 lat lon </span>
</span></span><span style="display:flex;"><span>    latlon_cut <span style="color:#f92672">=</span>clusterp[clusterp[<span style="color:#e6db74">&#39;cluster&#39;</span>]<span style="color:#f92672">==</span>g]<span style="color:#f92672">.</span>iloc[:, <span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 再來，使用 scipy 中的 ConvexHull 函式</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 將剛剛的資料 (lat lon) 放進該函式</span>
</span></span><span style="display:flex;"><span>    hull <span style="color:#f92672">=</span> ConvexHull(latlon_cut<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 取得每群的 lat lon 邊界</span>
</span></span><span style="display:flex;"><span>    Lat <span style="color:#f92672">=</span> latlon_cut<span style="color:#f92672">.</span>values[hull<span style="color:#f92672">.</span>vertices,<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    Long <span style="color:#f92672">=</span> latlon_cut<span style="color:#f92672">.</span>values[hull<span style="color:#f92672">.</span>vertices,<span style="color:#ae81ff">1</span>] 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 將 boundary 存成 dataframe ，並轉成 lat lon 的 list</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 在 folium 中畫出邊界的 polygon</span>
</span></span><span style="display:flex;"><span>    cluster <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;lat&#39;</span>:Lat,<span style="color:#e6db74">&#39;lon&#39;</span>:Long })       
</span></span><span style="display:flex;"><span>    area <span style="color:#f92672">=</span> list(zip(cluster[<span style="color:#e6db74">&#39;lat&#39;</span>],cluster[<span style="color:#e6db74">&#39;lon&#39;</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    list_index <span style="color:#f92672">=</span> g<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>    lay_cluster <span style="color:#f92672">=</span> layer_list[list_index ] 
</span></span><span style="display:flex;"><span>    folium<span style="color:#f92672">.</span>Polygon(locations<span style="color:#f92672">=</span>area,
</span></span><span style="display:flex;"><span>        color<span style="color:#f92672">=</span>color_list[list_index],
</span></span><span style="display:flex;"><span>        weight<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        fill<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        fill_opacity<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>        opacity<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)<span style="color:#f92672">.</span>add_to(lay_cluster) 
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 加入可以選擇 layer 的控制區</span>
</span></span><span style="display:flex;"><span>folium<span style="color:#f92672">.</span>LayerControl(collapsed<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,position<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;bottomright&#39;</span>)<span style="color:#f92672">.</span>add_to(m)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 存成 html 檔</span>
</span></span><span style="display:flex;"><span>print(m)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 地圖會存在與程式碼相同路徑的資料夾中</span>
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;River_clustering.html&#39;</span>)
</span></span></code></pre></div><p><img src="figures/5-2-3-2.png" alt="Python output"></p>
<h2 id="密度-kernel-density">密度 (Kernel density)</h2>
<p>密度是我們常用以描述事件聚集強度的觀念，而傳統一般的密度都是以：個數/面積的公式去計算，但是，這樣的計算方法卻容易受到面積的影響，同樣的測站數/案例數在面積不同的鄉鎮，就會出現不同的密度，反而讓我們無法正確地探勘事件的聚集強度。</p>
<p>因此，為了避免面積造成計算的差異，所以我們可以用核密度 (kernel density) 的方式去描述事件聚集的強度；核密度的概念就是：以樣本點為中心，並利用固定半徑的移動視窗 (moving windows) 去框選其他樣本點，最後以所有樣本點的數值加總來取代樣本點的舊有數值。這樣的方式可以標準化密度公式中的「面積」，並取得一個全面性的密度分佈圖，以協助我們瞭解整體事件的分佈強度 (圖1)。</p>
<p>在這個案例中，我們也來看看是否能用核密度的方法去描述地下水位站的分佈強弱。</p>
<p><img src="figures/5-2-4-1.png" alt="圖1：核密度推估法的概念圖"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> county<span style="color:#f92672">.</span>loc[county[<span style="color:#e6db74">&#39;COUNTYNAME&#39;</span>]<span style="color:#f92672">.</span>isin([<span style="color:#e6db74">&#34;嘉義縣&#34;</span>,<span style="color:#e6db74">&#34;嘉義市&#34;</span>])]
</span></span><span style="display:flex;"><span>basemap <span style="color:#f92672">=</span> basemap<span style="color:#f92672">.</span>set_crs(<span style="color:#ae81ff">4326</span>,allow_override<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>gdf <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>overlay(gdf_level, basemap, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;intersection&#39;</span>) 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># selecting the polygon&#39;s geometry field to filter out points that </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># are not overlaid</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 利用plotly套件 畫出河川水位核密度地圖，gdf為河川水位資料點位與數值</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> plotly.express <span style="color:#66d9ef">as</span> px
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> px<span style="color:#f92672">.</span>density_mapbox(gdf, lat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, lon<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lon&#39;</span>, z<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Observations&#39;</span>, radius<span style="color:#f92672">=</span><span style="color:#ae81ff">25</span>,
</span></span><span style="display:flex;"><span>                        center<span style="color:#f92672">=</span>dict(lat<span style="color:#f92672">=</span><span style="color:#ae81ff">23.5</span>, lon<span style="color:#f92672">=</span><span style="color:#ae81ff">120.5</span>), zoom<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>                        mapbox_style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stamen-terrain&#34;</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-4-2.png" alt="Python output"></p>
<h2 id="空間內插-spatial-interpolation">空間內插 (Spatial interpolation)</h2>
<p>微型感測站的設置就像是我們在空間上進行數值採樣，透過這些採樣的結果，我們可以利用一些統計方法還原母體的全貌。因為我們無法在每一吋土地上佈滿測站，所以一定會面臨有些地區有資料，有些地區卻沒有資料的狀況，而空間內插 (Spatial interpolation) 就是以統計的方法，協助我們推估沒有資料的區域，進而了解母體全貌的方法。</p>
<p>要利用空間內插的方法，首先，我們必須要先瞭解：確定性模型（Deterministic model）與機率性模型 (Stochastic model) 這兩個概念。所謂確定性模型就是我們再掌握某空間現象的分佈規則下，舊可以利用某個相關性參數，去推估未知區域的數值，例如台灣的門牌號碼是將單數與雙數非別排列，所以假若某間房子的前一個門牌為6號，而後一個門牌為10號，那我們可以推估中間這個房子的門牌為8號。而機率性則是假設真實環境非常複雜，然而我們只能透過機率以及變異數的變化去建立適當的推估模型，並接受其差值以及不確定性 (uncertainty)。</p>
<p>所以，接下來我們就利用雲林的地下水位站來練習幾種常見的空間內插方法。</p>
<h3 id="反距離加權法-inverse-distance-weighting">反距離加權法 (Inverse Distance Weighting)</h3>
<p>在反距離加權法的模式中，我們會利用已知樣本點間的數值差與間距建立推估模型。一般而言，若兩點的差值為10單位、而間距為100公尺，則理論上每10公尺的差值應該為1，但是考量到差值的分佈不應該是線性關係，所以反距離加權法利用地理學第一定律：越鄰近的事物越相近，去以距離作為評估兩點之間數值差異的依據，其策略就是把差值X距離次方的倒數，以獲得該位置的推估值。所以，距離越大權數越小，反之距離越近，權數愈大。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.interpolate <span style="color:#f92672">import</span> Rbf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distance_matrix</span>(x0, y0, x1, y1):
</span></span><span style="display:flex;"><span>    obs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack((x0, y0))<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>    interp <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack((x1, y1))<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 在指定範圍中建立 distance matrix</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 參考資料: &lt;http://stackoverflow.com/questions/1871536&gt;</span>
</span></span><span style="display:flex;"><span>    d0 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>subtract<span style="color:#f92672">.</span>outer(obs[:,<span style="color:#ae81ff">0</span>], interp[:,<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    d1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>subtract<span style="color:#f92672">.</span>outer(obs[:,<span style="color:#ae81ff">1</span>], interp[:,<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    print(d0<span style="color:#f92672">.</span>dtype,d1<span style="color:#f92672">.</span>dtype)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>hypot(d0, d1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">simple_idw</span>(x, y, z, xi, yi, pows):
</span></span><span style="display:flex;"><span>    dist <span style="color:#f92672">=</span> distance_matrix(x,y, xi,yi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># IDW 權重為 1 / distance</span>
</span></span><span style="display:flex;"><span>    weights <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> dist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使權重加總為 1</span>
</span></span><span style="display:flex;"><span>    weights <span style="color:#f92672">/=</span> weights<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 在每個要插值的點上，將權重乘以 Z 值</span>
</span></span><span style="display:flex;"><span>    zi <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(weights<span style="color:#f92672">.</span>T, z)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> zi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_aspect(<span style="color:#e6db74">&#39;equal&#39;</span>)
</span></span><span style="display:flex;"><span>pows <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>nx, ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>xmin, xmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">119.8</span>, <span style="color:#ae81ff">121.2</span>
</span></span><span style="display:flex;"><span>ymin, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>interpolatep <span style="color:#f92672">=</span> gdf[[<span style="color:#e6db74">&#34;lon&#34;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>, <span style="color:#e6db74">&#39;Observations&#39;</span>]]
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lon&#39;</span>]
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lat&#39;</span>]
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;Observations&#39;</span>]
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> z<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>xi <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(xmin,xmax, nx)
</span></span><span style="display:flex;"><span>yi <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(ymin, ymax, ny)
</span></span><span style="display:flex;"><span>xi, yi <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(xi, yi)
</span></span><span style="display:flex;"><span>xi, yi <span style="color:#f92672">=</span> xi<span style="color:#f92672">.</span>flatten(), yi<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 計算 IDW</span>
</span></span><span style="display:flex;"><span>grid <span style="color:#f92672">=</span> simple_idw(x,y,z,xi,yi,pows)
</span></span><span style="display:flex;"><span>grid <span style="color:#f92672">=</span> grid<span style="color:#f92672">.</span>reshape((ny, nx))
</span></span><span style="display:flex;"><span>grid <span style="color:#f92672">=</span> grid<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>imshow(grid, extent<span style="color:#f92672">=</span>(xmin, xmax, ymin, ymax))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lightgray&#39;</span>);
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>scatter(x, y, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, s<span style="color:#f92672">=</span>z,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input point&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>colorbar()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlim(xmin, xmax)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylim(ymin, ymax)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;IDW&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-5-1.png" alt="Python output"></p>
<h3 id="克力金法-kriging">克力金法 (Kriging)</h3>
<p>克利金法的原理則是利用已知點的位置與數值，去建立一個半變異圖 (semi-variogram)，並依據這個圖進行樣本點的分組，以得到數個區域性變量 (regionalized variable)，並以其為基礎進行數值推估。克利金法與前述反距離加權法相似，都是利用已知點的數值與距離去推估鄰近地區的未知點數值，比較大的差異是克力金法會將樣本的依照距離作分組，從而依照距離調整其不同的推估公式。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 建立網格範圍與解析度</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>resolution <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>  <span style="color:#75715e"># cell size in meters</span>
</span></span><span style="display:flex;"><span>gridx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">119.8</span>, <span style="color:#ae81ff">121.2</span>, resolution)
</span></span><span style="display:flex;"><span>gridy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">24</span>, resolution)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 定義函式 raster to polygon </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> itertools
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> shapely.geometry <span style="color:#f92672">import</span> Polygon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pixel2poly</span>(x, y, z, resolution):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    x: x coords of cell
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    y: y coords of cell
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    z: matrix of values for each (x,y)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resolution: spatial resolution of each cell
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    polygons <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    half_res <span style="color:#f92672">=</span> resolution <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, j  <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(range(len(x)), range(len(y))):
</span></span><span style="display:flex;"><span>        minx, maxx <span style="color:#f92672">=</span> x[i] <span style="color:#f92672">-</span> half_res, x[i] <span style="color:#f92672">+</span> half_res
</span></span><span style="display:flex;"><span>        miny, maxy <span style="color:#f92672">=</span> y[j] <span style="color:#f92672">-</span> half_res, y[j] <span style="color:#f92672">+</span> half_res
</span></span><span style="display:flex;"><span>        polygons<span style="color:#f92672">.</span>append(Polygon([(minx, miny), (minx, maxy), (maxx, maxy), (maxx, miny)]))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(z, (int, float)):
</span></span><span style="display:flex;"><span>            values<span style="color:#f92672">.</span>append(z)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            values<span style="color:#f92672">.</span>append(z[j, i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> polygons, values
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 利用pykrige 內插計算網格數值</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pykrige.ok <span style="color:#f92672">import</span> OrdinaryKriging
</span></span><span style="display:flex;"><span>krig <span style="color:#f92672">=</span> OrdinaryKriging(x<span style="color:#f92672">=</span>gdf[<span style="color:#e6db74">&#34;lon&#34;</span>], y<span style="color:#f92672">=</span>gdf[<span style="color:#e6db74">&#34;lat&#34;</span>], z<span style="color:#f92672">=</span>gdf[<span style="color:#e6db74">&#39;Observations&#39;</span>], variogram_model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;spherical&#34;</span>, pseudo_inv<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>z, ss <span style="color:#f92672">=</span> krig<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;grid&#34;</span>, gridx, gridy)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>imshow(z);
</span></span></code></pre></div><p><img src="figures/5-2-5-2.png" alt="Python output"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 利用plotly 將網格與地圖疊合呈現</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> plotly.express <span style="color:#66d9ef">as</span> px
</span></span><span style="display:flex;"><span>polygons, values <span style="color:#f92672">=</span> pixel2poly(gridx, gridy, z, resolution)
</span></span><span style="display:flex;"><span>water_model <span style="color:#f92672">=</span> (gpd<span style="color:#f92672">.</span>GeoDataFrame({<span style="color:#e6db74">&#34;water_modelled&#34;</span>: values}, geometry<span style="color:#f92672">=</span>polygons, crs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">.</span>to_crs(<span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span><span style="display:flex;"><span>                 )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> px<span style="color:#f92672">.</span>choropleth_mapbox(water_model, geojson<span style="color:#f92672">=</span>water_model<span style="color:#f92672">.</span>geometry, locations<span style="color:#f92672">=</span>water_model<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>                           color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;water_modelled&#34;</span>, color_continuous_scale<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RdYlGn_r&#34;</span>, opacity<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                           center<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;lat&#34;</span>: <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#34;lon&#34;</span>: <span style="color:#ae81ff">121</span>}, zoom<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>                           mapbox_style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;carto-positron&#34;</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_layout(margin<span style="color:#f92672">=</span>dict(l<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, r<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, t<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>, b<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_traces(marker_line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p><img src="figures/5-2-5-3.png" alt="Python output"></p>
<h3 id="最近鄰居插值-nearest-neighbor-interpolation">最近鄰居插值 (Nearest neighbor Interpolation)</h3>
<p>最近鄰居法的方法其實很簡單，若我們想得知空間上某一個位置的數值，只需要找到最鄰近且有數值的測站，就可以當作是這個位置的數值。這個方法基本上也是依循越鄰近越相似的原理去設計，且常被應用在影像處理及放大的案例上。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.interpolate <span style="color:#f92672">import</span> NearestNDInterpolator
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>interpolatep <span style="color:#f92672">=</span> gdf[[<span style="color:#e6db74">&#34;lon&#34;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>, <span style="color:#e6db74">&#39;Observations&#39;</span>]]
</span></span><span style="display:flex;"><span>xd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lon&#39;</span>]
</span></span><span style="display:flex;"><span>yd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lat&#39;</span>]
</span></span><span style="display:flex;"><span>zd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;Observations&#39;</span>]
</span></span><span style="display:flex;"><span>xd <span style="color:#f92672">=</span> xd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>yd <span style="color:#f92672">=</span> yd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>zd <span style="color:#f92672">=</span> zd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(min(xd), max(xd))
</span></span><span style="display:flex;"><span>Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(min(yd), max(yd))
</span></span><span style="display:flex;"><span>X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(X, Y)  <span style="color:#75715e"># 2D grid for interpolation</span>
</span></span><span style="display:flex;"><span>interp <span style="color:#f92672">=</span> NearestNDInterpolator(list(zip(xd, yd)), zd)
</span></span><span style="display:flex;"><span>Z <span style="color:#f92672">=</span> interp(X, Y)
</span></span><span style="display:flex;"><span>im <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>pcolormesh(X, Y, Z, shading<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;auto&#39;</span>)
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>);
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>scatterplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lon&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, data<span style="color:#f92672">=</span>interpolatep,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input point&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>colorbar(im)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlim(xmin, xmax)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylim(ymin, ymax)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-5-4.png" alt="Python output"></p>
<h2 id="空間內插後的資料處理">空間內插後的資料處理</h2>
<h3 id="擷取等值線資料-contour">擷取等值線資料 (contour)</h3>
<p>一般來說，我們將測站依照其位置與數值進行空間內插後，就會得到一個全面性的網格資料，然而，我們可以如何解析這些網格資料呢？首先，最容易的方式就是依照網格的數值與位置，去將數值相近的點連成一條線，其概念類似於在起伏不定的地形上，劃設等高線，而我們這樣的話法可以將其視為等值線。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> osgeo <span style="color:#f92672">import</span> gdal
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> elevation 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 利用 Matplotlib 中的 &#39;contourf&#39; 函式來畫</span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(xmin, xmax)
</span></span><span style="display:flex;"><span>Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(ymin, ymax)
</span></span><span style="display:flex;"><span>krig <span style="color:#f92672">=</span> OrdinaryKriging(x<span style="color:#f92672">=</span>interpolatep[<span style="color:#e6db74">&#39;lon&#39;</span>], y<span style="color:#f92672">=</span>interpolatep[<span style="color:#e6db74">&#39;lat&#39;</span>], z<span style="color:#f92672">=</span>interpolatep[<span style="color:#e6db74">&#39;Observations&#39;</span>], variogram_model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;spherical&#34;</span>)
</span></span><span style="display:flex;"><span>z, ss <span style="color:#f92672">=</span> krig<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;grid&#34;</span>, X, Y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>im <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>contourf(z, cmap <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;viridis&#34;</span>, 
</span></span><span style="display:flex;"><span>            levels <span style="color:#f92672">=</span> list(range(<span style="color:#f92672">-</span><span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">10</span>)),extent<span style="color:#f92672">=</span>(xmin, xmax, ymin, ymax))
</span></span><span style="display:flex;"><span>basemap<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>);
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Elevation Contours Taiwan&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/5-2-6-1.png" alt="Python output"></p>
<h3 id="擷取橫切面的資料-profile">擷取橫切面的資料 (Profile)</h3>
<p>劃設等值線可以讓我們獲知數值的分佈梯度與範圍，而另一個協助我們瞭解數值分佈的方式則是剖面線，其原理就是在兩點之間劃設一條直線，並依照直線的位置去擷取相對應的推估數值。這樣的方法可以協助我們知道兩點之間的數值變化起伏，在某些空氣品質的研究中，科學家就會利用剖面線的方式評估道路兩側的PM2.5變化。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_kde_raster</span>(Z, XX, YY, min_x, max_x, min_y, max_y, proj, filename):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Export and save a kernel density raster.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 取得解析度</span>
</span></span><span style="display:flex;"><span>    xres <span style="color:#f92672">=</span> (max_x <span style="color:#f92672">-</span> min_x) <span style="color:#f92672">/</span> len(XX)
</span></span><span style="display:flex;"><span>    yres <span style="color:#f92672">=</span> (max_y <span style="color:#f92672">-</span> min_y) <span style="color:#f92672">/</span> len(YY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 取得 bound 等資訊</span>
</span></span><span style="display:flex;"><span>    transform <span style="color:#f92672">=</span> Affine<span style="color:#f92672">.</span>translation(min_x <span style="color:#f92672">-</span> xres <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, min_y <span style="color:#f92672">-</span> yres <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> Affine<span style="color:#f92672">.</span>scale(xres, yres)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 輸出為 raster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> rasterio<span style="color:#f92672">.</span>open(
</span></span><span style="display:flex;"><span>            filename,
</span></span><span style="display:flex;"><span>            mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;w&#34;</span>,
</span></span><span style="display:flex;"><span>            driver <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GTiff&#34;</span>,
</span></span><span style="display:flex;"><span>            height <span style="color:#f92672">=</span> Z<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>            width <span style="color:#f92672">=</span> Z<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>            count <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            dtype <span style="color:#f92672">=</span> Z<span style="color:#f92672">.</span>dtype,
</span></span><span style="display:flex;"><span>            crs <span style="color:#f92672">=</span> proj,
</span></span><span style="display:flex;"><span>            transform <span style="color:#f92672">=</span> transform,
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">as</span> new_dataset:
</span></span><span style="display:flex;"><span>            new_dataset<span style="color:#f92672">.</span>write(Z, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pykrige.ok <span style="color:#f92672">import</span> OrdinaryKriging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> affine <span style="color:#f92672">import</span> Affine
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> rasterio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span>start_cor <span style="color:#f92672">=</span> [<span style="color:#ae81ff">119.9</span>,<span style="color:#ae81ff">23.2</span>]
</span></span><span style="display:flex;"><span>end_cor <span style="color:#f92672">=</span> [<span style="color:#ae81ff">120.1</span>,<span style="color:#ae81ff">23.9</span>]
</span></span><span style="display:flex;"><span>npoints<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(xmin, xmax, npoints)
</span></span><span style="display:flex;"><span>Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(ymin, ymax, npoints)
</span></span><span style="display:flex;"><span>interpolatep <span style="color:#f92672">=</span> gdf[[<span style="color:#e6db74">&#34;lon&#34;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>, <span style="color:#e6db74">&#39;Observations&#39;</span>]]
</span></span><span style="display:flex;"><span>xd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lon&#39;</span>]
</span></span><span style="display:flex;"><span>yd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;lat&#39;</span>]
</span></span><span style="display:flex;"><span>zd <span style="color:#f92672">=</span> interpolatep[<span style="color:#e6db74">&#39;Observations&#39;</span>]
</span></span><span style="display:flex;"><span>xd <span style="color:#f92672">=</span> xd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>yd <span style="color:#f92672">=</span> yd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>zd <span style="color:#f92672">=</span> zd<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#34;float64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>krig <span style="color:#f92672">=</span> OrdinaryKriging(x<span style="color:#f92672">=</span>xd, y<span style="color:#f92672">=</span>yd, z<span style="color:#f92672">=</span>zd, variogram_model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;spherical&#34;</span>)
</span></span><span style="display:flex;"><span>zr, ss <span style="color:#f92672">=</span> krig<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;grid&#34;</span>, X, Y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 輸出 raster</span>
</span></span><span style="display:flex;"><span>export_kde_raster(Z <span style="color:#f92672">=</span> zr, XX <span style="color:#f92672">=</span> X, YY <span style="color:#f92672">=</span> Y,
</span></span><span style="display:flex;"><span>                  min_x <span style="color:#f92672">=</span> xmin, max_x <span style="color:#f92672">=</span> xmax, min_y <span style="color:#f92672">=</span> ymin, max_y <span style="color:#f92672">=</span> ymax,
</span></span><span style="display:flex;"><span>                  proj <span style="color:#f92672">=</span> <span style="color:#ae81ff">4326</span>, filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;kriging_result.tif&#34;</span>)
</span></span><span style="display:flex;"><span>kriging <span style="color:#f92672">=</span> rasterio<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#34;kriging_result.tif&#34;</span>,mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dist <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>sqrt((end_cor[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>start_cor[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span>(end_cor[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>start_cor[<span style="color:#ae81ff">1</span>])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">111</span>
</span></span><span style="display:flex;"><span>npoints<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>lat <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(start_cor[<span style="color:#ae81ff">1</span>], end_cor[<span style="color:#ae81ff">1</span>],npoints)
</span></span><span style="display:flex;"><span>lon <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(start_cor[<span style="color:#ae81ff">0</span>], end_cor[<span style="color:#ae81ff">0</span>],npoints)
</span></span><span style="display:flex;"><span>distarray <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, dist,npoints)
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>append(distarray, dist)
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;Latitude&#39;</span>: lat, <span style="color:#e6db74">&#39;Longtitude&#39;</span>:lon,<span style="color:#e6db74">&#39;h_distance&#39;</span>:distarray})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df[<span style="color:#e6db74">&#39;Observations&#39;</span>]<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>gdf_pcs <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>GeoDataFrame(df, geometry <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>points_from_xy(df<span style="color:#f92672">.</span>Longtitude, df<span style="color:#f92672">.</span>Latitude))
</span></span><span style="display:flex;"><span>gdf_pcs<span style="color:#f92672">.</span>crs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;init&#39;</span>:<span style="color:#e6db74">&#39;epsg:4326&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> index, row <span style="color:#f92672">in</span> gdf_pcs<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>    rows, cols <span style="color:#f92672">=</span> kriging<span style="color:#f92672">.</span>index(row[<span style="color:#e6db74">&#39;geometry&#39;</span>]<span style="color:#f92672">.</span>x,row[<span style="color:#e6db74">&#39;geometry&#39;</span>]<span style="color:#f92672">.</span>y)
</span></span><span style="display:flex;"><span>    kri_data <span style="color:#f92672">=</span> kriging<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)    
</span></span><span style="display:flex;"><span>    df[<span style="color:#e6db74">&#39;Observations&#39;</span>]<span style="color:#f92672">.</span>loc[index] <span style="color:#f92672">=</span> kri_data[rows, cols]
</span></span><span style="display:flex;"><span>profile <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;h_distance&#39;</span>,<span style="color:#e6db74">&#39;Observations&#39;</span>]]
</span></span><span style="display:flex;"><span>profile<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;h_distance&#39;</span>,y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Observations&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kriging<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p><img src="figures/5-2-6-2.png" alt="Python output"></p>
<h2 id="參考資源">參考資源</h2>
<ul>
<li>Geopandas初探, Chimin. <a href="https://ithelp.ithome.com.tw/articles/10202336">https://ithelp.ithome.com.tw/articles/10202336</a></li>
<li>scipy.spatial 空間處理模組說明 (<a href="https://docs.scipy.org/doc/scipy/reference/spatial.html">https://docs.scipy.org/doc/scipy/reference/spatial.html</a>)</li>
<li>scipy.interpolate 空間內插模組說明 (<a href="https://docs.scipy.org/doc/scipy/reference/interpolate.html">https://docs.scipy.org/doc/scipy/reference/interpolate.html</a>)</li>
<li>pykrige 克力金內插模組說明 (<a href="https://geostat-framework.readthedocs.io/projects/pykrige/en/stable/api.html#krigging-algorithms">https://geostat-framework.readthedocs.io/projects/pykrige/en/stable/api.html#krigging-algorithms</a>)</li>
</ul>

            <footer class="footline">
            </footer>
          </article>


<div align="center">
<hr width="70%">

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
<br />
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0;margin:2px" src="https://i.creativecommons.org/l/by/3.0/88x31.png" /></a>
</div>
<p style="height:30px">

<div id="disqus_thread" style="border-style: ridge; padding-inline:5px"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'learnciot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation showVisitedLinks">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
          <style>
            #logo svg,
            #logo svg * {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              fill: #282828 !important;
              fill: var(--MENU-SECTIONS-BG-color) !important;
              opacity: .945;
            }
            a#logo {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              font-family: 'Work Sans', 'Helvetica', 'Tahoma', 'Geneva', 'Arial', sans-serif;
              font-size: 30px;
              font-weight: 300;
              margin-top: -13px;
              max-width: 60%;
              text-transform: uppercase;
              width: 226px;
              white-space: nowrap;
            }
            a#logo:hover {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
            }
            #logo svg {
              margin-bottom: -20px;
              margin-left: -23.5px;
              width: 40.5%;
            }
            @media only all and (max-width: 59.938em) {
              a#logo {
                font-size: 25px;
                margin-top: -3px;
              }
              #logo svg {
                margin-bottom: -12px;
                margin-left: -23px;
              }
            }
            @media all and (-ms-high-contrast:none) {
              /* IE11s understanding of positioning is weird at best */
              a#logo {
                margin-top: -58px;
              }
              #logo svg {
                margin-bottom: -62px;
              }
            }
          </style>
          <a id="logo" href="/">
            Learn CIoT
          </a>

        </div>
        <div class="searchbox default-animation">
          <label class="a11y-only" for="search-by">搜尋</label>
          <i class="fas fa-search"></i>
          <input data-search-input id="search-by" type="search" placeholder="搜尋...">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['zh'];
        </script>
        <script src="/js/auto-complete.js?1697343324" defer></script>
        <script src="/js/lunr.min.js?1697343324" defer></script>
        <script src="/js/lunr.stemmer.support.min.js?1697343324" defer></script>
        <script src="/js/lunr.multi.min.js?1697343324" defer></script>
        <script src="/js/lunr.zh.min.js?1697343324" defer></script>
        <script src="/js/search.js?1697343324" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/ch1/" title="1. 教學網站簡介" class="dd-item"><a href="/ch1/">1. 教學網站簡介<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/" title="2. 整體課程前言" class="dd-item"><label for="section-0c4ff77f81b29c69f37066d67544c3b9" ></label><a href="/ch2/">2. 整體課程前言<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch2/ch2.1/" title="2.1. 課程架構說明" class="dd-item"><a href="/ch2/ch2.1/">2.1. 課程架構說明<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/ch2.2/" title="2.2. 課程軟體工具簡介" class="dd-item"><a href="/ch2/ch2.2/">2.2. 課程軟體工具簡介<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch3/" title="3. 資料取用" class="dd-item"><label for="section-2d571a52f8e6e09b8c11625532edb2d4" ></label><a href="/ch3/">3. 資料取用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch3/ch3.1/" title="3.1. 基本資料存取方法" class="dd-item"><a href="/ch3/ch3.1/">3.1. 基本資料存取方法<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch3/ch3.2/" title="3.2. 存取特定時空條件的資料" class="dd-item"><a href="/ch3/ch3.2/">3.2. 存取特定時空條件的資料<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch4/" title="4. 時間維度資料分析" class="dd-item"><label for="section-a3965432c40ae592eaa5a4a04592685e" ></label><a href="/ch4/">4. 時間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch4/ch4.1/" title="4.1. 時間序列資料處理" class="dd-item"><a href="/ch4/ch4.1/">4.1. 時間序列資料處理<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.2/" title="4.2. 時間序列資料預測" class="dd-item"><a href="/ch4/ch4.2/">4.2. 時間序列資料預測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.3/" title="4.3. 時間序列屬性分群" class="dd-item"><a href="/ch4/ch4.3/">4.3. 時間序列屬性分群<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch5/" title="5. 空間維度資料分析" class="dd-item parent"><label for="section-b6a8e999e0329c5971871ffc5b34192f" ></label><a href="/ch5/">5. 空間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch5/ch5.1/" title="5.1. 地理空間篩選" class="dd-item"><a href="/ch5/ch5.1/">5.1. 地理空間篩選<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch5/ch5.2/" title="5.2. 地理空間分析" class="dd-item active"><a href="/ch5/ch5.2/">5.2. 地理空間分析<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch6/" title="6. 資料應用" class="dd-item"><label for="section-f8bc2d76b61c5c9922024382e3ab1dcb" ></label><a href="/ch6/">6. 資料應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch6/ch6.1/" title="6.1. 機器學習初探" class="dd-item"><a href="/ch6/ch6.1/">6.1. 機器學習初探<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.2/" title="6.2. 異常資料偵測" class="dd-item"><a href="/ch6/ch6.2/">6.2. 異常資料偵測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.3/" title="6.3. 感測器聯合校正" class="dd-item"><a href="/ch6/ch6.3/">6.3. 感測器聯合校正<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch7/" title="7. 系統整合應用" class="dd-item"><label for="section-c663021a728355d88e45618764e92f92" ></label><a href="/ch7/">7. 系統整合應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch7/ch7.1/" title="7.1. QGIS 應用" class="dd-item"><a href="/ch7/ch7.1/">7.1. QGIS 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.2/" title="7.2. Tableau 應用" class="dd-item"><a href="/ch7/ch7.2/">7.2. Tableau 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.3/" title="7.3. Leafmap 應用" class="dd-item"><a href="/ch7/ch7.3/">7.3. Leafmap 應用<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/video/" title="教學影片" class="dd-item"><a href="/video/">教學影片<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/about/" title="關於我們" class="dd-item"><a href="/about/">關於我們<i class="fas fa-check read-icon"></i></a></li>
        </ul>
        <div id="shortcuts">
          <div class="nav-title">其他連結</div>
          <ul>
            <li><a class="padding" href="https://github.com/LearnCIOT/LearnCIOT.github.io"><i class='fab fa-fw fa-github'></i> GitHub</a></li>
            <li><a class="padding" href="/levels/"><i class='fas fa-fw fa-heartbeat'></i> 按照難度等級查詢</a></li>
            <li><a class="padding" href="/tags/"><i class='fas fa-fw fa-tags'></i> 按照文章標籤查詢</a></li>
            <li><a class="padding" href="/authors/"><i class='fas fa-fw fa-users'></i> 按照文章作者查詢</a></li>
          </ul>
        </div>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"/>
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch showVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch showLangSwitch">
              <a class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-language" onchange="location = baseUri + this.value;">
                    <option id="en" value="/en/ch5/ch5.2/">English</option>
                    <option id="zh-tw" value="/ch5/ch5.2/" selected>中文</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <a class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="relearn-light" value="relearn-light" selected>Relearn Light</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks showVisitedLinks"><a class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> 清除歷史紀錄</a></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>

    <script src="/js/clipboard.min.js?1697343324" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1697343324" defer></script>
    <script src="/js/featherlight.min.js?1697343324" defer></script>
    <script src="/js/jquery.svg.pan.zoom.js?1697343324" defer></script>
    <script src="/js/mermaid.min.js?1697343324" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/theme.js?1697343324" defer></script>
  </body>
</html>
