<!DOCTYPE html>
<html lang="zh-tw" class="js csstransforms3d">
  <head>

<meta property="og:title" content="6.1. 機器學習初探"/>
<meta property="og:description" content="我們使用空品和水位類別資料，結合天氣觀測資料，利用資料集的時間欄位進行連結，帶入機器學習的套件，進行資料分類與資料分群的分析。我們將示範機器學習的標準流程，並且介紹如何透過資料分類進一步進行資料預測，以及如何透過資料分群進行對資料進一步的深入探究。"/>
<meta property="og:image" content="https://learnciot.github.io/images/thumbnail.jpg"/>
<meta property="og:url" content="/ch6/ch6.1/"/>
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="627" />
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.104.3">
    <meta name="generator" content="Relearn 5.3.3+tip">
    <meta name="description" content="我們使用空品和水位類別資料，結合天氣觀測資料，利用資料集的時間欄位進行連結，帶入機器學習的套件，進行資料分類與資料分群的分析。我們將示範機器學習的標準流程，並且介紹如何透過資料分類進一步進行資料預測，以及如何透過資料分群進行對資料進一步的深入探究。">
    <meta name="author" content="Ling-Jyh Chen">
    <title>6.1. 機器學習初探 :: Tutorial for CIoT Open Data Applications</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1697341099" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1697341099" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1697341099" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1697341099" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1697341099" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1697341099" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1697341099" rel="stylesheet">
    <link href="/css/nucleus.css?1697341099" rel="stylesheet">
    <link href="/css/fonts.css?1697341099" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1697341099" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1697341099" rel="stylesheet">
    <link href="/css/theme-relearn-light.css?1697341099" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1697341099" rel="stylesheet">
    <link href="/css/variant.css?1697341099" rel="stylesheet">
    <link href="/css/print.css?1697341099" rel="stylesheet" media="print">
    <script src="/js/variant.js?1697341099"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="/index.json";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = '複製到剪貼板';
      window.T_Copied_to_clipboard = '複製到剪貼簿！';
      window.T_Copy_link_to_clipboard = '將連結複製到剪貼簿';
      window.T_Link_copied_to_clipboard = '連結複製到剪貼簿！';
      // some further base stuff
      var baseUriFull='https:\/\/LearnCIOT.github.io/';
      window.variants && variants.init( [ 'relearn-light' ] );
    </script>
    <script src="/js/jquery.min.js?1697341099" defer></script>
<meta property="fb:app_id" content="601826851395774" />
  </head>
  <body class="default-animation" data-url="/ch6/ch6.1/">




<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v14.0" nonce="hWjBXHAv"></script>

    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div class="navigation">
             <a class="nav nav-next" href="/ch6/ch6.2/" title="6.2. 異常資料偵測"><i class="fas fa-chevron-right fa-fw"></i></a>
          </div>
          <div class="navigation">
             <a class="nav nav-prev" href="/ch6/" title="6. 資料應用"><i class="fas fa-chevron-left fa-fw"></i></a>
          </div>
          <div id="top-github-link">
            <a class="github-link" title='編輯網頁' href="https://github.com/LearnCIOT/LearnCIOT.github.io/tree/main/content/ch6/ch6.1/index.zh-tw.md" target="blank">
              <i class="fas fa-pen fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='導航'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <span id="toc-menu" title='目錄'><i class="fas fa-list-alt fa-fw"></i></span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <meta itemprop="itemListOrder" content="Descending" />
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="3" /><a itemprop="item" href="/"><span itemprop="name">民生公共物聯網資料應用</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="2" /><a itemprop="item" href="/ch6/"><span itemprop="name">6. 資料應用</span></a> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><meta itemprop="position" content="1" /><a itemprop="item" href="/ch6/ch6.1/" aria-disabled="true"><span itemprop="name">6.1. 機器學習初探</span></a></li>
            </ol>
          </div>
          <div class="default-animation progress">
            <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#基本介紹">基本介紹</a>
      <ul>
        <li><a href="#分類問題-classification">分類問題 (Classification)</a></li>
        <li><a href="#分群問題-clustering">分群問題 (Clustering)</a></li>
      </ul>
    </li>
    <li><a href="#套件安裝與引用">套件安裝與引用</a></li>
    <li><a href="#案例一空品資料的場所型態分類">案例一：空品資料的場所型態分類</a>
      <ul>
        <li><a href="#資料清理">資料清理</a></li>
        <li><a href="#移除離群值">移除離群值</a></li>
        <li><a href="#區別訓練資料與測試資料">區別訓練資料與測試資料</a></li>
        <li><a href="#使用-sklearn-預建模型">使用 Sklearn 預建模型</a></li>
      </ul>
    </li>
    <li><a href="#案例二空品資料的分群">案例二：空品資料的分群</a>
      <ul>
        <li><a href="#資料下載與前處理">資料下載與前處理</a></li>
        <li><a href="#動態時間校正-dynamic-time-warping-dtw">動態時間校正 (Dynamic Time Warping, DTW)</a></li>
        <li><a href="#使用-k-mean-分群演算法">使用 K-Mean 分群演算法</a></li>
        <li><a href="#探究資料分群與地理位置的關係">探究資料分群與地理位置的關係</a></li>
        <li><a href="#探究資料分群與風場風向的關係">探究資料分群與風場風向的關係</a></li>
      </ul>
    </li>
    <li><a href="#案例三結合氣象與水資源資料的分類與分群">案例三：結合氣象與水資源資料的分類與分群</a>
      <ul>
        <li><a href="#資料下載與前處理-1">資料下載與前處理</a></li>
        <li><a href="#計算特定淹水感測器與雨量測站資料的相似度">計算特定淹水感測器與雨量測站資料的相似度</a></li>
        <li><a href="#資料分群並探究相關性高的雨量站">資料分群並探究相關性高的雨量站</a></li>
        <li><a href="#資料分類並由雨量計資料預測淹水可能性">資料分類並由雨量計資料預測淹水可能性</a></li>
      </ul>
    </li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
            </div>
          </div>
        </div>
      </nav>

      <main id="body-inner" class="highlightable ">
        <div class="flex-block-wrapper">
          <div id="head-tags"><div class="tags">
  <a class="level-link" href="/levels/intermediate">
  <b>
	&starf;&starf;&starf;&star;&star;
  </b>
  </a>
  <a class="tag-link" href="/tags/python">Python</a>
  <a class="tag-link" href="/tags/%E6%B0%B4">水</a>
  <a class="tag-link" href="/tags/%E7%A9%BA">空</a>
</div>

          </div>


  
  
  

  <section class="social-share">
    <ul class="share-icons">
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?hashtags=codingnconcepts&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f&amp;text=6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2" target="_blank" rel="noopener" aria-label="Share on Twitter" class="share-btn twitter">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="26px" viewBox="0 0 31 26" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(11.372549%,60.784314%,94.117647%);fill-opacity:1;" d="M 27.742188 6.535156 C 27.761719 6.8125 27.761719 7.089844 27.761719 7.371094 C 27.761719 15.875 21.414062 25.683594 9.800781 25.683594 L 9.800781 25.675781 C 6.371094 25.683594 3.011719 24.679688 0.125 22.792969 C 0.625 22.851562 1.125 22.882812 1.628906 22.886719 C 4.46875 22.886719 7.230469 21.914062 9.46875 20.125 C 6.765625 20.070312 4.398438 18.277344 3.570312 15.65625 C 4.515625 15.839844 5.492188 15.800781 6.421875 15.542969 C 3.476562 14.9375 1.355469 12.300781 1.355469 9.234375 L 1.355469 9.152344 C 2.234375 9.652344 3.214844 9.929688 4.222656 9.960938 C 1.449219 8.070312 0.59375 4.304688 2.265625 1.363281 C 5.472656 5.386719 10.203125 7.832031 15.277344 8.089844 C 14.769531 5.855469 15.464844 3.511719 17.105469 1.941406 C 19.644531 -0.496094 23.644531 -0.371094 26.035156 2.21875 C 27.449219 1.933594 28.804688 1.40625 30.042969 0.65625 C 29.574219 2.144531 28.585938 3.410156 27.269531 4.214844 C 28.519531 4.066406 29.742188 3.722656 30.894531 3.203125 C 30.046875 4.496094 28.980469 5.625 27.742188 6.535156 Z M 27.742188 6.535156 "/>
</g>
</svg>

          <p>Twitter</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f" target="_blank" rel="noopener" aria-label="Share on Facebook" class="share-btn facebook">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<linearGradient id="linear0" gradientUnits="userSpaceOnUse" x1="-277.375" y1="406.6018" x2="-277.375" y2="407.5726" gradientTransform="matrix(32,0,0,-31.82224,8892.0008,12969.8672)">
<stop offset="0" style="stop-color:rgb(0%,38.431373%,87.843137%);stop-opacity:1;"/>
<stop offset="1" style="stop-color:rgb(9.803922%,68.627451%,100%);stop-opacity:1;"/>
</linearGradient>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:url(#linear0);" d="M 13.359375 31.839844 C 5.761719 30.480469 0 23.921875 0 16 C 0 7.199219 7.199219 0 16 0 C 24.800781 0 32 7.199219 32 16 C 32 23.921875 26.238281 30.480469 18.640625 31.839844 L 17.761719 31.121094 L 14.238281 31.121094 Z M 13.359375 31.839844 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 22.238281 20.480469 L 22.960938 16 L 18.71875 16 L 18.71875 12.878906 C 18.71875 11.601562 19.199219 10.640625 21.121094 10.640625 L 23.199219 10.640625 L 23.199219 6.558594 C 22.078125 6.398438 20.800781 6.238281 19.679688 6.238281 C 16 6.238281 13.441406 8.480469 13.441406 12.480469 L 13.441406 16 L 9.441406 16 L 9.441406 20.480469 L 13.441406 20.480469 L 13.441406 31.761719 C 14.320312 31.921875 15.199219 32 16.078125 32 C 16.960938 32 17.839844 31.921875 18.71875 31.761719 L 18.71875 20.480469 Z M 22.238281 20.480469 "/>
</g>
</svg>

          <p>Facebook</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f&amp;source=https%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f&amp;title=6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2&amp;summary=6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="share-btn linkedin">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(0%,49.411765%,73.333333%);fill-opacity:1;" d="M 16 32 C 24.835938 32 32 24.835938 32 16 C 32 7.164062 24.835938 0 16 0 C 7.164062 0 0 7.164062 0 16 C 0 24.835938 7.164062 32 16 32 Z M 16 32 "/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 26.222656 25.332031 L 22.203125 25.332031 L 22.203125 18.488281 C 22.203125 16.613281 21.492188 15.566406 20.007812 15.566406 C 18.390625 15.566406 17.546875 16.65625 17.546875 18.488281 L 17.546875 25.332031 L 13.675781 25.332031 L 13.675781 12.296875 L 17.546875 12.296875 L 17.546875 14.050781 C 17.546875 14.050781 18.710938 11.898438 21.476562 11.898438 C 24.242188 11.898438 26.222656 13.585938 26.222656 17.078125 Z M 9.054688 10.589844 C 7.734375 10.589844 6.667969 9.511719 6.667969 8.183594 C 6.667969 6.855469 7.734375 5.777344 9.054688 5.777344 C 10.375 5.777344 11.441406 6.855469 11.441406 8.183594 C 11.441406 9.511719 10.375 10.589844 9.054688 10.589844 Z M 7.054688 25.332031 L 11.09375 25.332031 L 11.09375 12.296875 L 7.054688 12.296875 Z M 7.054688 25.332031 "/>
</g>
</svg>

            <p>LinkedIn</p>
          </a>
      </li>
      

      
      
      <li>
        <a href="whatsapp://send?text=6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bd%bf%e7%94%a8%e7%a9%ba%e5%93%81%e5%92%8c%e6%b0%b4%e4%bd%8d%e9%a1%9e%e5%88%a5%e8%b3%87%e6%96%99%ef%bc%8c%e7%b5%90%e5%90%88%e5%a4%a9%e6%b0%a3%e8%a7%80%e6%b8%ac%e8%b3%87%e6%96%99%ef%bc%8c%e5%88%a9%e7%94%a8%e8%b3%87%e6%96%99%e9%9b%86%e7%9a%84%e6%99%82%e9%96%93%e6%ac%84%e4%bd%8d%e9%80%b2%e8%a1%8c%e9%80%a3%e7%b5%90%ef%bc%8c%e5%b8%b6%e5%85%a5%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e9%80%b2%e8%a1%8c%e8%b3%87%e6%96%99%e5%88%86%e9%a1%9e%e8%88%87%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e7%9a%84%e5%88%86%e6%9e%90%e3%80%82%e6%88%91%e5%80%91%e5%b0%87%e7%a4%ba%e7%af%84%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e7%9a%84%e6%a8%99%e6%ba%96%e6%b5%81%e7%a8%8b%ef%bc%8c%e4%b8%a6%e4%b8%94%e4%bb%8b%e7%b4%b9%e5%a6%82%e4%bd%95%e9%80%8f%e9%81%8e%e8%b3%87%e6%96%99%e5%88%86%e9%a1%9e%e9%80%b2%e4%b8%80%e6%ad%a5%e9%80%b2%e8%a1%8c%e8%b3%87%e6%96%99%e9%a0%90%e6%b8%ac%ef%bc%8c%e4%bb%a5%e5%8f%8a%e5%a6%82%e4%bd%95%e9%80%8f%e9%81%8e%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e9%80%b2%e8%a1%8c%e5%b0%8d%e8%b3%87%e6%96%99%e9%80%b2%e4%b8%80%e6%ad%a5%e7%9a%84%e6%b7%b1%e5%85%a5%e6%8e%a2%e7%a9%b6%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f%0a" target="_blank" class="share-btn whatsapp">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<image id="image5" width="588" height="590" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkwAAAJOCAYAAABFrFjIAAAABmJLR0QA/wD/AP+gvaeTAAAgAElEQVR4nO3debSldXkn+u/vPefUQBUzjqCigoIISEAxDgkmBDVm6DYXo1FpYrzcdCfcXIxJO6S7z7p9zWBWx9zk3k6uHROHa2KHXE00kaAQiVOrEQcGGURFRZwYlIKqOsPez/2jCqzhFG8N55y9T53PZy0Wtd+z9/s+B12rvuv5/fbzSwAAAADgQLRRF8DSm67pyS/l3rVrsnFtJeu6zK8dJmsGaZNJ1nXJZMtwKvNt3TCZTOumkqxryWRLTSXp0rImSYap9ffft6WtrdRO/x/qkjVJN7GsvyCsAJXhTCXDUdexWnXJcJjM/uBKm+uS+SRJZev2a4NhMtsyrEo30yqzw2R+YnIw05LZpJubT2ZbajaZnOuS2a3ZumUuM1svzZu2pqVG8KuxTASmFWa6prvvJIfMZnZDZc2hlcGGynBD5icObS2HVLKuUuu7VuuTrKu09UnWVtrallqbZN22f2qqtTZZyfqWTFYymWFbl2SytZqqbe+bTDKVpKtkbZJ0264nSba/Z9f/D63Z9jZgFzOJv1BHaNB2CEyVzFUy2P5ya9v2v80wyWxSw5Y2U5XZJPPpMrPteuZbMjOsmm3JfNJmkmz9wT/1wJ9btS3D+69VtrbJtqXLcMt8uvtaJu5rmbnv3my999L2pi3L+l+B/SYwjZmL6+K1389hx3TpjkpyRAbtiJY6PK0OTdqGlraxko2V2pDUoV1rGyrZkGE2puWQlqyvZH22hZn7/z050l8KYHXYJUBt/2dbB2tLumxOsrkq93bJ5qRtqtS9ldqUapta6p6q7vvd5ODulqnvzWXm7sdl7d3TbVpncgwITCN0fl2y/rAcfuxgfv64tPbIruWhlfbQluExw9aO6pIjUjmikiOSHJpkQ5JD4n83gIPFfEs2VbIpyaZW+d6wy/dS9b0u3V2VuiOpb1flu5mo21vyjcdk6pvTbXp+1IWvNv7iXUYX1vQRXQaPqUE7Pq0e1dKOG2Z4XKt2bFqOTfKQbAtHAJBsWzb8bpLvpuX2VL7R0r5eVbel2tfb5PDWTbnva5b2lp7AtIS2d5AePxwMH99aPXaYPKZrOb4qj0ny6CRHj7pGAFacQZJvpdrXW6tbh8mtXfLVGravDCeHtzw2k1/VgVp8AtMiu7CmH575+ZNaaydUy+NbywmpOiFpx0f3CIDFV0m+nWq3ptUtLe1Lw8qXMjH44mwGN/1l+927R13gwUBgOlCV9kt5/aMH8+3krmsnVdpJqTopLY9Pcmz8NwZgec0n+Wpabkm1G1vqxuGwbpycHN7wZ+23vz3q4lYqf5nvp1fU9CMzP//kdDl1mPbkVjk5LU+MLhIA4+VbqdxYLTd2qetaV9cmU9e9pU3fNerCVhKBaR+8vF69ocv6p3TDnJHk1FROTcspSQ4bdW0AsBe+m5brWrXrUvn8YKI+d1i+d90ftz+eGXVh405g6lNpv5Tpxw8Gg7PS6inVcmYqT+nSjhl1aQCwv4ap29LyuVa5ulV9dmJi6uo/a9O3jbqucSUw7cH5Nb1mQwant2HOHqbObmlnJfWEmGINwMFlNskXKvXprrpP1kQ+eV9u/MKl7dJB7ydXEYFpFy+vV2/o5g95euuGz0jl6ZU8rbXoJgFw8Kt8I2mfSKtPtmF97N7JqU9f2qZn+z948BOYtntpTR+2Zn74w5X6kbR6dpKnZodz0wBgFdmU1Cday4eHw3y4TU596q1teuuoixqlVR+Yzq9L1m+YP/RZLXVutfqRJGdm24GzALDabWmpT1Rr/9wN68rJye9+8s3tzXOjLmoUVm1guqgumpqff8jZw7Rz03JuJWc3h9QCwEK2VvLR1nJFDdoVj52a+OxqOxR49QWmSrtw9j88OZP1vFQ9N2nPjKU3ANgbm5J2VVp9cKKbvOwtbfqWURe0XFZVYHpZve4RU4PueZX2gqTOTXL4qGsCgBXou5Vc3qX+vpuY+uBqGIK5KgLTxXXx2k2Dw388qZ9O2vOTPGbUNQHAilftxiTvH6b9/eMmu48czIf+HvSB6RX1W0+sYV5YlX+Vbd98O+h/ZwBYLpXMt+RjaXnPsJt8z9vb9NdGXdNSOGjDw7+r6Y33DQY/2VL/OslPxvElALBkKrmjpd5bqXcfNrHpioPtuJWDMjBdWK89KfMTL07a+Wn1pFHXAwCrRFVydWv5m4mu3vWW9oavjrqgxXJQBaaL6+K19w4Oe16lvTjJTyfZMOqaAGAV+l5S705NvOv4ye5DB8PepoMmML2iph85HM6/tCUvqcoZo64HAFa5SvLx1tq7prqJd725Td8x6oIOxEERmC6Yff3TWtcubMmLkxw56noAgAd8uyp/2YbtL9669j9fO+pi9teKDkzbxgUc9jMt+cVKOy/JxKhrAgB2M5u09yX158dPTH5gJS7RrdjAdEG99ug2nLgww/aKZmM3AIy9Sj6VlrfOd5PvfGebvmfU9eyLFRmYXlavOaGbn7yotfrFpB0z6noAgL01vL2qe8vEZP23v2hv+Pqoq9lbKy4wXTD32h9O6/5tS86PM+AAYCW6L8k7a1D/99vX/vY1oy5mb6yYwDRd092XB7PP7dJ+rZLzsoJqBwB2M6jU31XVH71j6nf+edTF9FkRoeOiumhqdnDMz1XaJUmeNup6AIBF86FK+4PHTUy+f7pND0ddzJ6MfWA6vy5Zv3644YI2rF9Ly8mjrgcAWGQtV6fyprUT3/3rN7c3z426nIWMdWB6eb16w8Rw7f9clVcledSo6wEAlkjl5nT5L4d197xtHM+hG9vA9Ir6zUMH81P/NsklaXn4qOsBAJZWDfPVLu2/3Dd1359d2t60ZdT17GgsA9NF9e8P3zo/+SstuSSJsQEAsGrU7a3a76+Zmnrzm9v05lFXc7+xC0zbO0u/lm1h6ahR1wMALLtvpdob29Tkn7y1TW8ddTFJ0o26gB29vF69YTg/9SsRlgBgNXt4Wv1mzc3/0sV18dpRF5OMUWA6vy5Z382v+eVKXhVhCQBWu4enDV/z/bnDL7yoLpoadTFjEZguqoumNsxteGXSfiPJQ0ZdDwAwDtpxSb12ZnDMS6ZreqSZZeSBabqmu5nBMS+pVv8+ycNGXQ8AMD5ay2Oq2utuHcy9YJR1jDww3TqYe0FVe12SY0ddCwAwflryxKr8xwvmXv+sUdUw0sB0wdxrf3hY+Y8teeIo6wAAxt5ZSf7TBTOvO20UDx/ZWIGXbX3NCW1i4o9b8rxR1QAArCSVllw6Pzn/qne2N962nE8eSWC6oF57dBt0v1dVrxhVDQDAijSo5I+Gk2um39mm71muhy77ktyFNb0u8+3iqnpZhCUAYN9MtOSVE/NzrzynpieX66HLHpgGg5nzk/xqkrEYRAUArDiHJvWq4wYzP7VcD1zWwPTy2dee3VV7TZKjl/O5AMBB59iuut+6cOY/nLocD1u2wPTS+s3jWut+q5InLdczAYCDWZ1ZbfC6l9T0MUv9pGUJTBfXxWsn5id+LannL8fzAIDVoVpeuGZ+5peXej/TsgSmewaH/mzSXplkYjmeBwCsGmuS9quPHsz+xFI+ZMkD08tnfuvkqrw2yRFL/SwAYPWp5GGpvP7CLa85fqmesaSB6fya3tha/UaSpyzlcwCAVa7yjOFE979dXBcvybfwl3S9b/3c7IuS/HxqKZ8CAJCW5MLvz278aJK/WeybL1mH6cKZ156U5NVJDlmqZwAA7ODwtO41v7Dl9Y9Z7BsvSWC6sKbXDVv3qiQnL8X9AQAWVmdOdsNfXexvzS1JYJqfnXtBpV68FPcGAHgw1dovPmZ+648t5j0X/Sy3C+s3Hj6Ym3xv0p662PcGANg79aE2lfPf3n7nzsW42+Ju+q60wfzELyY5K3Z6AwCj8yOZa7+Q5I8X42aLuiR3wezrTk21X84SdK4AAPbBRDK8+GVbX3PCYtxs0QLTRXXRVLXhJUkevVj3BADYX5V2Yuvar5xf5x/wSSOLFpi2zB/17KT93GLdDwDgwLWXrZs74awDvcuiBKaLavqQDNuvJzl0Me4HALA46pgkl1xUF00dyF0WJTBtnp05Ly0/vhj3AgBYZC+4b/6YHzmQGxxwYHppTR/WWl6VZEnObgEAOEAb23D46+fXJev39wYHHJgmZrc+P8kPH+h9AACWSmvtx9YP1p+zv58/oMB0fk1vHLZ2cZb4EF8AgAO0tgb1v15cF+/XitgBBaa1szPntuTsA7kHAMCyaDnnrvlDn7U/H93vwHR+Ta9Jy69GdwkAWBnWtdSv7s9cpv0OO2vnZ85O5ZllpjcAsFIMc+7auRNPT/KZffnY/gWmSsts/S9JW+fIOABgBdmYYb0yyb/blw/tV3/oZVt/84mtTXy8Ukftz+cBAEboW92wzn77+t/72t5+YP/2MLXuxcISALBCPXzQuhfuywf2OTC9on7z0CQ/v6+fAwAYF60NX35hTa/b2/fvc2Cam5l4dpIn7uvnAADGRzttfn7mqXv77n0OTNXqwv35HADAGJnMYPhv9vbN+xR8Ltj8+mNbmkN2AYCVr7UX/GK99iF789Z9Ckw1OXyezd4AwEHi4fOzdc7evHGvA9N0TXeV4Uv2uyQAgDFTyV5lm70OTLfMbH1cqjk3DgA4aLS0H71g8+uP7XvfvizJPS/Jxv0vCQBgvFTqqPnJ4Y/1vW/vjkaptJrLzzoGBQA42LSqf53kHQ/2nr3qMF2w5fWPTNXTFqUqAIBxUvXsC+q1Rz/YW/aqwzSYmH9OksOixQQAHGxajhnODJ6Z5L17esve7WEa1k8tVk0AAOOm0h4067S+G7y8Xr1hODNxc5JHLlpVAABjpCVfmlm7/kmXtunZhX7e22Ga3zJ1WpJHLHplAABjopLj18xu2eNZub2BaaLVc7MXnSgAgBVsoqqdu6cf9gamasM9fhgA4GDRUj+xp589aGA6vy45KmmnLn5JAABj56kvr1dvWOgHDxqYpmbW/lCSw5akJACA8XLMYK47ZaEfPGhgapVzlqQcAIAxVMPuRxe6/qCDK6vlWUtTDgDA+GmpZyf5/V2v77HDtG0Nr05b0qoAAMbLWefX9JpdL+4xMM3NTT4hyZFLWhIAwFiph3czM8fvenWPS3LdsJ7u7DgAYJVpEzV4apKbd7y4503fLU9b6ooAAMZNa+3sXa/tOTBVPWVJqwEAGEOVOmPXawsGpvPrkvWpPH7pSwIAGDOVJ15UF03teGnBPUxrZ6YePUwOtYUJAFiFjrlvyxEPS3Lb/RcW7DBV6sRlKwkAYLy0YeuesOOFPQSmdvwyFAMAMKYGj9vx1R42fbfHLXwdAGA1aMfv+GrBPUyVHL/QdQCAVeL4HV8s3GGqetRyVAIAMKaO2/HFnuYwHbsMhQAAjKtH7PhityW559fFa7O1jl6+egAAxs7DdnyxW4fp8M3rj06y2ym9AACryKEvr1dvuP/FboGpy+ARu14DAFhlurmtkw954MWuPx1M5KHLWw8AwPjpavhAJtotME1U95BdrwEArDbDLg+//8+7BaaqJjABANTwgY3fuwemDAUmAIC0BwLT7pO+qzumUstaDgDAuKlkz3uY0uqoZa0GAGAMdclRO/x5Zy3DI5a3HACA8VOtHshEuy3JVdoRsSQHAKx2lQcC00JnyekwAQDs0GESmAAAFlJt4cB0Tk1PJjl02QsCABg/Cwemh9y9ZUMWGjUAALD6HPL8unhtsktgmlo/bzkOAGCbtvHejYcluwSmuUF35GjqAQAYP93UzJHJLstvExN1RJkoAACwzaAdnuzSYaphDh9NNQAA46cmFghMqdo4kmoAAMbRYFs22vkbca02GvINALBNV+2QZNcluWo6TAAA21Wr3QNT15qhlQAA27W2baD3Lh0mU74BAB6wfX/3zpu+W9aPpBgAgDFUbYE9TC3b1ukAAEhquMAepmGyYTTlAACMoe37u3c5aLcdUuYKAABs1xbaw1T2MAEAPKDWJbtP+l4zkloAAMbStsC0y5Jc1sWSHABAkqQqC3SYEh0mAIAHbFt927nDVG2NDhMAwDYt3dpk9zlM60ZTDgDAONrWYdr5aJRkajTFAACMn7bQHqZKdJgAALartm370q7fkpuwgwkA4AETye7fkrMkBwDwA7tv+o4lOQCAHU0luwemXV8DAKx6u+xhsoMJAGAHC3aYAAD4gZ33ME3XtPAEALCznb8ld3Vut+EbAGABD+xhWnf3kVOZmh1lLQAAY2mnTd+2fAMA7M6+JQCAHgITAEAPgQkAoIfBlQAAPXSYAAB6CEwAAD0EJgCAHgITAEAPgysBAHroMAEA9Nh5rIAWEwDAbnSYAAB6CEwAAD1M+gYA6KHDBADQQ2ACAOghMAEA9DC4EgCghw4TAEAPgQkAoIfABADQQ2ACAOixw6bvu5NaN7pKAADGlA4TAEAPgQkAoIfABADQw+BKAIAeOkwAAD0EJgCAHgITAEAPgQkAoMfkzi9t+wYA2JUOEwBAj507TBpMAAC7MYcJAKCHJTkAgB4CEwBAD4EJAKCHwAQA0MMcJgCAHjpMAAA9BCYAgB4CEwBAD4MrAQB6OBoFAKCHJTkAgB4CEwBAD4EJAKCHwZUAAD10mAAAeghMAAA9zGECAOihwwQA0ENgAgDoITABAPRwNAoAQA9zmAAAeliSAwDoITABAPQwhwkAoIcOEwBAD4EJAKCHwAQA0ENgAgDoITABAPTYZdK378kBAOxKhwkAoIfABADQ44ElubuTrBthIQAA40qHCQCgh8AEANBDYAIA6CEwAQD02HkOU8xhAgDYlQ4TAEAPgQkAoMdOS3JORgEA2J0OEwBAD4EJAKCHwAQA0ENgAgDoITABAPQwuBIAoIcOEwBAj53nMI2qCgCAMabDBADQY+c9TFpMAAC70WECAOghMAEA9BCYAAB6mMMEANBDhwkAoIc5TAAAPXSYAAB6CEwAAD0EJgCAHgITAEAPR6MAAPQwhwkAoIclOQCAHuYwAQD00GECAOghMAEA9BCYAAB6CEwAAD0EJgCAHuYwAQD02HmsgLwEALAbS3IAAD0EJgCAHgITAEAPgQkAoIfABADQQ2ACAOhhDhMAQI+d5zCNqgoAgDFmSQ4AoMfOS3JaTAAAu9FhAgDoITABAPQQmAAAeghMAAA9zGECAOhhDhMAQA9LcgAAPQQmAIAeAhMAQA+TvgEAeugwAQD0EJgAAHqYwwQA0MMcJgCAHpbkAAD2bDYRmAAAHszWRGACAHgwlQhMAAC9BCYAgB4mfQMA9DCHCQCghzlMAAA97GECAOghMAEA9BCYAAB6CEwAAD0EJgCAHgITAEAPYwUAAHoYXAkA0OMHgenuJOtGVwgAwNhp2/5lDxMAQA+BCQCgh8AEANBDYAIA6CEwAQD0MIcJAKCHOUwAAD0syQEA9BCYAAB67LwkZ0UOAOAHtmcjHSYAgB4CEwBAD4EJAKCHOUwAAD12CEx3J1k3skIAAMZPS2JJDgCgl8AEANBDYAIA6CEwAQD0MOkbAKCHDhMAQA9zmAAAeuy8JCcyAQDsYFs2siQHANBDYAIA6CEwAQD0EJgAAHoITAAAPQQmAIAeO89hMlUAAGA35jABAPSwJAcA0ENgAgDoITABAPQQmAAAeghMAAA9dh4rMKoqAADGmA4TAEAPc5gAAHrsHJjkJQCA3ViSAwDoITABAPQQmAAAeghMAAA9zGECAOihwwQA0MMcJgCAHjpMAAA9BCYAgB4CEwBAD0ejAAD00GECAOjxQIfp7iTrRlgIAMC4adv/rcMEANDDHCYAgB46TAAAPQQmAIAeAhMAQA+BCQCgh8AEANBjp2/JlS/JAQA84P5opMMEANBDYAIA6GFwJQBADx0mAIAeAhMAQA+BCQCgh8AEANBj5zlMo6oCAGCM6TABAPQQmAAAeuw8h8nZKAAAu9FhAgDoITABAPQQmAAAeghMAAA9BCYAgB4GVwIA9NBhAgDoITABAPTYeXClRTkAgN3sMul7RFUAAIwxS3IAAD0EJgCAHgITAEAPc5gAAHroMAEA9BCYAAB6mMMEANBDhwkAoIfABADQQ2ACAOjhaBQAgB7mMAEA9LAkBwDQQ2ACAOghMAEA9DC4EgCghw4TAEAPgQkAoIfABADQQ2ACAOhhcCUAQA9HowAA9LAkBwDQQ2ACAOhhcCUAQA8dJgCAHgITAEAPgQkAoIc5TAAAPXSYAAB6CEwAAD0EJgCAHrscjWIXEwDArnSYAAB6CEwAAD0EJgCAHgITAEAPgysBAHroMAEA9BCYAAB6CEwAAD0EJgCAHjtP+rbtGwBgNzpMAAA9djlLbkRVAACMMR0mAIAeBlcCAPTQYQIA6CEwAQD0EJgAAHoITAAAPQyuBADoocMEANBDYAIA6CEwAQD0MLgSAKCHs+QAAHpYkgMA2LNhIjABADyYmWSHwLR1awajqwUAYCzNJjvsYVq35ciZ4cZvja4cAIAx9UCH6eqz3jw3ykIAAMaVPUwAAHvSti3J7RqY5kdQCgDAuJpJdh9cObPrNQCAVasyl+zeYZodQSkAAGOpWrYmuwemrSOoBQBgLHULd5iaDhMAwHZVC+xhSpUOEwDAD+w86TtJmj1MAAA72nnSd5JUamY0tQAAjKUtye6bvu8dQSEAAGOpbd+utHNgatk8kmoAAMZQJZuS3TZ9t82VGklBAADjprV2X7JLh6lSm0ZTDgDAGNq++mYPEwDAHgzT7k12D0z3jaAWAIDxNKwFAlM1m74BALZrWSgwbb8IAEBSC+1huv+rcwAAJNn+Lbmdxgp0LZurjBUAAEiSNszuS3KV3DOacgAAxs9wst2T7LqHaZjvjaQaAIAxNFnbAtPOh++24feSNpqKAADGzGBm6/eTXTtMc0MdJgCAJEmbu+a0Z2xJdglMg8mNAhMAQJKkNqVND5NdAtP1Tzplc5LZkdQEADBO6gd7u3dektuWonxTDgCg5e77/7jrWXJp8U05AIBK7rz/z7sFpkoJTADAqtfygw7T5EI/rJj2DQCsdrXnJblK3bW8xQAAjKHWHshEuwem1r6zvNUAAIyhynfv/+PuS3KVbzt/FwCgPRCYduswJfXt5SwFAGAc1fDBAtOwE5gAgFWvusED25R2C0yDtG8tbzkAAONnzcTkngNTWnSYAIDVbm7TxNyeB1eu25I7kgyWtSQAgPFy5y0nXjZz/4vdAtPVZ71vc5wnBwCsbt/Y8cUC35JLktjHBACsWpW6fcfXu81hSpK0+noqJy9LRQAA46by9R1fLtxhqrp1OWoBABhHXZdbd3y9YIep0m5d6DoAwGowrPrKjq8X7jC1+vKyVAMAMIYm2uROWWjBwFTVblqecgAAxs78oGZv3fHCgoFpfmLyS0m2LEdFAABj5pvXP+nyu3e8sOAepptOeu+mJ1/3k19NctKylAUAMCZacn1aasdre5rDlJZ8dulLAgAYL9XaZ3a9tsfANEx9amnLAQAYP22BDLTHwDTR5RNLWw4AwNiZa/N19a4X9xiYNk/lC3GmHACwqrSvXnPa2bfvenXho1GS3HLiZfc8+brnXZe0ZyxtYQAAY6Lqk2nTw10v77HDlCSV9pGlqwgAYLy0rhbMPnvsMCVJtfxzKv9+aUoCABgrwz01ix60w7R2Jp9Oct+SlAQAMF5um1mTLy30gwcNTJ8947I7kly3JCUBAIyXj99y4mUzC/3gQQNTWiotVyxJSQAAY6VduaefPHhgSlIZXr64xQAAjJ3ZVvWhPf2wNzANJtZ+Lsm3F7UkAIDxcuPJN2y8dU8/7A1MN5303k1JPrqYFQEAjJNW+eClL7p0sKefP+hYgR+o96Xazy1WUQAA46S6vP/Bft7bYUqSVsN/SrJpUSoCABgnldvnJ6b+5cHe0vbyRu2U6573T0nOWYSyAADGyTuuP/UfL3iwN+xVhykt1VJ/uyglAQCMkWG1d/e9Zy/3MCWDieH722DiDUk2HFBVAADj45s1Ndt7du7edZiS3HDyM7+U5FMHVBIAwDhpufzGk6+8s+9tex2Y0qaHrdq7DqgoAIDxUV21v9qbN+59YErS2uCyJHfvV0kAAGOkJbfOTU39j7157z4Fpuue/IHbUtnjOSsAACtFtbxn+4DuXvsUmNJS1eqtSYb7URcAwLjYWoN6596+ed8CU5K5dd1Hkty8r58DABgf9alD5u64dm/fvc+B6ZYTL7snyX/f188BAIyNyluvPuvqub19+z4HpiSZqOG7YvM3ALAStdzaJiYu25eP7FdguvbUD9yU1vbpQQAAY+Jd15/y/m/tywf2etL3Tloqnx/+abq8MMm6/boHAMDyu6urwdv39UP7F5iStMnDPlmDez6a5Nz9vQcAwHJqlX+47rQrbtznzx3IQ0/5/PN+Ztjqb5JMHch9AACWwaZUd94Np1/2iX394H7tYbrfRIZXJtmrCZkAAKNUaZc/7K4tn96fzx5QYLrm9A/c11X9cZK9/loeAMAI3NdV/dFVz7lqfn8+fECBKUnm1667vFU+eqD3AQBYQu9fP3fHPi/F3e+AA9NNJ71307CrP0iy9UDvBQCwBO5OdX+wL4Mqd3XAgSlJ7t10+JWttQ8uxr0AABZVy/93w00b/+XAbrFITrrm+T/aMvy7JIcv1j0BAA7Q7cPWnn/Tqf94zYHcZFE6TEmyYfY7H0/LpYt1PwCARfCWm578j3t9yO6eLFpguvqsq+faIH+Y5NbFuicAwAG4Zq66N6elDvRGixaYkuQLT7n8+lT7r0mGi3lfAIB9NFtpb7rl9MtuW4ybLWpgSpKpDN+WZL+/tgcAsAg+OL++vXuxbrZom753dNLnz/vp1vKO2AAOACy/b3bD4Yuuf8oVizYnctE7TEkyMXn45Un7f5fi3gAAD2JYLf/P9ac/6+OLedMl6TAlySnXP/eEwaDeneTUpXoGAMCOKvlIN9l+/oYnXf7NxbzvknSYkuT6U3BtjmwAAAobSURBVC6/pVq9Mcm9S/UMAIAdfLeS31nssJQsYWBKko0z697dqizNAQBLbdBa3nzo7J1XLMXNl2xJ7n7bluaGf5lqT13qZwEAq1TlgzWsC2/6oQ/evhS3X9IOU7Jtaa6l/XaSO5f6WQDAqvS1dPWGpQpLyTIEpiTpJg5/f6v8SZL9PiUYAGABW1rLH9546jM/spQPWZbAdP0pl85OTAz+ryTvXY7nAQCrQ6W9c2Z2+Odp00t6ysiyBKYkue7UK7+9fWnugE4LBgBIkpb20W44fOOXz7ri+0v9rGULTElyw+mXf6aqvSHJt5fzuQDAQecr6ep/v+GMD35xOR62rIEpSTbO3/GeVP4wyeblfjYAcFC4q5Lfv+HJz7hyuR647IHp6rOunltXs3+aan+RZLDczwcAVrSZlvzJxrm1b1vqfUs7WvbAlCSfO+Oq77XhxO+35O9H8XwAYEWqVPur2eSPrj7rfcu6UrXkgysfzEnXnHdmq/rDSp41yjoAgJWg/r4y+eqbTv/Hm5b7ySMNTEnyhGvOPbdV+4M4pBcA2LOP1nD4qpvPuPJfRvHwiVE8dEd3/tcvf+WY7zz+jiRnJTly1PUAAGPn2mr1upufcuVHR1XASPYw7aSlbrrxiHdX8ttJvj7qcgCAsXJzWv7zzadesWzfiFvI6ANTkrzo0sGhc3e9rdJ+N8mSnQMDAKwoX67K/3HTjUe8Oy01ykLGIzBl27iB2cNm/zzJG5N8Z9T1AAAj9dVUe8Mj7577q7zo0pGPIRqbwJQktz72qq0b59b9t5b6/aR9a9T1AAAj8bVUfnfj/J3vuOo5V82PuphkDL4lt5DTPn/ehq0tF7WqVyd55KjrAQCWzZdba783v37ibbeceNnMqIu538i/JbeQb//pl+bWv/yhn187NbU5rZ2S5PBR1wQALLmbU/XbG+fuevv1p354dtTF7GgsO0z3O/4r56xb9/2pf1PJryc5cdT1AABL5tokb3zE3XPvGpdluB2NdWBKklOuP3/N/Nz3XtSSV1VyxqjrAQAW3cdaqzfdeNORfzsOG7wXMvaBKUlS090Tr/nYT6VySZJzRl0OALAoKpV/rKo/uPmMK64c9eiAB7MyAtN2J3323HOq5deS9tMZ0/1XAMBemU1rf1PV/s+bn3L5p0ZdTJ8VFZiS5Amfee7p3UT9SlX9QpINo64HANhnd6e1tyXdn47iIN39seICU5Kc8ulzHz0/2V6Z5Jdi7AAArCRfqdSbB6378y+d/oEVM6h6RQamJDnhE88/bGL93EtT7cKknjbqegCAXh9L8paN8+v/+9VnvW/zqIvZFys2MCXJOR86Z/L2I6bOS1cXpvIzSdaOuiYAYDdbWst7apC/uPmMZ/1T2vRw1AXtqxUdmO53wueec8pETVxYLS9N8ohR1wMAPODrqXpH1/K2G59y5c2jLmZ/HRSBKUlO+uSPHz1ck59Pay9J8swcRL8bAKxAw6SuSuv+an6uLv3yWVd8f9QFHYiDK1T89fkTTzjh7uekay9O6oVJjhx1SQCwCn23Kn/Tuvqrm0979sdW4hLcrg6uwLTd4z597qMnJvLzrbX/Kamn5iD9PQFgzAyT/I/W2qXdXPfXN5x1+TdHXdBiOWiDxAlffP7absvMj2XQXpjWfjbJQ0ZdEwAcxG6vyt8l9Z5jvzf40DieB3cgDtrAdL/HX3veo7rB8F8leWFLnpVkctQ1AcBBZLYlVw3T3rNmau5vrz/lqm+NuqClcNAHpiTJX58/ccIJ33vWxES9oJKfSuXkUZcEACte5Zqk/cOwhu+75Yxnf/Jg2Ku0J6sjMG33uE+fe/jUZJ5brf1kqn4ylukAYH98M1X/kNa9v63bfMVNJ31s06gLWmqrKjDd76TPPu/4YQYvSKtzkzwnyeGjrgkAVoC7WvKhYdoV1eb+/pbTr7pt1AUtl1UZmJIklXbi537i9HR1birndsmzKzlk1GUBwBi6Ny0fTuWKrssVN556xXVpqVEXtZxWb2C631+fP3HCCXc9rXXtx1vajyT1jCQbRl0WAIyBTZV8vCVXperKm7941GfyoksHoy5qFASm7U65/vw1g9k7zxp27Ucz7J6dVk+PwZcArE53J/lYq/rIoGsfPnzu7quvPuvquVEXNUoC0y7O/PSZU5smDz+jVfeManl6Umcn7fgRlwUAy+ErqXyide2TGeRjj/j+3OcOtnlK+0tg2pNKe8LV5z2xJurpaXV2q/ZDaXVaKutGXRoALKItSbu2Ule3yifaxOCTN532oZtX2x6lPgLTXnjstT/+sKn57sxq9UNtmDPSckaS4+O/HwArU2VbN+lz1fKZlvbZQdc+/aXTP/CdURc2rvyFvw/O/PSZU/e2I06uLmcMW05t1U5N6tQkjxh1bQDQp7V8qyrXVuXaLu3zrepzj7hn8AXLbv0Epv10wieef1jWzJ7Sde3UyvDJqXZSKiel5bj47wrAeKgk30hyY1rdkGG+0LW6dm4wcd2Xz7ri+6MubiXxF/siOOX65x41Pzt78qC6k1prJ6XqiWk5IcnjkqwddX0ArCozSW5N8sWk3VhVN3Zdu6mbqRtuPPvKO0dc24olMC2yU64/Z+PMfPeEVHdCV3VCJScm9dikPTbJsUkmRl0jAAeVYZLbsy0k3ZLULa3alwY1/OLkhtmbV8OxJctBYFpKNd099rMfflTXtce1tMd2qccMK8e3bRvGj8u2AKUDBcC+mKvk9lb5Wmv5alXdWmm3duluncvglq+c8SNfP5gPwR0VgWkZnfnpM6funTr6uPkaHD8xbI9Kq+MqdVzSHVupR7bkoWl5qNEFAGy3JZU70nJHkm+ktduSfCM1vK3r8rXBXL66dv3RX7/+lEtnR13owU5gGqVKe/w15z2k1fDYVnlktTwswzy0tRzdWh1Zwzqy0o5oLRvT6rBU25jk0CQbY2kP4GCwJal7k3ZPknuTbEraXam6PyTdWZU7k+F3JzJ5+8z83G23PvWc7+ggLT+BaQyd9vnzNmzO7JET8xNHDVsd0ZIN6dphw2E2pmuHtWFtTMuhSW1srdtYqUOqckhLHZK09VVZ31rWJVmfZF22LfutTbJmpL8YwMGsZWsqs0m2VrKlJVuTbEmyJa02p7r7qmpLS+5Ly6ak3ZvUPZXcm6pNXWubUt2m4cTg7uFcd8fWrL/j9rPet3nEvxXbCUwr1GmfP2/Dpm6wcarahi7ZMBwO1w+rO6TL4JBqE+uqan0q67qu1mfY1qZlTdLWprKuWta21JphsqZr266N+vcBWDFatg6rZpLMpDLTdTWb6maGla3pMpOqmdZqSxu2LWnZOmxtS9dq8zB1Xzc3uXk+w83za7Zuetydk5vMP1o5BKZV5riP//D6NWs2rGlT3dqW2TVdm1wzHA7Wj7ougBVh2FU32bZmOJwZDtfOZjYzOTozt5x42cyoSwMAAAAAxtn/D9APxJ0/UvToAAAAAElFTkSuQmCC"/>
</defs>
<g id="surface2">
<use xlink:href="#image5" transform="matrix(0.054145,0,0,0.054145,0.054145,0)"/>
<path style=" stroke:none;fill-rule:evenodd;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 24.355469 7.726562 C 22.222656 5.585938 19.378906 4.410156 16.355469 4.40625 C 10.117188 4.40625 5.042969 9.484375 5.042969 15.71875 C 5.039062 17.714844 5.5625 19.660156 6.550781 21.375 L 4.945312 27.238281 L 10.945312 25.664062 C 12.597656 26.566406 14.457031 27.039062 16.351562 27.042969 L 16.355469 27.042969 C 22.589844 27.042969 27.664062 21.964844 27.667969 15.730469 C 27.667969 12.707031 26.492188 9.863281 24.355469 7.726562 Z M 16.355469 25.132812 L 16.351562 25.132812 C 14.664062 25.128906 13.007812 24.675781 11.566406 23.820312 L 11.222656 23.617188 L 7.664062 24.550781 L 8.613281 21.082031 L 8.390625 20.722656 C 7.449219 19.226562 6.949219 17.496094 6.953125 15.71875 C 6.953125 10.535156 11.171875 6.320312 16.359375 6.320312 C 18.871094 6.320312 21.230469 7.296875 23.003906 9.074219 C 24.78125 10.851562 25.757812 13.214844 25.757812 15.726562 C 25.753906 20.914062 21.535156 25.132812 16.355469 25.132812 Z M 21.511719 18.089844 C 21.230469 17.945312 19.839844 17.261719 19.582031 17.167969 C 19.320312 17.074219 19.132812 17.027344 18.945312 17.3125 C 18.757812 17.59375 18.214844 18.230469 18.050781 18.417969 C 17.882812 18.609375 17.71875 18.632812 17.4375 18.488281 C 17.152344 18.347656 16.242188 18.050781 15.164062 17.085938 C 14.324219 16.335938 13.757812 15.410156 13.589844 15.128906 C 13.425781 14.84375 13.574219 14.691406 13.714844 14.550781 C 13.84375 14.425781 13.996094 14.222656 14.140625 14.054688 C 14.28125 13.890625 14.328125 13.773438 14.421875 13.585938 C 14.515625 13.394531 14.46875 13.230469 14.398438 13.089844 C 14.328125 12.949219 13.761719 11.554688 13.527344 10.992188 C 13.296875 10.441406 13.066406 10.515625 12.890625 10.503906 C 12.726562 10.496094 12.539062 10.496094 12.347656 10.496094 C 12.160156 10.496094 11.855469 10.566406 11.59375 10.847656 C 11.335938 11.132812 10.605469 11.816406 10.605469 13.207031 C 10.605469 14.597656 11.617188 15.941406 11.761719 16.132812 C 11.902344 16.320312 13.753906 19.175781 16.589844 20.398438 C 17.261719 20.691406 17.789062 20.863281 18.199219 20.996094 C 18.878906 21.210938 19.492188 21.179688 19.980469 21.105469 C 20.523438 21.027344 21.652344 20.421875 21.890625 19.761719 C 22.125 19.101562 22.125 18.535156 22.054688 18.417969 C 21.984375 18.300781 21.792969 18.230469 21.511719 18.089844 Z M 21.511719 18.089844 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
      

      
      
      <li>
        <a href="mailto:?subject=Tutorial%20for%20CIoT%20Open%20Data%20Applications - 6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2.&amp;body=6.1.%20%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e5%88%9d%e6%8e%a2%2c%20by%20Tutorial%20for%20CIoT%20Open%20Data%20Applications%0a%e6%88%91%e5%80%91%e4%bd%bf%e7%94%a8%e7%a9%ba%e5%93%81%e5%92%8c%e6%b0%b4%e4%bd%8d%e9%a1%9e%e5%88%a5%e8%b3%87%e6%96%99%ef%bc%8c%e7%b5%90%e5%90%88%e5%a4%a9%e6%b0%a3%e8%a7%80%e6%b8%ac%e8%b3%87%e6%96%99%ef%bc%8c%e5%88%a9%e7%94%a8%e8%b3%87%e6%96%99%e9%9b%86%e7%9a%84%e6%99%82%e9%96%93%e6%ac%84%e4%bd%8d%e9%80%b2%e8%a1%8c%e9%80%a3%e7%b5%90%ef%bc%8c%e5%b8%b6%e5%85%a5%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e7%9a%84%e5%a5%97%e4%bb%b6%ef%bc%8c%e9%80%b2%e8%a1%8c%e8%b3%87%e6%96%99%e5%88%86%e9%a1%9e%e8%88%87%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e7%9a%84%e5%88%86%e6%9e%90%e3%80%82%e6%88%91%e5%80%91%e5%b0%87%e7%a4%ba%e7%af%84%e6%a9%9f%e5%99%a8%e5%ad%b8%e7%bf%92%e7%9a%84%e6%a8%99%e6%ba%96%e6%b5%81%e7%a8%8b%ef%bc%8c%e4%b8%a6%e4%b8%94%e4%bb%8b%e7%b4%b9%e5%a6%82%e4%bd%95%e9%80%8f%e9%81%8e%e8%b3%87%e6%96%99%e5%88%86%e9%a1%9e%e9%80%b2%e4%b8%80%e6%ad%a5%e9%80%b2%e8%a1%8c%e8%b3%87%e6%96%99%e9%a0%90%e6%b8%ac%ef%bc%8c%e4%bb%a5%e5%8f%8a%e5%a6%82%e4%bd%95%e9%80%8f%e9%81%8e%e8%b3%87%e6%96%99%e5%88%86%e7%be%a4%e9%80%b2%e8%a1%8c%e5%b0%8d%e8%b3%87%e6%96%99%e9%80%b2%e4%b8%80%e6%ad%a5%e7%9a%84%e6%b7%b1%e5%85%a5%e6%8e%a2%e7%a9%b6%e3%80%82%0a%0ahttps%3a%2f%2fLearnCIOT.github.io%2fch6%2fch6.1%2f%0a" target="_blank" class="share-btn email">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="32px" viewBox="0 0 32 32" version="1.1">
<defs>
<filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%">
  <feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"/>
</filter>
<mask id="mask0">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip1">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface5" clip-path="url(#clip1)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 26 22 C 26 23.101562 25.101562 24 24 24 L 8 24 C 6.898438 24 6 23.101562 6 22 L 6 12 C 6 10.898438 6.898438 10 8 10 L 24 10 C 25.101562 10 26 10.898438 26 12 Z M 26 22 "/>
</g>
<mask id="mask1">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip2">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface8" clip-path="url(#clip2)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 17.75 15.101562 C 16.800781 14.050781 15.199219 14.050781 14.25 15.101562 L 6.5 21.601562 C 6.398438 21.699219 6.351562 21.800781 6.25 21.898438 C 6.601562 22.550781 7.25 23 7.949219 23 L 23.949219 23 C 24.699219 23 25.300781 22.550781 25.648438 21.898438 C 25.601562 21.800781 25.5 21.699219 25.398438 21.601562 Z M 17.75 15.101562 "/>
</g>
<mask id="mask2">
  <g filter="url(#alpha)">
<rect x="0" y="0" width="32" height="32" style="fill:rgb(0%,0%,0%);fill-opacity:0.2;stroke:none;"/>
  </g>
</mask>
<clipPath id="clip3">
  <rect x="0" y="0" width="32" height="32"/>
</clipPath>
<g id="surface11" clip-path="url(#clip3)">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(13.72549%,12.156863%,12.54902%);fill-opacity:1;" d="M 6.300781 10.101562 C 6.648438 9.449219 7.300781 9 8 9 L 24 9 C 24.75 9 25.351562 9.449219 25.699219 10.101562 C 25.648438 10.199219 25.550781 10.300781 25.449219 10.398438 L 17.75 16.898438 C 16.800781 17.949219 15.199219 17.949219 14.25 16.898438 Z M 6.300781 10.101562 "/>
</g>
</defs>
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(46.666667%,70.196078%,83.137255%);fill-opacity:1;" d="M 32 16 C 32 24.835938 24.835938 32 16 32 C 7.164062 32 0 24.835938 0 16 C 0 7.164062 7.164062 0 16 0 C 24.835938 0 32 7.164062 32 16 Z M 32 16 "/>
<use xlink:href="#surface5" mask="url(#mask0)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 26 21 C 26 22.101562 25.101562 23 24 23 L 8 23 C 6.898438 23 6 22.101562 6 21 L 6 11 C 6 9.898438 6.898438 9 8 9 L 24 9 C 25.101562 9 26 9.898438 26 11 Z M 26 21 "/>
<use xlink:href="#surface8" mask="url(#mask1)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(87.843137%,87.843137%,81.960784%);fill-opacity:1;" d="M 17.75 16 C 16.800781 15.050781 15.199219 15.050781 14.25 16 L 6.5 21.75 C 6.398438 21.851562 6.351562 21.898438 6.25 22 C 6.601562 22.601562 7.25 22.949219 7.949219 22.949219 L 23.949219 22.949219 C 24.699219 22.949219 25.300781 22.550781 25.648438 22 C 25.601562 21.898438 25.5 21.851562 25.398438 21.75 Z M 17.75 16 "/>
<use xlink:href="#surface11" mask="url(#mask2)"/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 14.25 16 C 15.199219 16.949219 16.800781 16.949219 17.75 16 L 25.5 10.25 C 25.601562 10.148438 25.648438 10.101562 25.75 10 C 25.398438 9.398438 24.75 9.050781 24.050781 9.050781 L 8 9.050781 C 7.25 9.050781 6.648438 9.449219 6.300781 10 C 6.351562 10.101562 6.449219 10.148438 6.550781 10.25 Z M 14.25 16 "/>
</g>
</svg>

          <p>Email</p>
        </a>
      </li>
    </ul>
  </section>
  



<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCH7EJS8LE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ZCH7EJS8LE', { 'anonymize_ip': false });
}
</script>



          <article class="default">
<h1>6.1. 機器學習初探</h1>

<p><a href="https://colab.research.google.com/drive/14xfpf7Nv_1uadSeJh3vC61HL7r4z6KT8?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<div>
    <h2>Table Of Contents</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#基本介紹">基本介紹</a>
      <ul>
        <li><a href="#分類問題-classification">分類問題 (Classification)</a></li>
        <li><a href="#分群問題-clustering">分群問題 (Clustering)</a></li>
      </ul>
    </li>
    <li><a href="#套件安裝與引用">套件安裝與引用</a></li>
    <li><a href="#案例一空品資料的場所型態分類">案例一：空品資料的場所型態分類</a>
      <ul>
        <li><a href="#資料清理">資料清理</a></li>
        <li><a href="#移除離群值">移除離群值</a></li>
        <li><a href="#區別訓練資料與測試資料">區別訓練資料與測試資料</a></li>
        <li><a href="#使用-sklearn-預建模型">使用 Sklearn 預建模型</a></li>
      </ul>
    </li>
    <li><a href="#案例二空品資料的分群">案例二：空品資料的分群</a>
      <ul>
        <li><a href="#資料下載與前處理">資料下載與前處理</a></li>
        <li><a href="#動態時間校正-dynamic-time-warping-dtw">動態時間校正 (Dynamic Time Warping, DTW)</a></li>
        <li><a href="#使用-k-mean-分群演算法">使用 K-Mean 分群演算法</a></li>
        <li><a href="#探究資料分群與地理位置的關係">探究資料分群與地理位置的關係</a></li>
        <li><a href="#探究資料分群與風場風向的關係">探究資料分群與風場風向的關係</a></li>
      </ul>
    </li>
    <li><a href="#案例三結合氣象與水資源資料的分類與分群">案例三：結合氣象與水資源資料的分類與分群</a>
      <ul>
        <li><a href="#資料下載與前處理-1">資料下載與前處理</a></li>
        <li><a href="#計算特定淹水感測器與雨量測站資料的相似度">計算特定淹水感測器與雨量測站資料的相似度</a></li>
        <li><a href="#資料分群並探究相關性高的雨量站">資料分群並探究相關性高的雨量站</a></li>
        <li><a href="#資料分類並由雨量計資料預測淹水可能性">資料分類並由雨量計資料預測淹水可能性</a></li>
      </ul>
    </li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
</div>

<h2 id="基本介紹">基本介紹</h2>
<p>我們在之前的章節中，已經介紹民生公共物聯網豐富的開放資料內容，同時介紹從時間維度與空間維度的角度出發，進行各種不同的資料分析與處理，在這個章節中，我們將進一步初探機器學習的應用，介紹兩個經典的機器學習問題，分別是分類問題 (Classification) 與分群問題 (Clustering)。</p>
<h3 id="分類問題-classification">分類問題 (Classification)</h3>
<p>分類問題是機器學習理論中的一個經典問題，若用比較數學的方式來描述這個問題，我們可以假設有一組已經分類好的數據 <code>X</code>，以及每一筆資料在分類之後所得到的標籤集合 <code>Y</code>，而分類問題就是希望能透過這組分類好的數據與標籤，建構一個有效的分類器 (Classifier)，可以將尚未分類的數據 <code>X’</code>，並找到其中每一筆資料相對應的標籤 <code>Y’</code>。</p>
<p>因此，分類問題的重點，就是要構造一個有效的分類器 (Classifier)，為了達到這個目的，我們會先建立一個模型，利用已經標籤好 (labeled) 的數據進行訓練，並且讓這個模型盡可能地貼近與適應 (fit) 這些數據分佈狀態，完成訓練後，我們再利用此模型作為分類器，用來推測未知數據的標籤。</p>
<p>這個建立分類器的過程，在機器學習中被稱為監督式學習 (supervised learning)，而常見的分類器模型有 <em><a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">Nearest Neighbors</a></em>、<em><a href="https://en.wikipedia.org/wiki/Support-vector_machine">SVM Classifier</a></em>、<em><a href="https://en.wikipedia.org/wiki/Decision_tree">Decision Tree</a></em>、*<a href="https://en.wikipedia.org/wiki/Random_forest">Random Forest</a> *****等，在我們稍後的文章中，我們並不會針對每一種模型進行深入的講解，只會把這些模型直接拿來當作工具使用，對於這些模型有興趣的讀者，可以參考相關資源，自行再做更深入的探究。</p>
<h3 id="分群問題-clustering">分群問題 (Clustering)</h3>
<p>分群問題和分類問題非常相似，主要差異在於分類問題是用已知的標籤數據資料推論未知的數據資料，而分群問題則是完全「無中生有」，在沒有事先標籤的情況下，根據數據的特徵自動將它們歸類出不同的群組。</p>
<p>若以比較數學的方式來描述這個問題，我們可以假設有一組完全沒有標記的數據 <code>X</code>，而分類問題就是希望能透過某種演算法，將 <code>X</code> 的資料區分為 <code>k</code> 個群組，其中每一個群組內的資料彼此相似度大，而不同群組的資料彼此相異度大。</p>
<p>因此，分群問題的演算法主要就是根據數據的特性，不斷地判斷資料間的相似與相異度，並且讓相似的資料群聚在一起，讓相異的資料在分佈中彼此互斥，而常見的分群演算法有 <a href="https://en.wikipedia.org/wiki/K-means_clustering">K-Means</a>、<a href="https://en.wikipedia.org/wiki/DBSCAN">DBSCAN</a>、<a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">Hierarchical Clustering</a>、<a href="https://en.wikipedia.org/wiki/BIRCH">BIRCH</a> ******等，我們一樣不會針對每一種演算法進行深入的講解，只會把這些演算直接拿來當工具使用，對於這些模型有興趣的讀者，可以參考相關資源，自行再做更深入的探究。</p>
<h2 id="套件安裝與引用">套件安裝與引用</h2>
<p>在本章節中，我們除了使用 pyCIOT 套件獲取相關的民生公共物聯網開放資料外，將會使用到 pandas, numpy, matplotlib, json, os, glob, math, seaborn, warnings, tqdm, datetime,  geopy, scipy 等套件，這些套件由於在我們使用的開發平台 Colab 上皆已預先安裝好，因此不需要再另行安裝。然而，我們還會另外使用兩個 Colab 上並未預先安裝好的套件：fastdtw 和 sklearn，以及為了讓輸出的圖形美觀而使用 TaipeiSansTCBeta-Regular 字型，需使用下列的方式進行安裝：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 安裝 fastdtw 套件，用於快速動態時間扭曲。</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip3 install fastdtw <span style="color:#f92672">--</span>quiet
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安裝 scikit-learn 套件，用於機器學習。</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip3 install scikit<span style="color:#f92672">-</span>learn <span style="color:#f92672">--</span>quiet
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安裝 pyCIOT 套件。</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip3 install pyCIOT <span style="color:#f92672">--</span>quiet
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 從 Google Drive 下載 TaipeiSansTCBeta-Regular.ttf 字型檔案。</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>q <span style="color:#f92672">-</span>O TaipeiSansTCBeta<span style="color:#f92672">-</span>Regular<span style="color:#f92672">.</span>ttf https:<span style="color:#f92672">//</span>drive<span style="color:#f92672">.</span>google<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>uc<span style="color:#960050;background-color:#1e0010">?</span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>eGAsTN1HBpJAkeVM57_C7ccp7hbgSz3_<span style="color:#f92672">&amp;</span>export<span style="color:#f92672">=</span>download
</span></span></code></pre></div><p>待安裝完畢後，即可使用下列的語法先行引入相關的套件模組，完成本章節的準備工作：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 引入 pyCIOT 模組中的 data 模組。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pyCIOT.data <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入常用的模組。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json<span style="color:#f92672">,</span> os<span style="color:#f92672">,</span> glob<span style="color:#f92672">,</span> math
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib <span style="color:#66d9ef">as</span> mpl
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入字型管理相關模組，用於設定圖表字型。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.font_manager <span style="color:#f92672">import</span> fontManager
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm_notebook <span style="color:#66d9ef">as</span> tqdm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入日期時間相關模組。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入 seaborn 資料視覺化套件，並設定字型大小。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>set(font_scale<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 新增字型，並設定 matplotlib 的預設字型。</span>
</span></span><span style="display:flex;"><span>fontManager<span style="color:#f92672">.</span>addfont(<span style="color:#e6db74">&#39;TaipeiSansTCBeta-Regular.ttf&#39;</span>)
</span></span><span style="display:flex;"><span>mpl<span style="color:#f92672">.</span>rc(<span style="color:#e6db74">&#39;font&#39;</span>, family<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Taipei Sans TC Beta&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 隱藏警告訊息。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> warnings
</span></span><span style="display:flex;"><span>warnings<span style="color:#f92672">.</span>simplefilter(action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入距離計算模組及 fastdtw 套件。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> geopy.distance
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial.distance <span style="color:#f92672">import</span> euclidean
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> fastdtw <span style="color:#f92672">import</span> fastdtw
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 引入 scikit-learn 相關模組，用於機器學習。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sklearn
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score, confusion_matrix
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.neural_network <span style="color:#f92672">import</span> MLPClassifier
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.neighbors <span style="color:#f92672">import</span> KNeighborsClassifier
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.svm <span style="color:#f92672">import</span> SVC
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.gaussian_process.kernels <span style="color:#f92672">import</span> RBF
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.tree <span style="color:#f92672">import</span> DecisionTreeClassifier
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> RandomForestClassifier, AdaBoostClassifier
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.naive_bayes <span style="color:#f92672">import</span> GaussianNB
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.discriminant_analysis <span style="color:#f92672">import</span> QuadraticDiscriminantAnalysis
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.cluster <span style="color:#f92672">import</span> KMeans
</span></span></code></pre></div><p>安裝與引入所需模組完畢後，我們接下來依照民生公共物聯網的空氣品質資料與水資源資料兩個案例解析，介紹資料分類與分群。</p>
<h2 id="案例一空品資料的場所型態分類">案例一：空品資料的場所型態分類</h2>
<p>在這個案例中，我們使用民生公共物聯網資料平台中，環保署智慧城鄉空品微型感測器 (‘<code>OBS:EPA_IoT</code>’) 的資料，進行資料分類的示範。</p>
<p>我們首先使用 pyCIOT 所提供的 <code>Air().get_data()</code> 方法，下載取得所有環保署智慧城鄉空品微型感測器的最近一筆感測資料。注意，由於內容數量龐大，因此這個步驟可能需要等待較長的時間。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 定義資料來源為環保署智慧城鄉空品微型感測器 (OBS:EPA_IoT)。</span>
</span></span><span style="display:flex;"><span>Source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;OBS:EPA_IoT&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 從 Air() 中獲取資料。</span>
</span></span><span style="display:flex;"><span>Data <span style="color:#f92672">=</span> Air()<span style="color:#f92672">.</span>get_data(src<span style="color:#f92672">=</span>Source)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 過濾 Data 資料，只保留 data 長度為 3 且 properties 中有 &#39;areaType&#39; 的資料點。。</span>
</span></span><span style="display:flex;"><span>Data <span style="color:#f92672">=</span> [datapoint <span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data <span style="color:#66d9ef">if</span> len(datapoint[<span style="color:#e6db74">&#39;data&#39;</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;areaType&#39;</span> <span style="color:#f92672">in</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>]<span style="color:#f92672">.</span>keys()]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 輸出過濾後的第一筆資料，以 JSON 格式顯示，且縮排為 4。</span>
</span></span><span style="display:flex;"><span>print(json<span style="color:#f92672">.</span>dumps(Data[<span style="color:#ae81ff">0</span>], indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>))
</span></span></code></pre></div><pre tabindex="0"><code>{
    &#34;name&#34;: &#34;智慧城鄉空品微型感測器-10287974676&#34;,
    &#34;description&#34;: &#34;智慧城鄉空品微型感測器-10287974676&#34;,
    &#34;properties&#34;: {
        &#34;city&#34;: &#34;新北市&#34;,
        &#34;areaType&#34;: &#34;社區&#34;,
        &#34;isMobile&#34;: &#34;false&#34;,
        &#34;township&#34;: &#34;鶯歌區&#34;,
        &#34;authority&#34;: &#34;行政院環境保護署&#34;,
        &#34;isDisplay&#34;: &#34;true&#34;,
        &#34;isOutdoor&#34;: &#34;true&#34;,
        &#34;stationID&#34;: &#34;10287974676&#34;,
        &#34;locationId&#34;: &#34;TW040203A0507221&#34;,
        &#34;Description&#34;: &#34;廣域SAQ-210&#34;,
        &#34;areaDescription&#34;: &#34;鶯歌區&#34;
    },
    &#34;data&#34;: [
        {
            &#34;name&#34;: &#34;Relative humidity&#34;,
            &#34;description&#34;: &#34;相對溼度&#34;,
            &#34;timestamp&#34;: &#34;2022-08-05T06:51:29.000Z&#34;,
            &#34;value&#34;: 70.77
        },
        {
            &#34;name&#34;: &#34;Temperature&#34;,
            &#34;description&#34;: &#34;溫度&#34;,
            &#34;timestamp&#34;: &#34;2022-08-05T06:51:29.000Z&#34;,
            &#34;value&#34;: 33.78
        },
        {
            &#34;name&#34;: &#34;PM2.5&#34;,
            &#34;description&#34;: &#34;細懸浮微粒 PM2.5&#34;,
            &#34;timestamp&#34;: &#34;2022-08-05T06:51:29.000Z&#34;,
            &#34;value&#34;: 9.09
        }
    ],
    &#34;location&#34;: {
        &#34;latitude&#34;: 24.9507,
        &#34;longitude&#34;: 121.3408416,
        &#34;address&#34;: null
    }
}
</code></pre><p>我們可以發現每一個感測器的資料中，都同時有溫度、相對濕度、細懸浮微粒濃度等感測資料，同時也記載了感測器的基本資訊，例如所在城市、所在鄉鎮、機器編號、位置編號、場所型態等。在我們這個範例中，我們將以「場所型態」為標籤資料，並搭配感測資料（溫度、相對濕度、細懸浮微粒濃度）進行分類器的訓練。我們首先觀察目前「場所型態」的內容狀態。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 從 Data 資料集中取得所有不重複的 &#39;areaType&#39; 標籤。</span>
</span></span><span style="display:flex;"><span>Label <span style="color:#f92672">=</span> list(dict<span style="color:#f92672">.</span>fromkeys([datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data <span style="color:#66d9ef">if</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>]]))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始化一個計數器，用於計算每個 &#39;areaType&#39; 的出現次數。</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> dict<span style="color:#f92672">.</span>fromkeys(Label, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 迴圈遍歷 Data 資料集，計算每個 &#39;areaType&#39; 的出現次數。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data:
</span></span><span style="display:flex;"><span>    count[datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>]] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 輸出資料清理前的記錄總數。</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Before data cleaning, There are </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> records.&#34;</span><span style="color:#f92672">.</span>format(len(Data)))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 JSON 格式輸出每個 &#39;areaType&#39; 的計數結果，且縮排為 4。</span>
</span></span><span style="display:flex;"><span>print(json<span style="color:#f92672">.</span>dumps(count, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>))
</span></span></code></pre></div><pre tabindex="0"><code>Before data cleaning, There are 8620 records.
{
    &#34;社區&#34;: 223,
    &#34;交通&#34;: 190,
    &#34;一般社區&#34;: 2021,
    &#34;工業&#34;: 12,
    &#34;測站比對&#34;: 66,
    &#34;工業區&#34;: 3333,
    &#34;交通區&#34;: 683,
    &#34;鄰近工業區社區&#34;: 948,
    &#34;輔助區&#34;: 165,
    &#34;特殊區(民眾陳情熱區)&#34;: 143,
    &#34;特殊區(敏感族群聚集區)&#34;: 200,
    &#34;特殊區(測站比對)&#34;: 32,
    &#34;輔助區(無測站區)&#34;: 4,
    &#34;工業感測&#34;: 196,
    &#34;特殊感測&#34;: 4,
    &#34;輔助感測&#34;: 295,
    &#34;交通感測&#34;: 102,
    &#34;機動感測&#34;: 2,
    &#34;社區感測&#34;: 1
}
</code></pre><h3 id="資料清理">資料清理</h3>
<p>由於目前資料中共有 8620 筆資料散佈在 19 種場所型態中，為了符合資料的意義，我們首先將類似的場所型態進行合併，同時也為了讓分類器的示範能更順利，我們只專注在一般社區、交通區、工業區、鄰近工業區社區等四大場所型態。因此，我們用下列的程式進行資料的重新整理：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 迴圈遍歷 Data 資料集，對 &#39;areaType&#39; 進行資料清理和重新命名。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;社區&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;一般社區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;社區感測&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;一般社區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;交通&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;交通區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;交通感測&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;交通區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;工業&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;工業區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;工業感測&#39;</span>:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;工業區&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 若 &#39;areaType&#39; 不在指定的四種類別中，則設為 None。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;一般社區&#39;</span>, <span style="color:#e6db74">&#39;交通區&#39;</span>, <span style="color:#e6db74">&#39;工業區&#39;</span>, <span style="color:#e6db74">&#39;鄰近工業區社區&#39;</span>]:
</span></span><span style="display:flex;"><span>        datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 過濾資料，去除 &#39;areaType&#39; 為 None 的資料點。</span>
</span></span><span style="display:flex;"><span>Data <span style="color:#f92672">=</span> [datapoint <span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data <span style="color:#66d9ef">if</span> datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>] <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定義我們希望計數的標籤。</span>
</span></span><span style="display:flex;"><span>Label <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;一般社區&#39;</span>, <span style="color:#e6db74">&#39;交通區&#39;</span>, <span style="color:#e6db74">&#39;工業區&#39;</span>, <span style="color:#e6db74">&#39;鄰近工業區社區&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始化一個計數器，用於計算每個 &#39;areaType&#39; 的出現次數。</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> dict<span style="color:#f92672">.</span>fromkeys(Label, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 迴圈遍歷 Data 資料集，計算每個 &#39;areaType&#39; 的出現次數。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data:
</span></span><span style="display:flex;"><span>    count[datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>]] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 輸出資料清理後的記錄數量。</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;After data cleaning, There are </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> records.&#34;</span><span style="color:#f92672">.</span>format(len(Data)))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 JSON 格式顯示每個 &#39;areaType&#39; 的計數結果，且縮排為 4。</span>
</span></span><span style="display:flex;"><span>print(json<span style="color:#f92672">.</span>dumps(count, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>))
</span></span></code></pre></div><pre tabindex="0"><code>After data cleaning, There are 7709 records.
{
    &#34;一般社區&#34;: 2245,
    &#34;交通區&#34;: 975,
    &#34;工業區&#34;: 3541,
    &#34;鄰近工業區社區&#34;: 948
}
</code></pre><p>經過資料清理後，總共剩下 7709 筆資料，並且散佈在四大類的場所型態中。針對這些資料，我們接著考慮每筆資料的溫度、相對濕度、細懸浮微粒濃度感測值，並用不同的顏色代表不同場所型態的資料，繪製成一張三維的資料分佈圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 初始化存放資料的列表。</span>
</span></span><span style="display:flex;"><span>DataX, DataY <span style="color:#f92672">=</span> [], []
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 迴圈遍歷 Data 資料集，從每一個資料點中提取特徵和標籤。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> Data:
</span></span><span style="display:flex;"><span>    TmpX <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">3</span>  <span style="color:#75715e"># 初始化暫存特徵列表。</span>
</span></span><span style="display:flex;"><span>    TmpY <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># 初始化暫存標籤值。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> rawdata_array <span style="color:#f92672">in</span> datapoint[<span style="color:#e6db74">&#39;data&#39;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 提取資料點名稱為 &#39;Temperature&#39; 的值。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(rawdata_array[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Temperature&#39;</span>):
</span></span><span style="display:flex;"><span>            TmpX[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> rawdata_array[<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;value&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 提取資料點名稱為 &#39;Relative humidity&#39; 的值。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(rawdata_array[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Relative humidity&#39;</span>):
</span></span><span style="display:flex;"><span>            TmpX[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> rawdata_array[<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;value&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 提取資料點名稱為 &#39;PM2.5&#39; 的值。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(rawdata_array[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;PM2.5&#39;</span>):
</span></span><span style="display:flex;"><span>            TmpX[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> rawdata_array[<span style="color:#e6db74">&#39;values&#39;</span>][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;value&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 將 &#39;areaType&#39; 轉換為整數索引。</span>
</span></span><span style="display:flex;"><span>    TmpY <span style="color:#f92672">=</span> Label<span style="color:#f92672">.</span>index(datapoint[<span style="color:#e6db74">&#39;properties&#39;</span>][<span style="color:#e6db74">&#39;areaType&#39;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 將暫存的特徵和標籤加入至 DataX 和 DataY 列表。</span>
</span></span><span style="display:flex;"><span>    DataX<span style="color:#f92672">.</span>append(TmpX)
</span></span><span style="display:flex;"><span>    DataY<span style="color:#f92672">.</span>append(TmpY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將 DataX 和 DataY 列表資料轉換為 Numpy 陣列。</span>
</span></span><span style="display:flex;"><span>DataX_Numpy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(DataX)
</span></span><span style="display:flex;"><span>DataY_Numpy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(DataY)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 設定圖例字體大小。</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>rc(<span style="color:#e6db74">&#39;legend&#39;</span>,fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xx-small&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 創建一個 8x6 大小，150 dpi 的圖形。</span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">6</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 迴圈遍歷每一種標籤，並在 3D 空間中繪製對應的資料點。</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(Label)):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">0</span>],DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">1</span>],DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">2</span>], s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, label<span style="color:#f92672">=</span>Label[i])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示圖例。</span>
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>legend() 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 設定 X 軸標籤為 Temperatur， y 軸標籤為 Relative humidity， z 軸標籤為 PM2.5。</span>
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;Temperature&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Relative humidity&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_zlabel(<span style="color:#e6db74">&#39;PM2.5&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 顯示圖形。</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="figures/6-1-3-1.png" alt="Python output"></p>
<p>從資料分布圖中，我們可以發現絕大多數的資料都群聚在某一個特定的空間內，但仍有少數的資料零散地分布在很外圍的地方，這些遠離群體的資料我們稱為離群值 (Outlier)，對於資料分類或資料分群而言，離群值很容易導致我們的模型或演算法走向極端化，因而失去其通用性，因此我們需要先將這些資料予以移除。</p>
<h3 id="移除離群值">移除離群值</h3>
<p>移除離群值的方法，不外乎運用一些資料的統計特徵，可以依據不同的應用情境需求自行定義。在我們的範例中，我們定義如果一筆資料在其中一種感測資料的數值，距離平均值超過兩個標準差以上，該筆資料便歸類為離群值。我們將這些離群值的資料移除後，照例繪製一張三維空間的分佈圖觀察其分布狀況。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Outlier_Filter</span>(arr, k):
</span></span><span style="display:flex;"><span>    Boolean_Arr <span style="color:#f92672">=</span>  np<span style="color:#f92672">.</span>ones(arr<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], dtype<span style="color:#f92672">=</span>bool)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(arr<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
</span></span><span style="display:flex;"><span>        Boolean_Arr <span style="color:#f92672">=</span> Boolean_Arr <span style="color:#f92672">&amp;</span> (abs(arr[:,i] <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>mean(arr[:,i])) <span style="color:#f92672">&lt;</span>  k<span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>std(arr[:,i]))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Boolean_Arr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OutlierFilter <span style="color:#f92672">=</span> Outlier_Filter(DataX_Numpy, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>DataX_Numpy <span style="color:#f92672">=</span> DataX_Numpy[OutlierFilter]
</span></span><span style="display:flex;"><span>DataY_Numpy <span style="color:#f92672">=</span> DataY_Numpy[OutlierFilter]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;After removing Outliers, there are </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> records left.&#34;</span><span style="color:#f92672">.</span>format(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>rc(<span style="color:#e6db74">&#39;legend&#39;</span>,fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xx-small&#34;</span>)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">6</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(Label)):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">0</span>],DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">1</span>],DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">2</span>], s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, label<span style="color:#f92672">=</span>Label[i])
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;Temperature&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Relative humidity&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_zlabel(<span style="color:#e6db74">&#39;PM2.5&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre tabindex="0"><code>After removing Outliers, there are 7161 records left.
</code></pre><p><img src="figures/6-1-3-2.png" alt="Python output"></p>
<p>從最後呈現的結果中，我們共移除了 7709 - 7161 = 548 筆離群值資料，而最後留下的資料在三維空間的分佈也較為集中，不再有偏移在外圍的狀況發生。為了更容易觀察，我們以每次挑選兩個維度的方式，分別繪製三張資料在不同維度間的分佈狀況。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>rc(<span style="color:#e6db74">&#39;legend&#39;</span>,fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;large&#34;</span>)
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(Label)):
</span></span><span style="display:flex;"><span>        axes[i]<span style="color:#f92672">.</span>scatter(DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>j][:,i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>],DataX_Numpy[DataY_Numpy<span style="color:#f92672">==</span>j][:,(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>], s<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, label<span style="color:#f92672">=</span>Label[j])
</span></span><span style="display:flex;"><span>        axes[i]<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        Axis_label <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Temperature&#39;</span>, <span style="color:#e6db74">&#39;Relative humidity&#39;</span>, <span style="color:#e6db74">&#39;PM2.5&#39;</span>]
</span></span><span style="display:flex;"><span>        axes[i]<span style="color:#f92672">.</span>set_xlabel(Axis_label[i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>        axes[i]<span style="color:#f92672">.</span>set_ylabel(Axis_label[(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span></code></pre></div><p><img src="figures/6-1-3-3.png" alt="Python output"></p>
<p>從這三張圖中，我們已可發現不同顏色（場所型態）的資料隱約中似乎存在某種關係，雖然用肉眼很難直接敘明，但接下來我們將帶入分類模型來建構專屬的分類器。</p>
<h3 id="區別訓練資料與測試資料">區別訓練資料與測試資料</h3>
<p>在進入分類器的模型訓練前，我們還有一個步驟需要處理，那就是拆分數據，將現有的資料集分為訓練資料和測試資料。顧名思義，訓練資料將被用於調校分類器的模型，而測試資料則是用來測試所建構出來的分類器，在處理新資料時的效果。我們使用下列的範例程式，將資料集按照 4:1 的比例，切割成訓練資料與測試資料。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>indices <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>permutation(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>Train_idx, Test_idx <span style="color:#f92672">=</span> indices[:int(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">0.8</span>)], indices[<span style="color:#ae81ff">80</span>:(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> int(DataX_Numpy<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">0.8</span>))]
</span></span><span style="display:flex;"><span>TrainX, TestX <span style="color:#f92672">=</span> DataX_Numpy[Train_idx,:], DataX_Numpy[Test_idx,:]
</span></span><span style="display:flex;"><span>TrainY, TestY <span style="color:#f92672">=</span> DataY_Numpy[Train_idx], DataY_Numpy[Test_idx]
</span></span></code></pre></div><h3 id="使用-sklearn-預建模型">使用 Sklearn 預建模型</h3>
<p>我們直接使用 Scikit learn (sklearn) 這個 Python 套件所提供的分類器模型來進行訓練與測試，在系列的程式範例中，我們總共使用 Nearest neighbors, Linear SVM, RBF SVM, Decision Tree, Random Forest, Neural Net, Adaboost, Naive Bayes, QDA 共計九種模型，我們依次帶入訓練資料進行調校後，接著帶入測試資料進行預測，並且將測試資料與預測結果中的標籤內容進行比對，並用混淆矩陣 (confusion matrix) 的方式，呈現不同標籤組合的分類結果。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>classifier_names <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Nearest Neighbors&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Linear SVM&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;RBF SVM&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Decision Tree&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Random Forest&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Neural Net&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;AdaBoost&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Naive Bayes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;QDA&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>classifiers <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    KNeighborsClassifier(<span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>    SVC(kernel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">0.025</span>),
</span></span><span style="display:flex;"><span>    SVC(gamma<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    DecisionTreeClassifier(max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>    RandomForestClassifier(max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, n_estimators<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, max_features<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    MLPClassifier(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>),
</span></span><span style="display:flex;"><span>    AdaBoostClassifier(),
</span></span><span style="display:flex;"><span>    GaussianNB(),
</span></span><span style="display:flex;"><span>    QuadraticDiscriminantAnalysis(),
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">13.5</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, model <span style="color:#f92672">in</span> enumerate(classifiers):
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>fit(TrainX, TrainY)
</span></span><span style="display:flex;"><span>    Result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(TestX)
</span></span><span style="display:flex;"><span>    mat <span style="color:#f92672">=</span> confusion_matrix(TestY, Result)
</span></span><span style="display:flex;"><span>    sns<span style="color:#f92672">.</span>heatmap(mat<span style="color:#f92672">.</span>T, square<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;d&#39;</span>, cbar<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                xticklabels<span style="color:#f92672">=</span>Label, yticklabels<span style="color:#f92672">=</span>Label, ax <span style="color:#f92672">=</span> axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,  Accuracy : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(classifier_names[i], round(accuracy_score(Result, TestY), <span style="color:#ae81ff">3</span>)), fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bold&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>)
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;true label&#39;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>)
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;predicted label&#39;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span></code></pre></div><p><img src="figures/6-1-3-4.png" alt="Python output"></p>
<p>在這九種分類模型的分類結果中，我們發現 RBF SVM 可以達到將近 7成的分類成功率，事實上，這只是我們使用原始資料尚未進行更進一步處理分析的結果，讀者們若對於分類器有興趣，可以參考相關資源，進行更深入的探究，將能更加提升分類器對不同種類資料的分類能力。</p>
<h2 id="案例二空品資料的分群">案例二：空品資料的分群</h2>
<p>在這個案例中，我們使用民生公共物聯網開放資料中的環保署國家空品測站的感測資料，並且透過歷史資料的分析，利用資料分群的方式，將這些空品測站依照感測資料的變化趨勢關係予以分群，讓每一群的測站具有類似的感測資料變化趨勢。</p>
<h3 id="資料下載與前處理">資料下載與前處理</h3>
<p>我們使用下列的程式碼，從民生公共物聯網開放資料平台的<a href="https://history.colife.org.tw/">歷史資料庫</a>中下載 2021 年環保署國家空品測站的所有感測資料，並將下載回來的壓縮檔解開後，置於 <code>/content</code> 的目錄下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#39;EPA_OD_2021.zip&#39;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bepuuawo%2BWTgeizqi</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">nkrDkv53nvbJf5ZyL5a6256m65ZOB5ris56uZL0VQQV9PRF8yMDIxLnppcA%3D%3D&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#39;EPA_OD_2021.zip&#39;</span> <span style="color:#f92672">&amp;&amp;</span> rm <span style="color:#e6db74">&#39;EPA_OD_2021.zip&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#39;/content/EPA_OD_2021/EPA_OD_202112.zip&#39;</span> <span style="color:#f92672">-</span>d <span style="color:#e6db74">&#39;/content&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf <span style="color:#e6db74">&#39;/content/EPA_OD_2021&#39;</span>
</span></span></code></pre></div><p>我們先選用 2021 年 12月的資料，先把不需要的欄位 <code>Pollutant</code>、<code>SiteId</code>、<code>Status</code>、<code>SO2_AVG</code> 刪除，並且將感測資料的數值資料型態改為浮點數，以利後續的處理。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Dataframe <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;/content/EPA_OD_202112.csv&#34;</span>, parse_dates<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;PublishTime&#39;</span>])
</span></span><span style="display:flex;"><span>Dataframe <span style="color:#f92672">=</span> Dataframe<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Pollutant&#34;</span>, <span style="color:#e6db74">&#34;SiteId&#34;</span>, <span style="color:#e6db74">&#34;Status&#34;</span>, <span style="color:#e6db74">&#34;SO2_AVG&#34;</span>])
</span></span><span style="display:flex;"><span>Numerical_ColumnNames <span style="color:#f92672">=</span> list(Dataframe<span style="color:#f92672">.</span>columns<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ColumnName <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;SiteName&#39;</span>, <span style="color:#e6db74">&#39;County&#39;</span>, <span style="color:#e6db74">&#39;PublishTime&#39;</span>]:
</span></span><span style="display:flex;"><span>    Numerical_ColumnNames<span style="color:#f92672">.</span>remove(ColumnName)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> Numerical_ColumnName <span style="color:#f92672">in</span> Numerical_ColumnNames:
</span></span><span style="display:flex;"><span>    Dataframe[Numerical_ColumnName] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_numeric(Dataframe[Numerical_ColumnName], errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;coerce&#39;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float64&#39;</span>)
</span></span><span style="display:flex;"><span>Dataframe <span style="color:#f92672">=</span> Dataframe<span style="color:#f92672">.</span>dropna()
</span></span><span style="display:flex;"><span>Dataframe<span style="color:#f92672">.</span>head()
</span></span></code></pre></div><p><img src="figures/6-1-4-1.png" alt="Python output"></p>
<p>由於一個月的資料量十分龐大，為了精簡範例程式的執行時間，我們抽取其中 2021-12-13 至 2021-12-17 共計五天的資料 (<code>FiveDay_Dataframe</code>) 作為接下來的範例，並且把 <code>Country</code> 與 <code>SiteName</code> 兩個欄位合併，同時根據合併後的欄位和資料發佈時間進行排序。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>FiveDay_Dataframe <span style="color:#f92672">=</span> Dataframe<span style="color:#f92672">.</span>loc[(Dataframe[<span style="color:#e6db74">&#39;PublishTime&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#e6db74">&#39;2021-12-17 23:00:00&#39;</span>) <span style="color:#f92672">&amp;</span> (Dataframe[<span style="color:#e6db74">&#39;PublishTime&#39;</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;2021-12-13 00:00:00&#39;</span>)]
</span></span><span style="display:flex;"><span>FiveDay_Dataframe[<span style="color:#e6db74">&#39;CountyAndSiteName&#39;</span>] <span style="color:#f92672">=</span> FiveDay_Dataframe[<span style="color:#e6db74">&#39;County&#39;</span>] <span style="color:#f92672">+</span> FiveDay_Dataframe[<span style="color:#e6db74">&#39;SiteName&#39;</span>]
</span></span><span style="display:flex;"><span>FiveDay_Dataframe <span style="color:#f92672">=</span> FiveDay_Dataframe<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;County&#34;</span>, <span style="color:#e6db74">&#34;SiteName&#34;</span>])
</span></span><span style="display:flex;"><span>FiveDay_Dataframe <span style="color:#f92672">=</span> FiveDay_Dataframe<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;CountyAndSiteName&#39;</span>,<span style="color:#e6db74">&#39;PublishTime&#39;</span>])
</span></span><span style="display:flex;"><span>FiveDay_Dataframe <span style="color:#f92672">=</span> FiveDay_Dataframe<span style="color:#f92672">.</span>set_index(keys <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;CountyAndSiteName&#39;</span>])
</span></span><span style="display:flex;"><span>FiveDay_Dataframe
</span></span></code></pre></div><p><img src="figures/6-1-4-2.png" alt="Python output"></p>
<h3 id="動態時間校正-dynamic-time-warping-dtw">動態時間校正 (Dynamic Time Warping, DTW)</h3>
<p>接下來，我們必須判斷兩個測站之間的「相似度」，並且將其量化成一個數字。最基本的相似度量測方式，是直接將兩測站的資料，按照感測時間對齊後，計算兩兩之間空氣汙染物質感測數據的差距；但是，若考量測站資料具備時間序列的特性，空氣污染在各個測站間可能發生的順序不一，影響的時間長度亦不一定相同，需要更有彈性的推估兩個測站之間的相似度，因此我們先扣除掉資料中的風向、感測時間、經緯度等資訊後，選用動態時間校正 (DTW) 方法進行相似度量測，若兩個測站資料的 DTW 距離越小，代表兩者的相似度越高。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Site_TimeSeriesData <span style="color:#f92672">=</span> dict()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(FiveDay_Dataframe<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>values):
</span></span><span style="display:flex;"><span>    tmp <span style="color:#f92672">=</span> FiveDay_Dataframe[FiveDay_Dataframe<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> Site]
</span></span><span style="display:flex;"><span>    tmp <span style="color:#f92672">=</span> tmp<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;CountyAndSiteName&#39;</span>, <span style="color:#e6db74">&#39;PublishTime&#39;</span>], as_index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>    tmp <span style="color:#f92672">=</span> tmp<span style="color:#f92672">.</span>loc[:,<span style="color:#f92672">~</span>tmp<span style="color:#f92672">.</span>columns<span style="color:#f92672">.</span>isin([<span style="color:#e6db74">&#39;CountyAndSiteName&#39;</span>, <span style="color:#e6db74">&#39;PublishTime&#39;</span>])]
</span></span><span style="display:flex;"><span>    Site_TimeSeriesData[Site] <span style="color:#f92672">=</span> tmp<span style="color:#f92672">.</span>to_numpy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DictKeys <span style="color:#f92672">=</span> Site_TimeSeriesData<span style="color:#f92672">.</span>keys()
</span></span><span style="display:flex;"><span>Sites_DTW <span style="color:#f92672">=</span> dict()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, key1 <span style="color:#f92672">in</span> enumerate(DictKeys):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j, key2 <span style="color:#f92672">in</span> enumerate(DictKeys):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&gt;=</span> j: 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>						<span style="color:#75715e"># 計算扣除風向、感測時間、經度、緯度後資料的 DTW 距離</span>
</span></span><span style="display:flex;"><span>            Sites_DTW[str(key1)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">+</span>str(key2)] <span style="color:#f92672">=</span> fastdtw(Site_TimeSeriesData[key1][:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>], Site_TimeSeriesData[key2][:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>], dist<span style="color:#f92672">=</span>euclidean)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>Sites_DTW_keys <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(list(Sites_DTW<span style="color:#f92672">.</span>keys()))
</span></span><span style="display:flex;"><span>Site_DTW_Numpy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[value] <span style="color:#66d9ef">for</span> _, value <span style="color:#f92672">in</span> Sites_DTW<span style="color:#f92672">.</span>items()])
</span></span></code></pre></div><p>我們將所有測站兩兩間的 DTW 距離畫在數線上，可以得到下方的圖形；其中 DTW 距離從小到大皆有，若要進一步處理，便需要開始使用分群演算法來分析。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>scatter(Site_DTW_Numpy[:,<span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>len(Sites_DTW<span style="color:#f92672">.</span>items()), s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.05</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_visible(<span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><p><img src="figures/6-1-4-3.png" alt="Python output"></p>
<h3 id="使用-k-mean-分群演算法">使用 K-Mean 分群演算法</h3>
<p>我們使用 sklearn 套件中的 K-Means 模組來進行資料分群，由於分群演算法需事先設定最後要產生的群組數目，我們先設定為 3。我們使用下列的程式碼進行分群，並將結果依照資料所歸屬的群組組別 (Y 軸) 以及與其他資料的 DTW 相似度值 (X 軸) 繪製出來。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.cluster <span style="color:#f92672">import</span> KMeans
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> KMeans(n_clusters<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>fit([[value] <span style="color:#66d9ef">for</span> _, value <span style="color:#f92672">in</span> Sites_DTW<span style="color:#f92672">.</span>items()])
</span></span><span style="display:flex;"><span>Result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>labels_
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Number of Cluster</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i,len(Result[Result<span style="color:#f92672">==</span>i])))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將結果繪圖呈現</span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(Site_DTW_Numpy[Result<span style="color:#f92672">==</span>i][:,<span style="color:#ae81ff">0</span>],[i]<span style="color:#f92672">*</span>len(Site_DTW_Numpy[Result<span style="color:#f92672">==</span>i]), s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.05</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_visible(<span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><pre tabindex="0"><code>Number of Cluster0 : 1165
Number of Cluster1 : 994
Number of Cluster2 : 542
</code></pre><p><img src="figures/6-1-4-4.png" alt="Python output"></p>
<p>從分群結果中，我們可以看到 K-Means 演算法將原始資料分為三個群組，分別有 1165、994、542 筆資料，為了更進一步了解這三個群組的成因，我們繼續追查每個群組形成的可能原因。</p>
<h3 id="探究資料分群與地理位置的關係">探究資料分群與地理位置的關係</h3>
<p>我們首先假設空氣品質的變化具有地域性，因此探究資料分群的結果，是否和空品測站的地理位置有關。我們首先擷取測站的 GPS 經緯度座標，並換算出兩倆地理位置的實體距離，接著按照資料分群的結果，把不同群組的實體距離進行簡單的統計分析，並繪製在下方圖片中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Dist_for_Clusters <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>]<span style="color:#f92672">*</span>len(np<span style="color:#f92672">.</span>unique(Result))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    Dist_for_Cluster <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    Cluster <span style="color:#f92672">=</span> Sites_DTW_keys[Result<span style="color:#f92672">==</span>i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Sites <span style="color:#f92672">in</span> Cluster:
</span></span><span style="display:flex;"><span>        Site1, Site2 <span style="color:#f92672">=</span> Sites<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 獲取兩個測站的經緯度座標</span>
</span></span><span style="display:flex;"><span>        coord1 <span style="color:#f92672">=</span> Site_TimeSeriesData[Site1][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], Site_TimeSeriesData[Site1][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        coord2 <span style="color:#f92672">=</span> Site_TimeSeriesData[Site2][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], Site_TimeSeriesData[Site2][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 計算兩個測站的實體位置距離</span>
</span></span><span style="display:flex;"><span>        Dist_for_Cluster<span style="color:#f92672">.</span>append(geopy<span style="color:#f92672">.</span>distance<span style="color:#f92672">.</span>geodesic(coord1, coord2)<span style="color:#f92672">.</span>km)
</span></span><span style="display:flex;"><span>    Dist_for_Cluster <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Dist_for_Cluster)
</span></span><span style="display:flex;"><span>    Dist_for_Clusters[i] <span style="color:#f92672">=</span> Dist_for_Cluster
</span></span><span style="display:flex;"><span>Dist_for_Clusters <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Dist_for_Clusters)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for Dist_for_Cluster in Dist_for_Clusters:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     print(np.mean(Dist_for_Cluster))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    gtMean <span style="color:#f92672">=</span> Dist_for_Clusters[i][Dist_for_Clusters[i]<span style="color:#f92672">&gt;</span>np<span style="color:#f92672">.</span>mean(Dist_for_Clusters[i])]
</span></span><span style="display:flex;"><span>    ltMean <span style="color:#f92672">=</span> Dist_for_Clusters[i][Dist_for_Clusters[i]<span style="color:#f92672">&lt;</span>np<span style="color:#f92672">.</span>mean(Dist_for_Clusters[i])]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Mean Distance between Sites for Cluster</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i, np<span style="color:#f92672">.</span>mean(Dist_for_Clusters[i])))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;In Cluster</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> there are </span><span style="color:#e6db74">{:.2%}</span><span style="color:#e6db74"> less than mean, and </span><span style="color:#e6db74">{:.2%}</span><span style="color:#e6db74"> greater than mean.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i, len(ltMean)<span style="color:#f92672">/</span>len(Dist_for_Clusters[i]), len(gtMean)<span style="color:#f92672">/</span>len(Dist_for_Clusters[i])))
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(gtMean, [i]<span style="color:#f92672">*</span>len(gtMean), s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.05</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;orange&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(ltMean, [i]<span style="color:#f92672">*</span>len(ltMean), s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.05</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pink&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>axvline(np<span style="color:#f92672">.</span>mean(Dist_for_Clusters[i]), ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45</span><span style="color:#f92672">*</span>i, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">0.1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_visible(<span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><pre tabindex="0"><code>Mean Distance between Sites for Cluster0 : 84.34126465234523
In Cluster0 there are 60.09% less than mean, and 39.91% greater than mean.

Mean Distance between Sites for Cluster1 : 180.26230465399215
In Cluster1 there are 54.53% less than mean, and 45.47% greater than mean.

Mean Distance between Sites for Cluster2 : 234.89206124762546
In Cluster2 there are 39.48% less than mean, and 60.52% greater than mean.
</code></pre><p><img src="figures/6-1-4-5.png" alt="Python output"></p>
<p>從分析的結果中，我們可以發現對於 DTW 數值較高（時間序列相似度較低）的群組，其測站間的距離平均值亦較高，反之則距離平均值較低，由此可知測站資料的相似度確實與地理位置的差異有關，也應證了我們的假設，確認了空氣污染物的擴散確實會受到地理位置距離的影響。</p>
<h3 id="探究資料分群與風場風向的關係">探究資料分群與風場風向的關係</h3>
<p>我們接著假設空氣品質的變化受到環境風場的影響，因此探究資料分群的結果，是否和空品測站所在地的風向有關。我們首先擷取測站的 GPS 經緯度座標，並換算出兩倆地理位置的方位角關係，接著按照資料分群的結果，根據地理位置方位角與現場風向計算兩者的相關性，並將所獲得的數值進行簡單的統計分析，再繪製於下圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_bearing</span>(lat1, long1, lat2, long2):
</span></span><span style="display:flex;"><span>    dLon <span style="color:#f92672">=</span> (long2 <span style="color:#f92672">-</span> long1)
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>cos(math<span style="color:#f92672">.</span>radians(lat2)) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>sin(math<span style="color:#f92672">.</span>radians(dLon))
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>cos(math<span style="color:#f92672">.</span>radians(lat1)) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>sin(math<span style="color:#f92672">.</span>radians(lat2)) <span style="color:#f92672">-</span> math<span style="color:#f92672">.</span>sin(math<span style="color:#f92672">.</span>radians(lat1)) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>cos(math<span style="color:#f92672">.</span>radians(lat2)) <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>cos(math<span style="color:#f92672">.</span>radians(dLon))
</span></span><span style="display:flex;"><span>    brng <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arctan2(x,y)
</span></span><span style="display:flex;"><span>    brng <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>degrees(brng)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> brng
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Check_Wind_Dirc</span>(brng, wind_dirc):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> brng <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">180</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ((brng <span style="color:#f92672">&lt;</span> wind_dirc <span style="color:#f92672">+</span> <span style="color:#ae81ff">45</span>) <span style="color:#f92672">and</span> (brng <span style="color:#f92672">&gt;</span> wind_dirc <span style="color:#f92672">-</span> <span style="color:#ae81ff">45</span>)) <span style="color:#f92672">or</span> ((brng <span style="color:#f92672">-</span> <span style="color:#ae81ff">180</span> <span style="color:#f92672">&lt;</span> wind_dirc <span style="color:#f92672">+</span> <span style="color:#ae81ff">45</span>) <span style="color:#f92672">and</span> (brng <span style="color:#f92672">-</span> <span style="color:#ae81ff">180</span> <span style="color:#f92672">&gt;</span> wind_dirc <span style="color:#f92672">-</span> <span style="color:#ae81ff">45</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ((brng <span style="color:#f92672">&lt;</span> wind_dirc <span style="color:#f92672">+</span> <span style="color:#ae81ff">45</span>) <span style="color:#f92672">and</span> (brng <span style="color:#f92672">&gt;</span> wind_dirc <span style="color:#f92672">-</span> <span style="color:#ae81ff">45</span>)) <span style="color:#f92672">or</span> ((brng <span style="color:#f92672">+</span> <span style="color:#ae81ff">180</span> <span style="color:#f92672">&lt;</span> wind_dirc <span style="color:#f92672">+</span> <span style="color:#ae81ff">45</span>) <span style="color:#f92672">and</span> (brng <span style="color:#f92672">+</span> <span style="color:#ae81ff">180</span> <span style="color:#f92672">&gt;</span> wind_dirc <span style="color:#f92672">-</span> <span style="color:#ae81ff">45</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Brng_for_Clusters <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>]<span style="color:#f92672">*</span>len(np<span style="color:#f92672">.</span>unique(Result))
</span></span><span style="display:flex;"><span>Boolean_WindRelated_for_Clusters <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>]<span style="color:#f92672">*</span>len(np<span style="color:#f92672">.</span>unique(Result))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    Brng_for_Cluster <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    Boolean_WindRelated_for_Cluster <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    Cluster <span style="color:#f92672">=</span> Sites_DTW_keys[Result<span style="color:#f92672">==</span>i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Sites <span style="color:#f92672">in</span> Cluster:
</span></span><span style="display:flex;"><span>        Site1, Site2 <span style="color:#f92672">=</span> Sites<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>        coord1 <span style="color:#f92672">=</span> Site_TimeSeriesData[Site1][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], Site_TimeSeriesData[Site1][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        coord2 <span style="color:#f92672">=</span> Site_TimeSeriesData[Site2][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], Site_TimeSeriesData[Site2][<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        Brng_Between_Site <span style="color:#f92672">=</span> get_bearing(coord1[<span style="color:#ae81ff">0</span>], coord1[<span style="color:#ae81ff">1</span>], coord2[<span style="color:#ae81ff">0</span>], coord2[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        Brng_for_Cluster<span style="color:#f92672">.</span>append(Brng_Between_Site)
</span></span><span style="display:flex;"><span>        MeanWindDirc1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(Site_TimeSeriesData[Site1][:,<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>        MeanWindDirc2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(Site_TimeSeriesData[Site2][:,<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>        Boolean_WindRelated_for_Cluster<span style="color:#f92672">.</span>append(Check_Wind_Dirc(Brng_Between_Site, MeanWindDirc1) <span style="color:#f92672">or</span> Check_Wind_Dirc(Brng_Between_Site, MeanWindDirc2))
</span></span><span style="display:flex;"><span>    Brng_for_Cluster <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Brng_for_Cluster)
</span></span><span style="display:flex;"><span>    Boolean_WindRelated_for_Cluster <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Boolean_WindRelated_for_Cluster)
</span></span><span style="display:flex;"><span>    Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">=</span> Boolean_WindRelated_for_Cluster
</span></span><span style="display:flex;"><span>    Brng_for_Clusters[i] <span style="color:#f92672">=</span> Brng_for_Cluster
</span></span><span style="display:flex;"><span>Brng_for_Clusters <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Brng_for_Clusters)
</span></span><span style="display:flex;"><span>Boolean_WindRelated_for_Clusters <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(Boolean_WindRelated_for_Clusters)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Relevance for Cluster</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{:.2%}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i, len(Dist_for_Clusters[i][Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>])<span style="color:#f92672">/</span>len(Dist_for_Clusters[i])))
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(Dist_for_Clusters[i][Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>],\
</span></span><span style="display:flex;"><span>               [i]<span style="color:#f92672">*</span>len(Dist_for_Clusters[i][Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>]), s<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;green&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(Dist_for_Clusters[i][Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>],\
</span></span><span style="display:flex;"><span>               [i]<span style="color:#f92672">*</span>len(Dist_for_Clusters[i][Boolean_WindRelated_for_Clusters[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>]), s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.05</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;violet&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>axvline(np<span style="color:#f92672">.</span>mean(Dist_for_Clusters[i]), ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45</span><span style="color:#f92672">*</span>i, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">0.1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_visible(<span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><pre tabindex="0"><code>Relevance for Cluster0 : 54.08%
Relevance for Cluster1 : 39.24%
Relevance for Cluster2 : 22.69%
</code></pre><p><img src="figures/6-1-4-6.png" alt="Python output"></p>
<p>從分析的結果中，我們可以發現對於 DTW 數值較低 （時間序列相似度較高）的群組，其測站間方位角與風向的相關性較高，反之則相關性較低，由此可知測站資料的相似度確實與環境風場風向有關，也印證了我們的假設，確認空氣污染物的擴散確實會受到環境風場風向的影響。</p>
<h2 id="案例三結合氣象與水資源資料的分類與分群">案例三：結合氣象與水資源資料的分類與分群</h2>
<p>在這個案例中，我們結合資料分群與資料分類同時進行演練。我們使用民生公共物聯網開放資料中的中央氣象局雨量站和水利署（與縣市政府合建）淹水感測器的感測資料，並且透過歷史資料的分析，利用資料分群的方式，尋找和降雨變化最為相關的河川水位站群組，並且利用資料分類的方式，在僅有雨量資料的狀況時，得以進行特定地區是否造成淹水的預測。</p>
<h3 id="資料下載與前處理-1">資料下載與前處理</h3>
<p>我們使用下列的程式碼，從民生公共物聯網開放資料平台的<a href="https://history.colife.org.tw/">歷史資料庫</a>中下載 2021 年中央氣象局雨量站和水利署（與縣市政府合建）淹水感測器的所有感測資料，並將下載回來的壓縮檔解開後，置於 <code>/content</code> 的目錄下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 下載中央氣象局雨量站歷史資料</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#39;Rain_2021.zip&#39;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bawo%2BixoS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3lpK7msKPosaHlsYBf6Zuo6YeP56uZLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#39;Rain_Stataion.csv&#39;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2Bawo%2BixoS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">kuK3lpK7msKPosaHlsYBf6Zuo6YeP56uZL3JhaW5fc3RhdGlvbi5jc3Y%3D&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#39;Rain_2021.zip&#39;</span> <span style="color:#f92672">&amp;&amp;</span> rm <span style="color:#e6db74">&#39;Rain_2021.zip&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>find <span style="color:#e6db74">&#39;/content/2021&#39;</span> <span style="color:#f92672">-</span>name <span style="color:#e6db74">&#39;*.zip&#39;</span>  <span style="color:#f92672">-</span>exec unzip <span style="color:#f92672">-</span>q {} <span style="color:#f92672">-</span>d <span style="color:#e6db74">&#39;/content/Rain_2021_csv&#39;</span> \;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf <span style="color:#e6db74">&#39;/content/2021&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下載水利署（與縣市政府合建）淹水感測器資料</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#39;Flood_2021.zip&#39;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbLvvIjoiIfnuKPluILmlL</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">lupzlkIjlu7rvvIlf5re55rC05oSf5ris5ZmoLzIwMjEuemlw&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>wget <span style="color:#f92672">-</span>O <span style="color:#e6db74">&#39;Flood_Stataion.csv&#39;</span> <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#34;https://history.colife.org.tw/?r=/download&amp;path=L%2BawtOizh%2Ba6kC</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">msLTliKnnvbLvvIjoiIfnuKPluILmlL</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">lupzlkIjlu7rvvIlf5re55rC05oSf5ris5ZmoL3N0YXRpb25f5rC05Yip572y77yI6IiH57ij5biC5pS</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">5bqc5ZCI5bu677yJX%2Ba3ueawtOaEn%2Ba4rOWZqC5jc3Y%3D&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>unzip <span style="color:#f92672">-</span>q <span style="color:#e6db74">&#39;Flood_2021.zip&#39;</span> <span style="color:#f92672">&amp;&amp;</span> rm <span style="color:#e6db74">&#39;Flood_2021.zip&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>find <span style="color:#e6db74">&#39;/content/2021&#39;</span> <span style="color:#f92672">-</span>name <span style="color:#e6db74">&#39;*_QC.zip&#39;</span>  <span style="color:#f92672">-</span>exec unzip <span style="color:#f92672">-</span>q {} <span style="color:#f92672">-</span>d <span style="color:#e6db74">&#39;/content/Flood_2021_csv&#39;</span> \;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>rm <span style="color:#f92672">-</span>rf <span style="color:#e6db74">&#39;/content/2021&#39;</span>
</span></span></code></pre></div><p>接下來我們先處理降雨量資料，將所下載的 2021 年所有測站的資料逐一讀取，並把接下來不會使用到的 <code>MIN_10</code>、<code>HOUR_6</code>、<code>HOUR_12</code>、<code>NOW</code> 欄位刪除，同時移除 11 月以後的資料後，彙整為 <code>Rain_df</code> 物件，同時讀入測站資訊成為 <code>Rain_Station_df</code> 物件。由於這個步驟所處理的資料量十分龐大，因此會花費較多的時間，請耐心等候。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>csv_files <span style="color:#f92672">=</span> glob<span style="color:#f92672">.</span>glob(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;/content/Rain_2021_csv&#34;</span>, <span style="color:#e6db74">&#34;*.csv&#34;</span>))
</span></span><span style="display:flex;"><span>csv_files<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>Rain_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將所有資料逐一讀取，並把接下來不會使用到的 MIN_10、HOUR_6、HOUR_12、NOW 欄位刪除</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> csv_file <span style="color:#f92672">in</span> tqdm(csv_files):
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(csv_file, parse_dates<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;obsTime&#39;</span>])
</span></span><span style="display:flex;"><span>    tmp_df<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;MIN_10&#39;</span>,<span style="color:#e6db74">&#39;HOUR_6&#39;</span>, <span style="color:#e6db74">&#39;HOUR_12&#39;</span>, <span style="color:#e6db74">&#39;NOW&#39;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[tmp_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>minute <span style="color:#f92672">==</span> <span style="color:#ae81ff">00</span>]
</span></span><span style="display:flex;"><span>        Rain_df <span style="color:#f92672">=</span>  pd<span style="color:#f92672">.</span>concat([Rain_df, tmp_df])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        print(csv_file)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>Rain_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#34;2021-11-01 00:00:00&#34;</span>]
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>_get_numeric_data()
</span></span><span style="display:flex;"><span>num[num <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Rain_df<span style="color:#f92672">.</span>dropna(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Rain_df<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;station_id&#39;</span>,<span style="color:#e6db74">&#39;obsTime&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Rain_Station_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;/content/Rain_Stataion.csv&#39;</span>)
</span></span><span style="display:flex;"><span>Rain_df
</span></span></code></pre></div><p><img src="figures/6-1-5-1.png" alt="Python output"></p>
<p>我們接下來處理淹水感測器的資料，將所下載的 2021 年所有測站的資料逐一讀取，並移除 11 月以後的資料，以及含有缺失值的資料後，將資料儲存為 <code>Flood_df</code> 物件，同時讀入測站資訊成為 <code>Flood_Station_df</code> 物件。這個步驟所處理的資料量一樣十分龐大，因此會花費較多的時間，請務必耐心等候。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>csv_files <span style="color:#f92672">=</span> glob<span style="color:#f92672">.</span>glob(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;/content/Flood_2021_csv&#34;</span>, <span style="color:#e6db74">&#34;*_QC.csv&#34;</span>))
</span></span><span style="display:flex;"><span>csv_files<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>Flood_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 將所有資料逐一讀取，並彙整成 Flood_df </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> csv_file <span style="color:#f92672">in</span> tqdm(csv_files):
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(csv_file, parse_dates<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>])
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[(tmp_df[<span style="color:#e6db74">&#39;PQ_unit&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;cm&#39;</span>)]
</span></span><span style="display:flex;"><span>    Flood_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([Flood_df,tmp_df], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Flood_df <span style="color:#f92672">=</span> Flood_df<span style="color:#f92672">.</span>loc[Flood_df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#34;2021-11-01 00:00:00&#34;</span>]
</span></span><span style="display:flex;"><span>Flood_df<span style="color:#f92672">.</span>replace(<span style="color:#f92672">-</span><span style="color:#ae81ff">999.0</span>,<span style="color:#ae81ff">0.0</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Flood_df<span style="color:#f92672">.</span>dropna(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Flood_df<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;timestamp&#39;</span>], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>Flood_Station_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;/content/Flood_Stataion.csv&#39;</span>)
</span></span><span style="display:flex;"><span>Flood_df
</span></span></code></pre></div><p><img src="figures/6-1-5-2.png" alt="Python output"></p>
<h3 id="計算特定淹水感測器與雨量測站資料的相似度">計算特定淹水感測器與雨量測站資料的相似度</h3>
<p>由於淹水感測器的資料量十分龐大，因此我們先挑選一個位於雲林縣且編號為 <code>43b2aec1-69b0-437b-b2a2-27c76a3949e8</code> 的淹水感測器，將其資料取出後存在 <code>Flood_Site_df</code> 物件中，作為後續處理的範例。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Flood_Site_df <span style="color:#f92672">=</span> Flood_df<span style="color:#f92672">.</span>loc[Flood_df[<span style="color:#e6db74">&#39;station_id&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;43b2aec1-69b0-437b-b2a2-27c76a3949e8&#39;</span>]
</span></span><span style="display:flex;"><span>Flood_Site_df<span style="color:#f92672">.</span>head()
</span></span></code></pre></div><p><img src="figures/6-1-5-3.png" alt="Python output"></p>
<p>我們接著計算雨量站資料與選定的淹水感測器之間的相似度，我們一樣使用動態時間校正 (Dynamic Time Warping, DTW) 進行量測，由於 DTW 的值越小代表相似度越大，為了能更直觀表達相似度，我們在這個案例中，將相似度定義為 DTW 值的倒數，並且計算這個選定的淹水感測器與所有雨量站資料的相似度。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Flood_Sensor_np <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[v,v,v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>]<span style="color:#f92672">.</span>to_numpy()])
</span></span><span style="display:flex;"><span>Site_dtw_Dist <span style="color:#f92672">=</span> dict()
</span></span><span style="display:flex;"><span>Rain_tmp_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[(Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>hour <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> tqdm(np<span style="color:#f92672">.</span>unique(Rain_Station_df<span style="color:#f92672">.</span>loc[Rain_Station_df[<span style="color:#e6db74">&#39;city&#39;</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;臺南市&#39;</span>][<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">.</span>to_numpy())):
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> Rain_tmp_df<span style="color:#f92672">.</span>loc[(Rain_tmp_df[<span style="color:#e6db74">&#39;station_id&#39;</span>] <span style="color:#f92672">==</span> Site)]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> tmp_df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    tmp_np <span style="color:#f92672">=</span> tmp_df[[<span style="color:#e6db74">&#39;RAIN&#39;</span>,<span style="color:#e6db74">&#39;HOUR_3&#39;</span>,<span style="color:#e6db74">&#39;HOUR_24&#39;</span>]]<span style="color:#f92672">.</span>to_numpy()
</span></span><span style="display:flex;"><span>    Site_dtw_Dist[Site] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>fastdtw(Flood_Sensor_np, tmp_np, dist<span style="color:#f92672">=</span>euclidean)[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>Site_dtw_Dist <span style="color:#f92672">=</span> dict(sorted(Site_dtw_Dist<span style="color:#f92672">.</span>items(), key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> item: item[<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>print(json<span style="color:#f92672">.</span>dumps(Site_dtw_Dist, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>))
</span></span></code></pre></div><pre tabindex="0"><code>{
    &#34;88K590&#34;: 4.580649481044748e-05,
    &#34;C0K560&#34;: 4.744655320519647e-05,
    &#34;C0K490&#34;: 4.79216996101994e-05,
    &#34;C0K520&#34;: 5.038234963332513e-05,
    &#34;C0K420&#34;: 5.0674082994877385e-05,
    &#34;C0K250&#34;: 5.1021366345465985e-05,
    &#34;C0K280&#34;: 5.118406054309105e-05,
    &#34;A0K420&#34;: 5.1515699268157996e-05,
    &#34;C0K400&#34;: 5.178763059243615e-05,
    &#34;O1J810&#34;: 5.2282255279259976e-05,
    &#34;C0K240&#34;: 5.2470804312991397e-05,
    &#34;01J960&#34;: 5.334885670256585e-05,
    &#34;C0K470&#34;: 5.438256498969844e-05,
    &#34;81K580&#34;: 5.45854441959214e-05,
    &#34;C0K410&#34;: 5.5066753408217084e-05,
    &#34;A2K570&#34;: 5.520214274022887e-05,
    &#34;01J970&#34;: 5.529887546186233e-05,
    &#34;C0K480&#34;: 5.5374254960644355e-05,
    &#34;C0K460&#34;: 5.5657892623955056e-05,
    &#34;72K220&#34;: 5.5690175197363816e-05,
    &#34;C0K510&#34;: 5.5742273217039165e-05,
    &#34;C1K540&#34;: 5.618025674136218e-05,
    &#34;C0K550&#34;: 5.621240903075098e-05,
    &#34;C0K450&#34;: 5.62197509062689e-05,
    &#34;C0K291&#34;: 5.6380522616008906e-05,
    &#34;C0K330&#34;: 5.638960953991442e-05,
    &#34;C0K530&#34;: 5.6525582441919285e-05,
    &#34;C0K500&#34;: 5.6825555408648244e-05,
    &#34;C0K440&#34;: 5.692254536595e-05,
    &#34;C0K430&#34;: 5.697351917955081e-05,
    &#34;01J930&#34;: 5.7648109890427854e-05,
    &#34;C0K580&#34;: 5.770344946580767e-05,
    &#34;C0K390&#34;: 5.782553930260475e-05,
    &#34;01J100&#34;: 5.7933240408734325e-05,
    &#34;01K060&#34;: 5.8343415644572526e-05
}
</code></pre><h3 id="資料分群並探究相關性高的雨量站">資料分群並探究相關性高的雨量站</h3>
<p>如同前面的作法，我們藉由分群演算法來幫我們依照相似度的關係，將雨量計分為三個群組，並且找出其中相似度最高的群組，以及群組中的雨量計代碼。在我們的範例中，我們找到的三個群組各自有 9、23、3 個雨量計，同時第二個群組的時間序列資料與淹水感測器的資料相似度最高。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cluster_model <span style="color:#f92672">=</span> KMeans(n_clusters<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">.</span>fit([[value] <span style="color:#66d9ef">for</span> _, value <span style="color:#f92672">in</span> Site_dtw_Dist<span style="color:#f92672">.</span>items()])
</span></span><span style="display:flex;"><span>Result <span style="color:#f92672">=</span> cluster_model<span style="color:#f92672">.</span>labels_
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Number of Cluster </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i,len(Result[Result<span style="color:#f92672">==</span>i])))
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>Site_DTW_Numpy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([value <span style="color:#66d9ef">for</span> _, value <span style="color:#f92672">in</span> Site_dtw_Dist<span style="color:#f92672">.</span>items()])
</span></span><span style="display:flex;"><span>Site_Name_Numpy <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([key <span style="color:#66d9ef">for</span> key, _ <span style="color:#f92672">in</span> Site_dtw_Dist<span style="color:#f92672">.</span>items()])
</span></span><span style="display:flex;"><span>Mean_Dis_For_Cluster <span style="color:#f92672">=</span> [<span style="color:#66d9ef">None</span>] <span style="color:#f92672">*</span> len(np<span style="color:#f92672">.</span>unique(Result))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>unique(Result):
</span></span><span style="display:flex;"><span>    Mean_Dis_For_Cluster[i] <span style="color:#f92672">=</span> (np<span style="color:#f92672">.</span>mean(Site_DTW_Numpy[Result<span style="color:#f92672">==</span>i]))
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(Site_DTW_Numpy[Result<span style="color:#f92672">==</span>i],[i]<span style="color:#f92672">*</span>len(Site_DTW_Numpy[Result<span style="color:#f92672">==</span>i]), s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Mean Distance of Cluster </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(i,Mean_Dis_For_Cluster[i]))
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_visible(<span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>Best_Cluster <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(Mean_Dis_For_Cluster <span style="color:#f92672">==</span> np<span style="color:#f92672">.</span>amax(Mean_Dis_For_Cluster))[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>Best_Site <span style="color:#f92672">=</span> Site_Name_Numpy[Result <span style="color:#f92672">==</span> Best_Cluster]
</span></span><span style="display:flex;"><span>print(Best_Site)
</span></span></code></pre></div><pre tabindex="0"><code>Number of Cluster 0 : 9
Number of Cluster 1 : 23
Number of Cluster 2 : 3
Mean Distance of Cluster 0 : 5.1629678408018994e-05
Mean Distance of Cluster 1 : 5.6307994901628334e-05
Mean Distance of Cluster 2 : 4.7058249208614454e-05
[&#39;C0K470&#39; &#39;81K580&#39; &#39;C0K410&#39; &#39;A2K570&#39; &#39;01J970&#39; &#39;C0K480&#39; &#39;C0K460&#39; &#39;72K220&#39;
 &#39;C0K510&#39; &#39;C1K540&#39; &#39;C0K550&#39; &#39;C0K450&#39; &#39;C0K291&#39; &#39;C0K330&#39; &#39;C0K530&#39; &#39;C0K500&#39;
 &#39;C0K440&#39; &#39;C0K430&#39; &#39;01J930&#39; &#39;C0K580&#39; &#39;C0K390&#39; &#39;01J100&#39; &#39;01K060&#39;]
</code></pre><p><img src="figures/6-1-5-4.png" alt="Python output"></p>
<p>為了更進一步了解淹水感測器與這 23 個雨量計之間的相互關係，我們將這個選定的淹水感測器的感測資料按照時間順序繪製成圖。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>tmp<span style="color:#f92672">=</span> Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>]<span style="color:#f92672">.</span>to_numpy()
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>plot(range(len(tmp)),tmp, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span></code></pre></div><p><img src="figures/6-1-5-5.png" alt="Python output"></p>
<p>接著我們將最相似群組的這 23 個雨量計的每小時降雨資料按照時間順序分別繪製成 23 張圖，由圖中所示，可以發現在淹水感測器出現高值時，雨量計的數值確實也都有增加的狀態發生，兩者的變化趨勢確實具備極高的相似度，符合我們的常理預期。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(len(Best_Site)<span style="color:#f92672">//</span><span style="color:#ae81ff">4</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, Site <span style="color:#f92672">in</span> enumerate(Best_Site):
</span></span><span style="display:flex;"><span>    tmp <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[Rain_df[<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">==</span>Site][<span style="color:#e6db74">&#39;RAIN&#39;</span>]
</span></span><span style="display:flex;"><span>    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(len(Best_Site)<span style="color:#f92672">//</span><span style="color:#ae81ff">4</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">4</span>,i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(range(len(tmp)),tmp, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span></code></pre></div><p><img src="figures/6-1-5-6.png" alt="Python output"></p>
<h3 id="資料分類並由雨量計資料預測淹水可能性">資料分類並由雨量計資料預測淹水可能性</h3>
<p>接下來我們利用資料分類的方法，以所選定的淹水感測器所記載的淹水資料作為標籤，搭配最佳相似群組的雨量計，建構一個簡單的分類器，預測淹水感測器所在地是否發生淹水現象。我們將原有 2021 年 1 到 10 月的資料區分為前 7 個月的訓練資料和後 2 個月的測試資料，並將前七個月中淹水感測器中數值大於 0 的資料標記為淹水事件（註：本範例乃基於方便使用的原則，採取最寬鬆的標準將水位大於 0 的事件皆認定為淹水事件；然而，有關淹水事件的判定其實有更嚴謹的相關規定，在正式使用時，建議仍應遵照相關法規的規範判定），數值等於 ０的資料標記為無淹水事件，並將整理完畢的資料，儲存在訓練資料 <code>Train_DataSet</code> 物件中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Flooding <span style="color:#f92672">=</span> Flood_Site_df<span style="color:#f92672">.</span>loc[(Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span>) <span style="color:#f92672">&amp;</span> (Flood_Site_df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#34;2021-08-01 00:00:00&#34;</span>)][[<span style="color:#e6db74">&#39;timestamp&#39;</span>, <span style="color:#e6db74">&#39;value&#39;</span>]]<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>Not_Flooding <span style="color:#f92672">=</span> Flood_Site_df<span style="color:#f92672">.</span>loc[(Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0.0</span>) <span style="color:#f92672">&amp;</span> (Flood_Site_df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#34;2021-08-01 00:00:00&#34;</span>)][[<span style="color:#e6db74">&#39;timestamp&#39;</span>, <span style="color:#e6db74">&#39;value&#39;</span>]]\
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span>sample(n<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">*</span>len(Flooding))<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Train_DataSet <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;x&#39;</span>:[], <span style="color:#e6db74">&#39;y&#39;</span>:[]}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> timestamp, _ <span style="color:#f92672">in</span>  tqdm(Flooding):
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[(Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&lt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))) <span style="color:#f92672">&amp;</span> (Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&gt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)))]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> Best_Site:
</span></span><span style="display:flex;"><span>        Site_tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[(tmp_df[<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">==</span>Site)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Site_tmp_df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            tmp_x<span style="color:#f92672">.</span>append(Site_tmp_df<span style="color:#f92672">.</span>tail(<span style="color:#ae81ff">24</span>)[[<span style="color:#e6db74">&#39;RAIN&#39;</span>, <span style="color:#e6db74">&#39;HOUR_3&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(tmp_x) <span style="color:#f92672">&lt;</span> len(Best_Site):
</span></span><span style="display:flex;"><span>        tmp_x<span style="color:#f92672">.</span>append(tmp_x[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(tmp_x)<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(tmp_x) <span style="color:#f92672">==</span> <span style="color:#ae81ff">24</span><span style="color:#f92672">*</span>len(Best_Site)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        Train_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>]<span style="color:#f92672">.</span>append(tmp_x)
</span></span><span style="display:flex;"><span>        Train_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> timestamp, _ <span style="color:#f92672">in</span>  tqdm(Not_Flooding):
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[(Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&lt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))) <span style="color:#f92672">&amp;</span> (Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&gt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)))]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> Best_Site:
</span></span><span style="display:flex;"><span>        Site_tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[(tmp_df[<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">==</span>Site)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Site_tmp_df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            tmp_x<span style="color:#f92672">.</span>append(Site_tmp_df<span style="color:#f92672">.</span>tail(<span style="color:#ae81ff">24</span>)[[<span style="color:#e6db74">&#39;RAIN&#39;</span>, <span style="color:#e6db74">&#39;HOUR_3&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(tmp_x)<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(tmp_x) <span style="color:#f92672">==</span> <span style="color:#ae81ff">24</span><span style="color:#f92672">*</span>len(Best_Site)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        Train_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>]<span style="color:#f92672">.</span>append(tmp_x)
</span></span><span style="display:flex;"><span>        Train_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>運用相同的方法，我們將 2021 年 8 到 10 月中淹水感測器中數值大於 0 的資料標記為淹水事件，數值等於 ０的資料標記為無淹水事件，並將整理完畢的資料，儲存在測試資料 <code>Test_DataSet</code> 物件中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Flooding <span style="color:#f92672">=</span> Flood_Site_df<span style="color:#f92672">.</span>loc[(Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span>) <span style="color:#f92672">&amp;</span> (Flood_Site_df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;2021-08-01 00:00:00&#34;</span>)][[<span style="color:#e6db74">&#39;timestamp&#39;</span>, <span style="color:#e6db74">&#39;value&#39;</span>]]<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>Not_Flooding <span style="color:#f92672">=</span> Flood_Site_df<span style="color:#f92672">.</span>loc[(Flood_Site_df[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0.0</span>) <span style="color:#f92672">&amp;</span> (Flood_Site_df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;2021-08-01 00:00:00&#34;</span>)][[<span style="color:#e6db74">&#39;timestamp&#39;</span>, <span style="color:#e6db74">&#39;value&#39;</span>]]\
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span>sample(n<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>len(Flooding))<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Test_DataSet <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;x&#39;</span>:[], <span style="color:#e6db74">&#39;y&#39;</span>:[]}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> timestamp, _ <span style="color:#f92672">in</span>  tqdm(Flooding):
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[(Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&lt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))) <span style="color:#f92672">&amp;</span> (Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&gt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)))]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> Best_Site:
</span></span><span style="display:flex;"><span>        Site_tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[(tmp_df[<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">==</span>Site)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Site_tmp_df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            tmp_x<span style="color:#f92672">.</span>append(Site_tmp_df<span style="color:#f92672">.</span>tail(<span style="color:#ae81ff">24</span>)[[<span style="color:#e6db74">&#39;RAIN&#39;</span>, <span style="color:#e6db74">&#39;HOUR_3&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(tmp_x) <span style="color:#f92672">&lt;</span> len(Best_Site):
</span></span><span style="display:flex;"><span>        tmp_x<span style="color:#f92672">.</span>append(tmp_x[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(tmp_x)<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(tmp_x) <span style="color:#f92672">==</span> <span style="color:#ae81ff">24</span><span style="color:#f92672">*</span>len(Best_Site)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        Test_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>]<span style="color:#f92672">.</span>append(tmp_x)
</span></span><span style="display:flex;"><span>        Test_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> timestamp, _ <span style="color:#f92672">in</span>  tqdm(Not_Flooding):
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    tmp_df <span style="color:#f92672">=</span> Rain_df<span style="color:#f92672">.</span>loc[(Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&lt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))) <span style="color:#f92672">&amp;</span> (Rain_df[<span style="color:#e6db74">&#39;obsTime&#39;</span>] <span style="color:#f92672">&gt;</span> (timestamp <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)))]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> Site <span style="color:#f92672">in</span> Best_Site:
</span></span><span style="display:flex;"><span>        Site_tmp_df <span style="color:#f92672">=</span> tmp_df<span style="color:#f92672">.</span>loc[(tmp_df[<span style="color:#e6db74">&#39;station_id&#39;</span>]<span style="color:#f92672">==</span>Site)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Site_tmp_df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            tmp_x<span style="color:#f92672">.</span>append(Site_tmp_df<span style="color:#f92672">.</span>tail(<span style="color:#ae81ff">24</span>)[[<span style="color:#e6db74">&#39;RAIN&#39;</span>, <span style="color:#e6db74">&#39;HOUR_3&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>flatten())
</span></span><span style="display:flex;"><span>    tmp_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(tmp_x)<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(tmp_x) <span style="color:#f92672">==</span> <span style="color:#ae81ff">24</span><span style="color:#f92672">*</span>len(Best_Site)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        Test_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>]<span style="color:#f92672">.</span>append(tmp_x)
</span></span><span style="display:flex;"><span>        Test_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>最後我們使用 Scikit learn (sklearn) 這個 Python 套件所提供的九個分類器模型 (Nearest neighbors, Linear SVM, RBF SVM, Decision tree, Random forest, Neural net, Adaboost, Naive Bayes, QDA) ，並且依次帶入訓練資料進行調校後，接著帶入測試資料進行淹水與否的預測，並且將預測結果與測試資料中的標籤內容進行比對，再用混淆矩陣 (confusion matrix) 的方式，呈現不同標籤組合的分類結果。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>names <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Nearest Neighbors&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Linear SVM&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;RBF SVM&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Decision Tree&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Random Forest&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Neural Net&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;AdaBoost&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Naive Bayes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;QDA&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>classifiers <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    KNeighborsClassifier(<span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>    SVC(kernel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">0.025</span>),
</span></span><span style="display:flex;"><span>    SVC(gamma<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    DecisionTreeClassifier(max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>    RandomForestClassifier(max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, n_estimators<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, max_features<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    MLPClassifier(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>),
</span></span><span style="display:flex;"><span>    AdaBoostClassifier(),
</span></span><span style="display:flex;"><span>    GaussianNB(),
</span></span><span style="display:flex;"><span>    QuadraticDiscriminantAnalysis(),
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">13.5</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, model <span style="color:#f92672">in</span> enumerate(classifiers):
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>fit(Train_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>], Train_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>])
</span></span><span style="display:flex;"><span>    Result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(Test_DataSet[<span style="color:#e6db74">&#39;x&#39;</span>])
</span></span><span style="display:flex;"><span>    mat <span style="color:#f92672">=</span> confusion_matrix(Test_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>], Result)
</span></span><span style="display:flex;"><span>    sns<span style="color:#f92672">.</span>heatmap(mat<span style="color:#f92672">.</span>T, square<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;d&#39;</span>, cbar<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                xticklabels<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;不淹水&#34;</span>,<span style="color:#e6db74">&#34;淹水&#34;</span>], yticklabels<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;不淹水&#34;</span>,<span style="color:#e6db74">&#34;淹水&#34;</span>], ax <span style="color:#f92672">=</span> axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,  Accuracy : </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(names[i], round(accuracy_score(Result, Test_DataSet[<span style="color:#e6db74">&#39;y&#39;</span>]), <span style="color:#ae81ff">3</span>)), fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bold&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>)
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;true label&#39;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>)
</span></span><span style="display:flex;"><span>    axes[i<span style="color:#f92672">//</span><span style="color:#ae81ff">3</span>][i<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;predicted label&#39;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span></code></pre></div><p><img src="figures/6-1-5-7.png" alt="Python output"></p>
<p>在這個案例中，我們發現 Nearest Neighbors 方法可以達到將近 7.3 成的分類成功率，事實上，這只是我們使用原始資料尚未進行更進一步處理分析的結果，倘若我們對於資料本身進行更多的分析，擷取更多的特徵，還有可能將分類成功率繼續提升，讀者們若對於分類器有興趣，可以參考相關資源，進行更深入的探究，將能更加提升分類器對不同種類資料的分類能力。</p>
<h2 id="參考資料">參考資料</h2>
<ul>
<li>Ibrahim Saidi, Your First Machine Learning Project in Python, Medium, Jan, 2022, (<a href="https://ibrahimsaidi.com.au/your-first-machine-learning-project-in-python-e3b90170ae41">https://ibrahimsaidi.com.au/your-first-machine-learning-project-in-python-e3b90170ae41</a>)</li>
<li>Esmaeil Alizadeh, An Illustrative Introduction to Dynamic Time Warping, Medium, Oct. 2020, (<a href="https://towardsdatascience.com/an-illustrative-introduction-to-dynamic-time-warping-36aa98513b98">https://towardsdatascience.com/an-illustrative-introduction-to-dynamic-time-warping-36aa98513b98</a>)</li>
<li>Jason Brownlee, 10 Clustering Algorithms With Python, Machine Learning Mastery, Aug. 2020, (<a href="https://machinelearningmastery.com/clustering-algorithms-with-python/">https://machinelearningmastery.com/clustering-algorithms-with-python/</a>)</li>
<li>Alexandra Amidon, How to Apply K-means Clustering to Time Series Data, TOwards Data Science, July 2020, (<a href="https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3">https://towardsdatascience.com/how-to-apply-k-means-clustering-to-time-series-data-28d04a8f7da3</a>)</li>
<li>scikit-learn Tutorials (<a href="https://scikit-learn.org/stable/tutorial/index.html">https://scikit-learn.org/stable/tutorial/index.html</a>)</li>
<li>FastDTW - A Python implementation of FastDTW, (<a href="https://github.com/slaypni/fastdtw">https://github.com/slaypni/fastdtw</a>)</li>
<li>Nearest Neighbors - Wikipedia, (<a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm</a>)</li>
<li>SVM Classifier - Wikipedia, (<a href="https://en.wikipedia.org/wiki/Support-vector_machine">https://en.wikipedia.org/wiki/Support-vector_machine</a>)</li>
<li>Decision Tree - Wikipedia, (<a href="https://en.wikipedia.org/wiki/Decision_tree">https://en.wikipedia.org/wiki/Decision_tree</a>)</li>
<li>Random Forest - Wikipedia, (<a href="https://en.wikipedia.org/wiki/Random_forest">https://en.wikipedia.org/wiki/Random_forest</a>)</li>
<li>K-Means - Wikipedia, (<a href="https://en.wikipedia.org/wiki/K-means_clustering">https://en.wikipedia.org/wiki/K-means_clustering</a>)</li>
<li>DBSCAN - Wikipedia, (<a href="https://en.wikipedia.org/wiki/DBSCAN">https://en.wikipedia.org/wiki/DBSCAN</a>)</li>
<li>Hierarchical Clustering - Wikipedia, (<a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">https://en.wikipedia.org/wiki/Hierarchical_clustering</a>)</li>
<li>BIRCH - Wikipedia, (<a href="https://en.wikipedia.org/wiki/BIRCH">https://en.wikipedia.org/wiki/BIRCH</a>)</li>
</ul>

            <footer class="footline">
            </footer>
          </article>


<div align="center">
<hr width="70%">

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
<br />
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0;margin:2px" src="https://i.creativecommons.org/l/by/3.0/88x31.png" /></a>
</div>
<p style="height:30px">

<div id="disqus_thread" style="border-style: ridge; padding-inline:5px"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'learnciot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation showVisitedLinks">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
          <style>
            #logo svg,
            #logo svg * {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              fill: #282828 !important;
              fill: var(--MENU-SECTIONS-BG-color) !important;
              opacity: .945;
            }
            a#logo {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
              font-family: 'Work Sans', 'Helvetica', 'Tahoma', 'Geneva', 'Arial', sans-serif;
              font-size: 30px;
              font-weight: 300;
              margin-top: -13px;
              max-width: 60%;
              text-transform: uppercase;
              width: 226px;
              white-space: nowrap;
            }
            a#logo:hover {
              color: #282828;
              color: var(--MENU-SECTIONS-BG-color);
            }
            #logo svg {
              margin-bottom: -20px;
              margin-left: -23.5px;
              width: 40.5%;
            }
            @media only all and (max-width: 59.938em) {
              a#logo {
                font-size: 25px;
                margin-top: -3px;
              }
              #logo svg {
                margin-bottom: -12px;
                margin-left: -23px;
              }
            }
            @media all and (-ms-high-contrast:none) {
              /* IE11s understanding of positioning is weird at best */
              a#logo {
                margin-top: -58px;
              }
              #logo svg {
                margin-bottom: -62px;
              }
            }
          </style>
          <a id="logo" href="/">
            Learn CIoT
          </a>

        </div>
        <div class="searchbox default-animation">
          <label class="a11y-only" for="search-by">搜尋</label>
          <i class="fas fa-search"></i>
          <input data-search-input id="search-by" type="search" placeholder="搜尋...">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div>
        <script>
          var contentLangs=['zh'];
        </script>
        <script src="/js/auto-complete.js?1697341099" defer></script>
        <script src="/js/lunr.min.js?1697341099" defer></script>
        <script src="/js/lunr.stemmer.support.min.js?1697341099" defer></script>
        <script src="/js/lunr.multi.min.js?1697341099" defer></script>
        <script src="/js/lunr.zh.min.js?1697341099" defer></script>
        <script src="/js/search.js?1697341099" defer></script>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics">
          <li data-nav-id="/ch1/" title="1. 教學網站簡介" class="dd-item"><a href="/ch1/">1. 教學網站簡介<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/" title="2. 整體課程前言" class="dd-item"><label for="section-0c4ff77f81b29c69f37066d67544c3b9" ></label><a href="/ch2/">2. 整體課程前言<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch2/ch2.1/" title="2.1. 課程架構說明" class="dd-item"><a href="/ch2/ch2.1/">2.1. 課程架構說明<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch2/ch2.2/" title="2.2. 課程軟體工具簡介" class="dd-item"><a href="/ch2/ch2.2/">2.2. 課程軟體工具簡介<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch3/" title="3. 資料取用" class="dd-item"><label for="section-2d571a52f8e6e09b8c11625532edb2d4" ></label><a href="/ch3/">3. 資料取用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch3/ch3.1/" title="3.1. 基本資料存取方法" class="dd-item"><a href="/ch3/ch3.1/">3.1. 基本資料存取方法<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch3/ch3.2/" title="3.2. 存取特定時空條件的資料" class="dd-item"><a href="/ch3/ch3.2/">3.2. 存取特定時空條件的資料<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch4/" title="4. 時間維度資料分析" class="dd-item"><label for="section-a3965432c40ae592eaa5a4a04592685e" ></label><a href="/ch4/">4. 時間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch4/ch4.1/" title="4.1. 時間序列資料處理" class="dd-item"><a href="/ch4/ch4.1/">4.1. 時間序列資料處理<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.2/" title="4.2. 時間序列資料預測" class="dd-item"><a href="/ch4/ch4.2/">4.2. 時間序列資料預測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch4/ch4.3/" title="4.3. 時間序列屬性分群" class="dd-item"><a href="/ch4/ch4.3/">4.3. 時間序列屬性分群<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch5/" title="5. 空間維度資料分析" class="dd-item"><label for="section-b6a8e999e0329c5971871ffc5b34192f" ></label><a href="/ch5/">5. 空間維度資料分析<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch5/ch5.1/" title="5.1. 地理空間篩選" class="dd-item"><a href="/ch5/ch5.1/">5.1. 地理空間篩選<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch5/ch5.2/" title="5.2. 地理空間分析" class="dd-item"><a href="/ch5/ch5.2/">5.2. 地理空間分析<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch6/" title="6. 資料應用" class="dd-item parent"><label for="section-f8bc2d76b61c5c9922024382e3ab1dcb" ></label><a href="/ch6/">6. 資料應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch6/ch6.1/" title="6.1. 機器學習初探" class="dd-item active"><a href="/ch6/ch6.1/">6.1. 機器學習初探<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.2/" title="6.2. 異常資料偵測" class="dd-item"><a href="/ch6/ch6.2/">6.2. 異常資料偵測<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch6/ch6.3/" title="6.3. 感測器聯合校正" class="dd-item"><a href="/ch6/ch6.3/">6.3. 感測器聯合校正<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/ch7/" title="7. 系統整合應用" class="dd-item"><label for="section-c663021a728355d88e45618764e92f92" ></label><a href="/ch7/">7. 系統整合應用<i class="fas fa-check read-icon"></i></a><ul>
          <li data-nav-id="/ch7/ch7.1/" title="7.1. QGIS 應用" class="dd-item"><a href="/ch7/ch7.1/">7.1. QGIS 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.2/" title="7.2. Tableau 應用" class="dd-item"><a href="/ch7/ch7.2/">7.2. Tableau 應用<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/ch7/ch7.3/" title="7.3. Leafmap 應用" class="dd-item"><a href="/ch7/ch7.3/">7.3. Leafmap 應用<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/video/" title="教學影片" class="dd-item"><a href="/video/">教學影片<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/about/" title="關於我們" class="dd-item"><a href="/about/">關於我們<i class="fas fa-check read-icon"></i></a></li>
        </ul>
        <div id="shortcuts">
          <div class="nav-title">其他連結</div>
          <ul>
            <li><a class="padding" href="https://github.com/LearnCIOT/LearnCIOT.github.io"><i class='fab fa-fw fa-github'></i> GitHub</a></li>
            <li><a class="padding" href="/levels/"><i class='fas fa-fw fa-heartbeat'></i> 按照難度等級查詢</a></li>
            <li><a class="padding" href="/tags/"><i class='fas fa-fw fa-tags'></i> 按照文章標籤查詢</a></li>
            <li><a class="padding" href="/authors/"><i class='fas fa-fw fa-users'></i> 按照文章作者查詢</a></li>
          </ul>
        </div>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVisitedLinks showFooter"/>
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch showVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch showLangSwitch">
              <a class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-language" onchange="location = baseUri + this.value;">
                    <option id="en" value="/en/ch6/ch6.1/">English</option>
                    <option id="zh-tw" value="/ch6/ch6.1/" selected>中文</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <a class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="relearn-light" value="relearn-light" selected>Relearn Light</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </a>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks showVisitedLinks"><a class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> 清除歷史紀錄</a></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>

    <script src="/js/clipboard.min.js?1697341099" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1697341099" defer></script>
    <script src="/js/featherlight.min.js?1697341099" defer></script>
    <script src="/js/jquery.svg.pan.zoom.js?1697341099" defer></script>
    <script src="/js/mermaid.min.js?1697341099" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/theme.js?1697341099" defer></script>
  </body>
</html>
